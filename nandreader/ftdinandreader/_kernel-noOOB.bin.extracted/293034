<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
         <link href="css/master.css" type="text/css" rel="stylesheet"/>
<% cgilua.lp.include("lp/language.lp") %>
<%
local translate = translate
%>
</head>
<body>

<div class='contentcontainer'>
<div class='contentitem'>
<table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Operation failed]==])%>.</td></tr>
                             <tr><td class="errorDesc"><p><%=translate([==[Warning: the passwords are not identical. Verify that the password entered in the "Set Password" and "Repeat Password" are identical]==])%></p>
							<br/>
        </td></tr></table>
        </td></tr>
		<tr><td>
         <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
          <tr><td class="width340">&nbsp;</td>
            <td class="verticalAlign">
				   <a href="./loginMgm.lp">
				<div name="thb11" class="midarea6-1 mainButton"><%=translate([==[Continue]==])%></div></a>
            </td></tr>
        </table>
    </td>
</tr>
</table>
</div>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
<link rel="stylesheet" href="css/style.css" type="text/css" />
<% cgilua.lp.include("lp/language.lp") %>
</head>
<body>
<div style="position:absolute; left:20px; top:5px; width:670px; height:690px; z-index:1; overflow: auto; "><!--questo e' il layer scrollabile che include la tabella ed evita la scrollbar orizzontale nell'iframe-->

<table border="0" width="640">
	<tr>
		<td class="titolo">Info</td>
	</tr>
	<tr><td>
	<table width="640" id="table20" border="1" class="tableBg">
	<tr>
		<td class="trScura">&nbsp;<%=translate([==[Operation failure]==])%></td>
	</tr>
	<tr>
		<td class="tdBiancaC">
		<p><%=translate([==[Rule already active]==])%></p>
		<p><%=translate([==[Warning: Verify that the IP address, the inner door and / or the external port configured]==])%><br/><%=translate([==[have not been assigned to another rule of port mapping / virtual server]==])%>.</p> 	
		<p><%=translate([==[Press "Continue" to return to previous page]==])%></p>
        </td>
	</tr>
	</table>
	</td>
	</tr>
	<tr><td>
	<table width="640" >
	<tr>
	<td class="tdChiara50">
		<input type="button" onclick="javascript:window.history.back();" value="<%=translate([==[Continue]==])%>" name="thb11"></td>
	</tr>
	</table>
	</td></tr>
</table>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
<link rel="stylesheet" href="css/style.css" type="text/css" />
<link href="css/menu.css" type="text/css" rel="stylesheet"/>
<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp")%>
<%
	local POST=cgilua.POST

	if cgilua.servervariable"REQUEST_METHOD" == "POST" then
		local page = "/"
		local round = "2"
		if POST["page"]~=nil and POST["page"]~="" then
			page = tostring(POST["page"])
		end
		
		if page=="statoPortMapping.lp" then
			round = "3"
		end
		
		saveall(0, 1)
		cgilua.redirect("save_alert.lp", { u = page, r = round })
		return	
	end
%>
</head>
<body>
<div class='contentcontainer'>
<div class='contentitem'>
<form name="saveResult" method="post" action="">
<input type="hidden" id="page" name="page" value="<%=cgilua.QUERY["page"]%>" />
<table cellspacing='0' cellpadding='0' width="100%">
<tr>
    <td class='icon' style='vertical-align:top' width='100px'><img src='images/warn__xl.gif' alt='Technicolor Gateway'></td>
    <td class='data' style='vertical-align:top'>
        <table cellspacing='0' cellpadding='0' width="100%">
        <tr><td>
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td style='vertical-align:top'>
            <span class='itemtitle'>Info</span><br/><br/>
            <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage">
            <tr><td class="trScura"><%=translate([==[Operation performed]==])%></td></tr>
            <tr><td class="tdBiancaC">
                <p>&nbsp;<%=translate([==[Successfully finished]==])%></p>
                <p><%=translate([==[To make permanent configuration changes, press the "Continue"]==])%>
                <%=translate([==[Failure to save leads to zero change settings after shutdown or restart your modem]==])%></p>
                <p><%=translate([==[Press "Continue" to save the configuration or]==])%>
                <%=translate([==[press "Cancel" and manually turn off the modem to undo the changes made]==])%></p>
            </td></tr></table>
            </td></tr>
            <tr><td align='center'>
                <input type="submit" value="<%=translate([==[Continue]==])%>" name="thb11" />&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="button" onclick="javascript:document.location.href='<%=cgilua.QUERY["page"]%>'"  value="<%=translate([==[Cancel]==])%>" name="thb12" />
            </td></tr></table>
        </td></tr></table>
    </td></tr></table>
</form>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</div>
</div>
</body>
</html>
<div class='contentcontainer'>
<div class='contentitem'>
<table cellspacing='0' cellpadding='0' width="100%">
<tr>
    <td class='icon' valign='top' width='100px'><img src='images/reac__xl.gif' alt='Technicolor Gateway'></td>
    <td class='data' valign='top'>
        <table cellspacing='0' cellpadding='0' width="100%">
        <tr><td>
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td valign='top'>
            <span class='itemtitle'>Info</span><br/><br/>   
            <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage">
            <tr><td class="trScura"><%=translate([==[Operation performed]==])%></td></tr>
            <tr><td class="tdBiancaC">
                <p>&nbsp;<%=translate([==[User created successfully]==])%></p>
            </td></tr></table>
            </td></tr>
            <tr><td align='center'>
                <input type="button" class="button" onclick="redirectConfirm()" value="<%=translate([==[Continue]==])%>" name="thb11">
            </td></tr>
            </td></tr></table>
        </td></tr></table>
</td></tr></table>
</div>
</div>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
         <link href="css/master.css" type="text/css" rel="stylesheet"/>
		 <link href="css/master1.css" type="text/css" rel="stylesheet"/>
		 <link href="css/layout.css" type="text/css" rel="stylesheet"/>
<% cgilua.lp.include("lp/language.lp") 
cgilua.lp.include("lp/device.lp") %>
<%
local translate = translate
%>
</head>
<body>
<div id="container">

<div style="float:right; color: grey; margin: -25px 15px 0;font-size:11px;">Release Modem: <%=getVersion()%></div>
<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0"  leftmargin="0" topmargin="0">
	<tr>
	


<div id="content">
	<td height="500" width="835" style='vertical-align:top;padding-top:20px'>
<div class='contentcontainer'>
<div class='contentitem'>
<table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Operation failed]==])%>.</td></tr>
                             <tr><td class="errorDesc"><p><%=translate([==[Attention: the password you entered were not identical. Make sure that the password entered in the fields "Set Password" and "Confirm Password" are identical.]==])%></p>
							<br/>
        </td></tr></table>
        </td></tr>
		<tr><td>
         <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
          <tr><td class="width340">&nbsp;</td>
            <td class="verticalAlign">
				   <a onclick="cancelConfirm()">
				<div class="midarea6-1 mainButton"><%=translate([==[Continue]==])%></div></a>
            </td></tr>
        </table>
    </td>
</tr>
</table>
</div>
</div>

</td>

</div>
</tr>
</table>

</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
         <link href="css/master.css" type="text/css" rel="stylesheet"/>
		 <link href="css/master1.css" type="text/css" rel="stylesheet"/>
		 <link href="css/layout.css" type="text/css" rel="stylesheet"/>
<% cgilua.lp.include("lp/language.lp")
	cgilua.lp.include("lp/device.lp")
 %>
<%
local translate = translate
%>
</head>
<body>
<div id="container">

<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0"  leftmargin="0" topmargin="0">
	<tr>
	
	

<div id="content">
	<td height="500" width="835" style='vertical-align:top;padding-top:20px'>
<div class='contentcontainer'>
<div class='contentitem'>
<table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Operation failed]==])%>.</td></tr>
                             <tr><td class="errorDesc"><p><%=translate([==[Attention: The password entered is not valid. Make sure that the password entered respect the minimum and maximum length allowed or not that contain special character or symbols will not allowed.]==])%></p>
							 <br/>
        </td></tr></table>
        </td></tr>
		<tr><td>
         <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
          <tr><td class="width340">&nbsp;</td>
            <td class="verticalAlign">
				   <a onclick="cancelConfirm()">
				<div class="midarea6-1 mainButton"><%=translate([==[Continue]==])%></div></a>
            </td></tr>
        </table>
    </td>
</tr>
</table>
</div>
</div>
</td>

</div>
</tr>
</table>

</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Modem Telecom Italia</title>
<link rel="stylesheet" href="css/master.css" type="text/css">
<script language="javascript" type="text/javascript" src="js/script.js"></script>
<script language="javascript" src="js/xp_progress.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Language" content="it">
</head>
<body>
<div class='contentcontainer'>
<div class='contentitem'>
<table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Saving]==])%>.</td></tr>
            <tr><td class="errorDesc"><p><%=translate([==[Please wait]==])%>...</p><p><%=translate([==[Saving settings in progress]==])%>!<br>
		<%=translate([==[When you finish the page will be redirected automatically]==])%>!
		</p>

		<div align="center" class="padtop10">
<script type="text/javascript">
<%
local round = "1"

if cgilua.QUERY["u"]~=nil and cgilua.QUERY["u"]~="" then
  local param = cgilua.urlcode.escape(cgilua.QUERY["u"])
  if cgilua.QUERY["uparam"]~=nil and cgilua.QUERY["uparam"]~="" then
    param = param .. "?u=" .. cgilua.QUERY["uparam"]
  end
%>
var bar1= createBar(300,15,'white',1,'black','#53669e',85,7,<%=round%>,'javascript:location.href="<%=cgilua.urlcode.unescape(param)%>";');
<% else %>
var bar1= createBar(300,15,'white',1,'black','#53669e',85,7,<%=round%>,'javascript:window.history.back();');
<% end %>
</script>
		</div>
		<br/></td></tr></table><br/>
		</td></tr>
		</table>
        </td></tr></table>
    </td>
</tr>
</table>
</div>
</div>

</body>
</html>


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<title>Modem Telecom Italia</title>

<!-- <link rel="stylesheet" href="css/style.css" type="text/css"> -->
<link rel="stylesheet" href="css/master.css" type="text/css">

<script language="javascript" type="text/javascript" src="js/script.js"></script>

<script language="javascript" src="js/xp_progress.js"></script>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="Content-Language" content="it">

</head>

<body>


<div class='contentcontainer'>
<div class='contentitem'>
<table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Saving]==])%>.</td></tr>
            <tr><td class="errorDesc">
		<p><%=translate([==[Please wait]==])%>...</p><p><%=translate([==[Saving settings in progress]==])%>!<br>

		<%=translate([==[When you finish the page will be redirected automatically]==])%>!

		<p>

		<div align="center">
<script src="js/antiCSRF.js"></script>
<script type="text/javascript">

<%

local round = "2"

if cgilua.QUERY["r"]~=nil and cgilua.QUERY["r"]~="" then

  round = cgilua.urlcode.escape(cgilua.QUERY["r"])

end



if cgilua.QUERY["u"]~=nil and cgilua.QUERY["u"]~="" then

  local param = cgilua.urlcode.escape(cgilua.QUERY["u"])

  if cgilua.QUERY["uparam"]~=nil and cgilua.QUERY["uparam"]~="" then

    param = param .. "?u=" .. cgilua.QUERY["uparam"]

  end

%>

var bar1= createBar(300,15,'white',1,'black','#53669e',85,7,<%=round%>,'javascript:location.href="<%=param%>";');

<% else %>

var bar1= createBar(300,15,'white',1,'black','#53669e',85,7,<%=round%>,'javascript:window.history.back();');

<% end %>



function sajax_init_object() {

        var A;

        try {

                A=new ActiveXObject("Msxml2.XMLHTTP");

        } catch (e) {

                try {

                        A=new ActiveXObject("Microsoft.XMLHTTP");

                } catch (oc) {

                        A=null;

                }

        }

        if(!A && typeof XMLHttpRequest != "undefined")

                A = new XMLHttpRequest();

        return A;

}
	
	rn = encodeURIComponent(rn);

        var urlStr = "/ipmod.lp";

	var params="rn="+rn;

        var xobj = sajax_init_object();    

	xobj.open('POST',urlStr,true);

	xobj.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

	xobj.setRequestHeader("Content-length", params.length);

	xobj.setRequestHeader("Connection", "close");

	xobj.send(params);


</script>

		</div>

		<br/></td></tr></table><br/>
		</td></tr>
		</table>
        </td></tr></table>
    </td>
</tr>
</table>
</div>
</div>


</body>

</html>


<%
local reply, error = mbus.getParameters{path = "ENV._BOARD_NAME", param = {"Value"}, flags="KEYPATH" }
cgilua.print(tostring(reply["ENV._BOARD_NAME"][1].param["Value"]))
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Modem Telecom Italia</title>
<link rel="stylesheet" href="css/master.css" type="text/css"/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script language="javascript" type="text/javascript" src="js/script.js"></script>
    <script language="JavaScript" type="text/javascript">
	
	if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="";
	}
	
	if(window.parent.menu.document.getElementById("teleSub")!=null && 
		window.parent.menu.document.getElementById("teleSub") != "undefinded") {
		window.parent.menu.document.getElementById("teleSub").style.display="none";	
	}

	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="";
	}

	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}

	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
		if(window.parent.menu.document.getElementById("ipv6list")) {
			window.parent.menu.document.getElementById("ipv6firewall").className="";
			window.parent.menu.document.getElementById("ipv6list").style.display="none";
		}
	}

	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {
		window.parent.menu.document.getElementById("port").className="";
	}

	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="submenuselect1";
	}
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {
		window.parent.menu.document.getElementById("urlfi").className="";
	}

	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {
		window.parent.menu.document.getElementById("waon").className="";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {
		window.parent.menu.document.getElementById("stru").className="";
	}	
  </script>
</head>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/style.lp") %>
<%
local translate = translate
local POST = cgilua.POST

function get_fw_state()
	local fw_data, error = mbus.getParameters{path = "Device.Firewall", param = "Config", datamodel = "second"}
	local fw_state = fw_data["Device.Firewall"][1].param["Config"]
	return fw_state
end

local fw_active = get_fw_state()
if cgilua.servervariable"REQUEST_METHOD" == "POST" then
	local modify={}
	local ret

	if POST["gui_fwstate"] == "1" and fw_active ~= "Low" then
		table.insert(modify, {path="Device.Firewall", param = {Config="Low"}, datamodel = "second"})
		ret = setMBUS_IGD(modify)
		if ret then
			fw_active = "Low"		
			saveall(15, 1)
		end

	elseif POST["gui_fwstate"] == "0" and fw_active ~= "Off" then
		table.insert(modify, {path="Device.Firewall", param = {Config="Off"}, datamodel = "second"})
		ret = setMBUS_IGD(modify)
		if ret then
			fw_active = "Off"		
			saveall(15, 1)
		end
	end
end

%>
	<body>
		<div class="contentContainer">
	 
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li><li><a href="simpleFirewall.lp"><%=translate([==[Firewall]==])%></a></li>
			</ul>
		</div>	
		
		
		
		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a class="current">
		<div class="tab">
			<span class="tabIcon_fire"></span>  
			<span class="contTabTxt transform"><%=translate([==[Configure firewall]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
			</ol>
		</div>
		
<div class="contentcontainer"> 

<form id="firewall" name="firewall" method="post" action="">
<div class='contentitem' class="fontSize">
<%
   writePageHeader_new()
   writeTableRowNoTitle()
 
%>
	<tr>
	<td  class=" fontSize tableTitle paddtop10"  style="width:300px;"><%=translate([==[firewall status]==])%></td>
	<td class=" fontSize tableTitle paddtop10"><%=translate([==[description]==])%></td >
	</tr>
<tr> <td align='center' colspan="2">&nbsp;</td></tr>
   <tr >
        <td  class=" oddrow_firewall firewallRow fontSize" >
       <input type="radio" value="0" id="fw_not_active" name="gui_fwstate">&nbsp;<%=translate([==[Inactived]==])%></td>
        <td class="oddrow_firewall firewallRow fontSize">
        <%=translate([==[Firewall off: disables controls on TCP/UDP maintaining the configuration of the virtual server, DMZ and Port Mapping]==])%>.
		</td>
    </tr>
	
	<tr>
        <td class=" evenrow_firewall firewallRow fontSize" >
		<input type="radio" value="1" id="fw_active" name="gui_fwstate" >&nbsp;<%=translate([==[Actived]==])%>&nbsp;<%=translate([==[(Basic protection)]==])%></td>
        <td class=" evenrow_firewall firewallRow fontSize" >
        <%=translate([==[Firewall active: blocks incoming connections without affecting the configuration of the DMZ, Virtual Server and Port Mapping]==])%>.</td>
    </tr>
	
	<!-- <tr><td></br></td></tr> -->
	<tr>
                   <td align='center' colspan="2">
			  <table border='0' cellspacing='0' cellpadding='0' width='100%' class="fontSize padtop10 txtAlignCenter">
	<tr>
					<td style="float:right;text-align:left">
				<a href ="javascript:submitFire()" style="float:right;text-align:left">
				<div name="thb8" class="midarea6-1 mainButton"><%=translate([==[Save]==])%></div></a>
				</td>
				<td style="padding-left:50px">
				<a href ="advance.lp">
				<div name="thb10" class="midarea6-1 secondaryButton"><%=translate([==[Back]==])%></div></a>
				</td>
				</tr>
				</table>
				</td></tr>
    <!-- <tr><td align='center'>
        <br/>
        <input type="submit" value="<%=translate([==[Save]==])%>" name="thb8"/>&nbsp;&nbsp;&nbsp;&nbsp;
        <input type="button" onclick='javascript: document.location.href="advance.lp";' value="<%=translate([==[Back <]==])%>" name="thb10"/>
    </td></tr> -->
<%
   endBlock()
   endPage()
%>
</div>
</form>
</div>
</div>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</body>
</html>

<script language="javascript">
var active = "<%=fw_active%>";
//alert(active)
function submitFire() {
	document.firewall.submit();
}
if(active == "Low"){
        document.getElementById("fw_active").checked = true;
}else{
        document.getElementById("fw_not_active").checked = true;
}
</script>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Modem Telecom Italia</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <!-- <link rel="stylesheet" href="css/style.css" type="text/css" /> -->
  <link rel="stylesheet" href="css/master.css" type="text/css" />
  <script language="javascript" type="text/javascript" src="js/script.js"></script>
  <script language="JavaScript" type="text/javascript">
    if(window.parent.menu.document.getElementById("base")!=null && 
		window.parent.menu.document.getElementById("base") != "undefinded") {

	}   
	if(window.parent.menu.document.getElementById("stcon")!=null && 
		window.parent.menu.document.getElementById("stcon") != "undefinded") {
		window.parent.menu.document.getElementById("stcon").className="";
	}
	
	if(window.parent.menu.document.getElementById("serte")!=null && 
		window.parent.menu.document.getElementById("serte") != "undefinded") {
		window.parent.menu.document.getElementById("serte").className="";
	}

	if(window.parent.menu.document.getElementById("lanst")!=null && 
		window.parent.menu.document.getElementById("lanst") != "undefinded") {
		window.parent.menu.document.getElementById("lanst").className="";
	}

	if(window.parent.menu.document.getElementById("wifist")!=null && 
		window.parent.menu.document.getElementById("wifist") != "undefinded") {
		window.parent.menu.document.getElementById("wifi2li").style.display="none";
		window.parent.menu.document.getElementById("wifi5li").style.display="none";
		window.parent.menu.document.getElementById("wifi_guestli").style.display="none";
		window.parent.menu.document.getElementById("wifist").className="";
		window.parent.menu.document.getElementById("wifi2").className="";
		window.parent.menu.document.getElementById("wifi5").className="";
		window.parent.menu.document.getElementById("wifi_guest").className="";
	}

	if(window.parent.menu.document.getElementById("asst")!=null && 
		window.parent.menu.document.getElementById("asst") != "undefinded") {
		window.parent.menu.document.getElementById("asst").className="";
	}

	if(window.parent.menu.document.getElementById("stat")!=null && 
		window.parent.menu.document.getElementById("stat") != "undefinded") {
		window.parent.menu.document.getElementById("stat").className="";
	}
	if(window.parent.menu.document.getElementById("loac")!=null && 
		window.parent.menu.document.getElementById("loac") != "undefinded") {
		window.parent.menu.document.getElementById("loac").className="";
	}
	
  </script>
</head>
<body>

<% cgilua.lp.include("lp/menu.lp") %>
<% cgilua.lp.include("lp/device.lp") %>

<div class="contentContainer">
	 
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="standard.lp"><%=translate([==[Basic Settings]==])%></a></li>
			</ul>
		</div>	

		


<div class='contentcontainer'>
<div class='contentitem'>
<table cellspacing="0" cellpadding="0" border="0"  class="table2 fontSize width750" style="padding-top:10px;margin-left:0px;">
  
  <tr> 
    <td class="tablecontaint2 padleft40 fontSize">
      <p><%=translate([==[The modem Telecom Italia offers more services]==])%>.</p><p>&nbsp;</p>
      <p><%=translate([==[Those services enable you to protect your network, to ease sharing of games and applications with other people on the Internet, or manage your local network.]==])%></p>
      <table border='0' cellspacing='0' cellpadding='0' class="marleft40">
	  <tr><td colspan='3'><img src='/images/spacer.gif' width='0' height='25' border='0' alt=''><br></td></tr>
	  <tr>
	  <td><img src='/images/spacer.gif' width='265' height='1' border='0' alt=''><br></td>
	  <td><img src='/images/spacer.gif' width='20' height='1' border='0' alt=''><br></td>
	  <td><img src='/images/spacer.gif' width='265' height='1' border='0' alt=''><br></td></tr>
	  
      <%
	printLeftBlock("wanStatus.lp", "bbc__xl.png", translate([==[Connection Status]==]))
	printRightBlock("statoServizi.lp", "cintorxl.png", translate([==[Telecom Italia Services]==]))
	printLeftBlock("lanStatus.lp", "ieth__xl.png", "LAN")
	printRightBlock("wlanStatus.lp?wifiPage=wifi", "iwla__xl.png", "Wi-Fi")
        printLeftBlock("helpAssistenza.lp", "tech__xl.png", translate([==[Assistance]==]))
	printRightBlock("statisticsAG.lp", "stxx__xl.png", translate([==[Statistics]==]))
	if isRemoteAccess()==false then
	        printLeftBlock("loginMgm.lp", "isec__xl.png", translate([==[Local Access]==]))
	end
      %>
</table></td></tr></table></td></tr></table>
</div>
</div>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Modem Telecom Italia</title>
<link rel="stylesheet" href="css/master.css" type="text/css">
<link href="css/master.css" rel="stylesheet" type="text/css" />
<link href="css/layout.css" rel="stylesheet" type="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<%
cgilua.lp.include("lp/device.lp")
local tprint=require("tableprint")
local POST = cgilua.POST
local modify = {}

local redirectPage="home.lp"

if cgilua.QUERY["fromPage"] ~= nil and cgilua.QUERY["fromPage"] =="wlanGuestConfig" then
	redirectPage = "wlanGuestConfig.lp?display=fromStartup"
end


if cgilua.servervariable"REQUEST_METHOD" == "POST" then

	--if configure button is clicked otherwise "cancel" button is not pressed
	if ( POST["cancel"] ~= nil and POST["cancel"] ~= "1") then 
		if( POST["confpw"] ~= nil and POST["newpw"] ~= nil ) then



			
			local reply, error = mbus.modify(
					function()
						local reply, error = mbus.setParameters{ path="TI_STORE.TiUserIntf", param = {PasswordRequired="true", AdminPassword=POST["newpw"]} }
					end)

			local userpath="Users.User"
			local reply, error = mbus.modify(
					function()
						local reply, error = mbus.setParameters{ path=userpath, param={Password=POST["newpw"]}, filter="(== Name admin)"}
					end)
					
			saveall(0,1)
			cgilua.redirect("save_alert.lp", { u = redirectPage })
		end	
	else
		--cancel is clicked
		if( POST["dontshow"] ~= nil and POST["dontshow"] == "on" ) then




		    --set the env variable here...
			local isDontShowChecked = ""
			local reply, error = mbus.getParameters{ path = "ENV", param = "Value", filter = "(== Name ".. "isDontShowChecked" ..")" }
			if reply["ENV"][1]~=nil and reply["ENV"][1].param~=nil then
				isDontShowChecked = reply["ENV"][1].param["Value"]
			end

					
			if isDontShowChecked=="" then
				local reply, error = mbus.modify(
				function()
					local reply, error = mbus.addObjects{path = "ENV", param = {Value = "true", Name = "isDontShowChecked"}}
				end)
			else
				local replyPath, errorPath = mbus.getParameters{ path = "ENV", param = { "Name", "Value" }, filter = "(== Name ".. "isDontShowChecked" ..")" }
				local showStartUpPath = replyPath["ENV"][1].path
				table.insert(modify, {path = showStartUpPath, param = {Value = "true"}})
				setMBUS(modify)
			end
			
		end
		cgilua.redirect(redirectPage)
	end	
end

local low = translate([==[Low]==])
local medium =  translate([==[Medium]==])
local high = translate([==[High]==])

%>
<script type="text/javascript">
function change_pwd()
{
tmp = checkPassword();
    
	var strength = document.getElementById("encryptionKeyStrengthDesc").innerHTML;
	
    if(1==tmp)
	{
		document.getElementById("set_pwd_table").style.display = "none";
		document.getElementById("result_start_identical").style.display = "block";
		return false;
		
	}   
    else if( (strength == "<%=translate([==[Low]==])%>") || (2==tmp) )
	{
		document.getElementById("set_pwd_table").style.display = "none";
		document.getElementById("result_start_fail").style.display = "block";
		return false;		
	}
	
	//check the keystrength.
	
	if(strength == "<%=translate([==[Medium]==])%>") 
	{
		document.getElementById("set_pwd_table").style.display = "none";
		document.getElementById("confirm_passwd_set").style.display = "block";
		return false;
	}
	submitConfirm();
}

function isValidPassward(str)
{
	var reg = /^[\da-zA-Z]{4,8}$/;
	//var reg = /^[\da-zA-Z!@#$%^&*()+\-={}?_~\[\]`|;:\\]{4,8}$/;
	//alert("reg"+ reg.test(str));
	return reg.test(str);
}
var passwordnew;
var passwordverif;
function checkPassword()
{
  passwordnew=document.getElementById("newpw");
  passwordverif=document.getElementById("confpw");

  if( passwordnew && passwordverif && passwordnew.value!=passwordverif.value)
  {   
	passwordnew=document.getElementById("newpw").value;
	passwordverif=document.getElementById("confpw").value;	
    return 1;
  }

  if ((!isValidPassward(passwordnew.value))||(!isValidPassward(passwordverif.value))||(passwordnew.value.indexOf(" ")!=-1))
  {  
	passwordnew=document.getElementById("newpw").value;
	passwordverif=document.getElementById("confpw").value;	 
    return 2;
  }

  return 0;
}

function submitConfirm()
{
  document.getElementById("form1").submit();  
}

function cancelConfirm()
{
  document.getElementById("newpw").value = "";
  document.getElementById("confpw").value = "";
  document.getElementById("set_pwd_table").style.display = "block";
  document.getElementById("confirm_passwd_set").style.display = "none";
  document.getElementById("result_start_fail").style.display = "none";
  document.getElementById("result_start_identical").style.display = "none";
  document.getElementById("keyStrength").style.display="none";
}

var desc = new Array();
	
desc[1] = "<%=low%>";
desc[2] = "<%=medium%>";
desc[3] = "<%=high%>";
	
	
function indicateEncryptionKeyStrength(password,id)
{

	//alert(id);
    if( id == "keyStrength")
	{
	//alert("blocking to keystren");
		document.getElementById("keyStrength").style.display="block";
	}
	
	
	var score   = 1;
//	var isSpecialCharExists = false;	
	var isAlphaNumericCharExists = false;
	var isAnyAlphaExists = false;
	var length =  password.length;
	
	
	
	//is any uppercase, lowervase and a number presents
	isAlphaNumericCharExists = (( password.match(/[a-z]/) ) && ( password.match(/[A-Z]/) )  && ( password.match(/\d+/) ));
	isAnyAlphaExists = (( password.match(/[a-z]/) ) || ( password.match(/[A-Z]/) )  || ( password.match(/\d+/) ));
	//if password has at least one special caracther give 1 point
	//isSpecialCharExists =  password.match(/.[!,@,#,$,%,^,&,*,(,),+,\-,=,{,},?,_,~,\[,\],`,|,;,:,\\]/);
	
	
	if ( length >= 4  && isAlphaNumericCharExists ) {
			score = 2;
		}
    if ( length == 8  && isAlphaNumericCharExists ){
		score = 3;
	}	
	
	if( isValidPassward(password) == false )
	{
		score = 1;
	}
	//document.getElementById("encryptionKeyStrengthDesc").innerHTML = desc[score];
	//document.getElementById("encryptionKeyStrength").className = "strength" + score;
	
	if( id == "keyStrength" )
	{
		//alert("assigning to keystreng");
		document.getElementById("encryptionKeyStrengthDesc").innerHTML = desc[score];
		document.getElementById("encryptionKeyStrength").className = "strength" + score;	
	}

	return score;
}
	
function fnRedirect()
{
	var check =	document.form1.dontshow.checked;
	document.getElementById("cancel").value = "1";
	submitConfirm();
}
</script>
</head>
<body>


<div>

<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0"  leftmargin="0" topmargin="0">
	<tr>	

<div id="content">
	<td height="500" width="835" style='vertical-align:top;padding-top:20px'>
<div>
<div id="confirm_passwd_set" style="display:none">
<%cgilua.lp.include("webparts/resultStartFail.lp")%>
</div>
<div id="result_start_fail" style="display:none">
<div class='contentcontainer'>
<div class='contentitem1'>
<table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Operation failed]==])%>.</td></tr>
                             <tr><td class="errorDesc"><p><%=translate([==[Warning: The password you entered is not valid. Make sure the passwords are to respect the minimum and maximum allowed, which contain at least one character of each of the following sets: [0-9], [a - z], [A - Z], or does not contain special characters or symbols not allowed]==])%></p>
							 <br/>
        </td></tr></table>
        </td></tr>
		<tr><td>
         <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
          <tr><td class="width340">&nbsp;</td>
            <td class="verticalAlign">
				   <a style='color:black' onclick="cancelConfirm()">
				<div class="midarea6-1 mainButton"><%=translate([==[Continue]==])%></div></a>
            </td></tr>
        </table>
    </td>
</tr>
</table>
</div>
</div>
</div>
<div id="result_start_identical" style="display:none">
<div class='contentcontainer'>
<div class='contentitem1'>
<table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Operation failed]==])%>.</td></tr>
                             <tr><td class="errorDesc"><p><%=translate([==[Attention: the password you entered were not identical. Make sure that the password entered in the fields "Set Password" and "Confirm Password" are identical.]==])%></p>
							 <br/>
        </td></tr></table>
        </td></tr>
		<tr><td>
         <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
          <tr><td class="width340">&nbsp;</td>
            <td class="verticalAlign">
				   <a style='color:black' onclick="cancelConfirm()">
				<div class="midarea6-1 mainButton"><%=translate([==[Continue]==])%></div></a>
            </td></tr>
        </table>
    </td>
</tr>
</table>
</div>
</div>
</div>


<div id="set_pwd_table">
<form id="form1" name="form1" action="" method="post">

<input type="hidden" name="cancel" id="cancel" value="0"/>

<div class='contentcontainer'>

<div class='contentitem1'>
<table cellspacing='0' cellpadding='0' width="90%">
<tr><td width="5%">&nbsp;</td>
    <td class='icon' style='vertical-align:top;padding-right:15px' style='vertical-align:top' width='60px'><img src='images/user__xl.png' alt='Technicolor Gateway'></td>
    <td class='data' style='vertical-align:top'>
        <table cellspacing='0' cellpadding='0' width="100%">
        <tr><td>
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td style='vertical-align:top'>

			<span style='padding-top:0px;font-weight:bold;font-size:12px' class='midarea2_telmain verticalAlign'><%=translate([==[Warning: not configured a password for access to the pages of Management modem.]==])%><br><%=translate([==[It is recommended for safety reasons to set this password.]==])%><br><%=translate([==[The configuration makes must enter the password each time you access to the pages of modem management.]==])%></span>
			
			<br /><br />
            <table width='94%' cellspacing='0' cellpadding='0' class="PageMessage">
			<tr><td colspan="2"><%=translate([==[The password must be from 4 to 8 characters long and contain at least one character of each of the following sets [0-9], [a - z], [A - Z].]==])%></td></tr>
			<tr height="20">
				<td colspna="2"></td>
			</tr>
            <tr><td class="tdBianca" align="right" style="padding-right:75px"><%=translate([==[Set Password: ]==])%></td><td><input name="newpw" id="newpw" value="" onkeyup="indicateEncryptionKeyStrength(this.value,'keyStrength')" autocomplete="off" size="12" maxlength="8" style="font-weight: 700" type="password">&nbsp;&nbsp;<b>[ 4 - 8 <%=translate([==[characters]==])%> ]</b></td></tr><br /><br />
				<tr><td></td><td class="tdBianca" rowspan="1" align="left">
			<table border="0" cellspacing="0" cellpadding="0" id="keyStrength" style="display:none">
			<tr>
			
			<td>				
			<table>
				<tr>
					<td>
					<div id="encryptionKeyStrengthDesc" value="Low">Low</div>
					</td>
				</tr>
				<tr>
					<td>
					<div id="encryptionKeyStrength" class="strength0"></div>	
					</td>
				</tr>
			</table>
			</td>
			</tr>
			</table></td></tr>
			
	<tr><td>&nbsp;</td></tr>
	<tr><td>&nbsp;</td></tr>
            <tr><td class="tdBianca" align="right" style="padding-right:75px"><%=translate([==[Repeat Password: ]==])%></td><td><input name="confpw" id="confpw" value="" autocomplete="off" size="12" maxlength="8" style="font-weight: 700" type="password">&nbsp;&nbsp;<b>[ 4 - 8 <%=translate([==[characters]==])%> ]</b></td></tr><br /><br />
			
		</table><br/>
                   </td></tr>

				   <table cellspacing='0' cellpadding='0' width='100%' style="text-align:center;margin-left:50px" class='padtop10'>
                   <tr >
                   <td class="fright">
						<a class="fright" style='color:black;' onclick='javascript:change_pwd();'><div class='midarea6-1 mainButton' name="thb8"><%=translate([==[Configure]==])%></div></a>
					</td>
					 <td style="vertical-align:top">
						<a onclick="return fnRedirect()"><div name="thb9" class='midarea7-4 secondaryButton'><%=translate([==[Continue without setting password]==])%></div></a></td>
				</tr>
				</table>
				<tr align="left"><td><span class="alignMid"><input type="checkbox" id="dontshow" class="alignMid" name="dontshow"></span>&nbsp;&nbsp;<span class="alignMid">(<%=translate([==[Dont show any more]==])%>)</span></td></tr>
                   </table>
        </td></tr></table>
    </td>
</tr>
</table>
</div>
</div>
</form>
</div>
</div>
</td>
</div>
</tr>
</table>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</div>
</body>
</html>

	 
	
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Modem Telecom Italia</title>
	<link rel="stylesheet" href="css/master.css" type="text/css" />
  <script language="JavaScript" type="text/javascript">
    if(window.parent.menu.document.getElementById("stcon")!=null && 
		window.parent.menu.document.getElementById("stcon") != "undefinded") {
		window.parent.menu.document.getElementById("stcon").className="";
	}
	
	if(window.parent.menu.document.getElementById("serte")!=null && 
		window.parent.menu.document.getElementById("serte") != "undefinded") {
		window.parent.menu.document.getElementById("serte").className="";
	}

	if(window.parent.menu.document.getElementById("lanst")!=null && 
		window.parent.menu.document.getElementById("lanst") != "undefinded") {
		window.parent.menu.document.getElementById("lanst").className="";
	}

	if(window.parent.menu.document.getElementById("wifist")!=null && 
		window.parent.menu.document.getElementById("wifist") != "undefinded") {
		window.parent.menu.document.getElementById("wifi2li").style.display="none";
		window.parent.menu.document.getElementById("wifi2li").style.display="none";
		window.parent.menu.document.getElementById("wifi5li").style.display="none";
		window.parent.menu.document.getElementById("wifist").className="";
		window.parent.menu.document.getElementById("wifi2").className="";
		window.parent.menu.document.getElementById("wifi5").className="";
		window.parent.menu.document.getElementById("wifi_guest").className="";
	}

	if(window.parent.menu.document.getElementById("asst")!=null && 
		window.parent.menu.document.getElementById("asst") != "undefinded") {
		window.parent.menu.document.getElementById("asst").className="";
	}

	if(window.parent.menu.document.getElementById("stat")!=null && 
		window.parent.menu.document.getElementById("stat") != "undefinded") {
		window.parent.menu.document.getElementById("stat").className="submenuselect";
	}
	if(window.parent.menu.document.getElementById("loac")!=null && 
		window.parent.menu.document.getElementById("loac") != "undefinded") {
		window.parent.menu.document.getElementById("loac").className="";
	}


	
  </script>
</head>
<%
cgilua.lp.include("lp/mbus_util.lp")
cgilua.lp.include("lp/common.lp")
cgilua.lp.include("lp/dsl.lp")
cgilua.lp.include("lp/ppp.lp")
cgilua.lp.include("lp/style.lp")
cgilua.lp.include("lp/connectionService.lp")


local translate = translate
local POST=cgilua.POST

-- ATM
local reply, error = mbus.getParameters{path = "Device.ATM.Link.1", param = "Enable", datamodel = "second"}
local atmEnable = reply["Device.ATM.Link.1"][1].param["Enable"]

-- DSL
local reply, error = mbus.getParameters{path = "Device.DSL.Line.1", param = {"Enable", "FirmwareVersion", "PowerManagementState"}, datamodel = "second"}
local dslEnable = reply["Device.DSL.Line.1"][1].param["Enable"]

if cgilua.servervariable"REQUEST_METHOD" == "POST" then
	ResetTrafficStat()
	if dslEnable == "true" or atmEnable == "true" then
		ResetADSLStat()
	end

	cgilua.redirect("statisticsAG.lp")
	return
end

--DSL paratmeter 
local dsl = getDSLInfo()

if dslEnable == "true" then
  dsl.fwVersion = reply["Device.DSL.Line.1"][1].param["FirmwareVersion"]
  dsl.pmState = reply["Device.DSL.Line.1"][1].param["PowerManagementState"]

  reply, error = mbus.getParameters{path = "Device.DSL.Line.1.Stats.Total", param = {"ErroredSecs", "SeverelyErroredSecs"}, datamodel = "second"}
  dsl.dslErroredSecs = reply["Device.DSL.Line.1.Stats.Total"][1].param["ErroredSecs"]
  dsl.dslSeverelyErroredSecs = reply["Device.DSL.Line.1.Stats.Total"][1].param["SeverelyErroredSecs"]
  if dsl.dslErroredSecs == "2147480000" then dsl.dslErroredSecs = "0" end
  if dsl.dslSeverelyErroredSecs == "2147480000" then dsl.dslSeverelyErroredSecs = "0" end

  dsl.dslState = translate([==[Unsynchronized]==])
  dsl.dslStateColor = "tdRed"
  if dsl.dsl_status == "Up" then
    dsl.dslState = translate([==[Actived]==])
    dsl.dslStateColor = "tdGreen"
  elseif dsl.dsl_status == "Initializing" then
    dsl.dslState = translate([==[In sync]==])
    dsl.dslStateColor = "tdOrange"
  end

  dsl.dslModulationType = ""
  if dsl.dsl_ModulationType == "ADSL_G.dmt" then
    dsl.dslModulationType = "ADSL"
  elseif dsl.dsl_ModulationType == "ADSL_G.dmt.bis" then
    dsl.dslModulationType = "ADSL2"
  elseif dsl.dsl_ModulationType == "ADSL_2plus" then
    dsl.dslModulationType = "ADSL2+"
  elseif dsl.dsl_ModulationType == "VDSL" then
    dsl.dslModulationType = "VDSL"
  end

  reply, error = mbus.getParameters{path = "Device.DSL.Channel.1", param = {"LinkEncapsulationUsed", "ACTINP", "UpstreamCurrRate", "DownstreamCurrRate"}, datamodel = "second"}
  dsl.LinkEncapsulationUsed = "ATM"
  if string.sub(tostring(reply["Device.DSL.Channel.1"][1].param["LinkEncapsulationUsed"]), -3, -1) == "PTM" then
    dsl.LinkEncapsulationUsed = "PTM"
  end
  dsl.ACTINP = reply["Device.DSL.Channel.1"][1].param["ACTINP"]
  dsl.UpstreamCurrRate = reply["Device.DSL.Channel.1"][1].param["UpstreamCurrRate"]
  dsl.DownstreamCurrRate = reply["Device.DSL.Channel.1"][1].param["DownstreamCurrRate"]

  reply, error = mbus.getParameters{path = "Device.DSL.Channel.1.Stats", param = "ShowtimeStart", datamodel = "second"}
  dsl.ShowtimeStart = reply["Device.DSL.Channel.1.Stats"][1].param["ShowtimeStart"]

  reply, error = mbus.getParameters{path = "Device.DSL.Channel.1.Stats.Total", param = {"XTURFECErrors", "XTURCRCErrors"}, datamodel = "second"}
  dsl.XTURFECErrors = reply["Device.DSL.Channel.1.Stats.Total"][1].param["XTURFECErrors"]
  dsl.XTURCRCErrors = reply["Device.DSL.Channel.1.Stats.Total"][1].param["XTURCRCErrors"]
  if dsl.XTURFECErrors == "2147480000" then dsl.XTURFECErrors = "0" end
  if dsl.XTURCRCErrors == "2147480000" then dsl.XTURCRCErrors = "0" end
end  -- dslEnable == "true"


-- ETH
local eth = {}
for i=1, 5 do
  eth[i] = getLanStatFromDev(i)
end

-- WiFi
local wifi = {}
local wifiStatsPath = "Device.WiFi.SSID.1.Stats"
reply, error = mbus.getParameters{path = wifiStatsPath, datamodel = "second"}
wifi.packetsReceived = reply[wifiStatsPath][1].param["PacketsReceived"]
wifi.packetsSent = reply[wifiStatsPath][1].param["PacketsSent"]
wifi.errorsReceived = reply[wifiStatsPath][1].param["ErrorsReceived"]
wifi.errorsSent = reply[wifiStatsPath][1].param["ErrorsSent"]

local wifi2 = {}
local wifiStatsPath = "Device.WiFi.SSID.2.Stats"
reply, error = mbus.getParameters{path = wifiStatsPath, datamodel = "second"}
wifi2.packetsReceived = reply[wifiStatsPath][1].param["PacketsReceived"]
wifi2.packetsSent = reply[wifiStatsPath][1].param["PacketsSent"]
wifi2.errorsReceived = reply[wifiStatsPath][1].param["ErrorsReceived"]
wifi2.errorsSent = reply[wifiStatsPath][1].param["ErrorsSent"]

local wifi3 = {}
local wifiStatsPath = "Device.WiFi.SSID.3.Stats"
reply, error = mbus.getParameters{path = wifiStatsPath, datamodel = "second"}
wifi3.packetsReceived = reply[wifiStatsPath][1].param["PacketsReceived"]
wifi3.packetsSent = reply[wifiStatsPath][1].param["PacketsSent"]
wifi3.errorsReceived = reply[wifiStatsPath][1].param["ErrorsReceived"]
wifi3.errorsSent = reply[wifiStatsPath][1].param["ErrorsSent"]


local wifi4 = {}
local wifiStatsPath = "Device.WiFi.SSID.4.Stats"
reply, error = mbus.getParameters{path = wifiStatsPath, datamodel = "second"}
wifi4.packetsReceived = reply[wifiStatsPath][1].param["PacketsReceived"]
wifi4.packetsSent = reply[wifiStatsPath][1].param["PacketsSent"]
wifi4.errorsReceived = reply[wifiStatsPath][1].param["ErrorsReceived"]
wifi4.errorsSent = reply[wifiStatsPath][1].param["ErrorsSent"]

-- IP
local ip_stats = {}
for i=1, 2 do
  ip_stats[i] = {}
  local ipStatsPath = "Device.IP.Interface." .. i .. ".Stats"
  reply, error = mbus.getParameters{path = ipStatsPath, datamodel = "second"}
  ip_stats[i].packetsReceived = reply[ipStatsPath][1].param["PacketsReceived"]
  ip_stats[i].packetsSent = reply[ipStatsPath][1].param["PacketsSent"]
  ip_stats[i].errorsReceived = reply[ipStatsPath][1].param["ErrorsReceived"]
  ip_stats[i].errorsSent = reply[ipStatsPath][1].param["ErrorsSent"]
end

--wan sencing type
local wanConnType, wanConnTitle = getWANConnectionType()

--telephony services
local voice = {}
for i=1, 3 do
    voice[i] = getVoiceStat(i)
end
%>
<body>

<div class="contentContainer">
	 
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="standard.lp"><%=translate([==[Basic Settings]==])%></a></li><li>|</li><li><a href="statisticsAG.lp"><%=translate([==[Statistics]==])%></a></li>
			</ul>
		</div>	

<div class="contentTab" id="content">
		<ol id="tocTab">
			<li><a href="statisticsAG.lp" class="current">
				<div class="tab">
				<span class="tabIconStatisticsAG"></span>  
				<span class="contTabTxt transform"><%=translate([==[Statistics]==])%></span>
				</div><div class="clrBth"></div></a>
			</li>
		</ol>
</div>

<div class='contentcontainer'>
<div class='contentitem'>

<table cellspacing='0' cellpadding='0' width="100%" class="fontSize"><tr>
    <td>
<%


if dslEnable == "true" then
  writeBlockRowTitle(translate([==[DSL]==]))
  writeBlockRow_Desc(translate([==[Firmware version]==]),                     dsl.fwVersion)
  writeBlockRow_Desc(translate([==[State]==]),                                dsl.dslState)
  writeBlockRow_Desc(translate([==[Transmission system]==]),                  dsl.dslModulationType)
  writeBlockRow_Desc(translate([==[Transmission mode]==]),                    dsl.latency_type)
  if dsl.dslModulationType == "VDSL" then
    local profile = ""
    local reply, error = mbus.getParameters{path = "Device.DSL.Line.1", param = "CurrentProfile", datamodel = "second"}
    if reply["Device.DSL.Line.1"][1] ~= nil and reply["Device.DSL.Line.1"][1].param ~= nil then
      profile = reply["Device.DSL.Line.1"][1].param["CurrentProfile"] or ""
    end
    writeBlockRow_Desc(translate([==[Profile]==]),                            profile)
  end
  writeBlockRow_Desc(translate([==[Power State]==]),                          dsl.pmState)
  writeBlockRow_Desc(translate([==[Maximum transmission rate]==]).." (Kbps)", dsl.upstreamMax)
  writeBlockRow_Desc(translate([==[Maximum receiving rate]==]).." (Kbps)",    dsl.downstreamMax)
  writeBlockRow_Desc("SNR Upstream (dB)",                                     dsl.up_noisemargin)
  writeBlockRow_Desc("SNR Downstream (dB)",                                   dsl.down_noisemargin)
  writeBlockRow_Desc(translate([==[Attenuation]==]).." Upstream (dB)",        dsl.up_attenuation)
  writeBlockRow_Desc(translate([==[Attenuation]==]).." Downstream (dB)",      dsl.down_attenuation)
  writeBlockRow_Desc(translate([==[Transmission power]==]).." (dB)",          dsl.up_power)
  writeBlockRow_Desc(translate([==[Receiving power]==]).." (dB)",             dsl.down_power)
  writeBlockRow_Desc(translate([==[Total ES (Errored Secs)]==]),              dsl.dslErroredSecs)
  writeBlockRow_Desc(translate([==[Total SES (Severely Errored Secs)]==]),    dsl.dslSeverelyErroredSecs)
  writeBlockRow_Desc(translate([==[Encapsulation Type]==]),                   dsl.LinkEncapsulationUsed)
  writeBlockRow_Desc(translate([==[Impulse Noise Protection (INP)]==]),       dsl.ACTINP)
  writeBlockRow_Desc(translate([==[Transmission rate]==]).." (Kbps)",         dsl.UpstreamCurrRate)
  writeBlockRow_Desc(translate([==[Receiving rate]==]).." (Kbps)",            dsl.DownstreamCurrRate)
  writeBlockRow_Desc(translate([==[Up time]==]),                              dsl.ShowtimeStart)
  writeBlockRow_Desc(translate([==[Total FEC Errors]==]),                     dsl.XTURFECErrors)
  writeBlockRow_Desc(translate([==[Total CRC Errors]==]),                     dsl.XTURCRCErrors)
  endBlock()
end

if atmEnable == "true" and wanConnType ~= "ETH" then
  writeBlockRowTitle(translate([==[ATM Statistics]==]))
  writeBlockRowTitle("PVC 8/35")
  writeBlockRow_Desc(translate([==[VPI/VCI]==]),                              dsl.pvc)
  writeBlockRow_Desc(translate([==[CRC errors]==]).." (PVC 8/35)",            dsl.crcErrors)
  writeBlockRowTitle("PVC 8/36")
  writeBlockRow_Desc(translate([==[VPI/VCI]==]),                              dsl.pvc_1)
  writeBlockRow_Desc(translate([==[CRC errors]==]).." (PVC 8/36)",            dsl.crcErrors_2)
  endBlock()
end

writeTableRowTitle_statisticsAG(translate([==[LAN interfaces]==]))
%>
  
  <tr>
    <td colspan="6" class="tableHd"><%=translate([==[Interface]==])%></td>
    <td colspan="6" class="tableHd"><%=translate([==[State]==])%></td>
    <td colspan="6" class="tableHd"><%=translate([==[Packets Sent]==])%></td>
    <td colspan="6" class="tableHd"><%=translate([==[Packets Received]==])%></td>
    <td colspan="6" class="tableHd"><%=translate([==[Error Packets Sent]==])%></td>
    <td colspan="6" class="tableHd"><%=translate([==[Error Packets Received]==])%></td>
  </tr> 
  
<%
local rowStyle = "oddrow"
local rowNum = 0
for i=1, 4 do
  if eth[i].enable == "true" then
    rowNum = rowNum + 1
    if rowNum%2==1 then
      rowStyle = "oddrow"
    else
      rowStyle = "evenrow"
    end
    writeTableRow_statisticsAG(6, rowStyle, "Ethernet "..i, eth[i].state, eth[i].packetsSent, eth[i].packetsReceived, eth[i].errorsSent, eth[i].errorsReceived)
  end
end
endBlock()

if eth[5].enable == "true" then
  writeTableRowTitle_statisticsAG(translate([==[WAN Ethernet Interface]==]))
%>
  <tr>
    <td colspan='6' class="tableHd"><%=translate([==[Interface]==])%></td>
    <td colspan='6' class="tableHd"><%=translate([==[State]==])%></td>
    <td colspan='6' class="tableHd"><%=translate([==[Packets Sent]==])%></td>
    <td colspan='6' class="tableHd"><%=translate([==[Packets Received]==])%></td>
    <td colspan='6' class="tableHd"><%=translate([==[Error Packets Sent]==])%></td>
    <td colspan='6' class="tableHd"><%=translate([==[Error Packets Received]==])%></td>
  </tr> 
<%
  writeTableRow_statisticsAG(6, "oddrow", "Ethernet 5", eth[5].state, eth[5].packetsSent, eth[5].packetsReceived, eth[5].errorsSent, eth[5].errorsReceived)
  endBlock()
end

writeTableRowTitle_statisticsAG(translate([==[Wi-Fi@2.4 GHz]==]))
writeTableRowHeader_Header(4, translate([==[Packets Sent]==]), translate([==[Packets Received]==]), translate([==[Errors Sent]==]), translate([==[Errors Received]==]))
writeTableRow_statisticsAG(4, "oddrow", wifi.packetsSent, wifi.packetsReceived, wifi.errorsSent, wifi.errorsReceived)
endBlock()

writeTableRowTitle_statisticsAG(translate([==[Wi-Fi@5 GHz]==]))
writeTableRowHeader_Header(4, translate([==[Packets Sent]==]), translate([==[Packets Received]==]), translate([==[Errors Sent]==]), translate([==[Errors Received]==]))
writeTableRow_statisticsAG(4, "oddrow", wifi2.packetsSent, wifi2.packetsReceived, wifi2.errorsSent, wifi2.errorsReceived)
endBlock()

writeTableRowTitle_statisticsAG(translate([==[Wi-Fi Guests]==]).."@2.4 GHz")
writeTableRowHeader_Header(4, translate([==[Packets Sent]==]), translate([==[Packets Received]==]), translate([==[Errors Sent]==]), translate([==[Errors Received]==]))
writeTableRow_statisticsAG(4, "oddrow", wifi3.packetsSent, wifi3.packetsReceived, wifi3.errorsSent, wifi3.errorsReceived)
endBlock()

writeTableRowTitle_statisticsAG(translate([==[Wi-Fi Guests]==]).."@5 GHz")
writeTableRowHeader_Header(4, translate([==[Packets Sent]==]), translate([==[Packets Received]==]), translate([==[Errors Sent]==]), translate([==[Errors Received]==]))
writeTableRow_statisticsAG(4, "oddrow", wifi4.packetsSent, wifi4.packetsReceived, wifi4.errorsSent, wifi4.errorsReceived)
endBlock()

local reply, error = mbus.getParameters{path = "Device.PTM.Link.1", param = {"Enable", "Status"}, datamodel = "second"}
local ptm_vdsl_status = ""
if reply["Device.PTM.Link.1"][1].param["Enable"] == "true" then
  ptm_vdsl_status = reply["Device.PTM.Link.1"][1].param["Status"]
end
local wan_eth_status = eth[5].enable

local IPTV_Ser = get_IPTVService()
local reply, error = mbus.getParameters{path = "Device.UserInterface.X_TELECOMITALIA_IT_WebPage", param ={"LANOption"},datamodel = "second"}
if reply["Device.UserInterface.X_TELECOMITALIA_IT_WebPage"][1].param["LANOption"] ~= "biz-br" and reply["Device.UserInterface.X_TELECOMITALIA_IT_WebPage"][1].param["LANOption"] ~= "biz-rt-napt-ena" and reply["Device.UserInterface.X_TELECOMITALIA_IT_WebPage"][1].param["LANOption"] ~= "biz-rt-napt-ipv6" then

	local IPTV_Ser = get_IPTVService()
	if IPTV_Ser ~= "OFF" and IPTV_Ser ~= "Off" then
	  writeTableRowTitle_statisticsAG(translate([==[IPTV Statistics]==]))
	%>
	  <tr>
		<td colspan='5'  class="tableHd"><%=translate([==[Port]==])%></td>
		<td colspan='5'  class="tableHd"><%=translate([==[Packets Sent]==])%></td>
		<td colspan='5'  class="tableHd"><%=translate([==[Packets Received]==])%></td>
		<td colspan='5'  class="tableHd"><%=translate([==[Errors Sent]==])%></td>
		<td colspan='5'  class="tableHd"><%=translate([==[Errors Received]==])%></td>
	  </tr> 
	<%
	  local rowNum = 0
	  reply, error = mbus.getParameters{path = "Device.ATM.Link.2", param = {"Enable", "Status"}, datamodel = "second"}
	  if reply["Device.ATM.Link.2"][1].param["Enable"] == "true" and reply["Device.ATM.Link.2"][1].param["Status"] == "Up" then
		reply, error = mbus.getParameters{path = "Device.Bridging.Bridge.2.Port.5.Stats", datamodel = "second"}
		local v = reply["Device.Bridging.Bridge.2.Port.5.Stats"][1].param
		writeTableRow_statisticsAG(5, "oddrow", "PVC 8/36", v["PacketsSent"], v["PacketsReceived"], v["ErrorsSent"], v["ErrorsReceived"])
		rowNum = 1
	  end

	  if ptm_vdsl_status == "Up" then
		reply, error = mbus.getParameters{path = "Device.Bridging.Bridge.2.Port.6.Stats", datamodel = "second"}
		local v = reply["Device.Bridging.Bridge.2.Port.6.Stats"][1].param
		local rowStyle = "evenrow"
		if rowNum == 0 then
		  rowStyle = "oddrow"
		end
		writeTableRow_statisticsAG(5, rowStyle, "PTM VDSL", v["PacketsSent"], v["PacketsReceived"], v["ErrorsSent"], v["ErrorsReceived"])
		rowNum = rowNum + 1
	  end
	  
	  if wan_eth_status == "true" then
		reply, error = mbus.getParameters{path = "Device.Bridging.Bridge.2.Port.7.Stats", datamodel = "second"}
		local v = reply["Device.Bridging.Bridge.2.Port.7.Stats"][1].param
		local rowStyle = "oddrow"
		if rowNum == 1 then
		  rowStyle = "evenrow"
		end
		writeTableRow_statisticsAG(5, rowStyle, translate([==[WAN Ethernet Interface]==]), v["PacketsSent"], v["PacketsReceived"], v["ErrorsSent"], v["ErrorsReceived"])
	  end

	  endBlock()
	end
end

writeTableRowTitle_statisticsAG(translate([==[Managed TV]==]))
reply, error = mbus.getParameters{path = "Device.DHCPv4.Client.1", param = {"Status"}, datamodel = "second"}
%>
  <tr>
	<td colspan='4'  class="tableHd"><%=translate([==[Packets Sent]==])%></td>
	<td colspan='4'  class="tableHd"><%=translate([==[Packets Received]==])%></td>
	<td colspan='4'  class="tableHd"><%=translate([==[Errors Sent]==])%></td>
	<td colspan='4'  class="tableHd"><%=translate([==[Errors Received]==])%></td>
  </tr> 
<%
if reply["Device.DHCPv4.Client.1"][1].param["Status"] == "Enabled" then
	reply, error = mbus.getParameters{path = "Device.IP.Interface.4.Stats", datamodel = "second"}
	local v = reply["Device.IP.Interface.4.Stats"][1].param
	writeTableRow_statisticsAG(4, "oddrow", v["PacketsSent"], v["PacketsReceived"], v["ErrorsSent"], v["ErrorsReceived"])
end

writeTableRowTitle_statisticsAG(translate([==[PPPoE Bridged Statistics]==]))
%>
  <tr>
    <td colspan='5'  class="tableHd"><%=translate([==[Port]==])%></td>
    <td colspan='5'  class="tableHd"><%=translate([==[Packets Sent]==])%></td>
    <td colspan='5'  class="tableHd"><%=translate([==[Packets Received]==])%></td>
    <td colspan='5'  class="tableHd"><%=translate([==[Errors Sent]==])%></td>
    <td colspan='5'  class="tableHd"><%=translate([==[Errors Received]==])%></td>
  </tr> 
<%
local rowNum = 0
reply, error = mbus.getParameters{path = "Device.ATM.Link.1", param = {"Enable", "Status"}, datamodel = "second"}
if reply["Device.ATM.Link.1"][1].param["Enable"] == "true" and reply["Device.ATM.Link.1"][1].param["Status"] == "Up" then
  reply, error = mbus.getParameters{path = "Device.Bridging.Bridge.3.Port.7.Stats", datamodel = "second"}
  local v = reply["Device.Bridging.Bridge.3.Port.7.Stats"][1].param
  writeTableRow_statisticsAG(5, "oddrow", "PVC 8/35", v["PacketsSent"], v["PacketsReceived"], v["ErrorsSent"], v["ErrorsReceived"])
  rowNum = 1
end
if ptm_vdsl_status == "Up" then
  reply, error = mbus.getParameters{path = "Device.Bridging.Bridge.3.Port.8.Stats", datamodel = "second"}
  local v = reply["Device.Bridging.Bridge.3.Port.8.Stats"][1].param
  local rowStyle = "evenrow"
  if rowNum == 0 then
    rowStyle = "oddrow"
  end
  writeTableRow_statisticsAG(5, rowStyle, "PTM VDSL", v["PacketsSent"], v["PacketsReceived"], v["ErrorsSent"], v["ErrorsReceived"])
  rowNum = rowNum + 1
end
if wan_eth_status == "true" then
  reply, error = mbus.getParameters{path = "Device.Bridging.Bridge.3.Port.9.Stats", datamodel = "second"}
  local v = reply["Device.Bridging.Bridge.3.Port.9.Stats"][1].param
  local rowStyle = "oddrow"
  if rowNum == 1 then
    rowStyle = "evenrow"
  end
  writeTableRow_statisticsAG(5, rowStyle, translate([==[WAN Ethernet Interface]==]), v["PacketsSent"], v["PacketsReceived"], v["ErrorsSent"], v["ErrorsReceived"])
end
endBlock()

writeTableRowTitle_statisticsAG(translate([==[Remote control]==]))
writeTableRowHeader_Header(4, translate([==[Packets Sent]==]), translate([==[Packets Received]==]), translate([==[Error Packets Sent]==]), translate([==[Error Packets Received]==]))
writeTableRow_statisticsAG(4, "oddrow", ip_stats[1].packetsSent, ip_stats[1].packetsReceived, ip_stats[1].errorsSent, ip_stats[1].errorsReceived)
endBlock()

local serviceTypePath = "Device.DeviceInfo"
local serviceReply, serviceError = mbus.getParameters{ path = serviceTypePath, param = "X_TELECOMITALIA_IT_ServiceType", datamodel = "second"}
local serviceType = serviceReply[serviceTypePath][1].param["X_TELECOMITALIA_IT_ServiceType"]
if string.match(tostring(serviceType), "MIA")~=nil then
    writeTableRowTitle_statisticsAG(translate([==[Telephony Statistics]==]))
%>
  <tr>
    <td colspan='5' class="tableHd"><%=translate([==[Interface]==])%></td>
    <td colspan='5' class="tableHd"><%=translate([==[IncomingCallsAnswered]==])%></td>
    <td colspan='5' class="tableHd"><%=translate([==[IncomingCallsFailed]==])%></td>
    <td colspan='5' class="tableHd"><%=translate([==[OutgoingCallsAnswered]==])%></td>
    <td colspan='5' class="tableHd"><%=translate([==[OutgoingCallsFailed]==])%></td>
  </tr> 
<%
    local rowStyle = "oddrow"
    local rowNum = 0
    for i=1, 3 do
        rowNum = rowNum + 1
        if rowNum%2==1 then
          rowStyle = "oddrow"
        else
          rowStyle = "evenrow"
        end
        if i==1 or i==2 then
            writeTableRow_statisticsAG(5, rowStyle, "FXS"..i, voice[i].inAns, voice[i].inFail, voice[i].outAns, voice[i].outFail) 
        else
            writeTableRow_statisticsAG(5, rowStyle, "DECT", voice[i].inAns, voice[i].inFail, voice[i].outAns, voice[i].outFail) 
        end
    end
    endBlock()
end

reply, error = mbus.getParameters{ path = "TI_STORE.TiUserIntf", param = "LANOption" }
local lanOption = reply["TI_STORE.TiUserIntf"][1].param["LANOption"] or ""
local TI_Device = getTIInfo_Device()
local device_PPP = getDevice_PPP();
if (TI_Device.lanOption == "res-rt-napt" or TI_Device.lanOption == "biz-rt-napt-ena" or TI_Device.lanOption =="res-rt-napt-ipv6" or TI_Device.lanOption == "biz-rt-napt-ipv6") and device_PPP.name== "User session" then 
  writeTableRowTitle_statisticsAG(translate([==[Data connection]==]))
  writeTableRowHeader_Header(4, translate([==[Packets Sent]==]), translate([==[Packets Received]==]), translate([==[Error Packets Sent]==]), translate([==[Error Packets Received]==]))
  writeTableRow_statisticsAG(4, "oddrow", ip_stats[2].packetsSent, ip_stats[2].packetsReceived, ip_stats[2].errorsSent, ip_stats[2].errorsReceived)
  endBlock()
end
%>

<br><form id="ResetForm1" method="POST" name="ResetForm1" action="">
<table cellspacing='0' cellpadding='0' width='100%' style="text-align:center" class="fontSize">
	<tr>	
		<td style="float:right;padding-right:10px;vertical-align:top">
		<a href="statisticsAG.lp" style="float:right;text-align:right">
		<div class="midarea6-1 mainButton"><%=translate([==[Update]==])%></div></a></td>
		<td style="width:215px;vertical-align:top">
		<a href="javascript:submitStatistics()">
		<div class="midarea7-1 mainButton" name="reset_traffic_button"><%=translate([==[Reset Statistics]==])%></div></a>
		<!-- <input type="submit" class='midarea6-2' value="<%=translate([==[Reset Statistics]==])%>" name="reset_traffic_button" /> --></td>
		<td  style="float:left;vertical-align:top">
		<a href="standard.lp">
		<div class="midarea6-1 secondaryButton"><%=translate([==[Back]==])%></div></a></td>
	</tr>
</table>
</form>

<% endPage() %>

</div>
</td></tr></table>
</div>
</div>
</div>
<script language="javascript">
function submitStatistics()
{
	document.ResetForm1.submit();
	}
</script>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
<!-- <link rel="stylesheet" href="css/style.css" type="text/css" /> -->
<link rel="stylesheet" href="css/master.css" type="text/css" />

<script language="javascript" type="text/javascript" src="js/portmap.js"></script>
<%
cgilua.lp.include("lp/mbus_util.lp")
cgilua.lp.include("lp/common.lp")
cgilua.lp.include("lp/portmap.lp")
cgilua.lp.include("lp/style.lp")
cgilua.lp.include("lp/util.lp")
cgilua.lp.include("lp/device.lp")
local tprint = require("tableprint")
local translate = translate
local POST = cgilua.POST
local portMappingPath = "Device.NAT.PortMapping"
local IGD_PortMapping_slen = string.len(portMappingPath) + 1
--flags to make a distinction whether other port mapping is existing
local portConflict = ""

local lanOption = getLANOption()
local TI_Device = getTIInfo_Device()
if TI_Device.lanOption ~= "res-rt-napt" and TI_Device.lanOption ~= "biz-rt-napt-ena" and 
TI_Device.lanOption ~= "res-rt-napt-ipv6" and TI_Device.lanOption ~= "biz-rt-napt-ipv6" then
  cgilua.redirect("index.lp")
  return
end

-- get NAT status 
local NATStatus = ""
local NATStart = ""
local NATEnd = ""
local NATPath = "Device.NAT.InterfaceSetting.ppp_0"
local reply, error = mbus.getParameters{ path = NATPath,
                        param = {"Enable", "X_TELECOMITALIA_IT_NATStartIPAddress", "X_TELECOMITALIA_IT_NATEndIPAddress"},
                        flags = "KEYPATH", datamodel = "second" }
if error==nil then
  NATStatus = reply[NATPath][1].param["Enable"]
  NATStart  = reply[NATPath][1].param["X_TELECOMITALIA_IT_NATStartIPAddress"]
  NATEnd    = reply[NATPath][1].param["X_TELECOMITALIA_IT_NATEndIPAddress"]
end

if cgilua.servervariable"REQUEST_METHOD" == "POST" then

  if NATStatus=="" then
    -- the NAT status has problem, so do nothing, just go back.
    cgilua.redirect("statoPortMapping.lp")
    return
  end

  local modify = {}
  local reply, error = mbus.getParameters{ path = portMappingPath, param = {"Enable", "InternalClient", "X_000E50_GUIDisabled", "X_000E50_InterfaceDisabled"}, datamodel = "second" }
  
  local manualDisabled = {}
  --Fistly deal with the rules to be set disabled by GUI
  for i, v in pairs(reply[portMappingPath]) do
    local path_id = string.sub(v.path, IGD_PortMapping_slen + 1)

    if (POST[path_id] == nil) then
	  
	  if (v["param"]["Enable"] == "false" and v["param"]["X_000E50_GUIDisabled"] == "false" and v["param"]["X_000E50_InterfaceDisabled"] == "false") then
		
	  elseif  (v["param"]["Enable"] == "false" and v["param"]["X_000E50_GUIDisabled"] == "false" and v["param"]["X_000E50_InterfaceDisabled"] == "true") then
		
      else
	    manualDisabled = "false" 
        
        table.insert(modify, { path = v.path, param = { Enable = manualDisabled}, datamodel = "second" })
	  end
    end
  end 
  setMBUS_IGD(modify)
  --Secondly deal with the rules to be set enabled by GUI one by one
  for i, v in pairs(reply[portMappingPath]) do
    modify = {}
    local path_id = string.sub(v.path, IGD_PortMapping_slen + 1)
    if (POST[path_id] ~= nil) then
      manualDisabled = "true"
  
      table.insert(modify, { path = v.path, param = { Enable = manualDisabled}, datamodel = "second" })
	
	  local result = setMBUS_IGD(modify)
  
	  if result == 1 then
	    saveall(0, 1)
	
	    cgilua.redirect("portmapping_conflictAlert.lp",{ flag="stateEnable"})
		local modify2 = {}
		table.insert(modify2, { path = v.path, param = {Enable="false"}, datamodel = "second" })
		
		result2 = setMBUS_IGD(modify2)
    
	    return
	  end 
    end
  end
 -- if #modify>0 then
--	local result = setMBUS_IGD(modify)
--	if result==1 then
--		saveall(0, 1)
--		cgilua.redirect("portmapping_conflictAlert.lp",{ flag="stateEnable"})
--		return
--	end
--  end

  saveall(0, 1)
  cgilua.redirect("save_alert.lp", { u="statoPortMapping.lp" })
  return
end

local portMappingList, error = getList_IGD(portMappingPath, nil, "Description", "InternalClient", "InternalPort", "ExternalPort", "Protocol", "Enable", "X_000E50_GUIDisabled", "X_000E50_InterfaceDisabled")
local isRemote = isRemoteAccess()
%>

<script type="text/javascript">
//<![CDATA[
function cancelConfirm()
{
  document.getElementById("statoPortMappingTable").style.display = "block";
  document.getElementById("confirmConfig").style.display = "none";
  document.getElementById("resultKoAll").style.display = "none";
}

function submitConfirm()
{
	document.getElementById("wifi_submit").removeAttribute("href");
    document.getElementById("wifi_submit").onclick = null;
    document.getElementById("wifi_submit_con").className = "next_wifidisable";
    document.getElementById("change_status_form").submit();
}

function linkToEdit(pathId)
{
  window.location.href="editPortMapping.lp?pathId="+pathId;
}

function change_status()
{
<%
  for i,v in pairs(portMappingList) do
    if NATStatus=="false" or (v["InternalClient"]~="" and inRange(tostring(v["InternalClient"]), NATStart, NATEnd)==false) then
      local pathId = string.sub(v.path, IGD_PortMapping_slen + 1)
%>
      if (document.getElementById("<%=pathId%>").checked == true) {
        document.getElementById("PMWarningMsg").innerHTML = "<%=errMsgNAT%>";
        document.getElementById("statoPortMappingTable").style.display = "none";
        document.getElementById("resultKoAll").style.display = "block";
        return false;
      }
<%
    end
	local enable = v["Enable"]
	local pathId = string.sub(v.path, IGD_PortMapping_slen + 1)
%>
	var path_checked = "false";
	if(document.getElementById("<%=pathId%>").checked == true){
		path_checked = "true";
	}
	var get_Path_checked = "<%=enable%>";
	if(path_checked != get_Path_checked){
		document.getElementById("statoPortMappingTable").style.display = "none";
		document.getElementById("confirmConfig").style.display = "block";
	}
<%
  end
%>
}

function changeCheck(n)
{
  if(document.getElementById(n).checked == true)
    document.getElementById("span"+n).innerHTML = "<%=translate([==[Active]==])%>";
  else
    document.getElementById("span"+n).innerHTML = "<%=translate([==[Disable]==])%>";
}
//]]>
</script>
    <script language="JavaScript" type="text/javascript">

	if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="";
	}
	
	if(window.parent.menu.document.getElementById("teleSub")!=null && 
		window.parent.menu.document.getElementById("teleSub") != "undefinded") {
		window.parent.menu.document.getElementById("teleSub").style.display="none";	
	}

	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="";
	}

	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}

	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
		if(window.parent.menu.document.getElementById("ipv6list")) {
			window.parent.menu.document.getElementById("ipv6firewall").className="";
			window.parent.menu.document.getElementById("ipv6list").style.display="none";
		}
	}

	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {
		window.parent.menu.document.getElementById("port").className="submenuselect1";
	}

	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="";
	}
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {
		window.parent.menu.document.getElementById("urlfi").className="";
	}

	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {
		window.parent.menu.document.getElementById("waon").className="";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {
		window.parent.menu.document.getElementById("stru").className="";
	}	
  </script>
</head>
<body>

<div class="contentContainer">
	 
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li><li><a href="statoPortMapping.lp"><%=translate([==[Port Mapping]==])%></a></li>
			</ul>
		</div>	
			
		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a class="current"><div class="tab"><span class="tabIcon_stport"></span>
				<span class="contTabTxt transform"><%=translate([==[Port Mapping]==])%></span>
				</div>
				<div class="clrBth"></div></a></li>
				<% if isRemoteAccess() == false then %>
				<li><a class="margin15" href="configurePortMapping.lp"><div class="tab">
				<span class="contTabTxt transform"><%=translate([==[Configure]==])%> Port Mapping</span></div></a>
				</li>
				<% end %>
			</ol>
		</div>

<!-- <table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
<tr><td align="left"><a href="advance.lp">Avanzate</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="statoPortMapping.lp">Port Mapping</a></td><td align="right"><%=showConfigMenu("configurePortMapping.lp")%></td></tr>
</table> -->

<div class='contentcontainer'>
<div class='contentitem' id="statoPortMappingTable">
<form method="POST" id="change_status_form" action="">
<%
writeBlockPageHeader(translate([==[Port Mapping Status]==]))
-- start to list virtual info
if portMappingList[1] == nil then	
%>
  <tr>
    <td class="midarea4">
      <p><%=translate([==[No rule of port configured mapping]==])%>.</p>
    </td>
  </tr>

<% else 
%>

  <table cellspacing='0' cellpadding='0' width='100%'><tr><td width='40' valign='top'></td><td valign='top'>
  <br>
  <table class='edittable_port valuespace' width='100%' cellspacing='0' cellpadding='0' border='0'>
  <tr><td colspan='8'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr> 
  <tr>
  <th class="tableHd"><%=translate([==[Active]==])%></th>
  <th class="tableHd"><%=translate([==[Application]==])%></th>
  <th class="tableHd" style="white-space: nowrap;"><%=translate([==[Destination IP]==])%></th>
  <th class="tableHd"><%=translate([==[Protocol]==])%></th>
  <th class="tableHd"><%=translate([==[Internal Port]==])%></th>
  <th class="tableHd"><%=translate([==[External Port]==])%></th>
  <th class="tableHd"><%=translate([==[Status]==])%></th>
  <th class="tableHd"><%=translate([==[Edit]==])%></th>
   </tr> 
   <tr><td colspan="8">&nbsp;</td></tr>
<%
--writeTableBlockHeader(8,translate([==[Active]==]),translate([==[Application]==]),translate([==[Destination IP]==]),translate([==[Protocol]==]),translate([==[Internal Port]==]),translate([==[External Port]==]),translate([==[Status]==]),translate([==[Edit]==]))

local rowStyle="oddrow_firewall"

local conIntPort = ""
local conExtPort = ""
local conProtocol = ""
for i,v in pairs(portMappingList) do
  local pathId = string.sub(v.path, IGD_PortMapping_slen + 1)
  local customStatus = "false"
  --if v["Enable"] == "true" and v["X_000E50_GUIDisabled"] == "false" and v["X_000E50_InterfaceDisabled"] == "false" then
	--customStatus = "true"
  --end 
  customStatus = v["Enable"]
  
  local isActive = "checked='checked'"
  local statusShow = translate([==[Active]==])
  if customStatus=="false" then
    isActive = ""
    statusShow = translate([==[Disable]==])
  end

  if i%2==1 then
      rowStyle = "oddrow_firewall"
    else
      rowStyle = "evenrow_firewall"
    end

  local internalPort = v["InternalPort"]
  local externalPort = v["ExternalPort"]
  if internalPort == "0" then 
    internalPort = "*"
  end

  if externalPort == "0" then 
    externalPort = "*"
  end
	
  local starExist = string.find(internalPort, "*")
  if starExist ~= nil and v["Protocol"]=="TCP" and string.match(portConflict,"tcp")==nil then
    portConflict = portConflict.."tcp"
  elseif starExist ~= nil and v["Protocol"]=="UDP" and string.match(portConflict,"udp")==nil then
    portConflict = portConflict.."udp"
  elseif starExist ~= nil and v["Protocol"]=="ALL" and string.match(portConflict,"all")==nil then
    portConflict = portConflict.."all"
  end

-- in case external Port is too long to display in GUI urgly, add some whitespace
externalPort=string.gsub(externalPort,",",", ")
externalPort=string.gsub(externalPort,";","; ")
internalPort=string.gsub(internalPort,",",", ")
internalPort=string.gsub(internalPort,";","; ")

if isRemote then
	writePortTableRow(8,rowStyle,[[<input type="checkbox" value="true" id="]]..pathId..[[" name="]]..pathId..[[" ]]..isActive..[[/>]],v["Description"],v["InternalClient"],v["Protocol"],internalPort,externalPort,statusShow,[[&nbsp;]])
else
	writePortTableRow(8,rowStyle,[[<input type="checkbox" value="true" id="]]..pathId..[[" name="]]..pathId..[[" ]]..isActive..[[/>]],v["Description"],v["InternalClient"],v["Protocol"],internalPort,externalPort,[[<div id="span]]..pathId..[[">]]..statusShow..[[</div>]],[[ <a style="color:black" onclick="linkToEdit(']]..pathId..[[')"><div class="midarea6-1 mainButton" style="margin-bottom:0px;" name="thb37">]]..translate([==[Edit]==])..[[</div></a>]])
end
local getProtocol = v["Protocol"]
conIntPort = conIntPort.."^"..internalPort	
conExtPort = conExtPort.."%"..externalPort
conProtocol = conProtocol.."@"..getProtocol
end

cgilua.set_session_var("Key1",conIntPort)
cgilua.set_session_var("Key2",conExtPort)
cgilua.set_session_var("KeyProtocol",conProtocol)
endBlock()
%>


	<table cellspacing='0' cellpadding='0' width='100%' class="paddtop10 txtAlignCenter">
				<tr><td style="text-align:left;">
				<table cellspacing='0' cellpadding='0'><tr>
				<td style='padding-left:250px'>
			<% if isRemote==false then%>
			<a onclick="change_status()" href="#">
			<div class="midarea6-1 mainButton" name="thb10" style="vertical-align:middle"><%=translate([==[Save]==])%></div></a>
			<%end%>
				</td>
			
					<td style='padding-left:50px'>
				<a href ="advance.lp">
		<div class="midarea6-1 mainButton" name="thb12" style="vertical-align:middle"><%=translate([==[Cancel]==])%></div> </a>
					</td>
				</tr>	
	</table>
	</td></tr></table>



<%
end
endPage()
%>

<input type="hidden" id="portConflictFlag" name="portConflictFlag" value="<%=portConflict%>" />
</form>
</div>
</div>
<script src="js/antiCSRF.js" type="text/javascript"></script>

<div id="confirmConfig" style="display:none">
<%cgilua.lp.include("webparts/confirmBack.lp")%>
</div>
<div id="portConflict" style="display:none">
<%cgilua.lp.include("webparts/portmapping_conflictAlert.lp")%>
</div> 
<div id="resultKoAll" style="display:none">
<%cgilua.lp.include("webparts/resultKO_noApp_reload.lp")%>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Modem Telecom Italia</title>
	<link rel="stylesheet" href="css/master.css" type="text/css" />
	         <script language="JavaScript" type="text/javascript">
    if(window.parent.menu.document.getElementById("stcon")!=null && 
		window.parent.menu.document.getElementById("stcon") != "undefinded") {
		window.parent.menu.document.getElementById("stcon").className="";
	}
	
	if(window.parent.menu.document.getElementById("serte")!=null && 
		window.parent.menu.document.getElementById("serte") != "undefinded") {
		window.parent.menu.document.getElementById("serte").className="submenuselect";
	}

	if(window.parent.menu.document.getElementById("lanst")!=null && 
		window.parent.menu.document.getElementById("lanst") != "undefinded") {
		window.parent.menu.document.getElementById("lanst").className="";
	}

	if(window.parent.menu.document.getElementById("wifist")!=null && 
		window.parent.menu.document.getElementById("wifist") != "undefinded") {
		window.parent.menu.document.getElementById("wifi2li").style.display="none";
		window.parent.menu.document.getElementById("wifi2li").style.display="none";
		window.parent.menu.document.getElementById("wifi5li").style.display="none";
		window.parent.menu.document.getElementById("wifist").className="";
		window.parent.menu.document.getElementById("wifi2").className="";
		window.parent.menu.document.getElementById("wifi5").className="";
		window.parent.menu.document.getElementById("wifi_guest").className="";
	}

	if(window.parent.menu.document.getElementById("asst")!=null && 
		window.parent.menu.document.getElementById("asst") != "undefinded") {
		window.parent.menu.document.getElementById("asst").className="";
	}

	if(window.parent.menu.document.getElementById("stat")!=null && 
		window.parent.menu.document.getElementById("stat") != "undefinded") {
		window.parent.menu.document.getElementById("stat").className="";
	}
	if(window.parent.menu.document.getElementById("loac")!=null && 
		window.parent.menu.document.getElementById("loac") != "undefinded") {
		window.parent.menu.document.getElementById("loac").className="";
	}
	
  </script>
</head>
<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<% cgilua.lp.include("lp/ppp.lp") %>
<% cgilua.lp.include("lp/dsl.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/connectionService.lp") %>
<% cgilua.lp.include("lp/style.lp") %>
<%
local translate = translate
local POST=cgilua.POST

if cgilua.servervariable"REQUEST_METHOD" == "POST" then	
	local info2 = getPPP("PPP.Intf.2")
	local PPP_Device = getDevice_PPP()
	if PPP_Device~=nil and info2~=nil then
		if PPP_Device.connectionStatus ~= "Connected" then
	   		setDataPPP(info2.ppp_path, "enabled", "true")
			sleep(4)
		else
	   		setDataPPP(info2.ppp_path, "disabled", "false")
			sleep(2)
		end
	end
	saveall(15, 1)
end

-- get handler
local PPP_Device = getDevice_PPP()
local TI_Device = getTIInfo_Device()
local TI_info = getTIInfo()
local info1 = getPPP("PPP.Intf.1")
local info2 = getPPP("PPP.Intf.2")
local dsl = getDSLInfo()
local pubLan = getPubLAN()
local wanEthIntf = getLanStat("ethif5")

--WAN ETH Connection 
local wanConnType, wanConnTitle = getWANConnectionType()

--ADSL Status
local dslState, dslStateColor = translateDSLState_Servizi(dsl.dsl_status)	

--Management PPP of Telecom_Italia
local pppStatus, pppStatusColor = translateManagementPPPState(info1.ppp_status, info1.ipaddr, info1.connectionTrigger, dsl.dsl_status)

--Data PPP of User session
local pppPPPStatus = translate([==[Not active]==])
local pppPPPStatusColor = "tdRed"
local connectType = "Automatica"
local connProtocol = "PPPoE"
if info2~=nil then
	pppPPPStatus, pppPPPStatusColor, connectType = translateDataPPPState(info2.ppp_status, info2.connectionTrigger, pppPPPStatus, pppPPPStatusColor, connectType)
end

--STB status
local iptv_tatus = translate([==[Not present]==])
local IPTV_Ser = get_IPTVService()
if IPTV_Ser ~= "OFF" and IPTV_Ser ~= "Off" then
	local intf = string.sub(tostring(IPTV_Ser), -1)
	iptv_tatus = translate([==[Active on Ethernet port ]==]) .. intf
  	if IPTV_Ser == "Dyn_Portmapping" then
			iptv_tatus = translate([==[Actived]==])
		end
end

--Get the wanEtherIntf state color
local wanStatusColor = "tdRed"
if wanEthIntf.state=="Active" then
    wanStatusColor = "tdGreen"
end
%>

<body>
<div class="contentContainer">
	 
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="standard.lp"><%=translate([==[Basic Settings]==])%></a></li><li>|</li><li><a href="statoServizi.lp"><%=translate([==[Telecom Italia Services]==])%></a></li>
			</ul>
		</div>	

		
		<div class="contentTab" id="content">
			<ol id="tocTab_tiServices"  style="list-style-type: none;">
				<li><a class="current">
		<div class="tab">
			<span class="tabIcon_conn"></span>  
			<span class="contTabTxt transform"><%=translate([==[Telecom Italia Services]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
			</ol>
		</div>
		
	<div class="contentcontainer">
	<div class='contentitem'> 
	<form method="POST" id="modemState" name="modemState" action="">
	<table cellspacing='0' cellpadding='0' border="0" >
	<tr>
	<td>
	<table cellspacing='0' cellpadding='0' border="0" class="fontSize">
	<tr>
	<td>

	<table cellspacing='0' cellpadding='0' border="0">
		<tr>
		<td class="midarea2 tableTitle"><%=translate([==[Connectivity]==])%></td>
		</tr></table> 

		
			<table cellspacing='0' cellpadding='0' border="0">
			 
			<tr><td> 

	<%if isDefaultConf() then%> 
				<!-- Begin of warning events-->
				<table cellspacing='0' cellpadding='0' width='100%'>
				<tr><td width='40' class="verticalAlign"></td><td class=" verticalAlign midareainfo">Info</td></tr>
				<tr><td width='40' class="verticalAlign"></td>
				<td class="verticalAlign"> 
				<table  class='midarea4' width='100%' cellspacing='0' cellpadding='0' style="line-height:150%;padding-left:0px"> 
				<tr>
					<td><%=translate([==[Your modem is not yet configured services for Telecom Italy]==])%>.</td>
				</tr> 
				</table> 
				</td></tr></table> <!-- End of warning events-->
	<%else%>
				<!-- Begin of Internet Connection-->
				<!--<table cellspacing='0' cellpadding='0' width='100%'><tr> <td width='40' style='vertical-align:top'>&nbsp;</td> <td style='vertical-align:top'> -->
				<table cellspacing='0' cellpadding='0' class="martop5">
				<tr>
				<td class="midarea2 tableTitle"><%=translate([==[Internet Link]==])%></td></tr><tr><td>
				<table width='100%' cellspacing='0' cellpadding='0' class='servizitable fontSize' style="line-height:150%;"> 
							<tr>
							<td width='300' class="sectionArea-1 padleft40" ><%=translate([==[rate profile]==])%>:</td>
							<td colspan='3' class="sectionArea-2"><%=TI_info.profile%></td></tr>  			
							<tr>
							<td width='300' class="sectionArea-1 padleft40"><%=translate([==[Mode]==])%>:</td>
							<td colspan='3' class="sectionArea-2"><%=TI_info.connectMode%>	</td></tr> 

	<%
	if info2~=nil then
	if (((TI_Device.lanOption == "res-rt-napt" or TI_Device.lanOption == "res-rt-napt-ipv6") and PPP_Device.connectionTrigger == "X_TELECOMITALIA_IT_Conditional")   
		   or ((TI_Device.lanOption == "biz-rt-napt-ena" or TI_Device.lanOption == "biz-rt-napt-ipv6")and PPP_Device.connectionTrigger == "AlwaysOn"))
		   and PPP_Device.name == "User session" then%>
				<tr ><td width='300' class="sectionArea-1 padleft40 verticalAlign padtop5"><%=translate([==[Automatic connection by modem]==])%>:</td>
				<%if PPP_Device.connectionStatus == "Unconfigured" then%>
					<td width='150' class="tdRed verticalAlign padtop5"><%=translate([==[Unconfigured]==])%></td>
				<%elseif PPP_Device.connectionStatus == "Connecting" then%>
					<td width='150' class="tdOrange verticalAlign padtop5"><%=translate([==[Connecting]==])%></td>
				<%elseif PPP_Device.connectionStatus == "Authenticating" then%>
					<td width='150' class="tdRed verticalAlign padtop5"><%=translate([==[Authenticating]==])%></td>
				<%elseif PPP_Device.connectionStatus == "Connected" then%>
					<td width='150' class="tdGreen verticalAlign padtop5"><%=translate([==[Active]==])%></td>
				<%elseif PPP_Device.connectionStatus == "PendingDisconnect" or PPP_Device.connectionStatus == "Disconnecting" then%>
					<td width='150' class="tdRed verticalAlign padtop5"><%=translate([==[Disconnecting]==])%></td>
				<%else%>
					<td width='150' class="tdRed verticalAlign padtop5"><%=translate([==[Not active]==])%></td>
				<%end%>
				<td class="fleft verticalAlign">
		<% if (TI_Device.lanOption == "res-rt-napt" or TI_Device.lanOption == "res-rt-napt-ipv6")and PPP_Device.connectionTrigger == "X_TELECOMITALIA_IT_Conditional" then %>
				
			<% if isRemoteAccess()==false then%>
			<%if PPP_Device.connectionStatus ~= "Connected" then%>
				<a href ="javascript:submitServizi()"><div class="midarea6-1 mainButton" name="thbA5"><%=translate([==[Active]==])%></div></a>
			<%else%>
				<a href ="javascript:submitServizi()"><div class="midarea6-1 mainButton" name="thbA4"><%=translate([==[Disable]==])%></div></a>
			<%end%>
			<%end%>
			
			<%end%>
				</td></tr>
	<%if (TI_Device.lanOption == "res-rt-napt" or TI_Device.lanOption == "biz-rt-napt-ena") and PPP_Device.name== "User session" then%>
				<tr><td width='300' class="sectionArea-1 padleft40 padtop5"><%=translate([==[Public IP address from your modem connection]==])%>:</td><td colspan='3' class="sectionArea-2 padtop5"><%=info2.ipaddr%></td></tr>
	<%end%>
	<%end end%>
				</table> 
				<!--</td></tr></table>-->
				<!-- End of Internet Connection-->
			
				<!-- Begin of WAN Connection-->
				<table cellspacing='0' cellpadding='0' width='100%' border="0" class="padtop10">
				<tr>
				<td class="verticalAlign"> 
				<table cellspacing='0' cellpadding='0' border="0" >
				<tr>
				<td class="midarea2 tableTitle"><%=wanConnTitle%>
				</td>
				</tr><tr><td>
				<table width='100%' cellspacing='0' cellpadding='0' class='servizitable fontSize' style="line-height:150%;"> 
						<%if wanConnType=="ETH" then%><!-- WAN Ethernet -->
				<%if wanEthIntf.state=="Active" then%>
					<tr><td  class="sectionArea-1 padleft40" ><%=translate([==[FIBER Ethernet service]==])%>:</td><td colspan='3' class="<%=wanStatusColor%>"><%=translate([==[Actived]==])%></td></tr>
				<%elseif wanEthIntf.state=="Inactive" then%>	
					<tr ><td  class="sectionArea-1 padleft40"><%=translate([==[FIBER Ethernet service]==])%>:</td><td colspan='3' class="<%=wanStatusColor%>"><%=translate([==[Inactived]==])%></td></tr>
				<% end%>
			<%elseif wanConnType=="VDSL" then%>
				<tr ><td  class="sectionArea-1 padleft40"><%=translate([==[VDSL service]==])%>:</td><td colspan='3' class="<%=dslStateColor%>"><%=dslState%></td></tr>
				<tr ><td  class="sectionArea-1 padleft40"><%=translate([==[Speed in transmission]==])%>(Kbps):</td><td colspan='3' class="sectionArea-2"><%=dsl.upstream%></td></tr> 
				<tr ><td  class="sectionArea-1 padleft40"><%=translate([==[Receiving speeds]==])%>(Kbps):</td><td colspan='3' class="sectionArea-2"><%=dsl.downstream%></td></tr>
			<%else%>
				<tr><td  class="sectionArea-1 padleft40"><%=translate([==[ADSL Service]==])%>:</td><td colspan='3' class="<%=dslStateColor%>"><%=dslState%></td></tr>
				<tr ><td  class="sectionArea-1 padleft40"><%=translate([==[Speed in transmission]==])%>(Kbps):</td><td colspan='3'
				class="sectionArea-2"><%=dsl.upstream%></td></tr> 
				<tr><td  class="sectionArea-1 padleft40" ><%=translate([==[Receiving speeds]==])%>(Kbps):</td><td colspan='3' style="color:#5e5e5e;width:330px;"
				class="sectionArea-2"><%=dsl.downstream%></td></tr>
			<% end%>
				
					
				</table> 
				</td></tr></table><!-- End of WAN Connection-->
	</table>			
	<tr>
	<%
	if TI_Device.lanOption ~= "biz-br" and TI_Device.lanOption ~= "biz-rt-napt-ena" and TI_info.lanOption ~= "biz-rt-napt-ipv6" then
	-- Begin of IPTV
	%>
	<td align='left'><table cellspacing='0' cellpadding='0' class="padtop10">
		  <tr>
				<td class="midarea2 tableTitle"><%=translate([==[IPTV]==])%>
		</td></tr></table></td>
	<tr><td>
	<table cellspacing='0' cellpadding='0' class='servizitable fontSize'>
	  <%
	  writeSectionRow(translate([==[IPTV service]==]), iptv_tatus)
	  if TI_info.stbConnected == "false" then
		writeSectionRow(translate([==[Decoder Telecom Italia]==]), translate([==[Unconfigured]==]))
	  else
		for i=1, TI_info.stbConnected_num do
		  writeSectionRow(translate([==[Decoder Telecom Italia]==]), translate([==[Connected to Ethernet port ]==]) .. TI_info.stbIntf[i])
		end
	  end
	  %>
     </table></td></tr>
	  <%
	  endBlock()
	-- End of IPTV
	
	-- Begin of Managed TV
	local managedTV_Path = "Device.DHCPv4.Client.1"
	local reply, error = mbus.getParameters{path = managedTV_Path, datamodel = "second"}
	local m_Enable = reply[managedTV_Path][1].param["Enable"]
	local m_Status = reply[managedTV_Path][1].param["Status"]
	local m_dhcpStatus = reply[managedTV_Path][1].param["DHCPStatus"]
	%>

	<table cellspacing='0' cellpadding='0' class="fontSize padtop10"><tr><td class="midarea2 tableTitle"><%=translate([==[MANAGED TV]==])%></td></tr></table>
	<table width='100%' cellspacing='0' cellpadding='0' style="line-height:150%;width:640px" class="servizitable width750"> 
		<tr>
		<td class="sectionArea-1 padleft40"><%=translate([==[Managed TV Service]==])%>:</td><td class="sectionArea-1"><%if m_Enable == "true" then%><%=translate([==[Actived]==])%><%else %><%=translate([==[Not present]==])%><% end%></td></tr>
		<tr>
		<%if m_Status ~= "Disabled" then%>
		<%if m_Status == "Error_Misconfigured" or m_Status == "Error" then%>
		<td class="sectionArea-1 padleft40"><%=translate([==[Addressing State]==])%>:</td>
		<td class="sectionArea-1"><%=translate([==[Anomaly]==])%></td>
		<%else if m_Status == "Enabled" then%>
		<td class="sectionArea-1 padleft40"><%=translate([==[Addressing State]==])%>:</td>
		<td class="sectionArea-1"><%if m_dhcpStatus == "INIT" then%><%=translate([==[Initialization]==])%><%elseif m_dhcpStatus == "SELECTING" then%><%=translate([==[Selection in progress]==])%><%elseif m_dhcpStatus == "REQUESTING" then%><%=translate([==[Request in progress]==])%><%elseif m_dhcpStatus == "REBINDING" then%><%=translate([==[Reassigning in progress]==])%><%elseif m_dhcpStatus == "BOUND" then%><%=translate([==[Assigned]==])%><%elseif m_dhcpStatus == "RENEWING" then%><%=translate([==[Renewal in progress]==])%><%else%><%=m_dhcpStatus%><%end%></td></tr>
		
		<%local managedTV_IP_Path = "Device.IP.Interface.4.IPv4Address.1"
		local reply, error = mbus.getParameters{path = managedTV_IP_Path, datamodel = "second"}
		local m_IP = reply[managedTV_IP_Path][1].param["IPAddress"]%>
		
		<tr><td class="sectionArea-1 padleft40"><%=translate([==[IP Address]==])%>:</td><td class="sectionArea-1"><%=m_IP%>&nbsp;</td></tr>  
		<%end end end%>
	</table>
	<!-- End of Managed TV -->
	<%end%>
	
	<%if true then
		if pubLan.isPubLan then
			pubLanStatus = translate([==[not Active]==])
			pubLanStatusColor = "tdRed"
			if pubLan.pubLanEnable then
				pubLanStatus = translate([==[Active]==])
				pubLanStatusColor = "tdGreen"
			end
	%>
<!-- Begin of LAN public-->
				<table cellspacing='0' cellpadding='0' class="fontSize padtop10"><tr><td class="midarea2 tableTitle"><%=translate([==[LAN Public]==])%></td></tr></table>
				<table width='100%' cellspacing='0' cellpadding='0' style="line-height:150%;width:640px" class="servizitable width750"> 
				<tr>
				<td class="sectionArea-1 padleft40"><%=translate([==[Public LAN Service]==])%>:</td><td class="<%=pubLanStatusColor%>"><%=pubLanStatus%></td></tr>
				<tr>
				<td class="sectionArea-1 padleft40"><%=translate([==[default Gateway]==])%>:</td><td class="sectionArea-1"><%=pubLan.pubIpDef%></td></tr>
				<tr>
				<td class="sectionArea-1 padleft40"><%=translate([==[Subnet Mask]==])%>:</td><td class="sectionArea-1"><%=pubLan.pubIpMask%></td></tr>  
				<tr>
				<td class="sectionArea-1 padleft40"><%=translate([==[start IP]==])%>:</td><td class="sectionArea-1"><%=pubLan.beginip%></td></tr> 	
				<tr>
				<td class="sectionArea-1 padleft40"><%=translate([==[end IP]==])%>:</td><td class="sectionArea-1"><%=pubLan.endip%></td></tr> 
				<tr>
				<td class="sectionArea-1 padleft40"><%=translate([==[Primary DNS]==])%>:</td><td class="sectionArea-1"><%=getDefaultDNS("1")%></td></tr> 
				<tr>
				<td class="sectionArea-1 padleft40"><%=translate([==[Secondary DNS]==])%>:</td><td class="sectionArea-1"><%=getDefaultDNS("2")%></td></tr> 
				</table> </td></tr>
				</td></tr></table><!-- End of LAN public-->
	<%
		end 
	end
	%>
	<%end%>
			</td></tr>
	</table>
	</td></tr></table>
	</form>
	</div> 
	</div>
	</div>
	<script language="javascript">
	function submitServizi() {
		document.modemState.submit();
	}
	</script>
	<script src="js/antiCSRF.js"></script>

	</body>
	</html>

<%
local print = cgilua.print
local tprint=require("tableprint")
local BSFTstatus = "Initial state"

function splitPath(str, pat)
   local t = {}
   local fpat = "(.-)" .. pat
   local last_end = 1
   local s, e, cap = str:find(fpat, 1)
   while s do
      if s ~= 1 or cap ~= "" then
         table.insert(t,cap)
      end
      last_end = e+1
      s, e, cap = str:find(fpat, last_end)
   end
   if last_end <= #str then
      cap = str:sub(last_end)
      table.insert(t, cap)
   end
   return t
end


local reply, error = mbus.getParameters{ path = "Voice.DM", param = { "Status","LastError"} }
    local status = reply["Voice.DM"][1].param["Status"] 
    local dmsError = reply["Voice.DM"][1].param["LastError"]	   
    if status == "UNCONFIGURED" then
	BSFTstatus = translate("Initial state")
    elseif status == "DOWNLOADING" then
	BSFTstatus = translate("The downloading is in progress")
    elseif status == "CONFIGURING" then
	BSFTstatus = translate("The downloading has completed and the configuration file is being processed")
    elseif status == "RECONFIGURING" then
	BSFTstatus = translate("The downloading has completed and the configuration file is being processed")	
    elseif status == "CONFIGURED" then
	BSFTstatus = translate("The configuration file has been successfully applied")
    elseif status == "ERROR" then
	local dmsArray = splitPath(dmsError," ")
	local ipAddress = ""
	if #dmsArray > 2 then
		if dmsArray[1] == "Failed" and dmsArray[2] == "to" then
			dmsError = "Failed to Resolve"
			ipAddress = dmsArray[4]
		elseif dmsArray[1] == "connect" and dmsArray[2] == "to" then
			dmsError = "connect to server"
			ipAddress = dmsArray[4]
		end
	end
	BSFTstatus = translate("An error has occurred")..": "..translate(dmsError).." "..ipAddress				
    end
cgilua.print(tostring(BSFTstatus)) 

%>


<%
local QUERY = cgilua.QUERY
local print = cgilua.print

local pathId = QUERY["pathId"]
if QUERY["pathId"] ~= nil then
	local pathDetail = "Device.Services.VoiceService.1.PhyInterface." .. tostring(pathId) .. ".Tests"
	local testState, connection, volDC, volAC, insulationResistance, phoneRelease, impedance, dial
	local reply, error = mbus.getParameters{ path = pathDetail, param = {"TestState", "PhoneConnectivity", "X_TELECOMITALIA_IT_Vloop_DC", "X_TELECOMITALIA_IT_Vloop_AC", "X_TELECOMITALIA_IT_Rloop", "X_TELECOMITALIA_IT_OffHook", "X_TELECOMITALIA_IT_REN", "X_TELECOMITALIA_IT_PSTN"}, datamodel = "second" }

	if reply[pathDetail]~=nil and reply[pathDetail][1]~=nil then
		testState = reply[pathDetail][1].param["TestState"]
		connection = reply[pathDetail][1].param["PhoneConnectivity"]
		volDC = reply[pathDetail][1].param["X_TELECOMITALIA_IT_Vloop_DC"]
		volAC = reply[pathDetail][1].param["X_TELECOMITALIA_IT_Vloop_AC"]
		insulationResistance = reply[pathDetail][1].param["X_TELECOMITALIA_IT_Rloop"]
		phoneRelease = reply[pathDetail][1].param["X_TELECOMITALIA_IT_OffHook"]
		impedance = reply[pathDetail][1].param["X_TELECOMITALIA_IT_REN"]
		dial = reply[pathDetail][1].param["X_TELECOMITALIA_IT_PSTN"]
	end
	
	print(tostring(testState) .. "##" .. tostring(connection) .. "##" .. tostring(volDC) .. "##" .. tostring(volAC) .. "##" .. tostring(insulationResistance) .. "##" .. tostring(phoneRelease) .. "##" .. tostring(impedance) .. "##" .. tostring(dial))
end
%>

<%
local QUERY = cgilua.QUERY
local print = cgilua.print
local fromUAId = QUERY["fromUAId"]
local toUAId = QUERY["toUAId"]
if QUERY["typeAndPriority"] == "1" then
    local fromUAPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line." .. QUERY["selectIndex"]
    local toUAPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line." .. QUERY["selectIndex"]
    local toVoicePortPath, fromVoicePortPath
    local pathIdVal = QUERY["pathId"]
    if tonumber(pathIdVal)<3 then
        toVoicePortPath = "Device.Services.VoiceService.1.PhyInterface." .. QUERY["pathId"]
        fromVoicePortPath = "Device.Services.VoiceService.1.PhyInterface." .. QUERY["pathId"]
    else
        toVoicePortPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. (tonumber(QUERY["pathId"])-2)
        fromVoicePortPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. (tonumber(QUERY["pathId"])-2)
    end
    local priorityVP = QUERY["priority"]
    local UAMap_path = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap"
    local VoicePortMap_path = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap"
    local uaMapPathId, voicePortMapPathId
    if fromUAId~=nil then
        local reply, error = mbus.modify(
        function()
            local reply1, error1 = mbus.addObjects{ path = UAMap_path, param = { FromUA = fromUAPath, ToVoicePort = toVoicePortPath }, datamodel = "second" }
            --get the object path id for deleting.
            uaMapPathId = string.gsub(reply1[UAMap_path][1].path, UAMap_path..".", "")
            if error1~=nil or reply1[UAMap_path][1]==nil then
                result=1
        cgilua.errorlog("error1 is not nil:")
            end
        end, {datamodel="second"})
    print(uaMapPathId)
    end
    if toUAId~=nil then
        local reply, error = mbus.modify(
        function()
            local reply2, error2
            if priorityVP=="" then
                reply2, error2 = mbus.addObjects{ path = VoicePortMap_path, param = { ToUA = toUAPath, FromVoicePort = fromVoicePortPath }, datamodel = "second" }
            else
                reply2, error2 = mbus.addObjects{ path = VoicePortMap_path, param = { ToUA = toUAPath, FromVoicePort = fromVoicePortPath, Priority = tostring(priorityVP) }, datamodel = "second" }
            end
            --get the object path id for deleting.
            voicePortMapPathId = string.gsub(reply2[VoicePortMap_path][1].path, VoicePortMap_path..".", "")
            if error2~=nil or reply2[VoicePortMap_path][1]==nil then
                result=1
        cgilua.errorlog("error1 is not nil:")
            end
        end, {datamodel="second"})
    print(voicePortMapPathId)
    end
end

if QUERY["deleteDirectNumFlag"] == "1" then
    local uaMapPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap." .. tostring(QUERY["uaMapPathId"])
    local voicePortMapPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap." .. tostring(QUERY["voicePortMapPathId"])
    if fromUAId~=nil then
        local reply, error = mbus.modify(
            function()
                if uaMapPath~=nil then
                    local reply1, error1 = mbus.deleteObjects{path = uaMapPath, datamodel = "second"}
                end
            end, {datamodel="second"})
        print("")
    end
    if toUAId~=nil then
        local reply, error = mbus.modify(
            function()
                if voicePortMapPath~=nil then
                    local reply2, error2 = mbus.deleteObjects{path = voicePortMapPath, datamodel = "second"}
                end
            end, {datamodel="second"})
        print("")
    end
end
%>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/style.css" type="text/css"/>
<link rel="stylesheet" href="css/menu.css" type="text/css" />
<script language="javascript" type="text/javascript" src="js/script.js"></script>
<script language="javascript" type="text/javascript" src="js/portmap.js"></script>
<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<% cgilua.lp.include("lp/form.lp") %>
<% cgilua.lp.include("lp/ppp.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<% cgilua.lp.include("lp/portmap.lp") %>
<% cgilua.lp.include("lp/style.lp") %>
<% cgilua.lp.include("lp/voip.lp") %>

<%
local translate = translate
local POST=cgilua.POST
local QUERY=cgilua.QUERY
local pathId = QUERY["pathId"]
local linePathInId = QUERY["linePathInId"]
local linePathOutId = QUERY["linePathOutId"]
local lineNumVal = QUERY["lineNum"]

local wrongPriority = translate([==[Warning: the input priority is incorrect. Use only the allowed characters (0-9)]==])
%>
</head>

<body>
<script type="text/javascript">
//<![CDATA[
function showErrorMsg(errorMsgStr)
{
    document.getElementById("conf_all_num").style.display="none";
    document.getElementById("resultKO").style.display="block";
    document.getElementById("errorMsg").innerHTML=errorMsgStr;
}

function submitAdd(pathIdVal)
{
    var selectNumber = document.getElementById("selectNumber").value;
    if(selectNumber=="")
    {
        document.getElementById("conf_all_num").style.display="none";
        document.getElementById("resultKoConfNum").style.display="block";
        return false;
    }

    <%if linePathInId==nil then%>
        var priorityStr = document.getElementById('Priority').value;
        if(priorityStr!="")
        {
            if(!priorityExam(priorityStr))
            {
                showErrorMsg('<%=wrongPriority%>');
                return false;
            }
        }
    <%end%>

    document.getElementById("typeAndPriority").value="1";

    var urlStr = "/tele_ajax.lp";
    <%if linePathInId~=nil then%>
        var fromUAId = document.getElementById("linePathInId").value;
        var params="pathId="+pathIdVal+"&typeAndPriority=1&fromUAId="+fromUAId+"&selectIndex="+selectNumber;
    <%end%>
    <%if linePathOutId~=nil then%>
        var toUAId = document.getElementById("linePathOutId").value;
        var params="pathId="+pathIdVal+"&typeAndPriority=1&toUAId="+toUAId+"&priority="+priorityStr+"&selectIndex="+selectNumber;
    <%end%>

    ajax_get(urlStr, params, ajaxCallback);

    var num = parseInt(document.getElementById("num").value) + 1;
    document.getElementById("num").value = num;
}

function cancelDelete(num, MapPathId)
{
    var urlStr = "/tele_ajax.lp";
    <%if linePathInId~=nil then%>
        var fromUAId = document.getElementById("linePathInId").value;
        var params="lineNum"+num+"&deleteDirectNumFlag=1&uaMapPathId="+MapPathId+"&fromUAId="+fromUAId;
    <%end%>
    <%if linePathOutId~=nil then%>
        var toUAId = document.getElementById("linePathOutId").value;
        var params="lineNum"+num+"&deleteDirectNumFlag=1&voicePortMapPathId="+MapPathId+"&toUAId="+toUAId;
    <%end%>
    ajax_get(urlStr, params, ajaxCallback);
    document.getElementById("port"+num).innerHTML = "";
    document.getElementById("port"+num).style.display= "none";
}

function cancelConfirm()
{
    document.getElementById("conf_all_num").style.display = "";
    document.getElementById("confirm").style.display = "none";
    document.getElementById("resultKoConfNum").style.display="none";
    document.getElementById("resultKO").style.display="none";

}

function ajaxCallback(ajax_obj)
{
    var rsps = ajax_obj.responseText.replace(/\s/g,"");
    if(rsps!="")
    {
        var selObj =  document.getElementById("selectNumber");
        var selectNumber = selObj.options[selObj.selectedIndex].innerHTML;
        var num = document.getElementById("num").value;
        var arr = rsps.split("#");
        document.getElementById("port"+num).innerHTML = selectNumber + "<input type='button' value='<%=translate([==[Clear]==])%>' onclick='cancelDelete("+num+", "+arr[0]+")' />";
    }

}

function priorityExam(str)
{
    //exam the input box value is number or not.
    //var filter=/^\s*[.,0-9]{0,10240}\s*$/;
    var filter=/^\d/g;
    if ((str.indexOf(' ') != -1) || (!str.match(filter)) || (str > 65535))
    {
        return false;
    }
    return true;
}

//]]>
</script>

<table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
<tr><td align="left"><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="telephonyStato.lp"><%=translate([==[Telephony services]==])%></a></td><td align="right"><a href="telephonyNumber.lp">NumberInfo</a></td></tr>
</table>

<div class='contentcontainer'>
<hr>
<div class='contentitem' id="conf_all_num">

<table border="0" width="100%">
<form id="modConfigFlag" name="modConfigFlag" action="" method="post">
<input type="hidden" id="configFlag" name="configFlag" value="0"/>
<tr>
    <td class='icon' style='vertical-align:top' width='100px'><img src='images/tel___xl.gif' alt=''></td>
    <td class='data' style='vertical-align:top'>
        <table cellspacing='0' cellpadding='0' width="100%">
        <tr>
            <td align='left'><span class='itemtitle'><%=translate([==[Telephony services]==])%></span></td>
        </tr>
        <tr><td>
            <br><!-- Begin of add Telephone number-->
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td width='40' style='vertical-align:top'><img src='images/bull__md.gif' alt=''></td><td style='vertical-align:top'>
            <input type="hidden" id="typeAndPriority" name="typeAndPriority" value="0"/>
            <input type="hidden" id="pathId" name="pathId" value="<%=QUERY['pathId']%>"/>
            <input type="hidden" id="linePathInId" name="linePathInId" value="<%=QUERY['linePathInId']%>"/>
            <input type="hidden" id="linePathOutId" name="linePathOutId" value="<%=QUERY['linePathOutId']%>"/>
            <input type="hidden" id="rowIndex" name="rowIndex" value=""/>
            <span class='blocktitle'><%=translate([==[Telephone service config]==])%></span><br>
            <table width='100%' class='datatable' cellspacing='0' cellpadding='0' style="line-height:150%;">
                <tr>
                <%
                local rowStyle = "oddrow"
                %>
                <td class="<%=rowStyle%>">
                    <select id="selectNumber" name="selectNumber" style="font-family:Tahoma;width:200px;overflow:hidden">
                    <option value="">&lt;<%=translate([==[Choose]==])%> &gt;</option>
                    <%
                    local lineNumPortName
                    if tonumber(pathId)<3 then
                        lineNumPortName = "Device.Services.VoiceService.1.PhyInterface." .. tostring(pathId)
                    else
                        lineNumPortName = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. tostring(tonumber(pathId)-2)
                    end
                    if linePathInId~=nil then
                        local preassInNum = getPreassignedInNum(lineNumPortName)
                        local allNumberPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
                        local replyAll, error = mbus.getParameters{ path = allNumberPath, param = "DirectoryNumber", filter="(== X_TELECOMITALIA_IT_LANManaged " .. "false" .. ")", datamodel = "second" }
                        for i,v in pairs(replyAll[allNumberPath]) do
                            if v.path~=lineNumVal and v.param["DirectoryNumber"]~=preassInNum then
                                cgilua.print("<option title='"..tostring(v.param["DirectoryNumber"]).."' value='"..tostring(string.gsub(v.path, "Device.Services.VoiceService.1.VoiceProfile.1.Line.", "")).."'>"..tostring(v.param["DirectoryNumber"]).."</option>")
                            end
                        end
                    end
                    if linePathOutId~=nil then
                        local preassOutNum = getPreassignedOutNum(lineNumPortName)
                        local allNumberPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
                        local replyAll, error = mbus.getParameters{ path = allNumberPath, param = "DirectoryNumber", filter="(== X_TELECOMITALIA_IT_LANManaged " .. "false" .. ")", datamodel = "second" }
                        for i,v in pairs(replyAll[allNumberPath]) do
                            if v.path~=lineNumVal and v.param["DirectoryNumber"]~=preassOutNum then
                                cgilua.print("<option title='"..tostring(v.param["DirectoryNumber"]).."' value='"..tostring(string.gsub(v.path, "Device.Services.VoiceService.1.VoiceProfile.1.Line.", "")).."'>"..tostring(v.param["DirectoryNumber"]).."</option>")
                            end
                        end
                    end
                    %>
                    </select>
                </td>
                <%
                if linePathOutId~=nil then
                %>
                <td><%=translate([==[Priority]==])%>:<input type="text" id="Priority" name="Priority" size="10" style="font-weight: 700" /></td>
                <%end%>
                </tr>
                <tr><td align='center'>
                    <input type="button" class="button" onclick='submitAdd("<%=pathId%>")' value="<%=translate([==[Apply]==])%>" name="thb1" />&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="button" class="button" onclick='javascript:document.location.href="telephonyStato.lp";' value="<%=translate([==[Back]==])%>" name="thb7" /></td>
                </tr>
            </table>
            </td></tr></table><!-- End of add Telephone number-->
            </form>
            <br><!-- Begin of showing Telephone numbers-->
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td width='40' style='vertical-align:top'><img src='images/bull__md.gif' alt=''></td><td style='vertical-align:top'>
            <input type="hidden" id="num" name="num" value="0">
            <input type="hidden" id="pathId" name="pathId" value="<%=QUERY['pathId']%>"/>
            <span class='blocktitle'><%=translate([==[Delete telephone]==])%></span><br>
            <table width='100%' class='datatable' cellspacing='0' cellpadding='0' style="line-height:150%;">
                <tr>
                <td>
                <%
                for i=1,100 do
                %>
                <div id="port<%=i%>"></div>
                <%
                end
                %>
                </td>
                </tr>
            </table>
            </td></tr></table><!-- End of showing Telephone numbers-->
            </td>
        </tr>
        </table>
    </td>
</tr>
</table>
</div>
</div>
<div id="resultKoConfNum" style="display:none">
<%cgilua.lp.include("webparts/resultKO_noconfnum.lp")%>
</div>
<div id="resultKO" style="display:none">
<%cgilua.lp.include("webparts/resultKO_URL.lp")%>
</div>
<div id="confirm" style="display:none">
<%cgilua.lp.include("webparts/confirmBack.lp")%>
</div>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/style.css" type="text/css"/>
<link rel="stylesheet" href="css/menu.css" type="text/css" />
<script language="javascript" type="text/javascript" src="js/script.js"></script>
<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<%
local translate = translate
local POST=cgilua.POST
local QUERY=cgilua.QUERY
local ProfilePath = "Voice.Profile"
local PortmapPath = "Voice.Portmap."
local voicePortsPath = "Voice.Ports"
local voicePortsPathLen = string.len(voicePortsPath) + 2 
local tprint = require("tableprint")

--Delete voice profile.
function delete_voice_profile(voiceProfilePath)
    local reply, error = mbus.modify(
    function()
        local reply1, error1 = mbus.deleteObjects{ path = voiceProfilePath }
    end)
end


--Create a new voip profile
function voip_profile_create(sipUri, username, password, voicePort, displayName, abbrNumber)
    local voipProfilePathStr = ""
    local reply, error = mbus.modify(
        function()
            local reply, error = mbus.addObjects{ path = "Voice.Profile",
                                                    param = { Username = username,
                                                              Password = password,
                                                              ["SIP-URI"] = sipUri,
                                                              VoicePort = voicePort,
                                                              DisplayName = displayName,
                                                              AbbrNumber = abbrNumber } }
        end)
end

--Get the voice port by port map path 
function find_voip_port(voicePortPath)
    local reply, error = mbus.getParameters{ path = voicePortPath, param = "Name"}
    if reply[voicePortPath][1]~=nil then
        return tostring(reply[voicePortPath][1].param["Name"])
    end 
    return ""
end

if cgilua.servervariable"REQUEST_METHOD" == "POST" then
    if POST["pathId"] ~= "nil" then
        local voiceProfilePath = "Voice.Profile."..tostring(POST["pathId"])
        delete_voice_profile(voiceProfilePath)
        local voipProfilePathStr = voip_profile_create(POST["SIPURI2"], POST["Username"], POST["Password"], POST["VoicePort"], POST["DisplayName"], POST["AbbrNumber"])
    else
        local voipProfilePathStr = voip_profile_create(POST["SIPURI2"], POST["Username"], POST["Password"], POST["VoicePort"], POST["DisplayName"], POST["AbbrNumber"])
    end
    cgilua.redirect("telephonyConfig.lp")
    return
end

local Username, SIPURI2, Password, ConfirmPassword, DisplayName, AbbrNumber, VoicePort, portmapPathId, voipPortPathId = "", "", "", "", "", "", "", "", ""
if QUERY["pathId"] ~= nil then
    ProfilePath = "Voice.Profile."..QUERY["pathId"]
    local reply, error = mbus.getParameters{ path = ProfilePath, param = {"Username", "SIP-URI", "Password", "DisplayName", "AbbrNumber" } }
    if reply[ProfilePath][1]~=nil then
        SIPURI2 = reply[ProfilePath][1].param["SIP-URI"]
        Username = reply[ProfilePath][1].param["Username"]
        Password = reply[ProfilePath][1].param["Password"]
        DisplayName = reply[ProfilePath][1].param["DisplayName"]
        AbbrNumber = reply[ProfilePath][1].param["AbbrNumber"]
        local portPath = reply[ProfilePath][1].path
            
        local replyPort, error = mbus.getParameters{ path = "Voice.Portmap", param = "VoicePort", filter = "(== UserAgent "..tostring(portPath)..")"}
        if replyPort["Voice.Portmap"][1]~=nil then
            if #(replyPort["Voice.Portmap"]) == 8 then
                VoicePort = "COMMON"
            elseif #(replyPort["Voice.Portmap"]) == 6 then
                VoicePort = "DECT"
            else
                VoicePort = find_voip_port(replyPort["Voice.Portmap"][1].param["VoicePort"])
            end
            voipPortPathId = string.sub(VoicePort, voicePortsPathLen)
            portmapPathId = string.sub(replyPort["Voice.Portmap"][1].path, 15)
        end
    end
end
%>
<script language="javascript" type="text/javascript">

function config_submit()
{
    if (document.getElementById("Password").value != document.getElementById("ConfirmPassword").value)
    {
        document.getElementById("set_service_configuration").style.display = "none";
        document.getElementById("passwordCheck").style.display = "block";
        return false;
    }

    document.getElementById("set_service_configuration").style.display = "none";
    document.getElementById("confirm").style.display = "block";
}

function submitConfirm()
{
    document.getElementById("modify_serv_conf").submit();
}

function cancelConfirm()
{
    document.getElementById("set_service_configuration").style.display = "";
    document.getElementById("passwordCheck").style.display = "none";
}

</script>
</head>
<body>
<table cellspacing='0' cellpadding='0' width="100%" class="NavBar"> <tr><td align="left"><a href="home.lp">casa</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="toolBox.lp">cassetta degli attrezzi</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="telephony.lp">telefonia</a></td><td align="right"><a href="telephonyStato.lp">visione d'insieme</a>&nbsp;&nbsp;|&nbsp;&nbsp;<em>Configura</em>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="telephonyExpert.lp">Esperto Configura</a></td></tr>
</table>

<div class='contentcontainer' id="set_service_configuration">
<hr>
<hr>
<form method="POST" id="modify_serv_conf" action="">
<input type="hidden" id="pathId" name="pathId" value="<%=QUERY["pathId"]%>" />
<input type="hidden" id="portmapPathId" name="portmapPathId" value="<%=portmapPathId%>" />
<div class='contentitem'>
<table border="0" width="100%">
<tr>
    <td class='icon' style='vertical-align:top' width='100px'><img src='images/csharing__xl.gif' alt='Interface'></td>
    <td class='data' style='vertical-align:top'>
        <table cellspacing='0' cellpadding='0' width="100%">
        <tr>
            <td align='left'><span class='itemtitle'><%=translate([==[Telephony Identity]==])%></span></td>
        </tr>
        <tr><td>
            <br><!-- Begin of Service Configuration-->
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td width='40' style='vertical-align:top'><img src='images/bull__md.gif' alt=''></td><td style='vertical-align:top'>
            <span class='blocktitle'><%=translate([==[Telephony Identity]==])%></span><br>
            <table width='100%' class='datatable' cellspacing='0' cellpadding='0' style="line-height:150%;">
                <br><!-- Begin of DeviceInfo-->

                <tr><td></td><td width='30px'></td><td width='220px'></td><td width='50px'></td></tr>
                <tr><td width='90'><%=translate([==[URI]==])%>:</td><td colspan='3'><input type="text" name="SIPURI2" value="<%=SIPURI2%>"/></td></tr>
                <tr><td width='90'><%=translate([==[User Name]==])%>:</td><td colspan='3'><input type="text" name="Username" value="<%=Username%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Password]==])%>:</td><td colspan='3'><input type="password" id="Password" name="Password" value="<%=Password%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Confirm Password]==])%>:</td><td colspan='3'><input type="password" id="ConfirmPassword" name="ConfirmPassword" value="<%=Password%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Display Name]==])%>:</td><td colspan='3'><input type="text" name="DisplayName" value="<%=DisplayName%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Abbr.Number]==])%>:</td><td colspan='3'><input type="text" name="AbbrNumber" value="<%=AbbrNumber%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Port]==])%>:</td><td colspan='3'>
                    <select id="VoicePort" name="VoicePort">
                    <option value="COMMON">COMMON</option>
                    <option value="FXS1">FXS1</option>
                    <option value="FXS2">FXS2</option>
                    <option value="DECT">DECT</option>
                    <option value="DECT1">DECT1</option>
                    <option value="DECT2">DECT2</option>
                    <option value="DECT3">DECT3</option>
                    <option value="DECT4">DECT4</option>
                    <option value="DECT5">DECT5</option>
                    <option value="DECT6">DECT6</option>
                    </select>
                </td></tr>
            </table>
            <br>
            <table cellspacing='0' cellpadding='0' width='100%' style="text-align:center">
            <tr><td style='vertical-align:top'>
                <input type="button" onclick="config_submit();" value="<%=translate([==[Apply]==])%>" name="thb8">&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="button" onclick='javascript: document.location.href="telephonyConfig.lp";' value="<%=translate([==[Cancel]==])%>" name="thb21">
            </td></tr></table>
            </td></tr></table>
        </td></tr></table>
</td></tr></table>
</div>
</form>
</div>
<script src="js/antiCSRF.js"></script>
<div id="confirm" style="display:none">
<%cgilua.lp.include("webparts/confirmBack.lp")%>
</div>
<div id="passwordCheck" style="display:none">
<%cgilua.lp.include("webparts/passwordCheck.lp")%>
</div>
<script language="javascript" type="text/javascript">
var VoicePort = "<%=VoicePort%>";
if(VoicePort != "")
{
    document.getElementById("VoicePort").value=VoicePort;
}
</script>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/style.css" type="text/css"/>
<link rel="stylesheet" href="css/menu.css" type="text/css" />
<script language="javascript" type="text/javascript" src="js/script.js"></script>
<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<%
local translate = translate
local POST=cgilua.POST
local SIPPath = "Voice.SIP"

if cgilua.servervariable"REQUEST_METHOD" == "POST" then

    local modify = {}
    table.insert(modify, {path = SIPPath, param={ PrimRegServer = POST["PrimRegServer"], RegPort = POST["RegPort"], PrimProxyServer = POST["PrimProxyServer"], ProxyPort = POST["ProxyPort"], SecProxyServer = POST["SecProxyServer"], SecProxyPort = POST["SecProxyPort"], Expires = POST["Expires"] }})

    setMBUS(modify)
    cgilua.redirect("telephonyExpert.lp")
    return
end

%>

<script language="javascript" type="text/javascript">

function config_submit()
{
    document.getElementById("set_service_configuration").style.display = "none";
    document.getElementById("confirm").style.display = "block";
}

function submitConfirm()
{
    document.getElementById("modify_serv_conf").submit();
}

function cancelConfirm()
{
    document.getElementById("set_service_configuration").style.display = "";
    document.getElementById("confirm").style.display = "none";
}

</script>
</head>
<body>
<table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
<tr><td align="left"><a href="home.lp">casa</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="toolBox.lp">cassetta degli attrezzi</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="telephonyExpert.lp">telefonia</a></td><td align="right"><a href="telephonyStato.lp">visione d'insieme</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="telephonyConfig.lp">Configura</a>&nbsp;&nbsp;|&nbsp;&nbsp;<em>Esperto Configura</em></td></tr>
</table>

<div class='contentcontainer' id="set_service_configuration">
<hr>
<hr>
<form method="POST" id="modify_serv_conf" action="">
<div class='contentitem'>
<table border="0" width="100%">
<tr>
    <td class='icon' style='vertical-align:top' width='100px'><img src='images/tel___xl.gif' alt=''></td>
    <td class='data' style='vertical-align:top'>
        <table cellspacing='0' cellpadding='0' width="100%">
        <tr>
            <td align='left'><span class='itemtitle'><%=translate([==[Telephony]==])%></span></td>
        </tr>
        <tr><td>
            <br><!-- Begin of Service Configuration-->
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td width='40' style='vertical-align:top'><img src='images/bull__md.gif' alt=''></td><td style='vertical-align:top'>
            <span class='blocktitle'><%=translate([==[Service Configuration]==])%></span><br>
            <table width='100%' class='datatable' cellspacing='0' cellpadding='0' style="line-height:150%;">
<%
            local PrimRegServer, RegPort, PrimProxyServer, ProxyPort, SecProxyServer, SecProxyPort, Expires
            local reply, error = mbus.getParameters{ path = SIPPath, param = {"PrimRegServer", "RegPort", "PrimProxyServer", "ProxyPort", "SecProxyServer", "SecProxyPort", "Expires"} }
            local v = reply[SIPPath][1]
            if v~=nil and v.param~=nil then
                PrimRegServer = v.param["PrimRegServer"]
                RegPort = v.param["RegPort"]
                PrimProxyServer = v.param["PrimProxyServer"]
                ProxyPort = v.param["ProxyPort"]
                SecProxyServer = v.param["SecProxyServer"]
                SecProxyPort = v.param["SecProxyPort"]
                Expires = v.param["Expires"]
%>
                <br><!-- Begin of DeviceInfo-->
                <tr><td></td><td width='30px'></td><td width='220px'></td><td width='50px'></td></tr>
                <tr><td width='90'><%=translate([==[Registrar]==])%>:</td><td colspan='3'><input type="text" name="PrimRegServer" value="<%=PrimRegServer%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Registrar Port]==])%>:</td><td colspan='3'><input type="text" name="RegPort" value="<%=RegPort%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Proxy]==])%>:</td><td colspan='3'><input type="text" name="PrimProxyServer" value="<%=PrimProxyServer%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Proxy Port]==])%>:</td><td colspan='3'><input type="text" name="ProxyPort" value="<%=ProxyPort%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Secondary Proxy]==])%>:</td><td colspan='3'><input type="text" name="SecProxyServer" value="<%=SecProxyServer%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Secondary Proxy Port]==])%>:</td><td colspan='3'><input type="text" name="SecProxyPort" value="<%=SecProxyPort%>"/></td></tr>
                <tr><td width='90'><%=translate([==[Expire Time]==])%>:</td><td colspan='3'><input type="text" name="Expires" value="<%=Expires%>"/></td></tr>
            <% end %>
            </table>
            <br>
            <table cellspacing='0' cellpadding='0' width='100%' style="text-align:center">
            <tr><td style='vertical-align:top'>
                <input type="button" onclick="config_submit();" value="<%=translate([==[Apply]==])%>" name="thb8">&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="button" onclick='javascript: document.location.href="telephonyExpert.lp";' value="<%=translate([==[Cancel]==])%>" name="thb21">
            </td></tr></table>
            </td></tr></table>
        </td></tr></table>
</td></tr></table>
</div>
</form>
</div>
<script src="js/antiCSRF.js"></script>
<div id="confirm" style="display:none">
<%cgilua.lp.include("webparts/confirmBack.lp")%>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/master.css" type="text/css"/>
<% cgilua.lp.include("lp/language.lp") %>
<%
local translate = translate
local POST = cgilua.POST

if cgilua.servervariable"REQUEST_METHOD" == "POST" then
	if POST["assoCheck"]=="1" then
		local path_id = POST["pathId"]
		local path_fxs1 = "Device.Services.VoiceService.1.PhyInterface.1"
		local path_fxs2 = "Device.Services.VoiceService.1.PhyInterface.2"
		local fxs1 = "0"
		local fxs2 = "0"
		local info1, error = mbus.getParameters{path = path_fxs1, param = {"X_TELECOMITALIA_IT_SwitchToPSTNIn", "X_TELECOMITALIA_IT_SwitchToPSTNOut"}, datamodel = "second"}
		if info1[path_fxs1][1].param["X_TELECOMITALIA_IT_SwitchToPSTNIn"] == "true" or 
			info1[path_fxs1][1].param["X_TELECOMITALIA_IT_SwitchToPSTNOut"] == "true" then
			fxs1 = "1"
		end
		local info2, error = mbus.getParameters{path = path_fxs2, param = {"X_TELECOMITALIA_IT_SwitchToPSTNIn", "X_TELECOMITALIA_IT_SwitchToPSTNOut"}, datamodel = "second"}
		if info2[path_fxs2][1].param["X_TELECOMITALIA_IT_SwitchToPSTNIn"] == "true" or 
			info2[path_fxs2][1].param["X_TELECOMITALIA_IT_SwitchToPSTNOut"] == "true" then
			fxs2 = "1"
		end
		if (fxs1 == "1" and path_id == "1") or (fxs2 == "1" and path_id == "2") then
			local to_page = "telephonyMeasurement.lp?asso_warn=1&path_id="..tostring(path_id)
			cgilua.redirect(to_page)
		else
			local to_page = "telephonyMeasurement.lp?asso_warn=0&path_id="..tostring(path_id)
			cgilua.redirect(to_page)
		end
	end
end
	
%>
</head>
<body>
<script type="text/javascript">
//<![CDATA[
function associated_check_submit(pathId)
{
	document.getElementById("assoCheck").value = "1";
	document.getElementById("pathId").value = pathId;
	document.assoCheckForm.submit();
}

function closeConfirm(){
	document.getElementById("TeleService").style.display="block";
	document.getElementById("voiceTest").style.display="none";
	document.getElementById("associatedCheck").style.display="none";	
	document.getElementById("pathId").value = "";
}

function submit_ok()
{
<% 

-- Fix for TI Security Issue mentioned in 20141205-report-agvtf-v2.pdf section C.1
-- Multiple cross-site scripting vulnerabilities 

local path_id = cgilua.QUERY["path_id"]
if path_id ~= nil then 
	path_id = cgilua.urlcode.escape(path_id)
%>
	var pathId = <%=path_id%>;
<%else%>
	var pathId = document.getElementById("pathId").value;
<%end%>
	window.location = "telephonyTest.lp?pathId=" + pathId;
}
//]]>
</script>
<div class="contentContainer">

		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="telephonyMeasurement.lp"><%=translate([==[Home]==])%></a></li><li>|</li><li><a href="telephonyMeasurement.lp"><%=translate([==[Telephony services]==])%></a></li>
			</ul>
		</div>	

		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a class="current">
		<div class="tab">
			<span class="tabIcon_voip"></span>
			<span class="contTabTxt"><%=translate([==[Telephony services]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
			</ol>
		</div>





<!-- <table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
<tr><td align="left"><a href="home.lp"><%=translate([==[Home]==])%></a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="telephonyMeasurement.lp"><%=translate([==[Telephony services]==])%></a></td></tr>
</table> -->

<% if cgilua.QUERY["asso_warn"] ~= nil then %>
<div id="TeleService" class='contentcontainer' style='display:none'>
<%else%>
<div id="TeleService" class='contentcontainer'>
<%end%>
<hr>

<div class='contentitem'>
<form method="POST" name="assoCheckForm" action="">
<input type="hidden" id="pathId" name="pathId" value="" />
<input type="hidden" id="assoCheck" name="assoCheck" value="0">
<table cellspacing='0' cellpadding='0' class="fontSize">
<tr>
<td>
<table  cellspacing='0' cellpadding='0' width='100%' >
    <tr>
	<td class="verticalAlign"> <table cellspacing='0' cellpadding='0' class="martop5">
	<tr>
	<td class="midarea2 tableTitle"><%=translate([==[Test of voice ports]==])%></td></tr></table></td>
				</tr>
            <tr><td>
			<table width='100%'  cellspacing='0' cellpadding='0' class='servizitable fontSize' style="line-height:150%;"> 
                 <tr><td style="vertical-align:top;padding-top:5px;width:150px;" class="sectionArea-1 padleft40 "><%=translate([==[Tests on FXS port]==])%>1:</td>
                    <td colspan='3' class="sectionArea-2 verticalAlign"><a onclick="associated_check_submit('1')">
						<div class="midarea6-1 mainButton" id="testFXS1" name="testFXS1"><%=translate([==[Lance]==])%></div>
						</a>
					</td>
				</tr>
                <tr><td style="vertical-align:top;padding-top:5px;width:150px" class="sectionArea-1 padleft40 "><%=translate([==[Tests on FXS port]==])%>2:</td>
                    <td colspan='3' class="sectionArea-2 verticalAlign">
						<a onclick="associated_check_submit('2')">
							<div class="midarea6-1 mainButton" id="testFXS2" name="testFXS2"><%=translate([==[Lance]==])%></div>
						</a>
					</td>
				</tr>
		<tr><td style="vertical-align:top;padding-top:5px;width:150px" class="sectionArea-1 padleft40 ">&nbsp;</td>
                                        <td colspan='3' class="sectionArea-2">&nbsp;
                                        </td>
                                </tr>
	

				<!-- For CPE_P00106866 -->
				<!--
				 <tr><td style="vertical-align:top;padding-top:5px;width:150px" class="sectionArea-1 padleft40 "><%=translate([==[Test su porta FXO]==])%>:</td>
                    			<td colspan='3' class="sectionArea-2">
						<a onclick="associated_check_submit('4')">
							<div class="midarea6-1 mainButton" id="testFXS2" name="testFXS2"><%=translate([==[Lance]==])%></div>
						</a>
					</td>
				</tr>
				-->	

            </table>
            </td></tr></table><!-- End of showing test FXS result-->
        </td></tr>
        </table>
  
</form>
</div>
</div>

<% if cgilua.QUERY["asso_warn"] ~= nil and cgilua.QUERY["asso_warn"] == "0" then %>
<div id="voiceTest" style="display:block">
<%else%>
<div id="voiceTest" style="display:none">
<%end%>
  <div class='contentcontainer'>
  <div class='contentitem'>
  <table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Warning]==])%>.</td></tr>
            <tr><td class="errorDesc">           
              <p><%=translate([==[Warning: the measurement procedure can result in the removal of telephone calls in progress]==])%></p>
                 <br/>
                 </td></tr></table>
                   </td></tr>
                   <tr><td>
                      <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
                         <tr><td class="verticalAlign fright">
                            <a class="fright" onclick="submit_ok()">
						<div class="midarea6-1 mainButton" name="thb11"><%=translate([==[Next]==])%></div>
					</a>
				</td>
				<td class="verticalAlign" style="padding-left:15px;">
					<a onclick="closeConfirm()">
						<div class="midarea6-1 mainButton" name="thb12"><%=translate([==[Cancel]==])%></div>
					</a>
        </td></tr></table>
    </td></tr></table>
  </div>
  </div>
</div>


<% if cgilua.QUERY["asso_warn"] ~= nil and cgilua.QUERY["asso_warn"] == "1" then %>
<div id="associatedCheck" style="display:block">
<%else%>
<div id="associatedCheck" style="display:none">
<%end%>

  <div class='contentcontainer'>
  <div class='contentitem'>
  <table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Warning]==])%>.</td></tr>
            <tr><td class="errorDesc">          
              <p><%=translate([==[Warning: the measurement procedure can be performed only when the FXS port is not associated with fixed-line input and / or output]==])%></p>
               <br/>
        </td></tr></table>
        </td></tr>
		<tr><td>
         <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
          <tr><td class="width340">&nbsp;</td>
            <td class="verticalAlign">
					<a onclick="closeConfirm()">
						<div class="midarea6-1 mainButton" name="thb12"><%=translate([==[Cancel]==])%></div>
					</a>
        </td></tr></table>
    </td></tr></table>
  </div>
  </div>
</div>

<script src="js/antiCSRF.js" type="text/javascript"></script>

</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/master.css" type="text/css"/>
<!-- <link rel="stylesheet" href="css/style.css" type="text/css"/>
<link rel="stylesheet" href="css/menu.css" type="text/css" /> -->
<script language="javascript" type="text/javascript" src="js/script.js"></script>

<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<% cgilua.lp.include("lp/style.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<% cgilua.lp.include("lp/form.lp")%>
<% cgilua.lp.include("lp/voip.lp")%>
<%
local translate = translate
local POST=cgilua.POST
local tprint=require("tableprint")

local NumberPath = "Device.Services.VoiceService.2.VoiceProfile"
local VoiceServicePath = "Device.Services.VoiceService.1.VoiceProfile.1"

--Define the param of serviceDECTState is Actived or Inactived
function getDECTHandsetStato()
    local serviceDECTPath = "Device.Services.VoiceService.1.PhyInterface.3"
    local replyDECT, error = mbus.getParameters{ path = serviceDECTPath, param = {"X_TELECOMITALIA_IT_Enable"}, datamodel = "second" }
    local serviceDECTState = replyDECT[serviceDECTPath][1].param["X_TELECOMITALIA_IT_Enable"]
    return serviceDECTState
end

--Get the DECTHandsetMaxNumberOfEntries
function getDECTHandsetMaxNumber()
    local DECTHandsetMaxNumberPath = "Device.Services.VoiceService.1.PhyInterface.3"
    local replyMax, error = mbus.getParameters{ path = DECTHandsetMaxNumberPath, param = {"X_TELECOMITALIA_IT_DECTHandsetMaxNumberOfEntries"}, datamodel = "second" }
    local DECTHandsetMaxNumber = replyMax[DECTHandsetMaxNumberPath][1].param["X_TELECOMITALIA_IT_DECTHandsetMaxNumberOfEntries"]
    return DECTHandsetMaxNumber
end

-- Get the Active Dect Handset count
-- Added by Vignesh A J
function getActiveDECTHandsetCount()
    local activeDectCount = 0
    local dectHandsetPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset"
    local reply, error = mbus.getParameters{ path = dectHandsetPath, param = {"Active"}, datamodel = "second" }
    if reply[dectHandsetPath]~=nil then
        for j,k in pairs(reply[dectHandsetPath]) do
			local activeStatusVal = k.param["Active"]
			
            if activeStatusVal=="true" then
                activeDectCount = tonumber(activeDectCount) + 1
            end
        end
    end
    return activeDectCount
end

--Get the DECTHandsetNumberOfEntries
function getDECTHandsetNumber()
    local DECTActive
    local DECTNum = 0
    local DECTHandsetNumberPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset"
    local reply, error = mbus.getParameters{ path = DECTHandsetNumberPath, param = {"Active"}, datamodel = "second" }
    if reply[DECTHandsetNumberPath]~=nil then
        for j,k in pairs(reply[DECTHandsetNumberPath]) do
            DECTActive = k.param["Active"]
            if DECTActive=="true" then
                DECTNum = tonumber(DECTNum) + 1
            end
        end
    end
    return DECTNum
end

--Get the active value which is true
function getDECTHandsetActive()
    local DECTHandsetActivePath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset"
    local replyActive, error = mbus.getParameters{ path = DECTHandsetActivePath, param = "Active", datamodel = "second" }
    local DECTHandsetActive = replyActive[DECTHandsetActivePath][1].param["Active"]
    return DECTHandsetActive
end

--Get the DECT PIN code
function getPINCode()
    local PINCodePath = "Voice.DECT.Base"
    local replyPIN, error = mbus.getParameters{ path = PINCodePath, param = "Pin" }
    local PINCode = replyPIN[PINCodePath][1].param["Pin"]
    return PINCode
end

--Change the value of FaxT38 checkbox
if cgilua.servervariable"REQUEST_METHOD" == "POST" then
    local modify = {}
    if POST["FaxT38Flag"] == "1" then
        local FaxTPath = "Device.Services.VoiceService.1.VoiceProfile.1.FaxT38"
        local replyFax, error = mbus.getParameters{ path = FaxTPath, param = {"Enable"}, datamodel = "second" }
        local FaxTActive = replyFax[FaxTPath][1].param["Enable"]
        if (POST["FaxTChk"]=="ON" and FaxTActive=="false") or (POST["FaxTChk"]==nil and FaxTActive=="true") then
            local status = "false"
            if POST["FaxTChk"]=="ON" and FaxTActive=="false" then
                status = "true"
            end
            modify = {}
            table.insert(modify, {path=FaxTPath, param= {Enable=status}, datamodel = "second"})
            local result = setMBUS_IGD(modify)
            if result==1 then
                cgilua.redirect("resultKO.lp")
                return
            end
        end
    end
    if POST["DECTInfoFlag"] == "1" then
        local DECTActive = getDECTHandsetStato()
        local enableDECTPath  = "Device.Services.VoiceService.1.PhyInterface.3"
        if (POST["EnableDECTChk"]=="ON" and DECTActive=="false") or (POST["EnableDECTChk"]==nil and DECTActive=="true") then
            local DECTstatus = "false"
            if POST["EnableDECTChk"]=="ON" and DECTActive=="false" then
                DECTstatus = "true"
            end
            modify = {}
            table.insert(modify, {path=enableDECTPath, param= {X_TELECOMITALIA_IT_Enable=DECTstatus}, datamodel = "second"})
            local result = setMBUS_IGD(modify)
            if result==1 then
                cgilua.redirect("resultKO.lp")
                return
            end
        end
    end

    if POST["DECTAttachFlag"] == "1" then
        local attachTerPath = "Voice.DECT.Base"
        modify = {}
        table.insert(modify, {path=attachTerPath, param={StartSubs="true"}})
        local result = setMBUS(modify)
        if result==1 then
            cgilua.redirect("resultKO.lp")
            return
        end
    end

    if POST["FXOInfoFlag"] == "1" then
        local enableFXOPath = "Device.Services.VoiceService.1.PhyInterface.4"
        local replyFXOEnable, error = mbus.getParameters{ path = enableFXOPath, param = {"X_TELECOMITALIA_IT_Enable"}, datamodel = "second" }
        local FXOActive = replyFXOEnable[enableFXOPath][1].param["X_TELECOMITALIA_IT_Enable"]
        if (POST["EnableFXOChk"]=="ON" and FXOActive=="false") or (POST["EnableFXOChk"]==nil and FXOActive=="true") then
            local FXOstatus = "false"
            if POST["EnableFXOChk"]=="ON" and FXOActive=="false" then
                FXOstatus = "true"
            end
            modify = {}
            table.insert(modify, {path=enableFXOPath, param= {X_TELECOMITALIA_IT_Enable=FXOstatus}, datamodel = "second"})
            local result = setMBUS_IGD(modify)
            if result==1 then
                cgilua.redirect("resultKO.lp")
                return
            end
        end
        local PSTNPath = "Device.Services.VoiceService.1.VoiceProfile.1"
        local replyPSTN, error = mbus.getParameters{ path = PSTNPath, param = {"PSTNFailOver"}, datamodel = "second" }
        local PSTNFailOver = replyPSTN[PSTNPath][1].param["PSTNFailOver"]
        if (POST["PSTNState"] == "0" and PSTNFailOver=="true") or (POST["PSTNState"] == "1" and PSTNFailOver=="false") then
            local PSTNFailOverState = "false"
            if (POST["PSTNState"] == "0" and PSTNFailOver=="true") then
                PSTNFailOverState = "false"
            end
            if (POST["PSTNState"] == "1" and PSTNFailOver=="false") then
                PSTNFailOverState = "true"
            end
            modify = {}
            table.insert(modify, {path=PSTNPath, param= {PSTNFailOver=PSTNFailOverState}, datamodel = "second"})
            local result = setMBUS_IGD(modify)
            if result==1 then
                cgilua.redirect("resultKO.lp")
                return
            end
        end
    end

    if POST["FXONumFlag"] == "1" then
        local modify = {}
        local fixedFXONum = POST["fixedLineNum"]
		if fixedFXONum~="" then
			local IsFXONumExist = getFXONum()
			if IsFXONumExist=="" then
				local reply, error = mbus.modify(
				function()
					local reply, error = mbus.addObjects{path = "ENV", param = {Value = fixedFXONum, Name = "IsFXONum"}}
				end)
			else
				local replyFXOPath, errorFXOPath = mbus.getParameters{ path = "ENV", param = { "Name", "Value" }, filter = "(== Name ".. "IsFXONum" ..")" }
				local FXOPath = replyFXOPath["ENV"][1].path
				table.insert(modify, {path = FXOPath, param = {Value = fixedFXONum}})
				setMBUS(modify)
			end
		end
    end

    if POST["DECTTerminalsFlag"] == "1" then
        local rowIndex = POST["rowIndex"]
        local terminalsPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. tostring(rowIndex)
        modify = {}
        table.insert(modify, {path=terminalsPath, param= {Active="false"}, datamodel = "second"})
        local result = setMBUS_IGD(modify)
        if result==1 then
            cgilua.redirect("resultKO.lp")
            return
        end
    end
saveall(0,1)
cgilua.redirect("telephonyNumber.lp")
end

local DECTMaxNum = getDECTHandsetMaxNumber()
local DECTNum = getDECTHandsetNumber()
local MaxDECTNumber = translate([==[Reached the maximum number of active DECT terminals. For others it is encouraged to combine necessary to delete any of the items]==])
local NoPSTNNumber = translate([==[Before pairing, it is necessary have an active phone service.]==])
%>
<script language="javascript" type="text/javascript">

function showErrorMsg(errorMsgStr)
{
    document.getElementById("set_telephony_number").style.display="none";
    document.getElementById("resultDECTKO").style.display="block";
    document.getElementById("errorMsg").innerHTML=errorMsgStr;
}

function changeTeleEnable()
{
    setTimeout(function() { alert('Please Wait!'); }, 1);
    document.getElementById("FXOInfoFlag").value="1";
    document.modify_voice_server_number.submit();
}

function submitNumToENV()
{
    document.getElementById("configFixedLine").style.display = "none";
    document.getElementById("confirm").style.display = "block";
}

function attachTerminal()
{
    setTimeout(function() { alert('Please Wait!'); }, 1);
    <% if tonumber(DECTNum)==tonumber(DECTMaxNum) then %>
        showErrorMsg('<%=MaxDECTNumber%>');
        return false;
    <% else %>
        document.getElementById("DECTAttachFlag").value="1";
        document.modify_voice_server_number.submit();
    <% end %>
}

function confNumToPSTN()
{
    setTimeout(function() { alert('Please Wait!'); }, 1);
    document.getElementById("FXONumFlag").value="1";
    document.modify_voice_server_number.submit();
}

function enableDect()
{
    setTimeout(function() { alert('Please Wait!'); }, 1);
    document.getElementById("DECTInfoFlag").value="1";
    document.modify_voice_server_number.submit();
}

function disTerminal(rowIndex)//disassociatesNumber:line number
{
    document.getElementById("rowIndex").value=rowIndex;
    document.getElementById("DECTTerminalsFlag").value = "1";
    document.modify_voice_server_number.submit();
}

function changeFaxT38()
{
    setTimeout(function() { alert('Please Wait!'); }, 1);
    document.getElementById("FaxT38Flag").value="1";
    document.modify_voice_server_number.submit();
}

function enableSubmit(PSTNState)
{
    setTimeout(function() { alert('Please Wait!'); }, 1);
    document.getElementById("FXOInfoFlag").value="1";
    document.getElementById("PSTNState").value=PSTNState;
    document.modify_voice_server_number.submit();
}

function submitConfirm()
{
    document.getElementById("modify_voice_server_number").submit();
}

function cancelConfirm()
{
    document.getElementById("set_telephony_number").style.display = "";
    document.getElementById("resultDECTKO").style.display="none";
    document.getElementById("confirm").style.display = "none";
}

</script>

</head>
<body>

<div class="contentContainer">
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li> <li><a href="telephonyNumber.lp"><%=translate([==[Telephone numbers]==])%></a></li> 
			</ul>
		</div>

<!-- <table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
<tr><td align="left"><a href="advance.lp">Avanzate</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="telephonyNumber.lp">Numeri telefonici</a></td><td align="right"><a href="voipStato.lp">Stato</a></td></tr>
</table> -->

<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a href="voipStato.lp">
		<div class="tab">
			<span class="tabIcon_sttel"></span>  
			<span class="contTabTxt transform"><%=translate([==[Telephony services]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
		
			<li><a href="telephonyNumber.lp"  class="current margin15">
		
		<div class="tab">
			<span class="contTabTxt transform"><%=translate([==[Telephone numbers]==])%></span></div></a></li>
		
			</ol>
	</div>


<div class='contentcontainer' id="set_telephony_number">
<hr>
<form method="POST" name="modify_voice_server_number" id="modify_voice_server_number" action="">
<input type="hidden" id="PSTNState" name="PSTNState" value=""/>
<div class='contentitem'>

<table border="0" width="100%">
<tr>
    <td class='data' style='vertical-align:top'>
        <table cellspacing='0' cellpadding='0' width="100%">
        <tr><td>
            <br> <!-- Begin of showing telephony numbers-->
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td width='40' style='vertical-align:top'></td><td style='vertical-align:top'>             
            <span class='midarea2_telmain tableTitle'><%=translate([==[Telephone numbers]==])%></span><br>
                <table class='edittable valueSpace' width='100%' cellspacing='0' cellpadding='0' border='0'>
                <!-- <tr><td colspan='3' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                <tr><td colspan='3'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr> -->
                <tr><th width='20%' class="tableHd"><%=translate([==[phone Number]==])%></th><th width='35%' class="tableHd"><%=translate([==[Associated terminals for incoming calls]==])%></th><th width='35%' class="tableHd"><%=translate([==[Associated Terminals for outgoing calls]==])%></th></tr>
                <!-- <tr><td colspan='3'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr> -->
                <tr><td colspan='3' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                <%
                local rowStyle = "oddrow"
                local rowNum = 0
                local phoneNumber, terminalPhoneNumber, lanManagedVal, UAMap, VoicePortMap = "-", "false", "-", "-"
				local reply, error, FromUA, ToUA
				for i=1, 3 do
					local allincomteminal = ""
					local alloutgoteminal = ""
					local extuacount = 0
					NumberPath = "Device.Services.VoiceService.2.VoiceProfile."..i..".Line.1"
					reply, error = mbus.getParameters{ path = NumberPath, param = {"DirectoryNumber", "X_TELECOMITALIA_IT_LANManaged"}, datamodel = "second" }

					if reply[NumberPath][1] ~= nil then
					
                        phoneNumber = reply[NumberPath][1].param["DirectoryNumber"]
						if phoneNumber ~= nil and phoneNumber ~= "" then
						
							terminal_path = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"
							replyterminal_path, error = mbus.getParameters{ path = terminal_path, param = {"FromUA", "ToUA"}, datamodel = "second" }
							if replyterminal_path[terminal_path] ~= nil and replyterminal_path[terminal_path][1] ~= nil then
								for j,v in pairs(replyterminal_path[terminal_path]) do
									FromUA = v.param["FromUA"]
									ToUA = v.param["ToUA"]
						
									if FromUA == NumberPath then
										replyTopath, error = mbus.getParameters{ path = ToUA, param = {"DirectoryNumber"}, datamodel = "second" }
										terminalPhoneNumber = replyTopath[ToUA][1].param["DirectoryNumber"]

										local UAMapAll, VoicePortMapAll
										local phoneTypePath
										local replydirNumberpath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
										local replydirNumber, error = mbus.getParameters{ path = replydirNumberpath, param = {"DirectoryNumber"}, datamodel = "second" }
										if replydirNumber[replydirNumberpath] ~= nil then
											for l,m in pairs(replydirNumber[replydirNumberpath]) do
												local mapdirNumber = m.param["DirectoryNumber"]
												if mapdirNumber == terminalPhoneNumber then
													phoneTypePath = m.path
												end
											end
										end						
						
										local incomingPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap"
										local outgoingPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap"
										local replyIncoming, error = mbus.getParameters{ path = incomingPath, param = {"FromUA", "ToVoicePort"}, filter = "(== FromUA "..tostring(phoneTypePath)..")", datamodel = "second" }
										local replyOutgoing, error = mbus.getParameters{ path = outgoingPath, param = {"ToUA", "FromVoicePort"}, filter = "(== ToUA "..tostring(phoneTypePath)..")", datamodel = "second" }
										for j,k in pairs(replyIncoming[incomingPath]) do
											if (k.param["ToVoicePort"]) ~= nil then
												UAMap = k.param["ToVoicePort"]
												
												if UAMap~=nil then
													local UAMapId = string.sub(UAMap, -1)
													if UAMap=="Device.Services.VoiceService.1.PhyInterface.3" then
														UAMap = "DECT1"..",".."DECT2"..",".."DECT3"..",".."DECT4"..",".."DECT5"
													else
														if string.match(tostring(UAMap), "DECTHandset")~=nil then
															UAMap = "DECT" .. tostring(UAMapId)
														else
															UAMap = "FXS" .. tostring(UAMapId)
														end
													end
													if UAMapAll==nil then
														UAMapAll = UAMap
													else
														UAMapAll = UAMapAll .. "," .. UAMap
													end
												end
											end											
										end
										if UAMapAll==nil then											
											UAMapAll = "-"
										end

										for t,l in pairs(replyOutgoing[outgoingPath]) do
											if (l.param["FromVoicePort"]) ~= nil then
												VoicePortMap = l.param["FromVoicePort"]
												if VoicePortMap~=nil then
													local VoicePortMapId = string.sub(VoicePortMap, -1)
													if VoicePortMap=="Device.Services.VoiceService.1.PhyInterface.3" then
														VoicePortMap = "DECT1"..",".."DECT2"..",".."DECT3"..",".."DECT4"..",".."DECT5"
													else
														if string.match(tostring(VoicePortMap), "DECTHandset")~=nil then
															VoicePortMap = "DECT" .. tostring(VoicePortMapId)
														else
															VoicePortMap = "FXS" .. tostring(VoicePortMapId)
														end
													end
													if VoicePortMapAll ==nil then
														VoicePortMapAll = VoicePortMap 
													else
														VoicePortMapAll = VoicePortMapAll .. "," .. VoicePortMap 
													end
												end
											end
										end
										if VoicePortMapAll==nil then
											VoicePortMapAll = "-"
										end
										if VoicePortMapAll ~= "-" or UAMapAll ~= "-" then
											extuacount = extuacount + 1
											if allincomteminal == "" then
												allincomteminal = UAMapAll
											else
												if extuacount%4 == 0 then
													allincomteminal = tostring(allincomteminal)..", "..tostring(UAMapAll)
												else
													allincomteminal = tostring(allincomteminal)..", "..tostring(UAMapAll)
												end
												if extuacount%3 == 0 then
													allincomteminal = tostring(allincomteminal).." <br/> "
												end
											end
											
											
											if alloutgoteminal == "" then
												alloutgoteminal = VoicePortMapAll
											else
												if extuacount%4 == 0 then
													alloutgoteminal = tostring(alloutgoteminal)..", "..tostring(VoicePortMapAll)
												else
													alloutgoteminal = tostring(alloutgoteminal)..", "..tostring(VoicePortMapAll)
												end
												if extuacount%3 == 0 then
													alloutgoteminal = tostring(alloutgoteminal).." <br/> "
												end
											end
										end
									end
								end
							end
							
							local phyIntf_IP = getIPConnectionInfo()
							local phoneIPType
							if #phyIntf_IP > 0 then
								for i=1, #phyIntf_IP do
									local v = phyIntf_IP[i]
									phoneIPType = v.name
									local inOutCall = v.AllInOutCallNum1
									if inOutCall ~= nil and inOutCall ~= "" then
										local inOutCallArray = split(inOutCall,"##")
										local incomingCallNum, outgoingCallNum = "-", "-"
										incomingCallNum = inOutCallArray[1]
										outgoingCallNum = inOutCallArray[2]
										local strfind = string.find
										local temp, j = 0
										temp = strfind(incomingCallNum, "/>", j)
										if temp ~= nil then
											local incomingCallNumber = split(incomingCallNum,"/>")
											incomingCallNum = incomingCallNumber[2]
										end
										if incomingCallNum == phoneNumber then
											extuacount = extuacount + 1
											if allincomteminal == "" then
												allincomteminal = v.name
											else
												if extuacount%4 == 0 then
													allincomteminal = tostring(allincomteminal)..", "..tostring(v.name)
												else
													allincomteminal = tostring(allincomteminal)..", "..tostring(v.name)
												end
												if extuacount%3 == 0 then
													allincomteminal = tostring(allincomteminal).." <br/> "
												end
											end
											if alloutgoteminal == "" then
												alloutgoteminal = v.name
											else
												if extuacount%4 == 0 then
													alloutgoteminal = tostring(alloutgoteminal)..", "..tostring(v.name)
												else
													alloutgoteminal = tostring(alloutgoteminal)..", "..tostring(v.name)
												end
												if extuacount%3 == 0 then
													alloutgoteminal = tostring(alloutgoteminal).." <br/> "
												end
											end
										end
									end	
								end
							end	
							
							if extuacount ~= 0 then
								rowNum = rowNum + 1
								if rowNum%2==1 then
									rowStyle = "oddrow"
								else
									rowStyle = "evenrow"
								end%>
								
								<tr><td class="<%=rowStyle%>" colspan='3'></td></tr>
								<tr class="<%=rowStyle%>">
								<td class="<%=rowStyle%>" style="word-break:break-all;width:300px;"><%=phoneNumber%></td>
								<td class="<%=rowStyle%>"><%=tostring(allincomteminal)%></td>
								<td class="<%=rowStyle%>"><%=tostring(alloutgoteminal)%></td>
								</tr>
								<tr><td class="<%=rowStyle%>" colspan='3'></td></tr>
							<%end
						end
					end
				end%>
                </table>
            </td></tr></table> <!-- End of showing telephony numbers-->
        </td></tr>
        <tr><td>
  <!-- Begin of Configuring the fixed line -->
            <table cellspacing='0' cellpadding='0' width='100%' id='configFixedLine' class="width770 marleft40" style="clear:both;"><tr><td style='vertical-align:top'>
            <input type="hidden" id="FXOInfoFlag" name="FXOInfoFlag" value="0"/>
            <input type="hidden" id="FXONumFlag" name="FXONumFlag" value="0"/>
            <span class='midarea2_telmain tableTitle martop15 fbold'><%=translate([==[Configuring the fixed line]==])%></span>
            <span class='midarea4_telmain1 tableTitle fbold'><%=translate([==[FXO port]==])%></span>
                <table  cellspacing='0' cellpadding='0' border='0' class="width750">
                <%
                local enablePath = "Device.Services.VoiceService.1.PhyInterface.4"
                local replyEnable, error = mbus.getParameters{ path = enablePath, param = "X_TELECOMITALIA_IT_Enable", datamodel = "second" }
                local Enable = replyEnable[enablePath][1].param["X_TELECOMITALIA_IT_Enable"]
                local FXOEnable = translate([==[Disable]==])
                if Enable=="true" then
                    FXOEnable = translate([==[Active]==])
                end
                --Enable : Attiva/Disattiva
                %>

                <tr>
					<td class="fleft width200"><%=translate([==[state]==])%>:</td>
					<td class="fleft" colspan="2"><div><%=FXOEnable%></div></td>
				</tr>
                <%
                local isChecked = 'checked="checked"'
                if getFXOVoiceServiceEnable()=="false" then
                    isChecked = ""
                end
                %>
                <tr>
					<td class="fleft width200 paddtop10" ><%=translate([==[Fixed network active]==])%>:</td>
					<td class="fleft paddtop10 width20" >
					<input type="checkbox" <%=isChecked%> name="EnableFXOChk" value="ON" /></td>
					 <td class="fleft verticalAlign padtop5 padleft108">
					 <a onclick='changeTeleEnable()' href="#"><div class='midarea6-1 mainButton'><%=translate([==[Apply]==])%></div></a>
					</td>
					</tr>	
					                <%
                local PSTNNum = getFXONum()
                if Enable=="true" then
                %>
                   <tr>
                    <td class="fleft width200 paddtop10"><%=translate([==[Number of fixed line]==])%>:
                    <input type="text" id="fixedLineNum" name="fixedLineNum" size="12" value="<%=PSTNNum%>" class="inputClass"/></td>
                    <td class="fleft  buttonTop padleft128" colspan="2">
					<a onclick='confNumToPSTN()' href="#"><div class='midarea6-1 mainButton' name="thb9"><%=translate([==[Configure]==])%></div></a>					</td></tr>
                <%
                else
                %>
                   <tr>
                    <td class="fleft width200 paddtop10"><%=translate([==[Number of fixed line]==])%>:</td>
					<td class="fleft paddtop10" colspan="2"><%=PSTNNum%></td></tr>
                <%end%>
				 </table>
				 <table width='100%' cellspacing='0' cellpadding='0' border='0'>
                              <tr><td colspan='2' class='black'>&nbsp;</td></tr>
                <tr><td colspan='2' ><p><%=translate([==[The user must have an active network of telephone numbering PSTN. The fixed line can be switched off when the router is connected only via the internet and not with landline. In this case all calls take place over the Internet]==])%>.</p></td></tr>
                <tr><td colspan='2'>&nbsp;</td></tr>
                <tr><td  class="fleft alignMid padtop5 fallback"><%=translate([==[Enables the functionality of wireline Fall Back]==])%>:</td>
                <td class="fleft" style="width:300px;" >
                <%
                if Enable=="true" then
                    local PSTNPath = "Device.Services.VoiceService.1.VoiceProfile.1"
                    local replyPSTN, error = mbus.getParameters{ path = PSTNPath, param = {"PSTNFailOver"}, datamodel = "second" }
                    local PSTNFailOver = replyPSTN[PSTNPath][1].param["PSTNFailOver"]
                    if PSTNFailOver == "true" then
                %>
					<a onclick="enableSubmit('0')" href="#"><div class='midarea6-1 mainButton'><%=translate([==[Disable]==])%></div></a><br>
                    <!-- <input type="button" value="<%=translate([==[Disable]==])%>" onclick="enableSubmit('0')" /> -->
                    <%else%>
					<a onclick="enableSubmit('1')" href="#"><div class='midarea6-1 mainButton'><%=translate([==[Active]==])%></div></a><br>
                    <!-- <input type="button" value="<%=translate([==[Active]==])%>" onclick="enableSubmit('1')" /> -->
                    <%end%>
                <%end%>
                </td></tr>
                <tr><td colspan='2'>&nbsp;</td></tr>
                <tr style="height:55px"><td colspan='2' ><p ><%=translate([==[The functionality of Fall Back on fixed-line allows you to use DECT and analog telephones connected to the router via the PSTN in the event of a fall Internet connection (either analog telephones, DECT) or interruption to a router (only analog phones). The user must have an active phone numbers on the PSTN]==])%>.</p></td></tr>
                </table></td></tr> </table>
            <!-- End of Configuring the fixed line-->
        </td></tr>
        <tr><td>
            <!-- Begin of DECT information-->
            <table cellspacing='0' cellpadding='0' width='100%' class="width770"><tr><td width='40' style='vertical-align:top'><!-- <img src='#' alt=''> --></td><td style='vertical-align:top'>
            <input type="hidden" id="DECTInfoFlag" name="DECTInfoFlag" value="0"/>
            <input type="hidden" id="DECTAttachFlag" name="DECTAttachFlag" value="0"/>
            <span class='midarea4_telmain1 tableTitle fbold'><%=translate([==[DECT]==])%></span><br>
            <span class='midarea4_telmain1 tableTitle fbold'><%=translate([==[DECT service]==])%></span>
                <table width='100%' cellspacing='0' cellpadding='0' border='0'>
				
                    <% 
                    local DECTState = getDECTHandsetStato()
                    local serviceDECTState = translate([==[Disable]==])
                    if DECTState=="true" then
                        serviceDECTState = translate([==[Active]==])
                    end
                    %>
                    <tr>
					<td class="fleft width200"><%=translate([==[Status]==])%>:</td>
					<td class="fleft" colspan="2" ><%=serviceDECTState%></td></tr>
                    <%
                    local isChecked = 'checked="checked"'
                    if getServiceDECTEnable()=="false" then
                        isChecked = ""
                    end
                    local PINCode = getPINCode()
                    %>
				<tr>
	             <td class="fleft paddtop10 alignMid width200" ><%=translate([==[Enables DECT]==])%>: </td>
				 <td class="fleft paddtop10 alignMid width20">
				 <input type="checkbox" <%=isChecked%> name="EnableDECTChk" value="ON" /></td>
				 <td class="verticalAlign padtop5  fleft enableDECT">
						<a id="enableDECT" name="enableDECT" onclick='enableDect()' href="#">
						<div class='midarea6-1 mainButton'><%=translate([==[Apply]==])%></div>
						</a>
						</td>
				</tr>

				<tr>
					<td colspan='3' ><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br>
					</td>
				</tr>

                    <tr>
					<td class="alignMid fleft width200 paddtop10"><%=translate([==[PIN terminals Association]==])%>:</td>
					<td class="alignMid fleft width50 paddtop10"><div><%=PINCode%></div></td>
					<td class=" fleft padtop5 padleft78">
					<a onclick='attachTerminal()' href="#">
					<div class='midarea7-1 mainButton'><%=translate([==[Attach the terminal]==])%></div></a>
					</td>
					</tr>
                    <tr><td colspan='3' class="padtop5">
					<p><%=translate([==[The PIN you must enter on the register]==])%>.</p>
					</td></tr>
                </table>
            <span class='midarea2_telmain tableTitle padtop10 fbold'>
				<%=translate([==[DECT terminals]==])%></span><!-- <br> -->
                <table class='edittable valueSpace' width='100%' cellspacing='0' cellpadding='0' border='0' id='terminalsDECT'>
                <input type="hidden" id="DECTTerminalsFlag" name="DECTTerminalsFlag" value="0"/>
                <input type="hidden" id="rowIndex" name="rowIndex" value=""/>
                    <%
                    local associatedTerminalsPath = "Device.Services.VoiceService.1.PhyInterface.3"
                    local replyTerminals, error = mbus.getParameters{ path = associatedTerminalsPath, param = {"X_TELECOMITALIA_IT_DECTHandsetMaxNumberOfEntries"}, datamodel = "second" }
                    local associatedTerminals = replyTerminals[associatedTerminalsPath][1].param["X_TELECOMITALIA_IT_DECTHandsetMaxNumberOfEntries"]
                    %>
                    <!-- <tr class='midarea4_newtelmain2'> -->
					<tr><td class=" paddtop10 alignMid"><%=translate([==[Number of terminals associated]==])%>:</td>
					<td  colspan="2"><%=associatedTerminals%></td>
					</tr>
					
					<!-- Fix for CPE_P00104548 -->
				
					<tr><td class=" paddtop10 alignMid"><%=translate([==[Number of terminals associating]==])%>:</td>
					<td colspan="2"><%=getActiveDECTHandsetCount()%></td>
					</tr>
							<tr><td colspan='3'>&nbsp;</td></tr>
					
                    <tr><td  class="tableHd " style="width:200px;"><%=translate([==[terminal Name]==])%></td><td  class="tableHd "><%=translate([==[Status]==])%></td><td class="tableHd" ><%=translate([==[Disassociates terminal]==])%></td></tr>
					<!-- <tr><td colspan='3'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr> -->
					<tr><td colspan='3' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                    <%
                    local rowStyle = "oddrow"
                    local rowNum = 0
                    local handsetDECTActive
                    local handsetPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset"
                    local replyHandset, error = mbus.getParameters{ path = handsetPath, param = {"Active", "TerminalName"}, datamodel = "second" }
                    for i,v in pairs(replyHandset[handsetPath]) do
                        handsetDECTActive = "Non associato"
                        local handsetActive = v.param["Active"]
                        local terminalName = v.param["TerminalName"]
                        if handsetActive == "true" then
                            handsetDECTActive = "Associato"
                        end
                        rowNum = rowNum + 1
                        if rowNum%2==1 then
                            rowStyle = "oddrow"
                        else
                            rowStyle = "evenrow"
                        end
                    %>
                    <tr>
                    <td  class="<%=rowStyle%>"><%=terminalName%><input type="hidden" id="terminalName<%=rowNum%>" name="terminalName<%=rowNum%>" value="<%=terminalName%>" /></td>
                    <td  class="<%=rowStyle%>"><%=handsetDECTActive%></td>
                    <%
                        if handsetActive == "true" then
                    %>
                    <td class="<%=rowStyle%> buttonTop">
					<a onclick='javascript: disTerminal("<%=i%>");' href="#"><div class='midarea7-1 mainButton'><%=translate([==[Disassociates terminal]==])%></div></a>
					<!-- <input type="button" class="button" onclick='javascript: disTerminal("<%=i%>");' value="<%=translate([==[Disassociates terminal]==])%>"  /> -->
					</td>
                    <%
                        else
                    %>
                    <td class="<%=rowStyle%>" style="width:170px">Non associato</td>
                        <%end%>
                    <%end%>
                    </tr>
                </table>
            </td><!-- </tr> --></table><!-- End of DECT information-->
        </td></tr>
        <tr><td>
            <br><!-- Begin of Other Options-->
            <table cellspacing='0' cellpadding='0' width='100%' class="width770">
				<tr>
					<td width='40' style='vertical-align:top'><!-- <img src='images/bull__md.gif' alt=''> --></td>
					<td style='vertical-align:top'>
            <input type="hidden" id="FaxT38Flag" name="FaxT38Flag" value="0"/>
            <span class='midarea2_telmain tableTitle fbold'>Fax T.38</span>
                <table class='' width='100%' cellspacing='0' cellpadding='0' border='0'>
                    <%
                    local isChecked = 'checked="checked"'
                    if getFaxTEnable()=="false" then
                        isChecked = ""
                    end
                    local FaxT = getFaxTEnable()
                    local FaxTStato = translate([==[off]==])
                    if FaxT=="true" then
                        FaxTStato = translate([==[on]==])
                    end
                    %>
                    <tr>
						<td class="fleft width200"><%=translate([==[Status]==])%>:</td>
						<td class="fleft " colspan="2"><%=FaxTStato%></td>
					</tr>
                    <tr>
						<td class="fleft width200 paddtop10"><%=translate([==[Configure]==])%>: </td>
						<td class="fleft paddtop10 width20" ><input type="checkbox" <%=isChecked%> name="FaxTChk" value="ON"  class=" alignMid"/>
						</td>
						                    <td class="verticalAlign buttonTop fleft padleft108">
						<a onclick='javascript: changeFaxT38();' href="#"><div class='midarea6-1 mainButton'><%=translate([==[Apply]==])%></div></a>
						</td></tr>
					<tr>
					<td class="fleft width200 paddtop10">&nbsp;</td>

					</tr>
					
                </table>
            </td></tr></table><!-- End of Other Options-->
        </td></tr>
        </table>
    </td>
</tr>
</table>
</div>
</form>
</div>

<div id="confirm" style="display:none">
<%cgilua.lp.include("webparts/confirmBack.lp")%>
</div>
<div id="resultDECTKO" style="display:none">
<%cgilua.lp.include("webparts/resultKO_VoIP.lp")%>
</div>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/master.css" type="text/css"/>
<!-- <link rel="stylesheet" href="css/style.css" type="text/css"/>
<link rel="stylesheet" href="css/menu.css" type="text/css" /> -->
<script language="javascript" type="text/javascript" src="js/script.js"></script>
 <script language="JavaScript" type="text/javascript">
   if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="submenuselect1";
		//window.parent.menu.document.getElementById("teleSub").style.display="block";	
	}
	
	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="";
	}

	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}
	
	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
		if(window.parent.menu.document.getElementById("ipv6list")) {
			window.parent.menu.document.getElementById("ipv6firewall").className="";
			window.parent.menu.document.getElementById("ipv6list").style.display="none";
		}
	}

	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {
		window.parent.menu.document.getElementById("port").className="";
	}

	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="";
	}
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {
		window.parent.menu.document.getElementById("urlfi").className="";
	}

	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {
		window.parent.menu.document.getElementById("waon").className="";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {
		window.parent.menu.document.getElementById("stru").className="";
	}	
  </script>
<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<% cgilua.lp.include("lp/style.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<% cgilua.lp.include("lp/form.lp")%>
<% cgilua.lp.include("lp/voip.lp")%>
<%
local translate = translate
local POST=cgilua.POST
local tprint=require("tableprint")

local NumberPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
local VoiceServicePath = "Device.Services.VoiceService.1.VoiceProfile.1"


local QUERY=cgilua.QUERY
local triggerFlag = QUERY["f"]

--Define the param of serviceDECTState is Actived or Inactived
function getDECTHandsetStato()
    local serviceDECTPath = "Device.Services.VoiceService.1.PhyInterface.3"
    local replyDECT, error = mbus.getParameters{ path = serviceDECTPath, param = {"X_TELECOMITALIA_IT_Enable"}, datamodel = "second" }
    local serviceDECTState = replyDECT[serviceDECTPath][1].param["X_TELECOMITALIA_IT_Enable"]
    return serviceDECTState
end

--Get the DECTHandsetMaxNumberOfEntries
function getDECTHandsetMaxNumber()
    local DECTHandsetMaxNumberPath = "Device.Services.VoiceService.1.PhyInterface.3"
    local replyMax, error = mbus.getParameters{ path = DECTHandsetMaxNumberPath, param = {"X_TELECOMITALIA_IT_DECTHandsetMaxNumberOfEntries"}, datamodel = "second" }
    local DECTHandsetMaxNumber = replyMax[DECTHandsetMaxNumberPath][1].param["X_TELECOMITALIA_IT_DECTHandsetMaxNumberOfEntries"]
    return DECTHandsetMaxNumber
end

-- Get the Active Dect Handset count
-- Added by Vignesh A J
function getActiveDECTHandsetCount()
    local activeDectCount = 0
    local dectHandsetPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset"
    local reply, error = mbus.getParameters{ path = dectHandsetPath, param = {"Active"}, datamodel = "second" }
    if reply[dectHandsetPath]~=nil then
        for j,k in pairs(reply[dectHandsetPath]) do
			local activeStatusVal = k.param["Active"]
			
            if activeStatusVal=="true" then
                activeDectCount = tonumber(activeDectCount) + 1
            end
        end
    end
    return activeDectCount
end

--Get the DECTHandsetNumberOfEntries
function getDECTHandsetNumber()
    local DECTActive
    local DECTNum = 0
    local DECTHandsetNumberPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset"
    local reply, error = mbus.getParameters{ path = DECTHandsetNumberPath, param = {"Active"}, datamodel = "second" }
    if reply[DECTHandsetNumberPath]~=nil then
        for j,k in pairs(reply[DECTHandsetNumberPath]) do
            DECTActive = k.param["Active"]
            if DECTActive=="true" then
                DECTNum = tonumber(DECTNum) + 1
            end
        end
    end
    return DECTNum
end

--Get the active value which is true
function getDECTHandsetActive()
    local DECTHandsetActivePath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset"
    local replyActive, error = mbus.getParameters{ path = DECTHandsetActivePath, param = "Active", datamodel = "second" }
    local DECTHandsetActive = replyActive[DECTHandsetActivePath][1].param["Active"]
    return DECTHandsetActive
end

--Get the DECT PIN code
function getPINCode()
    local PINCodePath = "Voice.DECT.Base"
    local replyPIN, error = mbus.getParameters{ path = PINCodePath, param = "Pin" }
    local PINCode = replyPIN[PINCodePath][1].param["Pin"]
    return PINCode
end

--Change the value of FaxT38 checkbox
if cgilua.servervariable"REQUEST_METHOD" == "POST" then
    local modify = {}
    if POST["FaxT38Flag"] == "1" then
        local FaxTPath = "Device.Services.VoiceService.1.VoiceProfile.1.FaxT38"
        local replyFax, error = mbus.getParameters{ path = FaxTPath, param = {"Enable"}, datamodel = "second" }
        local FaxTActive = replyFax[FaxTPath][1].param["Enable"]
        if (POST["FaxTChk"]=="ON" and FaxTActive=="false") or (POST["FaxTChk"]==nil and FaxTActive=="true") then
            local status = "false"
            if POST["FaxTChk"]=="ON" and FaxTActive=="false" then
                status = "true"
            end
            modify = {}
            table.insert(modify, {path=FaxTPath, param= {Enable=status}, datamodel = "second"})
            local result = setMBUS_IGD(modify)
            if result==1 then
                cgilua.redirect("resultKO.lp")
                return
            end
        end
    end
    if POST["DECTInfoFlag"] == "1" then
        local DECTActive = getDECTHandsetStato()
        local enableDECTPath  = "Device.Services.VoiceService.1.PhyInterface.3"
        if (POST["EnableDECTChk"]=="ON" and DECTActive=="false") or (POST["EnableDECTChk"]==nil and DECTActive=="true") then
            local DECTstatus = "false"
            if POST["EnableDECTChk"]=="ON" and DECTActive=="false" then
                DECTstatus = "true"
            end
            modify = {}
            table.insert(modify, {path=enableDECTPath, param= {X_TELECOMITALIA_IT_Enable=DECTstatus}, datamodel = "second"})
            local result = setMBUS_IGD(modify)
            if result==1 then
                cgilua.redirect("resultKO.lp")
                return
            end
        end
    end

    if POST["DECTAttachFlag"] == "1" then
        local attachTerPath = "Voice.DECT.Base"
        modify = {}
        table.insert(modify, {path=attachTerPath, param={StartSubs="true"}})
        local result = setMBUS(modify)
        if result==1 then
            cgilua.redirect("resultKO.lp")
            return
        end
    end

    if POST["FXOInfoFlag"] == "1" then
        local enableFXOPath = "Device.Services.VoiceService.1.PhyInterface.4"
        local replyFXOEnable, error = mbus.getParameters{ path = enableFXOPath, param = {"X_TELECOMITALIA_IT_Enable"}, datamodel = "second" }
        local FXOActive = replyFXOEnable[enableFXOPath][1].param["X_TELECOMITALIA_IT_Enable"]
        if (POST["EnableFXOChk"]=="ON" and FXOActive=="false") or (POST["EnableFXOChk"]==nil and FXOActive=="true") then
            local FXOstatus = "false"
            if POST["EnableFXOChk"]=="ON" and FXOActive=="false" then
                FXOstatus = "true"
            end
            modify = {}
            table.insert(modify, {path=enableFXOPath, param= {X_TELECOMITALIA_IT_Enable=FXOstatus}, datamodel = "second"})
            local result = setMBUS_IGD(modify)
            if result==1 then
                cgilua.redirect("resultKO.lp")
                return
            end
        end
        local PSTNPath = "Device.Services.VoiceService.1.VoiceProfile.1"
        local replyPSTN, error = mbus.getParameters{ path = PSTNPath, param = {"PSTNFailOver"}, datamodel = "second" }
        local PSTNFailOver = replyPSTN[PSTNPath][1].param["PSTNFailOver"]
        if (POST["PSTNState"] == "0" and PSTNFailOver=="true") or (POST["PSTNState"] == "1" and PSTNFailOver=="false") then
            local PSTNFailOverState = "false"
            if (POST["PSTNState"] == "0" and PSTNFailOver=="true") then
                PSTNFailOverState = "false"
            end
            if (POST["PSTNState"] == "1" and PSTNFailOver=="false") then
                PSTNFailOverState = "true"
            end
            modify = {}
            table.insert(modify, {path=PSTNPath, param= {PSTNFailOver=PSTNFailOverState}, datamodel = "second"})
            local result = setMBUS_IGD(modify)
            if result==1 then
                cgilua.redirect("resultKO.lp")
                return
            end
        end
    end

    if POST["FXONumFlag"] == "1" then
        local modify = {}
        local fixedFXONum = POST["fixedLineNum"]
		if fixedFXONum~="" then
			local IsFXONumExist = getFXONum()
			if IsFXONumExist=="" then
				local reply, error = mbus.modify(
				function()
					local reply, error = mbus.addObjects{path = "ENV", param = {Value = fixedFXONum, Name = "IsFXONum"}}
				end)
			else
				local replyFXOPath, errorFXOPath = mbus.getParameters{ path = "ENV", param = { "Name", "Value" }, filter = "(== Name ".. "IsFXONum" ..")" }
				local FXOPath = replyFXOPath["ENV"][1].path
				table.insert(modify, {path = FXOPath, param = {Value = fixedFXONum}})
				setMBUS(modify)
			end
		end
    end

    if POST["DECTTerminalsFlag"] == "1" then
        local rowIndex = POST["rowIndex"]
        local terminalsPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. tostring(rowIndex)
        modify = {}
        table.insert(modify, {path=terminalsPath, param= {Active="false"}, datamodel = "second"})
        local result = setMBUS_IGD(modify)
        if result==1 then
            cgilua.redirect("resultKO.lp")
            return
        end
    end
    
    if POST["tiggerBSFTFile"] == "1" then
	local modify = {}
	table.insert(modify, {path="Voice.DM", param= {SyncTrigger="true"}})

        setMBUS(modify)	
    end
    if POST["tiggerBSFTFile"] == "1" then	
    	cgilua.redirect("telephonyNumberPBX.lp",{f="true"})		
    else
	cgilua.redirect("telephonyNumberPBX.lp")
    end		
end
--[[
function getBSFTConfStatus()
    local reply, error = mbus.getParameters{ path = "Voice.DM", param = { "Status"} }
    local BSFTstatus = reply["Voice.DM"][1].param["Status"] 
    if BSFTstatus == "UNCONFIGURED" then
	BSFTstatus = translate([==[Initial state]==])
    elseif BSFTstatus == "DOWNLOADING" then	
	BSFTstatus = translate([==[The downloading is in progress]==])
    elseif BSFTstatus == "CONFIGURING" then
	BSFTstatus = translate([==[The downloading has completed and the configuration file is being processed]==])
    elseif BSFTstatus == "CONFIGURED" then
	BSFTstatus = translate([==[The configuration file has been successfully applied]==])
    elseif BSFTstatus == "ERROR" then
	BSFTstatus = translate([==[An error has occurred]==])
    end			
    return BSFTstatus
end

local BSFTstatus = getBSFTConfStatus()
]]

local DECTMaxNum = getDECTHandsetMaxNumber()
local DECTNum = getDECTHandsetNumber()
local MaxDECTNumber = translate([==[Reached the maximum number of active DECT terminals. For others it is encouraged to combine necessary to delete any of the items]==])
local NoPSTNNumber = translate([==[Before pairing, it is necessary have an active phone service.]==])
%>
<script language="javascript" type="text/javascript">

function showErrorMsg(errorMsgStr)
{
    document.getElementById("set_telephony_number").style.display="none";
    document.getElementById("resultDECTKO").style.display="block";
    document.getElementById("errorMsg").innerHTML=errorMsgStr;
}

function changeTeleEnable()
{
    document.getElementById("FXOInfoFlag").value="1";
    document.modify_voice_server_number.submit();
}

function submitNumToENV()
{
    document.getElementById("configFixedLine").style.display = "none";
    document.getElementById("confirm").style.display = "block";
}

function attachTerminal()
{
    <% if tonumber(DECTNum)==tonumber(DECTMaxNum) then %>
        showErrorMsg('<%=MaxDECTNumber%>');
        return false;
    <% else %>
        document.getElementById("DECTAttachFlag").value="1";
        document.modify_voice_server_number.submit();
    <% end %>
}

function confNumToPSTN()
{
    document.getElementById("FXONumFlag").value="1";
    document.modify_voice_server_number.submit();
}

function enableDect()
{
    document.getElementById("DECTInfoFlag").value="1";
    document.modify_voice_server_number.submit();
}

function disTerminal(rowIndex)//disassociatesNumber:line number
{
    document.getElementById("rowIndex").value=rowIndex;
    document.getElementById("DECTTerminalsFlag").value = "1";
    document.modify_voice_server_number.submit();
}

function changeFaxT38()
{
    document.getElementById("FaxT38Flag").value="1";
    document.modify_voice_server_number.submit();
}

function enableSubmit(PSTNState)
{
    document.getElementById("FXOInfoFlag").value="1";
    document.getElementById("PSTNState").value=PSTNState;
    document.modify_voice_server_number.submit();
}

function submitConfirm()
{
    document.getElementById("modify_voice_server_number").submit();
}

function cancelConfirm()
{
    document.getElementById("set_telephony_number").style.display = "";
    document.getElementById("resultDECTKO").style.display="none";
    document.getElementById("confirm").style.display = "none";
}


function invokeBSFTFile() {
    document.getElementById("tiggerBSFTFile").value="1";
    if(document.getElementById("bsftStatus")) {	
	document.getElementById("bsftStatus").innerHTML="Download in corso";	  	
    } 	
    document.modify_voice_server_number.submit();
}


function sajax_init_object() {
        var A;
        try {
                A=new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
                try {
                        A=new ActiveXObject("Microsoft.XMLHTTP");
                } catch (oc) {
                        A=null;
                }
        }
        if(!A && typeof XMLHttpRequest != "undefined")
                A = new XMLHttpRequest();
        return A;
}

function ajax_get()
{
	//currentTab('mediaStatus','mediaconfig');
	
    var x = sajax_init_object();
    var url = "statusUpdate_PBX.lp";
    x.open('GET', url, true);
    x.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    x.setRequestHeader("Connection", "close");
    x.send("");
    x.onreadystatechange = function() {
        if (x.readyState == 4) {
	    if(document.getElementById("bsftStatus")) {
		    document.getElementById("bsftStatus").innerHTML=x.responseText;
	    }
            //ajax_cb(x.responseText.replace(/\s/g,""));
	    //ajax_cb(x.responseText);	
        }
    };
    delete x;
}



window.setInterval("ajax_get()", 1000*15);

</script>

</head>
<body onload="ajax_get()">

<div class="contentContainer">
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li> <li><a href="telephonyNumberPBX.lp"><%=translate([==[Telephone numbers]==])%></a></li> 
			</ul>
		</div>


<div class="contentTab" id="content">
			<ol id="tocTab">
				
			<li><a  href="telephonyNumberPBX.lp"  class="current">
		
		<div class="tab">
			<span class="contTabTxt transform"><%=translate([==[Telephone numbers]==])%></span></div></a></li>
		
			</ol>
	</div>


<div class='contentcontainer' id="set_telephony_number">
<hr>
<form method="POST" name="modify_voice_server_number" id="modify_voice_server_number" action="">
<input type="hidden" id="PSTNState" name="PSTNState" value=""/>
<div class='contentitem'>

<table border="0" width="100%">
<tr>
    <td class='data' style='vertical-align:top'>
        <table cellspacing='0' cellpadding='0' width="100%">
        <tr><td>
            <br> <!-- Begin of showing telephony numbers-->
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td width='40' style='vertical-align:top'></td><td style='vertical-align:top'>             
            <span class='midarea2_telmain tableTitle'><%=translate([==[Telephone numbers]==])%></span><br>
                <table class='edittable valueSpace' width='100%' cellspacing='0' cellpadding='0' border='0'>
                <!-- <tr><td colspan='3' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                <tr><td colspan='3'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr> -->
                <tr><th width='20%' class="tableHd"><%=translate([==[phone Number]==])%></th><th width='35%' class="tableHd"><%=translate([==[Associated terminals for incoming calls]==])%></th><th width='35%' class="tableHd"><%=translate([==[Associated Terminals for outgoing calls]==])%></th></tr>
                <!-- <tr><td colspan='3'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr> -->
                <tr><td colspan='3' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                <%
                local rowStyle = "oddrow"
                local rowNum = 0
                local phoneNumber, lanManagedVal, UAMap, VoicePortMap = "-", "false", "-", "-"
                local reply, error = mbus.getParameters{ path = NumberPath, param = {"DirectoryNumber", "X_TELECOMITALIA_IT_LANManaged"}, datamodel = "second" }
                if reply[NumberPath]~=nil and reply[NumberPath][1]~=nil then
                    for i,v in pairs(reply[NumberPath]) do
                        local UAMapAll, VoicePortMapAll
                        rowNum = rowNum + 1
                        if rowNum%2==1 then
                            rowStyle = "oddrow"
                        else
                            rowStyle = "evenrow"
                        end

                        phoneNumber = v.param["DirectoryNumber"]
                        lanManagedVal = v.param["X_TELECOMITALIA_IT_LANManaged"]
                        local phoneTypePath = v.path
                        local incomingPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap"
                        local outgoingPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap"
                        local replyIncoming, error = mbus.getParameters{ path = incomingPath, param = {"FromUA", "ToVoicePort"}, filter = "(== FromUA "..tostring(phoneTypePath)..")", datamodel = "second" }
                        local replyOutgoing, error = mbus.getParameters{ path = outgoingPath, param = {"ToUA", "FromVoicePort"}, filter = "(== ToUA "..tostring(phoneTypePath)..")", datamodel = "second" }
                        if replyIncoming[incomingPath]~=nil then
                            for j,k in pairs(replyIncoming[incomingPath]) do
                                UAMap = k.param["ToVoicePort"]
                                if UAMap~=nil then
                                    local UAMapId = string.sub(UAMap, -1)
                                    if UAMap=="Device.Services.VoiceService.1.PhyInterface.3" then
                                        UAMap = "DECT1"..",".."DECT2"..",".."DECT3"..",".."DECT4"..",".."DECT5"
                                    else
                                        if string.match(tostring(UAMap), "DECTHandset")~=nil then
                                            UAMap = "DECT" .. tostring(UAMapId)
                                        else
                                            UAMap = "FXS" .. tostring(UAMapId)
                                        end
                                    end
                                    if UAMapAll==nil then
                                        UAMapAll = UAMap
                                    else
                                        UAMapAll = UAMapAll .. "," .. UAMap
                                    end
                                end
                            end
                        end
                        if UAMapAll==nil then
                            UAMapAll = "-"
                        end

                        if replyOutgoing[outgoingPath]~=nil then
                            for t,l in pairs(replyOutgoing[outgoingPath]) do
                                VoicePortMap = l.param["FromVoicePort"]
                                if VoicePortMap~=nil then
                                    local VoicePortMapId = string.sub(VoicePortMap, -1)
                                    if VoicePortMap=="Device.Services.VoiceService.1.PhyInterface.3" then
                                        VoicePortMap = "DECT1"..",".."DECT2"..",".."DECT3"..",".."DECT4"..",".."DECT5"
                                    else
                                        if string.match(tostring(VoicePortMap), "DECTHandset")~=nil then
                                            VoicePortMap = "DECT" .. tostring(VoicePortMapId)
                                        else
                                            VoicePortMap = "FXS" .. tostring(VoicePortMapId)
                                        end
                                    end
                                    if VoicePortMapAll ==nil then
                                        VoicePortMapAll = VoicePortMap 
                                    else
                                        VoicePortMapAll = VoicePortMapAll .. "," .. VoicePortMap 
                                    end
                                end
                            end
                        end
                        if VoicePortMapAll==nil then
                            VoicePortMapAll = "-"
                        end
                %>
                
                <tr>
                <td class="<%=rowStyle%>" style="word-break:break-all;width:300px;"><%=phoneNumber%></td>
                        <%if lanManagedVal=="true" then%>
                <td><p><%=translate([==[Telephone number assigned to the LAN IP]==])%>.</p></td>
                        <%else%>
                <td class="<%=rowStyle%>"><%=UAMapAll%></td>
                <td class="<%=rowStyle%>"><%=VoicePortMapAll%></td>
                        <%end%>
                </tr>
                    <%end%>
                <%end%>
                <%
                if tonumber(#reply[NumberPath])%2==1 then
                    rowStyle = "evenrow"
                else
                    rowStyle = "oddrow"
                end

                local PSTNNumber = getFXONum()
                if PSTNNumber~="" then
                    local FXOPhoneNumber = PSTNNumber
                %>
                <tr><td class="<%=rowStyle%>" style="word-break:break-all;width:300px;" ><%=FXOPhoneNumber%></td>
                    <td class="<%=rowStyle%>" ><%=translate([==[Number associated with landline]==])%></td>
                </tr>
                <%end%>
                </table>
            </td></tr></table> <!-- End of showing telephony numbers-->
        </td></tr>
        <tr><td>
  <!-- Begin of Configuring the fixed line -->
            <table cellspacing='0' cellpadding='0' width='100%' id='configFixedLine' class="width770 marleft40" style="clear:both"><tr><td style='vertical-align:top'>
            <input type="hidden" id="FXOInfoFlag" name="FXOInfoFlag" value="0"/>
            <input type="hidden" id="FXONumFlag" name="FXONumFlag" value="0"/>
            <span class='midarea2_telmain tableTitle martop15 fbold'><%=translate([==[Configuring the fixed line]==])%></span>
            <span class='midarea4_telmain1 tableTitle fbold'><%=translate([==[FXO port]==])%></span>
                               <table  cellspacing='0' cellpadding='0' border='0' class="width750">
                <%
                local enablePath = "Device.Services.VoiceService.1.PhyInterface.4"
                local replyEnable, error = mbus.getParameters{ path = enablePath, param = "X_TELECOMITALIA_IT_Enable", datamodel = "second" }
                local Enable = replyEnable[enablePath][1].param["X_TELECOMITALIA_IT_Enable"]
                local FXOEnable = translate([==[Disable]==])
                if Enable=="true" then
                    FXOEnable = translate([==[Active]==])
                end
                --Enable : Attiva/Disattiva
                %>
				
				
                 <tr>
					<td class="fleft width200"><%=translate([==[state]==])%>:</td>
					<td class="fleft" colspan="2"><div><%=FXOEnable%></div></td>
				</tr>
                <%
                local isChecked = 'checked="checked"'
                if getFXOVoiceServiceEnable()=="false" then
                    isChecked = ""
                end
                %>
				                <tr>
					<td class="fleft width200 paddtop10" ><%=translate([==[Fixed network active]==])%>:</td>
					<td class="fleft paddtop10 width20" >
					<input type="checkbox" <%=isChecked%> name="EnableFXOChk" value="ON" /></td>
					 <td class="fleft verticalAlign padtop5 padleft108">
					 <a onclick='changeTeleEnable()' href="#"><div class='midarea6-1 mainButton'><%=translate([==[Apply]==])%></div></a>
					</td>
					</tr>	
	
                <%
                local PSTNNum = getFXONum()
                if Enable=="true" then
                %>
				                   <tr>
                    <td class="fleft width200 paddtop10"><%=translate([==[Number of fixed line]==])%>:
                    <input type="text" id="fixedLineNum" name="fixedLineNum" size="12" value="<%=PSTNNum%>" class="inputClass"/></td>
                    <td class="fleft  buttonTop padleft128" colspan="2">
					<a onclick='confNumToPSTN()' href="#"><div class='midarea6-1 mainButton' name="thb9"><%=translate([==[Configure]==])%></div></a>					</td></tr>
				                           
                <%
                else
                %>
				                   <tr>
                    <td class="fleft width200 paddtop10"><%=translate([==[Number of fixed line]==])%>:</td>
					<td class="fleft paddtop10"><%=PSTNNum%></td></tr>
                <%end%>
               </table><table width='100%' cellspacing='0' cellpadding='0' border='0'>
                <tr><td colspan='2' class='black'>&nbsp;</td></tr>
                <tr><td colspan='2' ><p><%=translate([==[The configuration features of the PSTN port (FXO) requires a telephone numbering on PSTN active. The capability may not be active for some offerings]==])%>.</p></td></tr>
                <tr><td colspan='2'>&nbsp;</td></tr>
                 <tr><td  class="fleft alignMid padtop5 fallback"><%=translate([==[Enables the functionality of wireline Fall Back]==])%>:</td>
                <td class="fleft" style="width:300px" >
                <%
                if Enable=="true" then
                    local PSTNPath = "Device.Services.VoiceService.1.VoiceProfile.1"
                    local replyPSTN, error = mbus.getParameters{ path = PSTNPath, param = {"PSTNFailOver"}, datamodel = "second" }
                    local PSTNFailOver = replyPSTN[PSTNPath][1].param["PSTNFailOver"]
                    if PSTNFailOver == "true" then
                %>
					<a onclick="enableSubmit('0')" href="#"><div class='midarea6-1 mainButton'><%=translate([==[Disable]==])%></div></a><br>
                    <!-- <input type="button" value="<%=translate([==[Disable]==])%>" onclick="enableSubmit('0')" /> -->
                    <%else%>
					<a onclick="enableSubmit('1')" href="#"><div class='midarea6-1 mainButton'><%=translate([==[Active]==])%></div></a><br>
                    <!-- <input type="button" value="<%=translate([==[Active]==])%>" onclick="enableSubmit('1')" /> -->
                    <%end%>
                <%end%>
                </td></tr>
                <tr><td colspan='2'>&nbsp;</td></tr>
                <tr style="height:55px"><td colspan='2' ><p ><%=translate([==[The feature is the ability to use analog phones and DECT connected to the modem through the traditional telephone network PSTN, even in case of a fall of Internet connection (both analog phones that DECT) or interruption in the power supply to the modem (analog phones only). This feature requires a telephone numbering on traditional network active]==])%>.</p></td></tr>
                </table></td></tr> </table>
            <!-- End of Configuring the fixed line-->
        </td></tr>
        <tr><td>
            <!-- Begin of DECT information-->
            <table cellspacing='0' cellpadding='0' width='100%' class="width770"><tr><td width='40' style='vertical-align:top'><!-- <img src='#' alt=''> --></td><td style='vertical-align:top'>
            <input type="hidden" id="DECTInfoFlag" name="DECTInfoFlag" value="0"/>
            <input type="hidden" id="DECTAttachFlag" name="DECTAttachFlag" value="0"/>
            <span class='midarea4_telmain1 tableTitle fbold'><%=translate([==[DECT]==])%></span><br>
            <span class='midarea4_telmain1 tableTitle fbold'><%=translate([==[DECT service]==])%></span>
                <table class='' width='100%' cellspacing='0' cellpadding='0' border='0'>
				
                    <% 
                    local DECTState = getDECTHandsetStato()
                    local serviceDECTState = translate([==[Disable]==])
                    if DECTState=="true" then
                        serviceDECTState = translate([==[Active]==])
                    end
                    %>
                    <tr><td class="fleft width200"><%=translate([==[Status]==])%>:</td><td class="fleft" colspan="2"><%=serviceDECTState%></td></tr>
                    <%
                    local isChecked = 'checked="checked"'
                    if getServiceDECTEnable()=="false" then
                        isChecked = ""
                    end
                    local PINCode = getPINCode()
                    %>
									<tr>
	             <td class="fleft paddtop10 alignMid width200" ><%=translate([==[Enables DECT]==])%>: </td>
				 <td class="fleft paddtop10 alignMid width20">
				 <input type="checkbox" <%=isChecked%> name="EnableDECTChk" value="ON" /></td>
				 <td class="verticalAlign padtop5  fleft enableDECT">
						<a id="enableDECT" name="enableDECT" onclick='enableDect()' href="#">
						<div class='midarea6-1 mainButton'><%=translate([==[Apply]==])%></div>
						</a>
						</td>
				</tr>
				<tr>
					<td colspan='3' ><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br>
					</td>
				</tr>
                    <tr>
					<td class="alignMid fleft width200 paddtop10"><%=translate([==[PIN terminals Association]==])%>:</td>
					<td class="alignMid fleft width50 paddtop10"><div><%=PINCode%></div></td>
					<td class="fleft padtop5 padleft78"><a onclick='attachTerminal()' href="#"><div class='midarea7-1 mainButton'><%=translate([==[Attach the terminal]==])%></div></a></td>
					</tr>	
										

                    <tr><td colspan='3' class="padtop5"><p><%=translate([==[The PIN you must enter on the register]==])%>.</p></td></tr>
                </table>
            <span class='midarea2_telmain tableTitle padtop10' style='font-weight:bold'><%=translate([==[DECT terminals]==])%></span><!-- <br> -->
                <table class='edittable valueSpace' width='100%' cellspacing='0' cellpadding='0' border='0' id='terminalsDECT'>
                <input type="hidden" id="DECTTerminalsFlag" name="DECTTerminalsFlag" value="0"/>
                <input type="hidden" id="rowIndex" name="rowIndex" value=""/>
                    <%
                    local associatedTerminalsPath = "Device.Services.VoiceService.1.PhyInterface.3"
                    local replyTerminals, error = mbus.getParameters{ path = associatedTerminalsPath, param = {"X_TELECOMITALIA_IT_DECTHandsetMaxNumberOfEntries"}, datamodel = "second" }
                    local associatedTerminals = replyTerminals[associatedTerminalsPath][1].param["X_TELECOMITALIA_IT_DECTHandsetMaxNumberOfEntries"]
                    %>
                    <!-- <tr class='midarea4_newtelmain2'> -->
					<tr><td class=" paddtop10 alignMid"><%=translate([==[Number of terminals associated]==])%>:</td>
					<td  colspan="2"><%=associatedTerminals%></td>
					</tr>
					
					<!-- Fix for CPE_P00104548 -->
				
					<tr><td class=" paddtop10 alignMid"><%=translate([==[Number of terminals associating]==])%>:</td>
					<td colspan="2"><%=getActiveDECTHandsetCount()%></td>
					</tr>
							<tr><td colspan='3'>&nbsp;</td></tr>
					
                    <tr><td  class="tableHd " style="width:200px;"><%=translate([==[terminal Name]==])%></td><td  class="tableHd "><%=translate([==[Status]==])%></td><td class="tableHd" ><%=translate([==[Disassociates terminal]==])%></td></tr>
					<!-- <tr><td colspan='3'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr> -->
					<tr><td colspan='3' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                    <%
                    local rowStyle = "oddrow"
                    local rowNum = 0
                    local handsetDECTActive
                    local handsetPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset"
                    local replyHandset, error = mbus.getParameters{ path = handsetPath, param = {"Active", "TerminalName"}, datamodel = "second" }
                    for i,v in pairs(replyHandset[handsetPath]) do
                        handsetDECTActive = "Non associato"
                        local handsetActive = v.param["Active"]
                        local terminalName = v.param["TerminalName"]
                        if handsetActive == "true" then
                            handsetDECTActive = "Associato"
                        end
                        rowNum = rowNum + 1
                        if rowNum%2==1 then
                            rowStyle = "oddrow"
                        else
                            rowStyle = "evenrow"
                        end
                    %>
                    <tr>
                    <td  class="<%=rowStyle%>"><%=terminalName%><input type="hidden" id="terminalName<%=rowNum%>" name="terminalName<%=rowNum%>" value="<%=terminalName%>" /></td>
                    <td  class="<%=rowStyle%>"><%=handsetDECTActive%></td>
                    <%
                        if handsetActive == "true" then
                    %>
                    <td class="<%=rowStyle%> buttonTop">
					<a onclick='javascript: disTerminal("<%=i%>");' href="#"><div class='midarea7-1 mainButton'><%=translate([==[Disassociates terminal]==])%></div></a>
					<!-- <input type="button" class="button" onclick='javascript: disTerminal("<%=i%>");' value="<%=translate([==[Disassociates terminal]==])%>"  /> -->
					</td>
                    <%
                        else
                    %>
                    <td class="<%=rowStyle%>" style="width:170px">Non associato</td>
                        <%end%>
                    <%end%>
                    </tr>
                </table>
            </td><!-- </tr> --></table><!-- End of DECT information-->
        </td></tr>
        <tr><td>
<!-- Begin of Other Options-->
	   <!--	
            <br>
            <table cellspacing='0' cellpadding='0' width='100%' class="width770">
				<tr>
					<td width='40' style='vertical-align:top'></td>
					<td style='vertical-align:top'>
            <input type="hidden" id="FaxT38Flag" name="FaxT38Flag" value="0"/>
            <span class='midarea2_telmain tableTitle' style='font-weight:bold'>Fax T.38</span>
                <table class='' width='100%' cellspacing='0' cellpadding='0' border='0'>
                    <%
                    local isChecked = 'checked="checked"'
                    if getFaxTEnable()=="false" then
                        isChecked = ""
                    end
                    local FaxT = getFaxTEnable()
                    local FaxTStato = translate([==[off]==])
                    if FaxT=="true" then
                        FaxTStato = translate([==[on]==])
                    end
                    %>
                    <tr>
						<td style="width:300px"><%=translate([==[Status]==])%>:</td>
						<td style="width:300px"><div style="padding-left:32px"><%=FaxTStato%></div></td>
					</tr>
                    <tr>
						<td  style="width:300px;vertical-align:middle" class=" padtop5"><%=translate([==[Configure]==])%>: &nbsp;<input type="checkbox" <%=isChecked%> name="FaxTChk" value="ON" />
						</td>
					    <td  style="width:300px"  class="verticalAlign padtop5">
						<a onclick='javascript: changeFaxT38();' href="#"><div class='midarea6-1 mainButton'><%=translate([==[Apply]==])%></div></a>
						
						</td>
					</tr>
                </table>
            </td></tr></table>
	-->
	<!-- End of Other Options-->
	

	<!-- BSFT configuration Start -->
	<br>
            <table cellspacing='0' cellpadding='0' width='100%' class="width770">
		<input type="hidden" id="tiggerBSFTFile" name="tiggerBSFTFile" value="0"/>
				<tr>
					<td width='40' style='vertical-align:top'></td>
					<td style='vertical-align:top'>
            <input type="hidden" id="FaxT38Flag" name="FaxT38Flag" value="0"/>
            <span class='midarea2_telmain tableTitle fbold'><%=translate([==[BSFT configuration]==])%></span>
                <table class='' width='100%' cellspacing='0' cellpadding='0' border='0'>
               	<tr>    
		<td style="width:165px">
			<%=translate([==[BSFT Configuration File Status]==])%>:</td><td  style="width:400px;"><div id="bsftStatus"></div>
		</td>
		</tr>
		<tr><td colspan="2"><img src='images/spacer.gif' border='0' width='1' height='10' alt=''><br></td></tr>
		<tr>    
		<td class="padtop5 verticalAlign padleft328" colspan="2">			 
			<a onclick="invokeBSFTFile();" href="#"><div class='midarea7-1 mainButton'><%=translate([==[DSoftkey for triggering BSFT configuration file download]==])%></div></a>					
		</td>
		</tr>

                
                </table>
            </td></tr></table>
	<!-- BSFT configuration end -->

        </td></tr>
        </table>
    </td>
</tr>
</table>
</div>
</form>
</div>

<script>
var trFlag = "<%=triggerFlag%>"

if(trFlag=="true") {
        if(document.getElementById("bsftStatus")) {
                    document.getElementById("bsftStatus").innerHTML="<%=translate([==[The downloading is in progress]==])%>"
        }
}
</script>
<div id="confirm" style="display:none">
<%cgilua.lp.include("webparts/confirmBack.lp")%>
</div>
<div id="resultDECTKO" style="display:none">
<%cgilua.lp.include("webparts/resultKO_VoIP.lp")%>
</div>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/style.css" type="text/css"/>
<link rel="stylesheet" href="css/menu.css" type="text/css" />
<script language="javascript" type="text/javascript" src="js/script.js"></script>

<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<% cgilua.lp.include("lp/style.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<% cgilua.lp.include("lp/form.lp")%>
<% cgilua.lp.include("lp/voip.lp")%>

<%
local translate = translate
local QUERY = cgilua.QUERY
local POST=cgilua.POST

local isRemote = isRemoteAccess()

--check the checkbox is checked or not
function isCheckedService(flag)
    local isChecked = 'checked="checked"'
    if flag~="true" then
        isChecked = ""
    end    
    return isChecked
end

--get port type from UAMap or VoicePortMap
function getPortType(pathStr)
    local reply, error = mbus.getParameters{ path = pathStr, param = "Description", datamodel = "second" }
    return reply[pathStr][1].param["Description"]
end

--check is there any line obj.
function isCheckLineExist()
    local numInfoPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
    local replyInfo, error = mbus.getParameters{ path = numInfoPath, param = "DirectoryNumber", datamodel = "second" }
    if replyInfo[numInfoPath][1]~=nil then
        return true
    end
    return false 
end

if cgilua.servervariable"REQUEST_METHOD" == "POST" then
    local modify = {}
    if POST["saveFlag"] == "1" then
        for i=1,2 do
            local posConfigPath = "Device.Services.VoiceService.1.PhyInterface." .. tostring(i)
            local status, pstnInStatus, pstnOutStatus = "false", "false", "false"
            if POST["posChk"..i]=="ON" then
                status = "true"
            end
            if POST["pstnInChk"..i]=="ON" then
                pstnInStatus = "true"
            end

            if POST["pstnOutChk"..i]=="ON" then
                pstnOutStatus = "true"
            end
            modify = {}
            table.insert(modify, {path=posConfigPath, param={X_TELECOMITALIA_IT_POSConfig=status, X_TELECOMITALIA_IT_SwitchToPSTNIn=pstnInStatus, X_TELECOMITALIA_IT_SwitchToPSTNOut=pstnOutStatus}, datamodel="second"})
            setMBUS_IGD(modify)
        end
    saveall(0, 1)
    cgilua.redirect("save_alert.lp", { u="telephonyStato.lp" })
    return
    end

    if POST["configInFlag"] == "1" then
        --delete the old telenumber
        local rowIndex = POST["rowIndex"]
        local portTypeValue, DECTAllObj
        if tonumber(rowIndex)<3 then
            portTypeValue = "Device.Services.VoiceService.1.PhyInterface." .. tostring(POST["pathId"])
        else
            portTypeValue = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. tostring(POST["pathId"])
            DECTAllObj = isDECTAllObjExistInUAMap()
            if DECTAllObj=="true" then
                --add other 3 objs after delete DECTAll obj
                addOtherThreeUAMapObj(portTypeValue)
            end
        end
        if POST["deleteAllFlag"]=="1" then
            if POST["linePathInId"]~="nil" then
                local delUAmap, deleteUAmap = getLinePathFromUAMap(portTypeValue)
                local deleteUAmapPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap"
                local reply, error = mbus.modify(
                    function()
                        if deleteUAmap~=nil then
                            local reply1, error1 = mbus.deleteObjects{path = deleteUAmapPath, filter="(and (== ToVoicePort " .. portTypeValue .. ") (== Preassigned " .. "false" .. "))", datamodel = "second"}
                        end
                    end, {datamodel="second"})
            end
            saveall(0, 1)
            cgilua.redirect("save_alert.lp", { u="telephonyStato.lp" })
            return
        else
            if POST["linePathInId"]~="nil" then
                local delUAmap, deleteUAmap = getLinePathFromUAMap(portTypeValue)
                local deleteUAmapPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap"
                local reply, error = mbus.modify(
                    function()
                        if deleteUAmap~=nil then
                            local reply1, error1 = mbus.deleteObjects{path = deleteUAmapPath, filter="(and (== ToVoicePort " .. portTypeValue .. ") (== Preassigned " .. "false" .. "))", datamodel = "second"}
                        end
                    end, {datamodel="second"})
            end

            --add a new telenumber select from the scroll down
            if tonumber(rowIndex)<3 then
                local selectInIndex = POST["selectInDirectoryNumber"..rowIndex]
                local fromUAPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line." .. selectInIndex
                local toVoicePortPath = "Device.Services.VoiceService.1.PhyInterface." .. POST["pathId"]
                local UAMap_path = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap"
                local linePathInId, lineNum
                local reply, error = mbus.modify(
                function()
                    local reply1, error1 = mbus.addObjects{ path = UAMap_path, param = { FromUA = fromUAPath, ToVoicePort = toVoicePortPath }, datamodel = "second" }
                    if error1~=nil or reply1[UAMap_path][1]==nil then
                        result=1
                
                    end
                    linePathInId = string.gsub(reply1[UAMap_path][1].path, UAMap_path..".", "")
                end, {datamodel="second"})
                saveall(0, 1)
                local pageStr = "telephonyConfig.lp?pathId="..POST["pathId"].."&linePathInId="..linePathInId.."&lineNum="..fromUAPath
                cgilua.redirect(tostring(pageStr))
                return
            else
                local selectInDECTIndex = POST["selectInDECTDirectoryNumber"..rowIndex]
                local fromUAPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line." .. selectInDECTIndex
                local toVoicePortPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. POST["pathId"]
                local UAMap_path = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap"
                local linePathInId, lineNum
                local reply, error = mbus.modify(
                function()
                    local reply1, error1 = mbus.addObjects{ path = UAMap_path, param = { FromUA = fromUAPath, ToVoicePort = toVoicePortPath }, datamodel = "second" }
                    if error1~=nil or reply1[UAMap_path][1]==nil then
                        result=1
                
                    end
                    linePathInId = string.gsub(reply1[UAMap_path][1].path, UAMap_path..".", "")
                end, {datamodel="second"})
                saveall(0, 1)
                local pageStr = "telephonyConfig.lp?pathId="..(tonumber(POST["pathId"])+2).."&linePathInId="..linePathInId.."&lineNum="..fromUAPath
                cgilua.redirect(tostring(pageStr))
                return
            end
        end
    end

    if POST["configOutFlag"] == "1" then
        --delete the old telenumber
        local rowIndex = POST["rowIndex"]
        local portTypeValue, DECTAllObj
        if tonumber(rowIndex)<3 then
            portTypeValue = "Device.Services.VoiceService.1.PhyInterface." .. tostring(POST["pathId"])
        else
            portTypeValue = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. tostring(POST["pathId"])
            DECTAllObj = isDECTAllObjExistInVpMap()
            if DECTAllObj=="true" then
                --add other 3 objs after delete DECTAll obj
                addOtherThreeVpMapObj(portTypeValue)
            end
        end
        if POST["deleteAllFlag"]=="1" then
            if POST["linePathOutId"]~="nil" then
                local delVoiceportmap, deleteVoiceportmap = getLinePathFromPortMap(portTypeValue)
                local deleteVoiceportmapPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap"
                local reply, error = mbus.modify(
                    function()
                        if deleteVoiceportmap~=nil then
                            local reply2, error2 = mbus.deleteObjects{path = deleteVoiceportmapPath, filter="(and (== FromVoicePort " .. portTypeValue .. ") (== Preassigned " .. "false" .. "))", datamodel = "second"}
                        end
                    end, {datamodel="second"})
            end
            saveall(0, 1)
            cgilua.redirect("save_alert.lp", { u="telephonyStato.lp" })
            return
        else
            if POST["linePathOutId"]~="nil" then
                local delVoiceportmap, deleteVoiceportmap = getLinePathFromPortMap(portTypeValue)
                local deleteVoiceportmapPath = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap"
                local reply, error = mbus.modify(
                    function()
                        if deleteVoiceportmap~=nil then
                            local reply2, error2 = mbus.deleteObjects{path = deleteVoiceportmapPath, filter="(and (== FromVoicePort " .. portTypeValue .. ") (== Preassigned " .. "false" .. "))", datamodel = "second"}
                        end
                    end, {datamodel="second"})
            end

            --add a new telenumber select from the scroll down
            if tonumber(rowIndex)<3 then
                local selectOutIndex = POST["selectOutDirectoryNumber"..rowIndex]
                local toUAPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line." .. selectOutIndex
                local fromVoicePortPath = "Device.Services.VoiceService.1.PhyInterface." .. POST["pathId"]
                local VoicePortMap_path = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap"
                local linePathOutId, lineNum
                local reply, error = mbus.modify(
                function()
                    local reply2, error2 = mbus.addObjects{ path = VoicePortMap_path, param = { ToUA = toUAPath, FromVoicePort = fromVoicePortPath }, datamodel = "second" }
                    if error2~=nil or reply2[VoicePortMap_path][1]==nil then
                        result=1
                
                    end
                    linePathOutId = string.gsub(reply2[VoicePortMap_path][1].path, VoicePortMap_path..".", "")
                end, {datamodel="second"})
                saveall(0, 1)
                local pageStr = "telephonyConfig.lp?pathId="..POST["pathId"].."&linePathOutId="..linePathOutId.."&lineNum="..toUAPath
                cgilua.redirect(tostring(pageStr))
                return
            else
                local selectOutDECTIndex = POST["selectOutDECTDirectoryNumber"..rowIndex]
                local toUAPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line." .. selectOutDECTIndex
                local fromVoicePortPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. POST["pathId"]
                local VoicePortMap_path = "Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap"
                local linePathOutId, lineNum
                local reply, error = mbus.modify(
                function()
                    local reply2, error2 = mbus.addObjects{ path = VoicePortMap_path, param = { ToUA = toUAPath, FromVoicePort = fromVoicePortPath }, datamodel = "second" }
                    if error2~=nil or reply2[VoicePortMap_path][1]==nil then
                        result=1
                
                    end
                    linePathOutId = string.gsub(reply2[VoicePortMap_path][1].path, VoicePortMap_path..".", "")
                end, {datamodel="second"})
                saveall(0, 1)
                local pageStr = "telephonyConfig.lp?pathId="..(tonumber(POST["pathId"])+2).."&linePathOutId="..linePathOutId.."&lineNum="..toUAPath
                cgilua.redirect(tostring(pageStr))
                return
            end
        end
    end
    return
end

%>
</head>

<body>
<script type="text/javascript">
//<![CDATA[
function submitInConf(pathId, linePathInId, rowIndex)
{
    document.getElementById("configInFlag").value="1";
    document.getElementById("pathId").value=pathId;
    document.getElementById("linePathInId").value=linePathInId;
    document.getElementById("rowIndex").value=rowIndex;

    if(rowIndex<3)
    {
        var selectInFXSNum = document.getElementById("selectInDirectoryNumber"+rowIndex).value;
        if(selectInFXSNum=="")
        {
            document.getElementById("configNum").style.display="none";
            document.getElementById("resultKoConfNum").style.display="block";
            return false;
        }
        if(selectInFXSNum=="deleteFlag")
        {
            document.getElementById("deleteAllFlag").value="1";
        }
    }
    else
    {
        var selectInDECTNum = document.getElementById("selectInDECTDirectoryNumber"+rowIndex).value;
        if(selectInDECTNum=="")
        {
            document.getElementById("configNum").style.display="none";
            document.getElementById("resultKoConfNum").style.display="block";
            return false;
        }
        if(selectInDECTNum=="deleteFlag")
        {
            document.getElementById("deleteAllFlag").value="1";
        }
    }
    document.getElementById("configNum").style.display="none";
    document.getElementById("confirm").style.display="block";
}

function submitOutConf(pathId, linePathOutId, rowIndex)
{
    document.getElementById("configOutFlag").value="1";
    document.getElementById("pathId").value=pathId;
    document.getElementById("linePathOutId").value=linePathOutId;
    document.getElementById("rowIndex").value=rowIndex;

    if(rowIndex<3)
    {
        var selectOutFXSNum = document.getElementById("selectOutDirectoryNumber"+rowIndex).value;
        if(selectOutFXSNum=="")
        {
            document.getElementById("configNum").style.display="none";
            document.getElementById("resultKoConfNum").style.display="block";
            return false;
        }
        if(selectOutFXSNum=="deleteFlag")
        {
            document.getElementById("deleteAllFlag").value="1";
        }
    }
    else
    {
        var selectOutDECTNum = document.getElementById("selectOutDECTDirectoryNumber"+rowIndex).value;
        if(selectOutDECTNum=="")
        {
            document.getElementById("configNum").style.display="none";
            document.getElementById("resultKoConfNum").style.display="block";
            return false;
        }
        if(selectOutDECTNum=="deleteFlag")
        {
            document.getElementById("deleteAllFlag").value="1";
        }
    }
    document.getElementById("configNum").style.display="none";
    document.getElementById("confirm").style.display="block";
}

function submitConfirm()
{
    document.getElementById("configTelephony").submit();
}

function cancelConfirm()
{
    document.getElementById("configNum").style.display = "";
    document.getElementById("confirm").style.display = "none";
    document.getElementById("resultKoConfNum").style.display="none";
}

function submitSave()
{
    document.getElementById("saveFlag").value="1";
    document.configTelephony.submit();
}

//]]>
</script>

<table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
<tr><td align="left"><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="telephonyStato.lp"><%=translate([==[Telephony services]==])%></a></td>
<%if isRemote==false then%>
<td align="right"><a href="telephonyNumber.lp"><%=translate([==[Telephone numbers]==])%></a></td>
<%end%>
</tr>
</table>

<div class='contentcontainer' id='configNum'>
<hr>
<div class='contentitem'>

<table border="0" width="100%">
<form id="configTelephony" name="configTelephony" action="" method="post">
<input type="hidden" id="configInFlag" name="configInFlag" value="0"/>
<input type="hidden" id="configOutFlag" name="configOutFlag" value="0"/>
<input type="hidden" id="saveFlag" name="saveFlag" value="0"/>
<input type="hidden" id="pathId" name="pathId" value=""/>
<input type="hidden" id="deleteAllFlag" name="deleteAllFlag" value=""/>
<input type="hidden" id="linePathInId" name="linePathInId" value=""/>
<input type="hidden" id="linePathOutId" name="linePathOutId" value=""/>
<input type="hidden" id="rowIndex" name="rowIndex" value=""/>
<tr>
    <td class='icon' style='vertical-align:top' width='100px'><img src='images/tel___xl.gif' alt=''></td>
    <td class='data' style='vertical-align:top'>
        <table cellspacing='0' cellpadding='0' width="100%">
        <tr>
            <td align='left'><span class='itemtitle'><%=translate([==[Telephony services]==])%></span></td>
        </tr>
        <tr><td>
            <br><!-- Begin of showing Telephone Service-->
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td width='40' style='vertical-align:top'><img src='images/bull__md.gif' alt=''></td><td style='vertical-align:top'>
            <span class='blocktitle'><%=translate([==[Telephone service State]==])%></span><br>
            <table width='100%' class='datatable' cellspacing='0' cellpadding='0' style="line-height:150%;">
                <tr><td colspan='6' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                <tr><td colspan='6'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <tr><th align='left'><%=translate([==[connection]==])%></th>
                    <th align='left' width='150px'><%=translate([==[Number of input]==])%></th>
                    <th align='left' width='150px'><%=translate([==[Number of outgoing]==])%></th>
                    <th align='left' style="word-break:break-all;width:5%;"><%=translate([==[Configuration]==])%>&nbsp;POS/FAX</th>
                    <th align='left'><%=translate([==[Associated with fixed line]==])%>:In</th>
                    <th align='left'><%=translate([==[Associated with fixed line]==])%>:Out</th>
                </tr>
                <tr><td colspan='6'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <tr><td colspan='6' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                <%
                local rowStyle = "oddrow"
                local rowNum = 0
                local phoneType, phyInterfaceEnable

                local phyIntf_T = getConnectionInfo()
                for i=1, #phyIntf_T do
                    rowNum = rowNum + 1
                    if rowNum%2==1 then
                        rowStyle = "oddrow"
                    else
                        rowStyle = "evenrow"
                    end
                    local v = phyIntf_T[i]
                    phoneType = v.name
                    if phoneType=="FXS" then
                        phoneType = "FXS" .. tostring(i)
                    end
                    if phoneType~="FXO" then
                        phyInterfaceEnable = v.enable
                        --if false, just show "Interface off"
                        if phyInterfaceEnable~="true" then
                %>
                <tr><td class="<%=rowStyle%>"><%=phoneType%></td><td class="<%=rowStyle%>" align="left" colspan="6"><%=translate([==[Interface off]==])%></td></tr>
                <%
                        else
                            if phoneType~="DECT" then
                                local incomingCallNum, outgoingCallNum = "-", "-"
                                local switchPath = "Device.Services.VoiceService.1.PhyInterface."..tostring(i)
                                local replySwitch, error = mbus.getParameters{ path = switchPath, param = {"X_TELECOMITALIA_IT_SwitchToPSTNIn", "X_TELECOMITALIA_IT_SwitchToPSTNOut"}, datamodel = "second"}
                                if replySwitch[switchPath][1].param["X_TELECOMITALIA_IT_SwitchToPSTNIn"]=="true" then
                                    incomingCallNum = translate([==[Fixed Line]==])
                                end
                                if replySwitch[switchPath][1].param["X_TELECOMITALIA_IT_SwitchToPSTNOut"]=="true" then
                                    outgoingCallNum = translate([==[Fixed Line]==])
                                end
                                local linePathInId, linePathOutId = "", ""
                                local posFAX = v.posConfig
                                local PSTNIn = v.switchToPSTNIn
                                local PSTNOut = v.switchToPSTNOut
                                local posFAXValue = translate([==[Disabled]==])
                                local PSTNInValue = translate([==[Disabled]==])
                                local PSTNOutValue = translate([==[Disabled]==])
                                if posFAX~="false" then
                                    posFAXValue = translate([==[Enabled]==])
                                end
                                if PSTNIn~="false" then
                                    PSTNInValue = translate([==[Enabled]==])
                                end
                                if PSTNOut~="false" then
                                    PSTNOutValue = translate([==[Enabled]==])
                                end
                                local pathId = string.sub(v.path, -1)
                                local linePathIn = getLinePathFromUAMap(v.path)
                                local linePathOut = getLinePathFromPortMap(v.path)
                                local g, f, linePathInId, linePathOutId
                                if linePathIn ~= nil then
                                    g, f, linePathInId = string.find(linePathIn, "%.([^.]+)$")
                                    incomingCallNum = getAllInCallNum(v.path)
                                end
                                if linePathOut ~= nil then
                                    g, f, linePathOutId = string.find(linePathOut, "%.([^.]+)$")
                                    outgoingCallNum = getAllOutCallNum(v.path)
                                end
                %>
                <tr><td width='33%' class='<%=rowStyle%>' colspan='6'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <tr>
                <td class="<%=rowStyle%>"><%=phoneType%><input type="hidden" id="phoneType<%=rowNum%>" name="phoneType<%=rowNum%>" value="<%=phoneType%>" /></td>
                <td class="<%=rowStyle%>" style="word-break:break-all;width:180px;"><%=incomingCallNum%></td>
                <td class="<%=rowStyle%>" style="word-break:break-all;width:180px;"><%=outgoingCallNum%></td>
                <td class="<%=rowStyle%>">
<%if isRemote~=false then%>
                    <%=posFAXValue%>
<%else%>
                    <input type="checkbox" <%=isCheckedService(posFAX)%> name="posChk<%=i%>" size="8" value="ON" />
<%end%>
                </td>
<%if isRemote~=false then%>
                <td class="<%=rowStyle%>"><%=PSTNInValue%></td>
                <td class="<%=rowStyle%>"><%=PSTNOutValue%></td>
<%else%>
                <td class="<%=rowStyle%>"><input type="checkbox" <%=isCheckedService(PSTNIn)%> name="pstnInChk<%=i%>" value="ON" /></td>
                <td class="<%=rowStyle%>"><input type="checkbox" <%=isCheckedService(PSTNOut)%> name="pstnOutChk<%=i%>" value="ON" /></td>
<%end%>
                </tr>
                    <%      end
                            if phoneType=="DECT" then
                                for j=1,4 do
                                    local incomingCallNum, outgoingCallNum = "-", "-"
                                    local linePathInId, linePathOutId = "", ""
                                    phoneType = "DECT" .. tostring(j)
                                    local DECTPath = v.path .. ".X_TELECOMITALIA_IT_DECTHandset." .. j
                                    local pathId = string.sub(DECTPath, -1)
                                    local linePathIn = getLinePathFromUAMap(DECTPath)
                                    local linePathOut = getLinePathFromPortMap(DECTPath)
                                    local InDECTAllLineNum = getDECTAllInCallNum()
                                    if InDECTAllLineNum~=nil then
                                        incomingCallNum = InDECTAllLineNum
                                    end
                                    local OutDECTAllLineNum = getDECTAllOutCallNum()
                                    if OutDECTAllLineNum~=nil then
                                        outgoingCallNum = OutDECTAllLineNum
                                    end
                                    local g, f, linePathInId, linePathOutId
                                    if linePathIn ~= nil then
                                        g, f, linePathInId = string.find(linePathIn, "%.([^.]+)$")
                                        if InDECTAllLineNum~=nil then
                                            incomingCallNum = tostring(InDECTAllLineNum) .. "<br/>" .. tostring(getAllInCallNum(DECTPath))
                                        else
                                            incomingCallNum = getAllInCallNum(DECTPath)
                                        end
                                    end
                                    if linePathOut ~= nil then
                                        g, f, linePathOutId = string.find(linePathOut, "%.([^.]+)$")
                                        if InDECTAllLineNum~=nil then
                                            outgoingCallNum = tostring(OutDECTAllLineNum) .. "<br/>" .. tostring(getAllOutCallNum(DECTPath))
                                        else
                                            outgoingCallNum = getAllOutCallNum(DECTPath)
                                        end
                                    end
                    %>
                <tr>
                <td class="<%=rowStyle%>"><%=phoneType%><input type="hidden" id="phoneType<%=i+j-1%>" name="phoneType<%=i+j-1%>" value="<%=phoneType%>" /></td>
                <%
                                    local DECTAssociato = getDECTHandsetAssociato(DECTPath)
                                    if DECTAssociato~="true" then
                %>
                <td class="<%=rowStyle%>" colspan="6"><%=translate([==[Terminal is not associated]==])%></td>
                <%
                                    else
                %>
                <td class="<%=rowStyle%>" style="word-break:break-all;width:180px;"><%=incomingCallNum%></td>
                <td class="<%=rowStyle%>" style="word-break:break-all;width:180px;"><%=outgoingCallNum%></td>
                <td class="<%=rowStyle%>"></td>
                <td class="<%=rowStyle%>"></td>
                <td class="<%=rowStyle%>"></td>
                <%
                                    end
                %>
                </tr>
                <%
                                end
                            end
                        end
                    end
                end
                %>
                <br>
<%if isRemote==false then%>
                <table cellspacing='0' cellpadding='0' width='100%' style="text-align:center">
                <tr><td style='vertical-align:top'>
                    <input type="button" class="button" onclick='javascript: submitSave();' value="<%=translate([==[Save]==])%>" name="thb10" />&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="hidden" id="rowNum" name="rowNum" value="<%=rowNum%>" />
                </td></tr></table>
<%end%>
            </table>
<%if isRemote==false then%>
            <table cellspacing='0' cellpadding='0' width='100%'><tr><td width='40' style='vertical-align:top'></td><td style='vertical-align:top'>
            <span class='blocktitle'></span><br>
            <table width='100%' class='datatable' cellspacing='0' cellpadding='0' style="line-height:150%;">
                <tr><td colspan='4' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                <tr><td colspan='4'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <tr><th align='left'><%=translate([==[connection]==])%></th>
                    <th align='left'><%=translate([==[ConfigurazioneIn]==])%></th>
                    <th align='left'><%=translate([==[ConfigurazioneOut]==])%></th>
                    <th width='9' align='left'><%=translate([==[Priority]==])%></th>
                </tr>
                <tr><td colspan='4'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <tr><td colspan='4' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                <tr><td width='33%' class='<%=rowStyle%>' colspan='4'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <%
                local rowStyle = "oddrow"
                local rowNum = 0
                local phoneType, phyInterfaceEnable

                local phyIntf_T = getConnectionInfo()
                for i=1, #phyIntf_T do
                    rowNum = rowNum + 1
                    if rowNum%2==1 then
                        rowStyle = "oddrow"
                    else
                        rowStyle = "evenrow"
                    end
                    local v = phyIntf_T[i]
                    phoneType = v.name
                    if phoneType=="FXS" then
                        phoneType = "FXS" .. tostring(i)
                    end
                    if phoneType~="FXO" then
                        phyInterfaceEnable = v.enable
                        --if false, just show "Interface off"
                        if phyInterfaceEnable~="true" then
                %>
                <tr><td class="<%=rowStyle%>"><%=phoneType%></td><td class="<%=rowStyle%>" align="left" colspan="4"><%=translate([==[Interface off]==])%></td></tr>
                <%
                        else
                            if phoneType~="DECT" then
                                local switchPath = "Device.Services.VoiceService.1.PhyInterface."..tostring(i)
                                local replySwitch, error = mbus.getParameters{ path = switchPath, param = {"X_TELECOMITALIA_IT_SwitchToPSTNIn", "X_TELECOMITALIA_IT_SwitchToPSTNOut"}, datamodel = "second"}
                                local linePathInId, linePathOutId = "", ""
                                local pathId = string.sub(v.path, -1)
                                local linePathIn = getLinePathFromUAMap(v.path)
                                local linePathOut = getLinePathFromPortMap(v.path)
                                local g, f, linePathInId, linePathOutId
                                if linePathIn ~= nil then
                                    g, f, linePathInId = string.find(linePathIn, "%.([^.]+)$")
                                end
                                if linePathOut ~= nil then
                                    g, f, linePathOutId = string.find(linePathOut, "%.([^.]+)$")
                                end
                %>
                <tr>
                <td class="<%=rowStyle%>"><%=phoneType%><input type="hidden" id="phoneType<%=rowNum%>" name="phoneType<%=rowNum%>" value="<%=phoneType%>" /></td>
                <td class="<%=rowStyle%>">
                    <input type="button" class="button" onclick='submitInConf("<%=pathId%>", "<%=linePathInId%>", "<%=i%>")' value="<%=translate([==[ConfigurazioneIn]==])%>" />
                    <select id="selectInDirectoryNumber<%=i%>" name="selectInDirectoryNumber<%=i%>" style="font-family:Tahoma;width:100px;overflow:hidden">
                    <option value="">&lt;<%=translate([==[Choose]==])%> &gt;</option>
                    <%
                        local preassInNum = getPreassignedInNum(v.path)
                        local allNumberPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
                        local replyAll, error = mbus.getParameters{ path = allNumberPath, param = "DirectoryNumber", filter="(== X_TELECOMITALIA_IT_LANManaged " .. "false" .. ")", datamodel = "second" }
                        for u,w in pairs(replyAll[allNumberPath]) do
                            if w.param["DirectoryNumber"]~=preassInNum then
                                cgilua.print("<option title='"..tostring(w.param["DirectoryNumber"]).."' value='"..tostring(string.gsub(w.path, "Device.Services.VoiceService.1.VoiceProfile.1.Line.", "")).."'>"..tostring(w.param["DirectoryNumber"]).."</option>")
                            end
                        end
                    %>
                    <option value="deleteFlag">&nbsp;&nbsp;-&nbsp;&nbsp;</option>
                    </select>
                </td>
                <td class="<%=rowStyle%>">
                    <input type="button" class="button" onclick='submitOutConf("<%=pathId%>", "<%=linePathOutId%>", "<%=i%>")' value="<%=translate([==[ConfigurazioneOut]==])%>" />
                    <select id="selectOutDirectoryNumber<%=i%>" name="selectOutDirectoryNumber<%=i%>" style="font-family:Tahoma;width:100px;overflow:hidden">
                    <option value="">&lt;<%=translate([==[Choose]==])%> &gt;</option>
                    <%
                        local preassOutNum = getPreassignedOutNum(v.path)
                        local allNumberPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
                        local replyAll, error = mbus.getParameters{ path = allNumberPath, param = "DirectoryNumber", filter="(== X_TELECOMITALIA_IT_LANManaged " .. "false" .. ")", datamodel = "second" }
                        for u,w in pairs(replyAll[allNumberPath]) do
                            if w.param["DirectoryNumber"]~=preassOutNum then
                                cgilua.print("<option title='"..tostring(w.param["DirectoryNumber"]).."' value='"..tostring(string.gsub(w.path, "Device.Services.VoiceService.1.VoiceProfile.1.Line.", "")).."'>"..tostring(w.param["DirectoryNumber"]).."</option>")
                            end
                        end
                    %>
                    <option value="deleteFlag">&nbsp;&nbsp;-&nbsp;&nbsp;</option>
                    </select>
                </td>
                <td class="<%=rowStyle%>"><input type="text" name="Priority" id="Priority" size="5"></td>
                </tr>
                <tr><td width='33%' class='<%=rowStyle%>' colspan='4'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <%          end
                            if phoneType=="DECT" then
                                for j=1,4 do
                                    local linePathInId, linePathOutId = "", ""
                                    phoneType = "DECT" .. tostring(j)
                                    local DECTPath = v.path .. ".X_TELECOMITALIA_IT_DECTHandset." .. j
                                    local pathId = string.sub(DECTPath, -1)
                                    local linePathIn = getLinePathFromUAMap(DECTPath)
                                    local linePathOut = getLinePathFromPortMap(DECTPath)
                                    local g, f, linePathInId, linePathOutId
                                    if linePathIn ~= nil then
                                        g, f, linePathInId = string.find(linePathIn, "%.([^.]+)$")
                                    end
                                    if linePathOut ~= nil then
                                        g, f, linePathOutId = string.find(linePathOut, "%.([^.]+)$")
                                    end
                %>
                <tr>
                <td class="<%=rowStyle%>"><%=phoneType%><input type="hidden" id="phoneType<%=i+j-1%>" name="phoneType<%=i+j-1%>" value="<%=phoneType%>" /></td>
                <%
                                    local DECTAssociato = getDECTHandsetAssociato(DECTPath)
                                    if DECTAssociato=="true" then
                %>
                <td class="<%=rowStyle%>">
                    <input type="button" class="button" onclick='submitInConf("<%=pathId%>", "<%=linePathInId%>", "<%=(i+j-1)%>")' value="<%=translate([==[ConfigurazioneIn]==])%>" />
                    <select id="selectInDECTDirectoryNumber<%=i+j-1%>" name="selectInDECTDirectoryNumber<%=i+j-1%>" style="font-family:Tahoma;width:100px;overflow:hidden">
                    <option value="">&lt;<%=translate([==[Choose]==])%> &gt;</option>
                    <%
                        local preassDECTInNum = getPreassignedInNum(DECTPath)
                        local allNumberPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
                        local replyAll, error = mbus.getParameters{ path = allNumberPath, param = "DirectoryNumber", filter="(== X_TELECOMITALIA_IT_LANManaged " .. "false" .. ")", datamodel = "second" }
                        for u,w in pairs(replyAll[allNumberPath]) do
                            if w.param["DirectoryNumber"]~=preassDECTInNum then
                                cgilua.print("<option title='"..tostring(w.param["DirectoryNumber"]).."' value='"..tostring(string.gsub(w.path, "Device.Services.VoiceService.1.VoiceProfile.1.Line.", "")).."'>"..tostring(w.param["DirectoryNumber"]).."</option>")
                            end
                        end
                    %>
                    <option value="deleteFlag">&nbsp;&nbsp;-&nbsp;&nbsp;</option>
                    </select>
                </td>
                <td class="<%=rowStyle%>">
                    <input type="button" class="button" onclick='submitOutConf("<%=pathId%>", "<%=linePathOutId%>", "<%=(i+j-1)%>")' value="<%=translate([==[ConfigurazioneOut]==])%>" />
                    <select id="selectOutDECTDirectoryNumber<%=i+j-1%>" name="selectOutDECTDirectoryNumber<%=i+j-1%>" style="font-family:Tahoma;width:100px;overflow:hidden">
                    <option value="">&lt;<%=translate([==[Choose]==])%> &gt;</option>
                    <%
                        local preassDECTOutNum = getPreassignedOutNum(DECTPath)
                        local allNumberPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
                        local replyAll, error = mbus.getParameters{ path = allNumberPath, param = "DirectoryNumber", filter="(== X_TELECOMITALIA_IT_LANManaged " .. "false" .. ")", datamodel = "second" }
                        for u,w in pairs(replyAll[allNumberPath]) do
                            if w.param["DirectoryNumber"]~=preassDECTOutNum then
                                cgilua.print("<option title='"..tostring(w.param["DirectoryNumber"]).."' value='"..tostring(string.gsub(w.path, "Device.Services.VoiceService.1.VoiceProfile.1.Line.", "")).."'>"..tostring(w.param["DirectoryNumber"]).."</option>")
                            end
                        end
                    %>
                    <option value="deleteFlag">&nbsp;&nbsp;-&nbsp;&nbsp;</option>
                    </select>
                </td>
                <td class="<%=rowStyle%>"><input type="text" name="Priority" id="Priority" size="5"></td>
                </tr>
                                    <%end%>
                <tr><td width='33%' class='<%=rowStyle%>' colspan='4'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                                <%end%>
                            <%end%>
                        <%end%>
                    <%end%>
                <%end%>
            </table>
            </td></tr></table>
<%end%>
            </td></tr></table>
        </td></tr></table>
    </td>
</tr>
</form>
</table>
</div>
</div>
<div id="resultKoConfNum" style="display:none">
<%cgilua.lp.include("webparts/resultKO_noconfnum.lp")%>
</div>
<div id="confirm" style="display:none">
<%cgilua.lp.include("webparts/confirmBack.lp")%>
</div>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Modem Telecom Italia</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/master.css" type="text/css" />	
<script language="javascript" type="text/javascript" src="js/portmap.js"></script>
<% cgilua.lp.include("lp/language.lp") %>
<%
local translate = translate
local QUERY = cgilua.QUERY
local pathId = cgilua.QUERY["pathId"]
local pathDetail = "Device.Services.VoiceService.1.PhyInterface." .. tostring(pathId) .. ".Tests"
local testSelectorStr = "Requested"
if pathId=="4" then
	testSelectorStr = "PhoneConnectivityTest"
end
local reply, error = mbus.modify(
        function()           
                local reply1, error1 = mbus.setParameters{path = pathDetail, param = {TestSelector=testSelectorStr}, datamodel = "second"}            
        end, {datamodel="second"})
%>
</head>
<body>
<script type="text/javascript">
//<![CDATA[
function changeTeleTest()
{
	var pathId = document.getElementById("pathId").value;
	var urlStr = "/teleTest_ajax.lp";
	var params="pathId="+pathId;
	ajax_get(urlStr, params, testUpdate_cb);
}

//Callback handle to test update:array_T{0=TestState, 1=connection, 2=volDC, 3=volAC, 4=insulationResistance,5=phoneRelease, 6=impedance, 7=dial}
function testUpdate_cb(ajax_obj)
{
	var pathId = document.getElementById("pathId").value;
	var rsps = ajax_obj.responseText.replace(/\s/g,"");
//alert(rsps);
	var array_T = rsps.split("##");
	if(array_T[0] == "Complete")
	{
		var connection = array_T[1];		
		var volDC = array_T[2];
		var volAC = array_T[3];
		var insulationResistance = array_T[4];
		var phoneRelease = array_T[5];
		var impedance = array_T[6];
		var dial = array_T[7];

		if(connection == "true")
		{
			connection = "<%=translate([==[Phone Connected]==])%>";
		}else{
			connection = "<%=translate([==[Phone not connected]==])%>";
		}
		document.getElementById("connection").innerHTML = connection;

		if(phoneRelease == "true")
		{
			phoneRelease = "<%=translate([==[Telephone hook]==])%>";
		}else{
			phoneRelease = "<%=translate([==[Phone locked]==])%>";
		}

		if(dial == "true")
		{
			dial = "<%=translate([==[This fixed line]==])%>";
		}else{
			dial = "<%=translate([==[No landline]==])%>";
		}
		
		document.getElementById("phoneRelease").innerHTML = phoneRelease;
		document.getElementById("dial").innerHTML = dial;

		document.getElementById("volDC").innerHTML = volDC;
		document.getElementById("volAC").innerHTML = volAC;
		document.getElementById("insulationResistance").innerHTML = insulationResistance;
		document.getElementById("impedance").innerHTML = impedance;
		
	}
}

function changeTeleTest4() {
	<%		
	local pathDetail = "Device.Services.VoiceService.1.PhyInterface.4.Tests"
	local con = "Phone not connected"
	local reply, error = mbus.getParameters{ path = pathDetail, param = {"PhoneConnectivity"}, datamodel = "second" }
	if reply[pathDetail]~=nil and reply[pathDetail][1]~=nil then
		con = reply[pathDetail][1].param["PhoneConnectivity"]
	end	
	%>
	var connection = "<%=con%>"
	if(connection == "true") {
		document.getElementById("connState").innerHTML = "<%=translate([==[Phone Connected]==])%>";
	} else {
		document.getElementById("connState").innerHTML = "<%=translate([==[Phone not connected]==])%>";
	}
}
<%if pathId ~= "4" then%>
	window.setInterval("changeTeleTest()", 2000);

<% else%>
	window.setInterval("changeTeleTest4()", 2000);
<%end%>

//]]>
</script>
<div class="contentContainer">
<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="telephonyTest.lp?pathId=<%=pathId%>"><%=translate([==[Telephony test result]==])%></a></li>
			</ul>
		</div>	

		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a class="current">
		<div class="tab">
			<span class="tabIcon_voip"></span>
			<span class="contTabTxt"><%=translate([==[Telephony services]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
			</ol>
		</div>
<!-- <table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
<tr><td align="left"><a href="advance.lp">Avanzate</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="telephonyTest.lp?pathId=<%=pathId%>"><%=translate([==[Telephony test result]==])%></a></td></tr>
</table> -->

<div class='contentcontainer'>	
<div class='contentitem'> 
<table cellspacing='0' cellpadding='0' class="fontSize">
<tr>
<td>
        <table  cellspacing='0' cellpadding='0' width='100%' >
		<tr>
		<td class="verticalAlign"> <table cellspacing='0' cellpadding='0' class="martop5">
		<tr>
		<td class="midarea2 tableTitle">
			<input type="hidden" id="pathId" name="pathId" value="<%=pathId%>"/>
			<%=translate([==[Test of voice ports]==])%></td></tr></table></td>
		</tr>
        <tr><td>		
        <table width='100%' class='datatable marleft40' cellspacing='0' cellpadding='0' style="line-height:150%;">
            <tr>
				<td colspan='2' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td>
			</tr>
            <tr>
				<td colspan='2'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td>
			</tr>
            <tr>
				<th  class="sectionArea-1 " align='left' width="400" class="padleft40"><%=translate([==[Label]==])%></th>
				<th class="sectionArea-1 " align='left'><%=translate([==[Shown Value]==])%></th>
			</tr>
            
                <%
		if tonumber(pathId)==1 or tonumber(pathId)==2 then
                %>
            <tr>
				<td  class="sectionArea-1 paddtop10" width='400' class="padleft40"><%=translate([==[Telephone connection]==])%>:</td>
				<td class="sectionArea-1 paddtop10">
					<div id="connection"><img src="images/wait.gif" width="15px" height="15px" /></div>
				</td>
			</tr>
            <tr>
				<td  class="sectionArea-1 padtop5" width='400' class="padleft40"><%=translate([==[DC voltage between a and b]==])%>:</td>
				<td class="sectionArea-1 padtop5">
					<div id="volDC"><img src="images/wait.gif" width="15px" height="15px" /></div>
				</td>
			</tr>
            <tr>
				<td  class="sectionArea-1 padtop5" width='400' class="padleft40"><%=translate([==[AC voltage between a and b]==])%>:</td>
				<td class="sectionArea-1 padtop5">
					<div id="volAC"><img src="images/wait.gif" width="15px" height="15px" /></div>
				</td>
			</tr>
            <tr>
				<td  class="sectionArea-1 padtop5" width='400' class="padleft40"><%=translate([==[Insulation resistance between a and b]==])%>:</td>
				<td class="sectionArea-1 padtop5">
					<div id="insulationResistance"><img src="images/wait.gif" width="15px" height="15px" /></div>
				</td>
			</tr>
            <tr>
				<td  class="sectionArea-1 padtop5" width='400' class="padleft40"><%=translate([==[Release of the phone]==])%>:</td>
				<td class="sectionArea-1 padtop5">
					<div id="phoneRelease"><img src="images/wait.gif" width="15px" height="15px" /></div>
				</td>
			</tr>
            <tr>
				<td  class="sectionArea-1 padtop5" width='400' class="padleft40"><%=translate([==[Impedance]==])%>:</td>
				<td class="sectionArea-1 padtop5">
					<div id="impedance"><img src="images/wait.gif" width="15px" height="15px" /></div>
				</td>
			</tr>
            <tr>
				<td  class="sectionArea-1 padtop5" width='400' class="padleft40"><%=translate([==[Presence dial]==])%>:</td>
				<td class="sectionArea-1 padtop5">
					<div id="dial"><img src="images/wait.gif" width="15px" height="15px" /></div>
				</td>
			</tr>
                <%  
		elseif tonumber(pathId)==4 then
                %>
            <tr>
				<td  class="sectionArea-1 padtop5" width='400' class="padleft40"><%=translate([==[Telephone connection]==])%>:</td>
				<td class="sectionArea-1 padtop5">
					<div id="connState"><img src="images/wait.gif" width="15px" height="15px" /></div>
				</td>
			</tr>
		<%end%>
                <br>
                <table class='padtop10' cellspacing='0' cellpadding='0' width='100%' style="text-align:center">
                <tr>
					<td style="padding-left:200px" class="paddtop10">	
						<a onclick='javascript:document.location.href="telephonyMeasurement.lp";'>
							<div name="thb7" class="midarea6-1 mainButton"><%=translate([==[Cancel]==])%></div>
						</a>
					</td>
                </tr>
			</table> 
            </table>
            </td></tr></table>
        </td></tr>
        </table>
   
</div>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
<link rel="stylesheet" href="css/master.css" type="text/css" />
<script language="javascript" type="text/javascript" src="js/portmap.js"></script>

<%
cgilua.lp.include("lp/mbus_util.lp")
cgilua.lp.include("lp/common.lp")
cgilua.lp.include("lp/style.lp")
cgilua.lp.include("lp/usb.lp")
cgilua.lp.include("lp/voip.lp")
cgilua.lp.include("lp/xml.lp")

local translate = translate
local POST=cgilua.POST
local TI_info = getTIInfo()

local cs_state, cs_name = get_cs_state()
local usbdisk_info
if cs_state == "true" then
    usbdisk_info = get_usbdisk_info()
end

local logPath = "TI_STORE.TiUserIntf"
local logStop = 0
local logAddress = ""
local logError = ""
local logErrorNoUSB = translate([==[Could not activate log file! Verify that the service "Remote Disk" is active and at least]==]) .. " " .. "<br/>" .. translate([==[one USB device is connected to the modem.]==])
local logErrorUSB = translate([==[Can not perform the requested operation on the connected USB devices.]==]) .. " " .. "<br/>" .. translate([==[Connect a new device and try again.]==])

--power description
local powerGreen=translate([==[Modem OK]==])
local powerRed=translate([==[Diagnostic Test Failed]==])
local powerFlashingGreen=translate([==[Reading/Writing on USB device]==])
local powerOff=""

--adsl description
local linkName = "ADSL/FIBRA"
local linkOff = translate([==[Physical connection is not determined]==])
local linkGreen = linkOff
local linkFlashingGreen = linkOff
local reply, error = mbus.getParameters{ path = "WANSensing", param = "CurrentMode"}
local wanConnType = reply["WANSensing"][1].param["CurrentMode"]
if wanConnType == "ADSL" then
  linkName = "ADSL"
  linkGreen = translate([==[ADSL line synchronized]==])
  linkFlashingGreen = translate([==[ADSL Synchronization in progress]==])
  linkOff = translate([==[ADSL line unsynchronized]==])
elseif wanConnType == "ETH" then
  linkName = "FIBRA"
  linkGreen = translate([==[WAN Ethernet connection active]==])
  linkFlashingGreen = ""
  linkOff = translate([==[WAN Ethernet connection is not active]==])
elseif wanConnType == "VDSL" then
  linkName = "ADSL"
  linkGreen = translate([==[VDSL line synchronized]==])
  linkFlashingGreen = translate([==[VDSL Synchronization in progress]==])
  linkOff = translate([==[VDSL line unsynchronized]==])
end

--internet description
local internetGreen=translate([==[Active data connection routed]==])
local internetOff=translate([==[Routed data connection is not active]==])

local wifiGreenDesc=translate([==[The Wi-Fi active radio interfaces are configured in secure mode (WPA-PSK)]==])
local wifiRedDesc=translate([==[At least one of the Wi-Fi radio interfaces is turned on and used in non safe mode]==]) .. " " .. "<br/>" .. translate([==[(WEP or disabled)]==])
local wifiFlashingGreen=translate([==[Procedure WPS (Wireless Protected Setup) in the course]==])
local wifiOff=translate([==[Both Wi-Fi radio interfaces are not active]==])

--service description
local serviceGreenDesc=translate([==[Additional services are configured correctly]==])
local serviceRedDesc=translate([==[Additional services not properly configured. Power cycle the modem]==])
local serviceFlashingGreen=translate([==[Configuration Tasks of ongoing service]==])
local serviceOff=translate([==[Additional services are not configured]==])

--DECT description
local DECTGreen=translate([==[Active interface, and properly used by at least one cordless DECT]==])
local DECTRed=translate([==[Interface is active but not used: Cordless DECT is not registered or not associated]==]) .. " " .. "<br/>" .. translate([==[with error number or VoIP]==])
local DECTFlashingGreen=translate([==[Pairing cordless underway]==])
local DECTOff=translate([==[Interface is not active]==])

--Line1 description
local cli_in = getAllInCallNum1("Device.Services.VoiceService.3.VoiceProfile.1.Line.1")
local cli_out = getAllOutCallNum1("Device.Services.VoiceService.3.VoiceProfile.1.Line.1")
if cli_in==nil then
    cli_in = ""
end
if cli_out==nil then
    cli_out = ""
end
--[[local LineOneGreen=translate([==[Interface OK. Number associated with input]==]) .. " " .. cli_in .. " , " .. translate([==[number associated output]==]) .. " " .. cli_out .. " "]]

local LineOneGreen=translate([==[Active Interface toward PSTN]==])
local LineOneGreen1=translate([==[OK Interface. Associated Number: <<CLI>>]==])
local LineOneFlashingRed=translate([==[Fault in the course]==])

local LineOneRed=translate([==[Error VoIP port]==])
local LineOneFlashingGreen=translate([==[Interface OK, but no number associated with other terminal.]==])
local LineOneOff=translate([==[Interface is not active]==])
local lineOneNoNum=isFXSMapNumExist("Device.Services.VoiceService.1.PhyInterface.1")
local lineOneEnable=getFXSEnable("Device.Services.VoiceService.1.PhyInterface.1")
if lineOneEnable=="false" then
    LineOneOff=translate([==[Interface is not active]==])
elseif lineOneEnable=="true" and lineOneNoNum=="true" then
    LineOneOff=translate([==[Active interface, no other terminal]==])
end

--Line2 description
local cli_two_in = getAllInCallNum1("Device.Services.VoiceService.3.VoiceProfile.1.Line.1")
local cli_two_out = getAllOutCallNum1("Device.Services.VoiceService.3.VoiceProfile.1.Line.1")
if cli_two_in==nil then
    cli_two_in = ""
end
if cli_two_out==nil then
    cli_two_out = ""
end
--[[local LineTwoGreen=translate([==[Interface OK. Number associated with input]==]) .. " " .. cli_two_in .. " , " .. translate([==[number associated output]==]) .. " " .. cli_two_out .. " "]]
local LineTwoGreen=translate([==[Active Interface toward PSTN]==])
local LineTwoGreen1=translate([==[OK Interface. Associated Number: <<CLI>>]==])
local LineTwoFlashingRed=translate([==[Fault in the course]==])
local LineTwoRed=translate([==[Error VoIP port]==])
local LineTwoFlashingGreen=translate([==[Interface OK, but no number associated with other terminal.]==])
local LineTwoOff=translate([==[Interface is not active]==])
local lineTwoNoNum=isFXSMapNumExist("Device.Services.VoiceService.1.PhyInterface.2")
local lineTwoEnable=getFXSEnable("Device.Services.VoiceService.1.PhyInterface.2")
if lineTwoEnable=="false" then
    LineTwoOff=translate([==[Interface is not active]==])
elseif lineTwoEnable=="true" and lineTwoNoNum=="true" then
    LineTwoOff=translate([==[Active interface, no other terminal]==])
end

local ledDesc = {	Power={Green=powerGreen, Red=powerRed, FlashingGreen=powerFlashingGreen, Off=powerOff},
			ADSL={Green=linkGreen, FlashingGreen=linkFlashingGreen, Off=linkOff},
			Internet={Green=internetGreen, Off=internetOff},
			Wifi={Green=wifiGreenDesc, Red=wifiRedDesc, FlashingGreen=wifiFlashingGreen, Off=wifiOff},
			Service={Green=serviceGreenDesc, Red=serviceRedDesc, FlashingGreen=serviceFlashingGreen, Off=serviceOff},
			DECT={Green=DECTGreen, Red=DECTRed, FlashingGreen=DECTFlashingGreen, Off=DECTOff},
			Line1={Green=LineOneGreen, Red=LineOneRed, FlashingGreen=LineOneFlashingGreen, Off=LineOneOff, FlashingRed=LineOneFlashingRed},
			Line2={Green=LineTwoGreen, Red=LineTwoRed, FlashingGreen=LineTwoFlashingGreen, Off=LineTwoOff, FlashingRed=LineTwoFlashingRed}
			}
local led_list = { "Power", "ADSL", "Internet", "Wifi", "Service", "DECT", "Line1", "Line2" }

local function getVendorLogFilename()
  local result = ""
  local reply, error = mbus.getParameters{path = "ENV", param = "Value", filter = "(== Name %Vendor_Log_File_1_tmp)"}
  if reply["ENV"][1]~=nil and reply["ENV"][1].param~=nil then
    result = reply["ENV"][1].param["Value"] or ""
  end
  return result
end

local function getVendorLogAddress()
  local result = ""
  local addr = ""
  local reply, error = mbus.getParameters{ path = logPath, param = {"logPath"} }
  if reply[logPath][1]~=nil and reply[logPath][1].param~=nil then
    result = reply[logPath][1].param["logPath"] or ""
  end
  if result ~= "" then
	  addr = "\\\\modemtelecom\\Disk_"..string.gsub(result, ".*sd", "")
  end
  return addr
end


function isDiskMoreThan2MB(freeDiskSize)
	local isPos = string.find(freeDiskSize, "GB")
	if isPos ~= nil then
		return true
	end
	
	local isPos = string.find(freeDiskSize, "MB")
	if isPos ~= nil then
		local diskSize = string.gsub(freeDiskSize, " MB", "")
		if tonumber(diskSize) >= 2 then
			return true
		end
	end
	
	return false
end

function isUsbReadOnly()
    for i=1, #usbdisk_info do
        for j=1,#usbdisk_info[i].part do
            local disk = usbdisk_info[i].part[j]
            if disk.readOnly ~= "true" then
                return false
            end
        end
    end
    return true
end

--Post Handler
if cgilua.servervariable"REQUEST_METHOD" == "POST" then
    --customer reset is done by restartAGing.lp
    --save and restart the model are done in restartingAG.lp
    
    --generate the backup file
    if POST["backupFlag"]=="1" then
        --Delete the old file if it is existed
        os.remove ("/tmp/AGConfig.cfg")
        os.remove ("/tmp/AGConfig.kry")

        --Create the xml file. 
        xmlCreateBR()

         mbus.modify(
         function()
                     mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {writeLog = "Backup: generated a backup file"}}
                             end)
        --Fix For CQ CPE_P00120870 Starts
        local mode = 1
        local err = xmlEncryptAndDecrypt(mode)

	--Fix for security issue in TI_M5
	--Merge Label MOD_ARCHIVE_DANT-V_r10.5_r10.5.e_WIPRO_V1.0.2-x from TI_BHS
        --Delete the AGConfig.xml file after encryption is completed
        os.remove ("/tmp/AGConfig.xml")

	if err == 1 then
        	cgilua.redirect("resultKO.lp")
                return
        else 
                os.rename("/tmp/AGConfig.kry", "/tmp/AGConfig.cfg")
                --Fix For CQ CPE_P00120870 Ends
                cgilua.redirect("/AGConfig.cfg")
                return
        end


    --restore the backup file
    elseif POST["restoreFlag"]=="1" then
        sleep(2)
        --Delete the old file if it is existed
        os.remove ("/tmp/AGConfig.cfg")
        os.remove ("/tmp/AGConfig.xml")

        --Change the upload file name to suit for decrypting input file name.
        local fileName = cgilua.POST["restoreFile"].filename
        local filePath="/tmp/" .. fileName
        os.rename(filePath, "/tmp/AGConfig.kry")

        mbus.modify(
            function()
                mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {writeLog = "Restore: restored a backup file"}}
            end)

	--Fix for Tessa 324
	--M4 .cfg file is unencrypted so no need to do decryption over an unencrypted .cfg file
	local temp = "telecomitalia"
	local path = "/tmp/AGConfig.kry"
	local fh = io.open(path)
	if fh~=nil then
		content = fh:read("*a")
	end
	fh:close()
	local val = string.find(content,temp)
	local err = 0
	if(val~=nil)then
		os.rename("/tmp/AGConfig.kry", "/tmp/AGConfig.xml")
	else
	        --Fix for CQ CPE_P00121582 Unable to do Restore via GUI
	
		--Decrypt the kry file to xml file, the param mode=0 means decrypt operation.
		local mode = 0
	        err = xmlEncryptAndDecrypt(mode)
	end
        if err == 1 then 
        	--If the decrypt operation is wrong, it would go to the restore warning page.
        	cgilua.redirect("restoreKO.lp")
        else
        	--Redirect to the restore page to parse the xml file
        	cgilua.redirect("restoreWaitInfo.lp?fileName=" .. fileName)
        end
	return

  elseif POST["logFlag"]=="1" or POST["logFlag"]=="2" then
    if POST["logFlag"] == "1" then
      -- start log
      if usbdisk_info == nil or #usbdisk_info == 0 then
        logError = logErrorNoUSB
      else
        for i=1, #usbdisk_info do
          local disk = ""
          local fstype = ""
          for j=1,#usbdisk_info[i].part do
            disk = usbdisk_info[i].part[j]
            fstype = tostring(disk.fstype)
            if fstype ~= "EXT2" and fstype ~= "EXT3" and disk.mount_point ~= "" and disk.readOnly ~= "true" then
              local part_size = 0
              if disk.ok == 1 and isDiskMoreThan2MB(disk.part_size) then
                -- write log to mount point
                local modify = {}
                table.insert(modify, {path = logPath, param = {logPath = "/var/usbmount/"..disk.device_name}})
                table.insert(modify, {path = logPath, param = {logState= "true"}})
                setMBUS(modify)
                
                logAddress = disk.sharing_addr
                local filename = getVendorLogFilename()
                logError = translate([==[Operation performed. Log]==]) .. " " .. filename .. " " .. translate([==[started on]==]) .. " " .. logAddress
                break
              end
            end
          end
        end
        if logAddress == "" then
          logError = logErrorUSB
        end
      end
      
    else
      -- stop log
      logAddress = getVendorLogAddress()
      local filename = getVendorLogFilename()

      local modify = {}
      table.insert(modify, {path = logPath, param = {logState = "false"}})
      setMBUS(modify)
      
      logStop = 1
      logError = translate([==[Operation performed. Log]==]) .. " " .. tostring(filename) .. " " .. translate([==[successfully created on]==]) .. " " .. tostring(logAddress) .. ".<br>" .. translate([==[To read the file, access the resource.]==])
    end

    --config the led Power mode 
    elseif POST["ledConfigFlag"]=="1" then
      local modify = {}
      table.insert(modify, {path = "TI_STORE.TiUserIntf", param = {LowConsumptionLED = POST["lcled"]}})
      setMBUS(modify)
      saveall(0, 1)
    end
  end

  local ledServiceColor=TI_info.static
  local ledServiceStatus="Solid"
  local isRedColor=string.find (ledServiceColor,"red_")
  if isRedColor~=nil then
      ledServiceColor="Red"
  else
      if ledServiceColor~="off" then		
          if ledServiceColor=="green_blink" then
              ledServiceStatus="Flash"
          end
          ledServiceColor="Green"
      else
          ledServiceColor="Off"
      end
  end

  local ledConfigList = getList("TI_STORE.TiUserIntf",nil,"LowConsumptionLED")
local activeChecked=""
local unactiveChecked=""

if ledConfigList[1]["LowConsumptionLED"]=="true" then
	activeChecked="checked='checked'"
else
	unactiveChecked="checked='checked'"
end

--log info
local log_status_str = translate([==[Inactived]==])
local in_progress, log_error = "false", "0"
local reply, error = mbus.getParameters{ path = logPath, param = {"logState", "logError"} }
local v = reply[logPath][1]

if v~=nil and v.param~=nil and v.param["logState"]~=nil then
    in_progress = v.param["logState"]
    log_error = v.param["logError"]

    if in_progress=="true" then
        logAddress = getVendorLogAddress()
        log_status_str = translate([==[In progress with]==]) .. " " .. logAddress
    else
        if log_error=="1" then
            log_status_str = translate([==[Finished - Error]==])
        elseif logStop == 1 then
            log_status_str = translate([==[Finished OK]==])
            if usbdisk_info == nil then
                log_status_str = translate([==[Finished - Error]==])
            end
        end
    end
end
%>

<script type="text/javascript">
//<![CDATA[

function backupClick()
{
	document.getElementById("backupFlag").value="1";
	document.backup.submit();
}

function restoreClick()
{
    var fileName = document.getElementById("restoreFile").value;
    var fileArray = fileName.split(".");
    var len = fileArray.length;
    var fileSuffix = fileArray[len-1]; 
    if(fileSuffix != "cfg")
    {
        document.getElementById("tools").style.display="none";
        document.getElementById("restoreKO").style.display="block";
    }
    else
    {
        document.getElementById("restoreFlag").value="1";
        document.restore.submit();
    }
}

function resetClick()
{	
	document.getElementById("tools").style.display="none";
	document.getElementById("defaultWait").style.display="block";
}

function logClick(n)
{
  if(n==1)
  {
    //start
    document.getElementById("tools").style.display="none";
    document.getElementById("logWarn").style.display="block";
  }
  else
  {
    //stop
    document.getElementById("logFlag").value = n;
    document.logForm.submit();
  }
}

function submitStartLog()
{
  document.getElementById("logFlag").value = 1;
  document.logForm.submit();
}

function submitConfirm()
{
  document.gwReset.submit();
}

function cancelConfirm()
{
	document.getElementById("tools").style.display="block";
	document.getElementById("defaultWait").style.display="none";
	document.getElementById("logWarn").style.display="none";
<% if logError ~= "" then %>
	document.getElementById("logResult").style.display="none";
<% end %>
}

function submit_lcled()
{
	document.getElementById("ledConfigFlag").value="1";
	document.ledEnergyConfig.submit();
}

function closeRestoreKO(){
	document.getElementById("tools").style.display="block";
	document.getElementById("restoreKO").style.display="none";	 
}
//Query the log state in every 2 seconds by ajax
function changeLogStatus()
{
    var urlStr = "/log_ajax.lp";
    var params="";
    <% if in_progress == "true" then %>
        ajax_get(urlStr, params, logStatusUpdate_cb);
    <% end %>
}

//Callback handle to log status update
function logStatusUpdate_cb(ajax_obj)
{
        var isUsbDisconnected = ajax_obj.responseText.replace(/\s/g,"");
        if(isUsbDisconnected == "true") {
        var logStatusStr = document.getElementById("logStatus").innerHTML;
                if(logStatusStr != "<%=translate([==[Finished - Error]==])%>")
                {
                        document.getElementById("logStatus").innerHTML = "<%=translate([==[Finished - Error]==])%>";
                }
        }
}

window.setInterval("changeLogStatus()", 2000);
//]]>
</script>
    <script language="JavaScript" type="text/javascript">
	if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="";
	}
	
	if(window.parent.menu.document.getElementById("teleSub")!=null && 
		window.parent.menu.document.getElementById("teleSub") != "undefinded") {
		window.parent.menu.document.getElementById("teleSub").style.display="none";	
	}

	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="";
	}

	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}
	
	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
		if(window.parent.menu.document.getElementById("ipv6list")) {
			window.parent.menu.document.getElementById("ipv6firewall").className="";
			window.parent.menu.document.getElementById("ipv6list").style.display="none";
		}
	}

	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {
		window.parent.menu.document.getElementById("port").className="";
	}

	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="";
	}
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {
		window.parent.menu.document.getElementById("urlfi").className="";
	}
	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {
		window.parent.menu.document.getElementById("waon").className="";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {
		window.parent.menu.document.getElementById("stru").className="submenuselect1";
	}		
  </script>
</head>
<body>

<div class="contentContainer">
	 	<table cellspacing='0' cellpadding='0' width="100%">
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li><li><a href="tool.lp"><%=translate([==[Tools]==])%></a></li>
			</ul>
		</div>	</table>

<div class="contentTab" id="content">
		<ol id="tocTab">
			<li><a href="tool.lp" class="current">
				<div class="tab">
				<span class="tabIconTool"></span>  
				<span class="contTabTxt transform"><%=translate([==[Tools]==])%></span>
				</div><div class="clrBth"></div></a>
			</li>
		</ol>
</div>
						
						
<div class='contentcontainer'>
<div class='contentitem'>
<div id="tools" class="fontSize">

<table cellspacing='0' cellpadding='0' width='100%'>
	<tr>		<td valign='top'>
			<table cellspacing='0' cellpadding='0'>
			<tr><td class="midarea2 tableTitle"><%=translate([==[Modem Configuration Backup]==])%></td></tr>
			</table>
			<table width='100%' cellspacing='0' cellpadding='0' class="width650" style='line-height:150%;'> 
		
			<tr><td  class="textColor" colspan='4'>
			 <form name="backup" method="post" action="">
			 <input type="hidden" id="backupFlag" name="backupFlag" value="0" />
			<table border='0' cellspacing='0' cellpadding='0' width='100%'  >
			<tr>
					<td class="padleft250">
					<a onclick="backupClick()" href="#">
					<div class="midarea7-1 mainButton"><%=translate([==[Save configuration]==])%></div></a>
					</td><td>&nbsp;</td>
			</tr>
			</table>
			</form>
			</td></tr>
			<tr><td  class="textColor padleft40"><p><font color="#FF0000"><%=translate([==[Warning]==])%>:</font> <%=translate([==[clicking on]==])%> <font color="#0000FF">&quot;<%=translate([==[Save configuration]==])%>&quot;</font> <%=translate([==[the backup file will be generated on the configuration of modem and saved on your computer at the location indicated in]==])%>&nbsp;<%=translate([==[rescue]==])%>.</p></td></tr>
			</table>
		</td>
	</tr>
</table>

<table cellspacing='0' cellpadding='0' width='100%' class="martop15">
	<tr>		<td  valign='top'>
		<table cellspacing='0' cellpadding='0'>
		<tr><td class="midarea2 tableTitle"><%=translate([==[Restore Configuration]==])%></td></tr>
		</table>
		<table width='100%' cellspacing='0' cellpadding='0' style='line-height:150%;' class="width650"> 

<%
	--get the upload id (new feature in R842)
	local id= cgilua.session.storefilepath("/tmp/","",1)
%>
		<tr><td class="textColor padleft40" colspan='4' >
		<form name="restore" method="post" action="tool.lp?id=<%=id%>" enctype='multipart/form-data'>
		<input type="hidden" id="restoreFlag" name="restoreFlag" value="0" />
		<table cellspacing='0' cellpadding='0'>
		<tr><td  class="textColor">
		<p><%=translate([==[Select the backup file to restore, then press]==])%> <font color="#0000FF"> &quot;<%=translate([==[Restore Configuration]==])%>&quot;:</font></p>
		</td></tr>
		<tr><td>
		<font face="Arial">
		<input type="file"  id="restoreFile" name="restoreFile" size="65"  class="inputClass"/><br/>
		</font>
		</td></tr>
		<tr><td class="padleft210">
		<table border='0' cellspacing='0' cellpadding='0' width='100%' class="martop5">
			<tr>
				<td>
				<a onclick="restoreClick()" href="#">
				<div class="midarea7-1 mainButton"><%=translate([==[Restore Configuration]==])%></div></a>
				</td><td>&nbsp;</td>
			</tr>
		</table>
		</td></tr></table>
		</form>
		</td></tr>
    
		<tr>
			<td class="textColor padleft40">
		<p><font color="#FF0000"><%=translate([==[Warning]==])%></font>: <%=translate([==[clicking on]==])%> <font color="#0000FF">&quot;<%=translate([==[Restore Configuration]==])%>&quot;</font> <%=translate([==[modem configuration will be updated with that present in the selected backup file]==])%>.</p>
		</td></tr>
		
		</table></td></tr></table>
		
		<table cellspacing='0' cellpadding='0' width='100%' class="martop15">
	<tr>		<td valign='top'>
			<table cellspacing='0' cellpadding='0'>
			<tr><td class="midarea2 tableTitle"><%=translate([==[Reset factory settings]==])%></td></tr>
			</table>
			<table width='100%' cellspacing='0' cellpadding='0' class="width650" style='line-height:150%;'> 

	<tr><td class="padleft230"><form name="gwReset" method="post" action="restartingAG.lp">
	<input type="hidden" name="action" id="resetAction" value="customerReset" />
	<table border='0' cellspacing='0' cellpadding='0' width='100%'>
			<tr>
				<td>
				<a onclick="resetClick()" href="#">
				<div class="midarea7-4 mainButton"><%=translate([==[Reset factory settings]==])%></div></a>
				</td><td>&nbsp;</td>
			</tr>
		</table>
    </form></td></tr>
	<tr><td class="textColor padleft40">
    <p><font color="#FF0000"><%=translate([==[Warning]==])%></font>: <%=translate([==[clicking on]==])%> <font color="#0000FF">&quot;<%=translate([==[Reset factory settings]==])%>&quot;</font> <%=translate([==[will be restored to the modem initial configurations and will therefore lose all user customizations.]==])%></p>
  </td></tr>
  </table>
  </td></tr></table>
 
  <table cellspacing='0' cellpadding='0' width='100%' class="martop15">
  <tr>
  <td valign='top'>
  <table cellspacing='0' cellpadding='0'>
  <tr><td class="midarea2 tableTitle"><%=translate([==[Modem activity log]==])%></td></tr></table>
  <table width='100%' cellspacing='0' cellpadding='0' style='line-height:150%;' class="width650"> 
  <tr><td class="textColor padleft40" ><%=translate([==[Log status]==])%>:&nbsp;&nbsp;&nbsp;&nbsp;<span id="logStatus"><%=log_status_str%></span></td></tr>
  <tr><td colspan='4' class="padtop5">
    <form name="logForm" method="post" action="">
      <input type="hidden" id="logFlag" name="logFlag" value="" />
	<% if in_progress == "false" then %>
	<table border='0' cellspacing='0' cellpadding='0' width='100%' style="text-align:center">
			<tr>
				<td class="textColor padleft305">
				<a onclick="logClick(1)" href="#">
				<div class="midarea6-1 mainButton" name="thbS3">Start</div></a>
				</td>
			</tr>
		</table>
	<% else %>
	<table border='0' cellspacing='0' cellpadding='0' width='100%' style="text-align:center">
			<tr>
				<td class="textColor padleft305">
				<a onclick="logClick(2)" href="#">
				<div class="midarea6-1 mainButton" name="thbS4">Stop</div></a>
				</td>
			</tr>
		</table>
	<% end %>
    </form>
	
    <p class="textColor padleft40"><font color="#FF0000"><%=translate([==[Warning]==])%></font>: <%=translate([==[clicking on]==])%> <font color="#0000FF">&quot;Start&quot;</font> <%=translate([==[mode will active modem Log activity. In this mode, the modem Telecom records all activities on a connected USB device. The recording will be active until the maximum size of the log file (2MBytes) is reached or until you press the button]==])%> <font color="#0000FF">&quot;Stop&quot;</font>.</p>
  </td></tr>
<%
endBlock()
%>

  <table cellspacing='0' cellpadding='0' width='100%' class="martop15">
  <tr>
    <td valign='top'>
  <table cellspacing='0' cellpadding='0'>
  <tr><td class="midarea2 tableTitle"><%=translate([==[Configuration]==])%> LED</td></tr></table>
  <table width='100%' cellspacing='0' cellpadding='0' style='line-height:150%;'> 

	

<form name="ledEnergyConfig" method="post" action="">
  <tr>
  <td class="textColor padleft40 width160"><%=translate([==[Power mode]==])%>:
      <input type="hidden" id="ledConfigFlag" name="ledConfigFlag" value="0" /></td>
	  <td class="textColor width120">
      <input type="radio" value="true" name="lcled" onclick="submit_lcled()" <%=activeChecked%> />&nbsp;<%=translate([==[ON]==])%>
     </td>
	 <td class="textColor">
	 <input type="radio" value="false" name="lcled" <%=unactiveChecked%> onclick="submit_lcled()" />&nbsp;<%=translate([==[NOT ACTIVE]==])%>
  </td></tr>
    </form></table>
<%
	endBlock()
%>

 
  <table cellspacing='0' cellpadding='0' width='100%' class="martop15"><tr>
  <td valign='top'>
  <span class="midarea2 tableTitle"><%=translate([==[LED Modem State]==])%></span><br>
  <table class='edittable valueSpace fontSize width750 servizitable marleft36' width='100%' cellspacing='0' cellpadding='0' border='0'>
<%
writeTableContHeader(3, translate([==[LED]==]), translate([==[State]==]), translate([==[Description]==]))
local rowStyle = "oddrow"
local rowNum = 0

for i,v in pairs(led_list) do
	local ledName=tostring(v)
	local led_gui_name = ledName 
	local pled = "LEDS.LED"
 local ledColor = ""
 local ledState = ""

	if ledName == "Service" then
		ledColor = ledServiceColor
		ledState = ledServiceStatus
	else
		local ledobj, err = mbus.getParameters{path = pled, param = {"Color", "State"}, filter = "(== Name "..ledName..")" }
		if ledobj[pled][1]~=nil and ledobj[pled][1].param~=nil and ledobj[pled][1].param["Color"]~=nil then
			ledColor = tostring(ledobj[pled][1].param["Color"])
			ledState = tostring(ledobj[pled][1].param["State"])
		end
	end
	if ledColor=="None" or ledColor=="" then
		ledColor="Off"
	end

	local styleColor="tdGreen"
	if ledColor=="Red" then
		styleColor="tdRed"
	elseif ledColor=="Off" then
		styleColor="tdBianca"
	end

	local isFlash=string.find (ledState,"Flash")
	if isFlash~=nil then
		ledColor = "FlashingGreen"
	end

	local ledColorTranslate=translate([==[Green]==])
	if ledColor == "FlashingGreen" then 
		ledColorTranslate=translate([==[FlashingGreen]==])
	elseif ledColor == "FlashingRed" then
		ledColorTranslate=translate([==[FlashingRed]==])
	elseif ledColor == "Red" then
		ledColorTranslate=translate([==[Red]==])
	elseif ledColor == "Off" then
		ledColorTranslate=translate([==[Off]==])
	end
	
	if ledName == "Wifi" then 
		led_gui_name = "Wi-Fi" 
	elseif ledName == "ADSL" then 
		led_gui_name = linkName
  if linkName == "ADSL/FIBRA" then
    ledColorTranslate = translate([==[Unknown]==])
  end
	end

  rowNum = rowNum + 1
  if rowNum%2==1 then
    rowStyle = "oddrow"
  else
    rowStyle = "evenrow"
  end
  
  local desc = ledDesc[ledName][ledColor]
  if desc==nil or desc=="" then
    desc = "&nbsp;"
  end
%>

  <tr>
    <td class="<%=rowStyle%> fontSize  width140"><div><%=led_gui_name%></div></td>
    <td class="<%=rowStyle%> <%=styleColor%> fontSize width110"><div><%=ledColorTranslate%></div></td>
    <td class="<%=rowStyle%> fontSize wordWrap width450 whiteWrap"></div><%=desc%></div></td>
  </tr>
  
<%
end
endBlock()

	
%>
  <table cellspacing='0' cellpadding='0' width='100%' class="martop15"><tr>
  <td>
  <table cellspacing='0' cellpadding='0'>
  <tr><td class="midarea2 tableTitle"><%=translate([==[Restart Modem]==])%></td></tr></table>
  <table width='100%' cellspacing='0' cellpadding='0' style='line-height:150%;'> 
  <tr><td class="textColor padleft250" colspan='4'>
    <form name="gwRestart" method="post" action="restartingAG.lp">
	<input type="hidden" name="action" id="restartAction" value="saveRestart" />
	<table border='0' cellspacing='0' cellpadding='0' width='100%' style="text-align:center">
			<tr>
				<td>
				<a href="javascript:document.gwRestart.submit();">
				<div class="midarea7-1 mainButton"><%=translate([==[Save and Restart]==])%></div></a>
				</td><td>&nbsp;</td>
			</tr>
		</table>
    </form>
	</td></tr>
	<tr><td class="textColor padleft40">
    <p><font color="#FF0000"><%=translate([==[Warning]==])%>:</font><br/> <%=translate([==[clicking on]==])%> <font color="#0000FF">"<%=translate([==[Save and Restart]==])%>"</font> <%=translate([==[saves the current configuration and reboots the modem. You may need to authenticate again to access the modem management console if security is enabled for access]==])%>.</p>
  </td></tr>
<%
	endBlock()

endPage()
%>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</div>

<div id="logWarn" style="display:none">
   <table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
                      <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Modem activity log]==])%></td></tr>
              <tr><td id="logWarnMsg" class="errorDesc">
              <p> <%=translate([==[Warning: Pressing the "Next" button will activate the modem Telecom recording mode of the Log File on the first USB device available.]==])%><br><%=translate([==[Verify that the Remote Disk is "Active" and that is connected to at least one memory device.]==])%><br><%=translate([==[Warning: this may slow down the operation mode of the modem.]==])%></p>
              <p class="paddtop10"><%=translate([==[Click "Next" to confirm or click "Cancel" to return to previous page]==])%>.</p>
              <br/>
                 </td></tr></table>
                   </td></tr>
                   <tr><td>
                      <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
                         <tr><td class="verticalAlign fright">
                            <a class="fright" onclick="submitStartLog()" href="#">
                <div class="midarea6-1 mainButton"><%=translate([==[Next]==])%></div></a>
                </td>
                <td  class="verticalAlign" style="padding-left:15px;">
                <a onclick="cancelConfirm()" href="#">
                <div class="midarea6-1 mainButton"><%=translate([==[Cancel]==])%></div></a>
                </td>
                </tr>
                </table>
           </td></tr></table>
</div>

<% if logError ~= "" then %>
<div id="logResult" style="display:none">
  <table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
                      <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Modem activity log]==])%></td></tr>
              <tr><td class="errorDesc"><p><%=logError%></p><br/>
        </td></tr></table>
        </td></tr>
        <tr><td>
         <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
          <tr><td class="width340">&nbsp;</td>
            <td class="verticalAlign">
          <a onclick="cancelConfirm()">
                <div class="midarea6-1 mainButton"><%=translate([==[Continue]==])%></div></a>
            </td></tr></table>
  </td></tr></table>
</div>
<script type="text/javascript">
document.getElementById("tools").style.display="none";
document.getElementById("logResult").style.display="";
</script>
<% end %>

<div id="defaultWait" style="display:none">
<%cgilua.lp.include("webparts/defaultWait.lp")%>
</div>
<div id="restoreKO" style="display:none">
<%cgilua.lp.include("webparts/restoreKO.lp")%>
</div>

</div>
</div>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Modem Telecom Italia</title>
<link rel="stylesheet" href="css/master.css" type="text/css"/>
<style>
.urlTop
{
	margin-top:125px;
}
.buttonTop
{
	margin-top:20px;
}
.imgleft
{
	padding-left:5px;
}
</style>
<script language="javascript" type="text/javascript" src="js/script.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Language" content="it"/>
    <script language="JavaScript" type="text/javascript">
	if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="";
	}
	
	if(window.parent.menu.document.getElementById("teleSub")!=null && 
		window.parent.menu.document.getElementById("teleSub") != "undefinded") {
		window.parent.menu.document.getElementById("teleSub").style.display="none";	
	}

	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="";
	}

	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}

	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
		if(window.parent.menu.document.getElementById("ipv6list")) {
			window.parent.menu.document.getElementById("ipv6firewall").className="";
			window.parent.menu.document.getElementById("ipv6list").style.display="none";
		}
	}

	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {
		window.parent.menu.document.getElementById("port").className="";
	}

	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="";
	}
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {
		window.parent.menu.document.getElementById("urlfi").className="submenuselect1";
	}

	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {
		window.parent.menu.document.getElementById("waon").className="";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {
		window.parent.menu.document.getElementById("stru").className="";
	}	

  </script>
  

</head>
<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<% cgilua.lp.include("lp/ppp.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/lan.lp") %>
<%
local translate = translate
local POST = cgilua.POST
local urlFilterPath = "Device.NAT.X_TELECOMITALIA_IT_URLFiltering.1" 
local TI_Device = getTIInfo_Device()
local ipInfo_T = getIPInfo()
local TI_info = getTIInfo()
if TI_Device.lanOption ~= "res-rt-napt" and TI_Device.lanOption ~= "biz-rt-napt-ena" and 
TI_Device.lanOption ~= "res-rt-napt-ipv6" and TI_Device.lanOption ~= "biz-rt-napt-ipv6" then
    cgilua.redirect("index.lp")
    return
end
if cgilua.servervariable"REQUEST_METHOD" == "POST" then
    local modify = {}
    -- only DSD enabled, url filter could effect, so when url filter eanble, DSD is eanbled;  when disabled, DSD is automatic
    local DSD, error = mbus.getParameters{ path = "DSD", param ={"Status"}}
    local DSDStatus = DSD["DSD"][1].param["Status"]
    if POST["enable"]=="1" and DSDStatus~="Enabled" then
        table.insert(modify, {path = "DSD", param={ Status = "Enabled"}})
        setMBUS(modify)
    elseif POST["enable"]=="0" and DSDStatus~="Automatic" then
        table.insert(modify, {path = "DSD", param={ Status = "Automatic"}})
        setMBUS(modify)
    end
    modify={}
    if POST["save"] == "1" then
        table.insert(modify, {path = urlFilterPath, param={ Enable = POST["enable"] }, datamodel="second"})
        table.insert(modify, {path = urlFilterPath, param={ FilteredURLsExclude = POST["exclude"] }, datamodel="second"})
        setMBUS_IGD(modify)
    end

    modify={}
    if POST["add"] == "1" and POST["addurl"] ~= "" then
        table.insert(modify, {path = urlFilterPath, param={ AddURL = POST["addurl"] }, datamodel="second"})

    elseif POST["remove"] == "1" and POST["removeurl"] ~= "" then
        table.insert(modify, {path = urlFilterPath, param={ RemoveURL = POST["removeurl"] }, datamodel="second"})

    elseif POST["clearurl"] == "1" then
        table.insert(modify, {path = urlFilterPath, param={ ClearURL = "1" }, datamodel="second"})
    end

    setMBUS_IGD(modify)
    saveall(0, 1)
    cgilua.redirect("save_alert.lp", { u="urlFilter.lp" })
    return
end

local active = 0
local exclude = 0
local set_url_disp = "none"
local url = ""
local url_list = {}

local reply, error = mbus.getParameters{ path = urlFilterPath, datamodel="second"}
local ret = reply[urlFilterPath][1]

if ret ~= nil and ret.param ~= nil and ret.param["Enable"] ~= nil then
  if ret.param["Enable"] == "true" then
    active = 1
    set_url_disp = "" 
  end

  if ret.param["FilteredURLsExclude"] == "true" then
    exclude = 1
    set_url_disp = ""
  end

  url = ret.param["FilteredURLs"]
  if url ~= "" then
    for s in string.gmatch(url, "([%w%.*]+)") do
      table.insert(url_list, s)
    end
  end
end

local function get_active_checked()
  local checkInfo=" "
  if active==1 then
    checkInfo = "checked='checked'"
  end
  return checkInfo
end

local function get_off_checked()
  local checkInfo=" "
  if active==0 then
    checkInfo = "checked='checked'"
  end
  return checkInfo
end

local function get_exclude_checked()
  local checkInfo=" "
  if exclude==1 then
    checkInfo = "checked='checked'"
  end
  return checkInfo
end

local function get_exclude_off_checked()
  local checkInfo=" "
  if exclude==0 then
    checkInfo = "checked='checked'"
  end
  return checkInfo
end

local pppStatuspath = "Device.PPP.Interface.ppp_0"
local pppStatusreply, error = mbus.getParameters{ path = pppStatuspath, param = {"Status"}, flags = "KEYPATH", datamodel = "second" }
local pppStatus = pppStatusreply[pppStatuspath][1].param["Status"]

local NATStatus = ""
local NATPath = "Device.NAT.InterfaceSetting.ppp_0"
local reply, error = mbus.getParameters{ path = NATPath, param = {"Enable"}, flags = "KEYPATH", datamodel = "second" }
if error==nil then
  NATStatus = reply[NATPath][1].param["Enable"]
end

local wrongUrl = translate([==[Warning: there are one or more URLs correct. Use only the allowed characters (az, AZ, 0-9, *)]==])
local listFull = translate([==[Warning: the list is full. Remove items before proceeding]==])
%>

<script language="javascript" type="text/javascript">
//<![CDATA[
function showErrorMsg(errorMsgStr)
{
    document.getElementById("set_url_table").style.display="none";
    document.getElementById("resultKO").style.display="block";
    document.getElementById("errorMsg").innerHTML=errorMsgStr;
}

function save_url()
{
    var excludeVal = document.getElementById('filterExclude').value;
    var oldFilterExclude = document.getElementById('R_active').checked;

    if(oldFilterExclude==true)
    {
        if (excludeVal=="1")
        {
            document.getElementById('save').value="1";
            document.getElementById("set_url_table").style.display="none";
            document.getElementById("excludeWarn").style.display = "none";
            document.getElementById("confirm").style.display = "block";
        }
        else
        {
            document.getElementById('save').value="1";
            document.getElementById("set_url_table").style.display="none";
            document.getElementById("excludeWarn").style.display = "block";
        }
    }
    else
    {
        document.getElementById('save').value="1";
        document.getElementById("set_url_table").style.display="none";
        document.getElementById("excludeWarn").style.display = "none";
        document.getElementById("confirm").style.display = "block";
    }
}

function submit_url()
{
    document.getElementById("excludeWarn").style.display = "none";
    document.getElementById("set_url_table").style.display="none";
    document.getElementById("confirm").style.display = "block";
}
function change_url()
{
<% if url == "" then %>
  if(document.getElementById('clearurl').value == "1")
  {
    document.getElementById('clearurl').value = "0";
    return false;
  }
<% end %>

  if(document.getElementById('remove').value == "1")
  {
    document.getElementById('remove').value = "0";
<% if url == "" then %>
    return false;
<% else %>
    var str = "";

    <% for n=1, #url_list do %>
      if((document.getElementById("url_check<%=n%>").checked))
      {
        str = str + (document.getElementById("url_check<%=n%>").value) + ",";
      }
    <%end%>
	
    if(str == "")
    {
      return false;
    }
    // remove the last redundant ','
    str = str.substring(0, str.length-1);
    document.getElementById('remove').value = "1";
    document.getElementById('removeurl').value = str;
<% end %>
  }
  else if(document.getElementById('add').value == "1")
  {
    document.getElementById('add').value = "0";
    var addurlstr = document.getElementById('addurl').value;
    if(addurlstr == "")
    {
      return false;
    }
      
    var urlstr = "<%=url%>";
    var urlarray = urlstr.split(",");
    var addurlarray = addurlstr.split(",");
	    
    if((addurlarray.length > 128) || ((urlarray.length + addurlarray.length) > 128))
    {
      showErrorMsg('<%=listFull%>');
      return false;
    }
  
    if((addurlstr.length > 1280) || ((urlstr.length + addurlstr.length) > 1280))
    {
      showErrorMsg('<%=listFull%>');
      return false;
    }
	
	for(var i=0;i<addurlarray.length;i++)
	{
		if (addurlarray[i].length > 81)
		{
			showErrorMsg('<%=listFull%>');
			return false;
		}
		for(var j=0;j<urlarray.length;j++)
		{
			if (addurlarray[i] == urlarray[j])
			{
			  showErrorMsg('<%=wrongUrl%>');
			  return false;
			}
		}
		for(var k=0;k<addurlarray.length;k++)
		{
			if ((addurlarray[k] == addurlarray[i]) && (i != k))
			{
			  showErrorMsg('<%=wrongUrl%>');
			  return false;
			}
		}
	}
	 if(!urlExam(addurlstr))
    {
      showErrorMsg('<%=wrongUrl%>');
      return false;
    }
	
    document.getElementById('add').value = "1";
  }
  
  document.getElementById("set_url_table").style.display = "none";
  document.getElementById("confirm").style.display = "block";
}

function submitConfirm()
{
  document.getElementById("wifi_submit").removeAttribute("href");
  document.getElementById("wifi_submit").onclick = null;
  document.getElementById("wifi_submit_con").className = "next_wifidisable";
  document.getElementById("change_url_form").submit();
}

function cancelConfirm()
{
  document.getElementById("set_url_table").style.display = "";
  document.getElementById("confirm").style.display = "none";
  document.getElementById("resultKO").style.display = "none";
  document.getElementById("add").value = "0";
  document.getElementById("remove").value = "0";
  document.getElementById("clearurl").value = "0";
  document.getElementById("removeurl").value = "";
}

function urlExam(str)
{
    var filter=/^\s*[.,A-Za-z0-9*]{0,10240}\s*$/;
    if ((str.indexOf(' ') != -1) || (!str.match(filter)))
    {
        return false;
    }
    return true;
}
	

//]]>
</script>

<body>
<div class="contentContainer">
	<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li>
				<li><a href="urlFilter.lp"><%=translate([==[URL Filtering]==])%></a></li> 
			</ul>
	</div>	
	<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a class="current" href="urlFilter.lp">
				<div class="tab">
				<span class="tabIcon_urlfil"></span>
				<span class="contTabTxt transform"><%=translate([==[URL Filtering]==])%></span>
				</div><div class="clrBth"></div></a>
				</li>
			</ol>
	
	</div>
<div>
<%if pppStatus ~= "Up" or NATStatus ~= "true" then%>
    <p class='midarea2 fontSize' style="width:795px;"><%=translate([==[Warning: the automatic connection modem is disconnected or the NAT is disabled. The barring service URL is not active]==])%></p>
</div>
<%else%>
<div class="contentcontainer" id="set_url_table">
<hr>
<form method="POST" id="change_url_form" action="">
<input type="hidden" name="save" id="save" value="0" />
<input type="hidden" name="add" id="add" value="0" />
<input type="hidden" name="remove" id="remove" value="0" />
<input type="hidden" name="clearurl" id="clearurl" value="0" />
<input type="hidden" name="removeurl" id="removeurl" value="" />
<input type="hidden" name="filterExclude" id="filterExclude" value="<%=active%>" />

<div class='contentitem' style="padding-top:30px">
 <table cellspacing='0' cellpadding='0' ><tr><td width="40">&nbsp;</td><td>
             <table class="fontSize width750" width='100%' cellspacing='0' cellpadding='0'>
				
				<tr>
					<td class="midarea4_newtelmain2" width="20%"><%=translate([==[Status]==])%>:</td>
					<td class="midarea4_newtelmain2" width="80%">
						<input type="radio" value="1" id="R_active" name="enable" <%=get_active_checked()%> >&nbsp;<%=translate([==[Enabled]==])%>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<input type="radio" value="0" id="R_off" name="enable" <%=get_off_checked()%> >&nbsp;<%=translate([==[Disabled]==])%>
					</td>
				</tr>
				<tr height="10">
					<td colspan="2"></td>
				</tr>
				<tr>
					<td class="midarea4_newtelmain2" width="20%"><%=translate([==[Reverse block]==])%>:</td>
					<td class="midarea4_newtelmain2" width="80%">
						<input type="radio" value="1" id="R_ExcludeActive" name="exclude" <%=get_exclude_checked()%> >&nbsp;<%=translate([==[Enable]==])%>&nbsp;&nbsp;&nbsp;&nbsp;<%=translate([==[Block all URLs except those specified in continuing]==])%>.
					</td>
				</tr>
				<tr>
					<td class="midarea4_newtelmain2" width="20%"></td>
					<td class="midarea4_newtelmain2" width="80%">
						<input type="radio" value="0" id="R_ExcludeOff" name="exclude" <%=get_exclude_off_checked()%> >&nbsp;<%=translate([==[Disable]==])%>&nbsp;&nbsp;&nbsp;&nbsp;<%=translate([==[Allow all URLs except those specified in continuing]==])%>.
					</td>
				</tr>
				<tr height="10">
					<td colspan="2"></td>
				</tr>
				<tr>
					<td colspan="2" style="padding-left:150px;">
					<div class="fleft">
						<a onclick='javascript: save_url();'>
							<div style="vertical-align:middle;color:black;" class='midarea6-1 mainButton'><%=translate([==[Save]==])%></div>
						</a>
					</div>
					<div class="fleft" style="padding-left:10px;">
						<a onclick='javascript: document.location.href="advance.lp";'>
							<div style="vertical-align:middle;color:black;" class='midarea6-1 mainButton '><%=translate([==[Cancel]==])%></div>
						</a>
					</div>
					</td>
				</tr>
            <tr height="10">
					<td colspan="2"></td>
				</tr>
				<tr>
					<td colspan="2">
						<div class="fleft">
					
						<div class="fleft midarea4_newtelmain2" ><%=translate([==[Blocked URL]==])%>:
						</div>
						
						
						<% if url ~= "" then %>
						<div class="blockUrl" style="margin-left:14%">
								
							<table class="edittable fontSize" cellspacing="0" cellpadding="0">
							<thead>
								<th class="tableHd" width="250"><%=translate([==[URL]==])%></th>
								<th class="tableHd" width="50"><%=translate([==[Remove]==])%></th>
							</thead>
							<%local rowStyle = "oddrow"
							for n=1, #url_list do 								
								if n%2 == 1 then
									rowStyle = "oddrow"
								else
									rowStyle = "evenrow"
								end%>
							<tr><td class='<%=rowStyle%>' colspan='2'></td></tr>
							<tr><td colspan='2'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''></td></tr>
							<tr class="<%=rowStyle%>">
								<td name="url_list<%=n%>" id="url_list<%=n%>" class="inputClass"><%=url_list[n]%></td>
								<td class=""><input type="checkbox" size="8" value="<%=url_list[n]%>" name="url_check<%=n%>" id="url_check<%=n%>" style="margin-left:20%"/></td>
							</tr>
							<% end %>
							</table>

						</div><% end %>
					</div></td>
					</tr>
			</table></td></tr></table>
			
			<table cellspacing='0' cellpadding='0' id="urlButton" >
			<tr height="10">
					<td colspan="2"></td>
				</tr>
			<tr class="fontSize padleft40" >				
					<td style="padding-left:191px;">
						<a onclick="javascript: document.getElementById('remove').value='1'; change_url();">
							<div style="vertical-align:middle;color:black;width:152px" class='midarea6-1 mainButton'><%=translate([==[Remove Selected URL]==])%></div>
						</a>
					</td>
					
					<td style="padding-left:10px;">
						<a onclick="javascript: document.getElementById('clearurl').value='1'; change_url();">
							<div style="vertical-align:middle;color:black;width:110px;" class='midarea6-1 mainButton'><%=translate([==[Remove all]==])%></div>
						</a>
					</td>
				</tr></table>
            
				 <table cellspacing='0' cellpadding='0' ><tr><td width="40">&nbsp;</td><td>
			
    <table class="tableTitle" cellspacing='0' cellpadding='0' width='100%'>
			<tr>
            <td class="midarea2_telmain"><%=translate([==[Add URL]==])%></td>
			</tr>
	</table>
    <table class="fontSize width750" width='100%' cellspacing='0' cellpadding='0' style="line-height:150%;">
        <tr>
			<td width="540"><textarea cols="72" rows="4" class="content" id="addurl" name="addurl" value="" class="inputClass"></textarea></td>
		</tr>
        <tr>
			<td class="midarea4_newtelmain2" style="margin-bottom:15px"><%=translate([==[Enter the URL to add, separated by a comma. Use only alphanumeric characters (a-z, A-Z, 0-9) or character *]==])%></td>
		</tr>
        <tr>
            <td>
				<a onclick="javascript: document.getElementById('add').value='1'; change_url();">
					<div class='midarea6-1 mainButton'><%=translate([==[Add]==])%></div>
				</a>
			</td>
		</tr>
    </table>
            </td>
		</tr>
	</table>
  
</div>
</form>
</div>
<% if url ~= "" then %>
<script language="javascript" type="text/javascript">
//<![CDATA[
var objURLList = document.getElementById("url_list");
if(objURLList.size < 6)
{
  objURLList.size = "6";
  document.getElementById("url_list_div").style.overflowY = "hidden";
}
if(objURLList.offsetWidth < 450)
{
  objURLList.style.width = "450px";
  objURLList.size = "6";
  document.getElementById("url_list_div").style.overflow = "hidden";
}
//]]>
</script>
<% end %>

<script src="js/antiCSRF.js"></script>
<div id="confirm" style="display:none">
<%cgilua.lp.include("webparts/confirmBack.lp")%>
</div>
<div id="excludeWarn" style="display:none">
<%cgilua.lp.include("webparts/resultKO_urlExclude.lp")%>
</div>
<div id="resultKO" style="display:none">
<%cgilua.lp.include("webparts/resultKO_URL.lp")%>
</div>
<%end%>
</div>
</body>

</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Modem Telecom Italia</title>
<link href="css/master1.css" rel="stylesheet" type="text/css" />
<link href="css/layout.css" rel="stylesheet" type="text/css" />
<link href="css/cpe.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="css/table.css" type="text/css">

</head>
<body>
<div id="container">
<div id="header" class="heightImg">
	<form id="logoutRemote" name="logoutRemote" action="/logoutRemote.lp" target="_self">
		<table cellspacing='0' cellpadding='0' width="100%" style="text-align:center">
			<tr><td colspan="3">&nbsp;</td></tr>
		</table>
	</form>
	<div style="margin-top:33px;">
	<hr>
	</div>
	<div style="float:left;width:100%;"><div style="float:left;margin-left:15%;font-size:15px" >GESTIONE MODEM</div>
	<div id="releasemodem" style=" color:#808080;font-size:11px;margin-left:74%"></div></div>		
</div>
<div style="margin-bottom:-5px;">
	<hr>
</div>
<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0"  leftmargin="0" topmargin="0">
	<tr>
	
	<td bgcolor='#e9eef2' width="170" height="720">
		<div id="bottom" style="height: 805px !important;"><table><tr></tr>
		<tr></tr></table></div><div style="height:10px"></div>
                      
    </td>
	
	<div id="content">
            
	<td height="811" width="835">
                   <iframe id="body" name="body" frameborder=0 width=100% height=100% scrolling="no" src="urlfilter_warning.lp"></iframe>
    </td>
			  
	<td height="500" class="rightContainer"></td>
			  
	</div>
			 
	<!-- 
		<td width="150" height="500"></td>
		<td height="500" width="835">
			<iframe name="body" frameborder=0 width=100% height=100% scrolling="auto" src="noconnect.lp"></iframe>
		</td>
		<td height="500" class="rightContainer"></td> -->
	</tr>
</table>
<div class="clrBth"></div>
  <div id="footer"> 
    <div class="footer_copyrights"> 
      <div>&copy; 2013 Telecom Italia&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; 
        | &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Partita IVA : <span id="partialValue"></span></div>
    </div>
  </div>
</div>
<script type="text/javascript">
var partialValue ="00488410010"
document.getElementById("partialValue").innerHTML=partialValue;
</script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
<head>
<% cgilua.lp.include("lp/device.lp") %>
<base target="mainFrame">
<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Language" content="it">
<link href="css/master.css" rel="stylesheet" type="text/css" />


</head>
<script language="javascript" type="text/javascript">
	parent.document.getElementById("releasemodem").innerHTML = "Release Modem: <%=getVersion()%>";
</script>
<%
local translate = translate

local msg=translate([==[Warning: the requested URL is blocked. To access, change the configuration of the barring service URLs. Press the "Next" button to access the Management of modems.]==])

%>
<body>

<div class='contentcontainer'>

<div class='contentitem'>
<table cellspacing='0' cellpadding='0' width="100%" class="width750 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Operation failed]==])%>.</td></tr>
                             <tr><td class="errorDesc"><p><%=msg%></p><br/>
							</td></tr></table>
							</td></tr>
							<tr><td>
							<table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
							<tr><td class="width340">&nbsp;</td>
							<td class="verticalAlign">
							<a onclick='javascript:top.location.href="/";'>
							<div class="midarea6-1 mainButton" name="thb11"><%=translate([==[Next]==])%></div>
							</a>
						

            </td></tr>
        </table>
    </td>
</tr>
</table>
</div>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Modem Telecom Italia</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/master.css" type="text/css" />
<script language="javascript" type="text/javascript" src="js/browserDetect.js"></script>

<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/usb.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<%


local translate = translate
local POST = cgilua.POST
local print = cgilua.print

local usbConfig_page="block"
local resultko_unmount_page = "none"
if cgilua.QUERY["busy"]=="1" then
    usbConfig_page="none"
    resultko_unmount_page = "block"
end

local isRemote = isRemoteAccess()

local printer_info, usbdisk_info
local cs_state, cs_name = get_cs_state()
local ps_state = get_ps_state()

if cs_state == "true" then
	usbdisk_info = get_usbdisk_info(cs_name) 
end

if ps_state == "true" then
	printer_info = get_printer_info()
end

if cgilua.servervariable"REQUEST_METHOD" == "POST" then
    	local contentSharingState = POST["contentsharing"]
		local printSharingState = POST["printersharing"]	
		local save = 0

    	if POST["usbMgmFlag"]=="1" and (cs_state ~= contentSharingState or ps_state ~= printSharingState) then			

		-- enable/disable print sharing
		if ps_state ~= printSharingState then
			local ps_modify={}	
			table.insert(ps_modify, {path = "PrinterSharing.LPD", param = {Enable = printSharingState}})
			table.insert(ps_modify, {path = "ENV", param = {Value = printSharingState}, filter = "(== Name %PS_GUI_STATE)"})
			setMBUS(ps_modify)
			save = 1
		end

		-- enable/disable content sharing
		if cs_state ~= contentSharingState then
			local modify = {}
			table.insert(modify, {path="ContentSharing.CIFS", param= {Enable=contentSharingState}})
			setMBUS(modify)
			save = 1
		end
		
		if save == 1 then
			saveall(0, 1)
		end

		if cs_state ~= contentSharingState then
			--enable the content sharing, it should remount the usb.
			if contentSharingState == "true" then
				--remount usb 
				remount_usbdisk()
			end
		end

		cgilua.redirect("save_alert.lp", { u = "usbConfig.lp" })
		return		
	end

	-- umount usb disk
	if POST["removeMgmFlag"]=="1" then
		local modify = {}
		local umount_dev =  POST["RemoveDisk"]
		local isUsbDiskBusy, usdDiskPath = is_usbdisk_busy(umount_dev)

		-- Fix for TESSA 450 - Warning message: 53 is never show and the USB disk activities are breaked
	        -- if read/write operation is going on USB via GUI, flag isUsbDiskBusyGUI will be set
		-- Adding write operation i.e., uploading, to show warning message 53 as per spec	
		
		local isUsbDiskBusyGUI, usbMode = is_usbdisk_busy_GUI(umount_dev)

		-- umount usb disk
		if POST["ForceRemoveDisk"] == "1" and umount_dev ~= nil then       
			while isUsbDiskBusy do
 	                       if(isUsbDiskBusy == false) then
		                       break
		               end
			       isUsbDiskBusy, usdDiskPath = is_usbdisk_busy(umount_dev)
			       --isUsbDiskBusyGUI = is_usbdisk_busy_GUI(umount_dev)
			end 
			if isUsbDiskBusyGUI then
			      	stop_USB_activity_GUI(umount_dev)
			end
			table.insert(modify, {path=usdDiskPath, param = {DoUnMount="true"}})
			setMBUS(modify)
        
		else
			--If the usb is active, it should show the warning page.
			if isUsbDiskBusy or isUsbDiskBusyGUI then
				local to_page = "usbConfig.lp?busy=1&devname="..tostring(POST["RemoveDisk"])
				cgilua.redirect(to_page)
				return
			end

			table.insert(modify, {path=usdDiskPath, param = {DoUnMount="true"}})
			setMBUS(modify)
        
		end
		sleep(3)
		--Fix for Tessa 216
		--saveall(0,1)
		cgilua.redirect("usbConfig.lp")
		return
	end 
end
local connectUSBlist = getUSBNameList()
local usbLstStrng = ""
if connectUSBlist ~= nil then
	for i=1,#connectUSBlist do
		if connectUSBlist[i].name ~= nil then
			usbLstStrng = usbLstStrng.."|"..connectUSBlist[i].name
		end
	end
end
%>
<script language="javascript" src="js/script.js"></script>
<script language="javascript"> 
var isunMountTrigged = false;
function umount_submit(devname)
{
	isunMountTrigged = true;
	document.getElementById("remove").removeAttribute("href");
    document.getElementById("remove").onclick = null;
    document.getElementById("remove").className = "aClicked";
	document.getElementById("removeMgmFlag").value = "1";
	document.getElementById("RemoveDisk").value = devname;
	document.usbForm.submit();
}

function confirm_submit()
{
        document.getElementById("usbMgmFlag").value = "1";
        document.usbForm.submit();
}

function confirm_unmount_submit()
{
	document.getElementById("removeMgmFlag").value = "1";
	document.getElementById("ForceRemoveDisk").value = "1";
	document.usbForm.submit();
}

function save_submit()
{
	document.getElementById("save").removeAttribute("href");
	document.getElementById("save").onclick = null;
	document.getElementById("save").className = "aClicked";
	var cs_off=document.getElementById("cs2").checked;
	var ps_off=document.getElementById("ps2").checked;
	var gw_cs_state="<%=cs_state%>";
	var gw_ps_state="<%=ps_state%>";

	if(gw_cs_state=="true" && cs_off==true)
	{
		document.getElementById("confirmConfig").style.display="block";
		document.getElementById("usbConfig").style.display="none";
	}else{
		document.getElementById("usbMgmFlag").value = "1";
		document.usbForm.submit();
	}
}

function cancelForm()
{
	window.location = "usbConfig.lp";
}

//body onload
function linkToUsb()
{	
	
		var id = "";
	if(window.parent.menu.document.getElementById("home")!=null && 
		window.parent.menu.document.getElementById("home") != "undefinded") {
		window.parent.menu.document.getElementById("home").style.display="block";
		window.parent.menu.document.getElementById("home").className="";
	}
	if(window.parent.menu.document.getElementById("base")!=null && 
		window.parent.menu.document.getElementById("base") != "undefinded") {
		window.parent.menu.document.getElementById("base").className="block";
	}
	if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="";
	}
	if(window.parent.menu.document.getElementById("teleSub")!=null && 
		window.parent.menu.document.getElementById("teleSub") != "undefinded") {
		window.parent.menu.document.getElementById("teleSub").style.display="none";
	}
	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="submenuselect1";
	}
	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}
	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
		if(window.parent.menu.document.getElementById("ipv6list")) {
			window.parent.menu.document.getElementById("ipv6firewall").className="";
			window.parent.menu.document.getElementById("ipv6list").style.display="none";
		}
	}
	
	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {	
		window.parent.menu.document.getElementById("port").className="";
	}
	
	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {		
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="";
	}
	
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {	
		window.parent.menu.document.getElementById("urlfi").className="";
	}
	/*if(window.parent.menu.document.getElementById("reac")!=null && 
		window.parent.menu.document.getElementById("reac") != "undefinded") {	
		window.parent.menu.document.getElementById("reac").className="";
	}*/
	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {	
		window.parent.menu.document.getElementById("waon").className="";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {	
		window.parent.menu.document.getElementById("stru").className="";
	}
	if(window.parent.menu.document.getElementById("advance")!=null && 
		window.parent.menu.document.getElementById("advance") != "undefinded") {	
		window.parent.menu.document.getElementById("advance").className="Icons";
	}
	if(window.parent.menu.document.getElementById("d3")!=null && 
		window.parent.menu.document.getElementById("d3") != "undefinded") {
		window.parent.menu.document.getElementById("d3").style.display="block";
	}
	
}
var usbliststr = "<%=usbLstStrng%>";
function usbResponse(data){
	var rsps = data.responseText;
	if(rsps.indexOf("true") > -1 && !isunMountTrigged){
		window.location = "usbConfig.lp";
	}
	setTimeout(function() {
	validateUSBEjct();},3000);	 
}
function validateUSBEjct(){
	if(usbliststr != null && usbliststr != ""){
		var urlStr = "/application_ajax.lp"
		var params="isUSB=true&usbNames="+usbliststr;		
		sajax_get(urlStr, params, usbResponse);		 	
	}
}
validateUSBEjct();


</script>

</head>
	<body onload="javascript:linkToUsb();">
	<!-- <table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
	<tr><td align="left"><a href="advance.lp">Avanzate</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="usbConfig.lp"></a></td><td align="right"><a href="usbStato.lp">Stato</a>&nbsp;&nbsp;|&nbsp;&nbsp;<em>Configura</em></td></tr>
	</table> -->
		<div class="contentContainer">
			<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp">
				<%=translate([==[Advanced Settings]==])%></a></li><li>|</li> <li><a href="usbConfig.lp"><%=translate([==[USB services]==])%></a></li> 
				</ul>
		</div>	

	<div class="contentTab" id="content">
	<ol id="tocTab">
		<li><a href="usbStato.lp" >
			<div class="tab">
			<span class="tabIcon_stusb"></span>  
			<span class="contTabTxt transform"><%=translate([==[USB services]==])%></span>
		</div><div class="clrBth"></div></a></li>
		<li><a href="usbConfig.lp" class="current margin15">
			<div class="tab">
				<span class="contTabTxt transform"><%=translate([==[Configure]==])%> <%=translate([==[USB services]==])%></span></div></a></li>
	</ol>
</div>

		<div class='contentcontainer' id="usbConfig" style="display:<%=usbConfig_page%>;">
			<hr>
		<div class='contentitem'>
		<form method="POST" name="usbForm" action="">
			<input type="hidden" id="RemoveDisk" name="RemoveDisk" value="<%=cgilua.QUERY["devname"]%>">
			<input type="hidden" id="ForceRemoveDisk" name="ForceRemoveDisk" value="0">
			<input type="hidden" id="usbMgmFlag" name="usbMgmFlag" value="0">
			<input type="hidden" id="removeMgmFlag" name="removeMgmFlag" value="0">
		<table border="0" width="100%" class="fontSize">
			<tr>
				<td>
        <table cellspacing='0' cellpadding='0' width='100%'>
			<tr>
				<td class="midarea2 tableTitle" style="font-weight:bold;"><%=translate([==[Management USB port]==])%></td>
			</tr>
			<tr>
				<td>
        <table width='100%' cellspacing='0' cellpadding='0' class="midarea4_telmain27 marleft40">
            <tr>
				<td class='wifiMidarea4-2' width='150' style="padding-left:0px;"><%=translate([==[Disk Sharing]==])%>:</td>
                <td>
                <input type="radio" value="true" id="cs1" name="contentsharing" />&nbsp;<%=translate([==[Enable]==])%>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="radio" value="false" id="cs2" name="contentsharing" />&nbsp;Disabilita</td></tr>
            <tr>
				<td class='wifiMidarea4-2' width='150' style="padding-left:0px;"><%=translate([==[Printer Sharing]==])%>:</td>
                <td>
                <input type="radio" value="true" id="ps1" name="printersharing" />&nbsp;<%=translate([==[Enable]==])%>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="radio" value="false" id="ps2" name="printersharing" />&nbsp;Disabilita</td>
			</tr>
            </table>
				</td>
			</tr>
		</table>

        <table cellspacing='0' cellpadding='0' style="text-align:center" class="">
            <tr>
				
				<td class="midarea4-2 verticalAlign" style="float:right;padding-left:120px;">
					<a onclick="save_submit()" href="#" id='save' style="float:right">
						<div class="midarea6-1 mainButton"><%=translate([==[Save]==])%></div>
					</a>
				</td>
				<td class="midarea4-3 padleft50 verticalAlign">
					<%if usbdisk_info==nil and printer_info==nil then%>
					<a href = "advance.lp">
						<div class="midarea6-1 secondaryButton"><%=translate([==[Back]==])%></div>
					</a>
					<%end%>
				</td>
			</tr>
		</table>
				</td>
			</tr>
		</table>
					<%
					if (usbdisk_info~=nil or printer_info~=nil)then 
					-- when no usb disk, not display below tables
					%>
			<tr>
				<td>
        <table cellspacing='0' cellpadding='0' width='100%' class="fontSize" style="margin-left:2px;">
			<tr >
				<!-- <td style="font-weight:bold;">
				</td> -->
				<td class="midarea2 tableTitle"><p><%=translate([==[USB devices]==])%></p></td></tr>
				<tr ><td>
			<%if usbdisk_info~=nil then%>	
        <table class='edittable width750 marleft40' width='100%' cellspacing='0' cellpadding='0' border='0'>
            <tr>
				<td colspan='6' align='center' class="midarea2 tableTitle" style="height:25px;padding-left:0px"><%=translate([==[Remote Disk]==])%></td>
			</tr>
            <tr>
				<th width="20%" class="tableHd" align='left' style="padding-left:0px;"><%=translate([==[Description]==])%></th>
				<th width="5%" class="tableHd" align='left'><%=translate([==[Standard USB]==])%></th>
				<th width="35%" class="tableHd" align='left'><%=translate([==[Device Address]==])%></th>
				<th width="20%" class="tableHd" align='left'><%=translate([==[Dimensions]==]).." "%></th>
				<th width="15%" class="tableHd" align='left'><%=translate([==[Partition Name]==])%></th>
				<th width="5%" class="tableHd" align='left'><%=translate([==[Removal]==])%></th>
			</tr>

                <%
                local part_name = {}
                local part_size = {}
                local sharing_addr = {}
                local sharing_addr_smb = {}
                local rowStyle = "oddrow_firewall"
                local rowNum = 0
                for i=1,#usbdisk_info do
                    part_name[i] = ""
                    part_size[i] = ""
                    sharing_addr[i] = ""
                    sharing_addr_smb[i] = ""
					local part_num = #usbdisk_info[i].part

                    rowNum = rowNum + 1
                    if rowNum%2==1 then
                        rowStyle = "oddrow_firewall"
                    else
                        rowStyle = "evenrow_firewall"
                    end


				%>
            <tr>
				<td width='33%' class='<%=rowStyle%>' colspan='6'></td>
			</tr>
				<%
                    for j=1,part_num do
						if j == 1 then
				%>
			<tr bgcolor="#f8f4f1">
				<td rowspan="<%=part_num%>" class="<%=rowStyle%>"><%=usbdisk_info[i].description%></td>
				<%
						end
						part_name[i]=tostring(usbdisk_info[i].part[j].friendly_name)
						part_size[i] = tostring(usbdisk_info[i].part[j].part_size)
						sharing_addr[i] = string.gsub(tostring(usbdisk_info[i].part[j].sharing_addr), "\\", "\\\\")
						sharing_addr_smb[i] = tostring(usbdisk_info[i].part[j].sharing_addr_smb)
						if usbdisk_info[i].part[j].ok == 0 then
						%>
				<td class="<%=rowStyle%>" colspan="5"><%=translate([==[Device not recognized. Try to run from a PC Safely]==])%></td>
			</tr>
						
						<%else%>
						<% if j == 1 then%>
			<td bgcolor="#f8f4f1" rowspan="<%=part_num%>" class="<%=rowStyle%>"><%=usbdisk_info[i].usbversion%></td>
						<%end%>
			<td bgcolor="#f8f4f1" class="<%=rowStyle%>">
								<script type="text/javascript">
									show_link("<%=sharing_addr[i]%>","<%=sharing_addr_smb[i]%>");
								</script>
			</td>
			<td bgcolor="#f8f4f1" class="<%=rowStyle%>"><%=part_size[i]%></td>
			<td bgcolor="#f8f4f1" class="<%=rowStyle%>"><%=part_name[i]%></td>
						<% if j == 1 then%>
			<td bgcolor="#f8f4f1" rowspan="<%=part_num%>" class="<%=rowStyle%>" width="82" style="padding-top:10px">
						<% if isRemote==false then%>
					<a href="#" id="remove" onclick="umount_submit('<%=usbdisk_info[i].devname%>')">
						<div class="midarea6-1 mainButton"><%=translate([==[Remove]==])%></div>
					</a>
						<%end%>
			</td>
						<%end%>
             	</tr>
					<%
						end
                    end
                	%>
            <tr>
				<td class="<%=rowStyle%>" colspan='6'></td>
			</tr>
				</td>
			</tr>
             <%end%>
		</table>
			 <%end%>
  


              
                <%
                if printer_info~=nil then
                %>
            <br>
            <table class='edittable width750 marleft40'  width='100%' cellspacing='0' cellpadding='0' border='0'>
                <tr>
					<td colspan='3' align='center' class="midarea2 tableTitle"><%=translate([==[USB Print Server]==])%></td>
				</tr>
                <tr>
					<td colspan='3'></td>
				</tr>
                <tr>
					<td colspan='3'></td>
				</tr>
                <tr>
					<th align='left' class="tableHd" ><%=translate([==[Description]==])%></th>
					<th align='left' class="tableHd" ><%=translate([==[Standard USB]==])%></th>
					<th align='left' class="tableHd"><%=translate([==[Device Address]==])%></th>
				</tr>
				<tr>
					<td colspan='3'> <img src='images/spacer.gif' border='0' width='1' height='5' alt=''></td>
				</tr>
				<tr>
					<td colspan='3'></td>
				</tr>
                <%
                local rowStyle = "oddrow_firewall"
                local rowNum = 0
                for i = 1, #printer_info do
                    if printer_info[i].name == "" then
                        printer_info[i].name="PRINTER"
                    end
                    rowNum = rowNum + 1
                    if rowNum%2==1 then
                        rowStyle = "oddrow_firewall"
                    else
                        rowStyle = "evenrow_firewall"
                    end
                local path_name = "\\\\" .. cs_name .."\\" .. printer_info[i].name
                %>
            <tr>
				<td width='33%' class='<%=rowStyle%>' colspan='3'></td>
			</tr>
            <tr>
                <td bgcolor="#f8f4f1" class="<%=rowStyle%>"><%=printer_info[i].description%></td>
                <td bgcolor="#f8f4f1" class="<%=rowStyle%>"><%=printer_info[i].usbversion%></td>
                <td bgcolor="#f8f4f1" class="<%=rowStyle%>"><%=path_name%></td>
			</tr>
            <tr>
				<td class="<%=rowStyle%>" colspan='3'></td>
			</tr>
			</table>  
		<%end%>
	
		<%end%>              
				
            <table cellspacing='0' cellpadding='0' width='100%' class="martop15" style="text-align:center">
					<td style="width:30%">
						</td>
						<td class="midarea3" style="vertical-align:top;width:300px;">
					<a href ="advance.lp">
						<div class="midarea6-1 secondaryButton"> <%=translate([==[Back]==])%> </div></a>
				</td>
							</tr>
			</table>
		</td>
			</tr>
	</table>
<%
end -- for usbConfig void page
%>
				
	</form>
<script src="js/antiCSRF.js" type="text/javascript"></script>
		</div>
	</div>
				<div id="confirmConfig" style="display:none">
			<%cgilua.lp.include("webparts/USBShareOff.lp")%>
		</div>
					<div id="unmount" style="display:<%=resultko_unmount_page%>">
			<%cgilua.lp.include("webparts/USBEnvRemove.lp")%>
		</div>
	</body>
</html>

<script language="javascript">
var cs_state= "<%=cs_state%>";
var ps_state= "<%=ps_state%>";
if(cs_state=="true"){
        document.getElementById("cs1").checked = true;
}else{
        document.getElementById("cs2").checked = true;
}
if(ps_state=="true"){
        document.getElementById("ps1").checked = true;
}else{
        document.getElementById("ps2").checked = true;
}
</script>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/master.css" type="text/css" />
<script language="javascript" type="text/javascript" src="js/browserDetect.js"></script>
    <script language="JavaScript" type="text/javascript">
	
	if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="";
	}
	
	if(window.parent.menu.document.getElementById("teleSub")!=null && 
		window.parent.menu.document.getElementById("teleSub") != "undefinded") {
		window.parent.menu.document.getElementById("teleSub").style.display="none";	
	}

	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="submenuselect1";
	}

	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}

	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
		if(window.parent.menu.document.getElementById("ipv6list")) {
			window.parent.menu.document.getElementById("ipv6firewall").className="";
			window.parent.menu.document.getElementById("ipv6list").style.display="none";
		}
	}

	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {
		window.parent.menu.document.getElementById("port").className="";
	}

	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="";
	}
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {
		window.parent.menu.document.getElementById("urlfi").className="";
	}

	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {
		window.parent.menu.document.getElementById("waon").className="";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {
		window.parent.menu.document.getElementById("stru").className="";
	}		
  </script>

<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/usb.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<%

--local tprint = require("tableprint")
local translate = translate
local POST = cgilua.POST

local usbState_page="block"
local resultko_unmount_page = "none"
if cgilua.QUERY["busy"]=="1" then
    usbState_page="none"
    resultko_unmount_page = "block"
end

local isRemote = isRemoteAccess()
local printer_info, usbdisk_info
local cs_state, cs_name = get_cs_state()
local ps_state = get_ps_state()

local cs_state_show = translate([==[Disabled]==])
if cs_state == "true" then
	cs_state_show = translate([==[Enabled]==]) 
	usbdisk_info = get_usbdisk_info(cs_name) 
end

local ps_state_show = translate([==[Disabled]==])
if ps_state == "true" then
	ps_state_show = translate([==[Enabled]==])
	printer_info = get_printer_info()
end

if cgilua.servervariable"REQUEST_METHOD" == "POST" then    
	local modify = {}
	local umount_dev =  POST["RemoveDisk"]
	local isUsbDiskBusy, usdDiskPath = is_usbdisk_busy(umount_dev)

	--  Fix for TESSA 450 - Warning message:53 is never show and the USB disk activities are breaked 
	-- if read/write operation is going on USB via GUI, flag isUsbDiskBusyGUI will be set
	local isUsbDiskBusyGUI = is_usbdisk_busy_GUI(umount_dev)

	-- umount usb disk
	if POST["ForceRemoveDisk"] == "1" and umount_dev ~= nil then        
	        	while isUsbDiskBusy do
	        		if(isUsbDiskBusy == false) then
		        	        break
			        end
		        	isUsbDiskBusy, usdDiskPath = is_usbdisk_busy(umount_dev)
		        end
		        if isUsbDiskBusyGUI then
		        	stop_USB_activity_GUI(umount_dev)
		        end
		table.insert(modify, {path=usdDiskPath, param = {DoUnMount="true"}})
		setMBUS(modify)
        
	else
		--If the usb is active, it should show the warning page.
		if isUsbDiskBusy or isUsbDiskBusyGUI then
			local to_page = "usbStato.lp?busy=1&devname="..tostring(POST["RemoveDisk"])
			cgilua.redirect(to_page)
			return
		end

		table.insert(modify, {path=usdDiskPath, param = {DoUnMount="true"}})
		setMBUS(modify)
        
	end
	sleep(3)
	--Fix for Tessa216
	--saveall(0,1)
	cgilua.redirect("usbStato.lp")
	return
end -- POST end
local connectUSBlist = getUSBNameList()
%>

<script language="javascript" src="js/script.js"></script>
<script language="javascript">
var isunMountTrigged=false;
function umount_submit(devname)
{
	isunMountTrigged = true;
	document.getElementById("remove").removeAttribute("href");
    document.getElementById("remove").onclick = null;
    document.getElementById("remove").className = "aClicked";
    document.getElementById("RemoveDisk").value = devname;
    document.usbForm.submit();
}

function confirm_unmount_submit()
{
    document.getElementById("ForceRemoveDisk").value = "1";
    document.usbForm.submit();
}

function cancelForm()
{
    document.getElementById("usbState").style.display="block";
    document.getElementById("resultko_unmount").style.display="none";
}

function linkToUsb()
{	
	
		var id = "";
	if(window.parent.menu.document.getElementById("home")!=null && 
		window.parent.menu.document.getElementById("home") != "undefinded") {
		window.parent.menu.document.getElementById("home").style.display="block";
		window.parent.menu.document.getElementById("home").className="";
	}
	if(window.parent.menu.document.getElementById("base")!=null && 
		window.parent.menu.document.getElementById("base") != "undefinded") {
		window.parent.menu.document.getElementById("base").className="block";
	}
	if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="";
	}
	if(window.parent.menu.document.getElementById("teleSub")!=null && 
		window.parent.menu.document.getElementById("teleSub") != "undefinded") {
		window.parent.menu.document.getElementById("teleSub").style.display="none";
	}
	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="submenuselect1";
	}
	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}
	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
	}
	
	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {	
		window.parent.menu.document.getElementById("port").className="";
	}
	
	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {		
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="";
	}
	
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {	
		window.parent.menu.document.getElementById("urlfi").className="";
	}
	/*if(window.parent.menu.document.getElementById("reac")!=null && 
		window.parent.menu.document.getElementById("reac") != "undefinded") {	
		window.parent.menu.document.getElementById("reac").className="";
	}*/
	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {	
		window.parent.menu.document.getElementById("waon").className="";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {	
		window.parent.menu.document.getElementById("stru").className="";
	}
	if(window.parent.menu.document.getElementById("advance")!=null && 
		window.parent.menu.document.getElementById("advance") != "undefinded") {	
		window.parent.menu.document.getElementById("advance").className="Icons";
	}
	if(window.parent.menu.document.getElementById("d3")!=null && 
		window.parent.menu.document.getElementById("d3") != "undefinded") {
		window.parent.menu.document.getElementById("d3").style.display="block";
	}
	
}

<%
local usbLstStrng = ""
if connectUSBlist ~= nil then
	for i=1,#connectUSBlist do
		if connectUSBlist[i].name ~= nil then
			usbLstStrng = usbLstStrng.."|"..connectUSBlist[i].name
		end
	end
end
%>
var usbliststr = "<%=usbLstStrng%>";
function usbResponse(data){
	var rsps = data.responseText;
	if(rsps.indexOf("true") > -1 && !isunMountTrigged){		 
		window.location = "usbStato.lp";
	}
	setTimeout(function() {
	validateUSBEjct();},3000);	 
}
function validateUSBEjct(){
	if(usbliststr != null && usbliststr != ""){
		var urlStr = "/application_ajax.lp"
		var params="isUSB=true&usbNames="+usbliststr;		
		sajax_get(urlStr, params, usbResponse);		 	
	}
}
validateUSBEjct();
</script>
<body onload="javascript:linkToUsb();">
<div class="contentContainer">
	<div class="breadCrumbContainer">
		<ul class="brdCrumb">
			<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li> <li><a href="usbStato.lp"><%=translate([==[USB services]==])%></a></li> 
		</ul>
	</div>
		
	<div class="contentTab" id="content">
		<ol id="tocTab">
			<li><a href="usbStato.lp" class="current">
		<div class="tab">
			<span class="tabIcon_stusb"></span>  
			<span class="contTabTxt transform"><%=translate([==[USB services]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
		<% if isRemote==false then%> 
			<li><a class="margin15" href="usbConfig.lp">
		<div class="tab">
			<span class="contTabTxt transform"><%=translate([==[Configure]==])%> <%=translate([==[USB services]==])%></span></div></a></li>
		<% end %> 
		</ol>
	</div>
	
	<div class='contentcontainer' id="usbState" style="display:<%=usbState_page%>;">
		<hr>
		<div class='contentitem'>
		<form method="POST" name="usbForm" action="">
		<input type="hidden" id="RemoveDisk" name="RemoveDisk" value="<%=cgilua.QUERY["devname"]%>" />
		<input type="hidden" id="ForceRemoveDisk" name="ForceRemoveDisk" value="0" />
		<table border="0" width="100%" class="fontSize">
			<tr><td>
			<table cellspacing='0' cellpadding='0' width='100%'>
				<tr>
					<td class='midarea2 tableTitle'><%=translate([==[Management USB port]==])%></td>
				</tr>
				<tr>
				<td>
				<table width='100%' cellspacing='0' cellpadding='0' class="midarea4_telmain27 marleft40">
					<tr>
						<td width='300' style="padding:10px 0 0 0;"><%=translate([==[Disk Sharing]==])%>:</td>
						<td><span><%=cs_state_show%></span></td>
					</tr>
					<tr>
						<td width='300' style="padding:10px 0 0 0 ;"><%=translate([==[Printer Sharing]==])%>:</td>
						<td><span><%=ps_state_show%></span></td>
					</tr>
				</table>
				</td>
				</tr> 
			</table>

			</td>
			</tr>
		</table>
 		<%
		if usbdisk_info~=nil or printer_info~=nil then 
		-- when no usb disk, not display below tables
		%>			
			<table cellspacing='0' cellpadding='0' width='100%' class="fontSize" style="margin-left:2px;">
			<tr><td class="midarea2 tableTitle padtop10"><%=translate([==[USB devices]==])%></td></tr>
			<tr><td>
				<%if usbdisk_info~=nil then%>
				<table class='edittable width750 marleft40' width='100%' cellspacing='0' cellpadding='0' border='0'>
					<tr>
						<td colspan='6' align='center' class="midarea2 tableTitle" style="height:25px;padding-left:0px"><%=translate([==[Remote Disk]==])%></td>
					</tr>
					
					<tr>
						<th width="20%" class="tableHd" align='left' style="padding-left:0px;"><%=translate([==[Description]==])%></th>
						<th width="5%" class="tableHd" align='left'><%=translate([==[Standard USB]==])%></th>
						<th width="35%" class="tableHd" align='left'><%=translate([==[Device Address]==])%></th>
						<th width="20%" class="tableHd" align='left'><%=translate([==[Dimensions]==]).." "%></th>
						<th width="15%" class="tableHd" align='left'><%=translate([==[Partition Name]==])%></th>
						<th width="5%" class="tableHd" align='left'><%=translate([==[Removal]==])%></th>
					</tr>

					<%
					local device_part_name = {}
					local part_name = {}
					local part_size = {}
					local sharing_addr = {}
					local sharing_addr_smb = {}
					local remote_addr
					local rowStyle = "oddrow_firewall"
					local rowNum = 0

					for i=1,#usbdisk_info do
						part_name[i] = ""
						part_size[i] = ""
						sharing_addr[i] = ""
						sharing_addr_smb[i] = ""
						local part_num = #usbdisk_info[i].part

						rowNum = rowNum + 1
						if rowNum%2==1 then
							rowStyle = "oddrow_firewall"
						else
							rowStyle = "evenrow_firewall"
						end
					%>

					<%
						for j=1,part_num do
						if j == 1 then
					%>
					<tr>
					<td rowspan="<%=part_num%>" class="<%=rowStyle%> padcell"><%=usbdisk_info[i].description%></td>
					<%
						end
							device_part_name[i]=tostring(usbdisk_info[i].part[j].device_name)
							part_name[i]=tostring(usbdisk_info[i].part[j].friendly_name)
							part_size[i] = tostring(usbdisk_info[i].part[j].part_size)
							sharing_addr[i] = string.gsub(tostring(usbdisk_info[i].part[j].sharing_addr), "\\", "\\\\")
							sharing_addr_smb[i] = tostring(usbdisk_info[i].part[j].sharing_addr_smb)
							remote_addr = "/var/usbmount/" .. tostring(device_part_name[i])
							if usbdisk_info[i].part[j].ok == 0 then
							%>
					<td class="<%=rowStyle%> padcell" colspan="5"><%=translate([==[Device not recognized. Try to run from a PC Safely]==])%></td>
					</tr>
					<%
					else
					%>
					<% if j == 1 then%>
					<td rowspan="<%=part_num%>" class="<%=rowStyle%> padcell"><%=usbdisk_info[i].usbversion%></td>
						<%end%>
					<td class="<%=rowStyle%> padcell">
							<script type="text/javascript">
									show_link("<%=sharing_addr[i]%>","<%=sharing_addr_smb[i]%>");
							</script>
					</td>
					<td class="<%=rowStyle%> padcell"><%=part_size[i]%></td>
					<td class="<%=rowStyle%> padcell">
						<%if isRemote then%>
						<a href="javascript:window.location.href='remoteAccessUsb.lp?filePath=<%=remote_addr%>';"/><%=part_name[i]%></a>
						<%else%>
						<a href="javascript:window.location.href='remoteAccessUsb.lp?filePath=<%=remote_addr%>';"/><%=part_name[i]%></a>
						<%end%>
					</td>
					<% if j == 1 then%>
					<td rowspan="<%=part_num%>" class="<%=rowStyle%> padcell" width="82" class="alignMid">
					<% if isRemote==false then%>
					<a href="#" onclick="umount_submit('<%=usbdisk_info[i].devname%>')"  id="remove" class="alignMid">
					<div class="midarea6-1 mainButton"><%=translate([==[Remove]==])%></div>
					</a>
					<%end%>
					</td>
					<%end%>
					</tr>
					<%
					end
					end
					%>

						
							</td>
							</tr>
							<%end%>
						</table>
					<%end%>
                
					<%
					if printer_info~=nil then
					%>
					<br>
						<table class='edittable width750 marleft40' width='100%' cellspacing='0' cellpadding='0' border='0'>
						<tr>
							<td colspan='3' align='center' class="midarea2 tableTitle"><%=translate([==[USB Print Server]==])%></td>
						</tr>
						
                		<tr>
							<th align='left' class="tableHd"><%=translate([==[Description]==])%></th>
							<th align='left' class="tableHd"><%=translate([==[Standard USB]==])%></th>
							<th align='left' class="tableHd"><%=translate([==[Device Address]==])%></th>
						</tr>
						<tr>
							<td colspan="3"> <img width="1" height="5" border="0" alt="" src="images/spacer.gif"></td>
						</tr>
						<%
						local rowStyle = "oddrow_firewall"
						local rowNum = 0
						for i = 1, #printer_info do
							if printer_info[i].name == "" then
								printer_info[i].name="PRINTER"
							end
							rowNum = rowNum + 1
							if rowNum%2==1 then
								rowStyle = "oddrow_firewall"
							else
								rowStyle = "evenrow_firewall"
							end
						local path_name = "\\\\" .. cs_name .."\\" .. printer_info[i].name
						%>
						<tr>
							<td width='33%' class='<%=rowStyle%>' colspan='3'></td>
						</tr>
						<tr>
							<td class="<%=rowStyle%>"><%=printer_info[i].description%></td>
							<td class="<%=rowStyle%>"><%=printer_info[i].usbversion%></td>
							<td class="<%=rowStyle%>"><%=path_name%></td>
						</tr>
						<tr>
							<td class="<%=rowStyle%>" colspan='3'></td>
						</tr>
					</table>
				<%end%>
		<%end%> 

			
		</td>
		</tr>
	</table>
	


						       <%
end -- for usbConfig void page
%>
			

		
	</form>
				<script src="js/antiCSRF.js" type="text/javascript"></script>
		</div>
	</div>
		<div id="resultko_unmount" style="display: <%=resultko_unmount_page%>;">
<%cgilua.lp.include("webparts/USBEnvRemove.lp")%>	
		</div>
	</body>
	</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" href="css/master.css" type="text/css"/>
<script language="javascript" type="text/javascript" src="js/script.js"></script>
<script language="javascript" type="text/javascript" src="js/portmap.js"></script>
<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<% cgilua.lp.include("lp/form.lp") %>
<% cgilua.lp.include("lp/ppp.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<% cgilua.lp.include("lp/portmap.lp") %>
<% cgilua.lp.include("lp/style.lp") %>
<% cgilua.lp.include("lp/voip.lp") %>

<%
local isRemote = isRemoteAccess()
local translate = translate
local POST=cgilua.POST
local QUERY=cgilua.QUERY
local pathId = QUERY["pathId"]
local get_assoNum = QUERY["assoNum"]
local assoNum = string.gsub(get_assoNum," ", "+")

if pathId==nil or pathId=="" then
    cgilua.redirect("voipStato.lp")
    return
end
local tprint = require("tableprint")

local switchPath1 = "Device.Services.VoiceService.3.VoiceProfile"
local linePath = "Device.Services.VoiceService.2.VoiceProfile.1.Line"

local linePath1 = "Device.Services.VoiceService.2.VoiceProfile"

local sipUri,dirNum = getFXSDECTSIP("Device.Services.VoiceService.1.VoiceProfile.1.Line")

local totalRowcount = 0
local count = 10
if(tonumber(pathId) == 1)then
	count = 1
else
	count = count + tonumber(pathId)
end
tprint("Path id added with count......")
tprint(count)
--check the checkbox is checked or not
function isCheckedService(flag)
    local isChecked = 'checked="checked"'
    if flag~="true" then
        isChecked = ""
    end    
    return isChecked
end

local rowIds = ""
--get count of phone number.
function countOfLineObj()    	
    local reply1, error1 = mbus.getParameters{ path = linePath1, datamodel = "second" }
    if reply1[linePath1]~=nil and reply1[linePath1][1]~=nil then
	local tmpPrty
        for h,f in pairs(reply1[linePath1]) do	
		local tempPath = f.path..".Line"
		local checkId = "numForUAMap"..h
		local checkVPId = "numForVPMap"..h
		local priorityId = "numPriority"..h  

		local reply, error = mbus.getParameters{ path = tempPath, param = "DirectoryNumber", datamodel = "second" }

		if reply[tempPath]~=nil and reply[tempPath][1]~=nil then
                for j,w in pairs(reply[tempPath]) do
                    --add the checked numbers to uamap.

		    local inCheckId = checkId..j
		    local inCheckVPId = checkVPId..j
		    local inPriorityId = priorityId..j

                    local numForInputExist = tostring(POST[inCheckId])
		    local priorityVP = tostring(POST[inPriorityId])
                    local numForOutgoExist = tostring(POST[inCheckVPId])			
		    if rowIds == "" then
			rowIds = inPriorityId		    
		    else
			rowIds = rowIds..","..inPriorityId
		    end	 			    
		end
		end
	end
	end
    --[[	
    local numberOfLineObj
    local replyLineNum, error = mbus.getParameters{ path = linePath, param = "DirectoryNumber", datamodel = "second" }
    numberOfLineObj = #replyLineNum[linePath]
    return numberOfLineObj
    ]]    
    return rowIds	
end

if cgilua.servervariable"REQUEST_METHOD" == "POST" then
    local modify = {}
    if POST["saveFlag"] == "1" then
        if tonumber(pathId)<3 then
            local posConfigPath = "Device.Services.VoiceService.1.PhyInterface." .. tostring(pathId)
            local oldPosConfig, oldPstnIn, oldPstnOut = POST["oldPosConfig"], POST["oldPstnIn"], POST["oldPstnOut"]
            local status, pstnInStatus, pstnOutStatus = "false", "false", "false"
            if POST["posChk"]=="ON" then
                status = "true"
            end
            if POST["pstnInChk"]=="ON" then
                pstnInStatus = "true"
            end

            if POST["pstnOutChk"]=="ON" then
                pstnOutStatus = "true"
            end
            modify = {}
	    	
            if oldPosConfig ~= status then
				table.insert(modify, {path=posConfigPath, param={X_TELECOMITALIA_IT_POSConfig=status}, datamodel="second"})
			end
			if oldPstnIn ~=  pstnInStatus then
				table.insert(modify, {path=posConfigPath, param={X_TELECOMITALIA_IT_SwitchToPSTNIn=pstnInStatus}, datamodel="second"})
			end
			if oldPstnOut ~= pstnOutStatus then
				table.insert(modify, {path=posConfigPath, param={X_TELECOMITALIA_IT_SwitchToPSTNOut=pstnOutStatus}, datamodel="second"})
			end
            setMBUS_IGD(modify)
		
			local portTypeValue = switchPath1 .. "." .. count .. ".Line.1"	
            --delete all the uamap.
			local deleteUAmapPath = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"
	    
	    	
            local reply, error = mbus.modify(
			function()
                        local reply1, error1 = mbus.deleteObjects{path = deleteUAmapPath, filter="(== ToUA " .. portTypeValue .. ")", datamodel = "second"}
                end, {datamodel="second"})
		
            --delete all the voiceportmap.
			local deleteVoiceportmapPath = "Device.Services.VoiceService.3.X_TELECOMITALIA_IT_UAMapping"
			    	
            local reply, error = mbus.modify(
                function()
                        local reply2, error2 = mbus.deleteObjects{path = deleteVoiceportmapPath, filter="(== FromUA " .. portTypeValue .. ")", datamodel = "second"}
                end, {datamodel="second"})
	     
            local UAmapPath = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"	    
			local VoiceportmapPath = "Device.Services.VoiceService.3.X_TELECOMITALIA_IT_UAMapping"
			local toVoicePortPath =   portTypeValue
			local fromVoicePortPath = portTypeValue
	    
			local outRowNoPrty = {}
			local outRow = {}
			local outCount = 1
			local outCount1 = 1						
			local reply1, error1 = mbus.getParameters{ path = linePath1, datamodel = "second" }
			if reply1[linePath1]~=nil and reply1[linePath1][1]~=nil then
			local tmpPrty
                for h,f in pairs(reply1[linePath1]) do	

				local tempPath = f.path..".Line"
				local checkId = "numForUAMap"..h
				local checkVPId = "numForVPMap"..h
				local priorityId = "numPriority"..h
				local numForInputExist = tostring(POST["assoNum"])
	
				local reply, error = mbus.getParameters{ path = tempPath, param = "DirectoryNumber", filter="(== DirectoryNumber " .. numForInputExist .. ")", datamodel = "second" }
	   		
				if reply[tempPath]~=nil and reply[tempPath][1]~=nil then
				
					for j,w in pairs(reply[tempPath]) do
                    --add the checked numbers to uamap.
					local inCheckId = checkId..j
					local inCheckVPId = checkVPId..j
					local inPriorityId = priorityId..j		

						if numForInputExist~="nil" and numForInputExist~="-" then
                        local fromUAPath = w.path
						local numLanManaged = isNumLanManaged(fromUAPath)
                         if numLanManaged~="true" then
                            local reply, error = mbus.modify(
                                function()
                                    local reply3, error3 = mbus.addObjects{ path = UAmapPath, param = { FromUA = fromUAPath, ToUA = toVoicePortPath }, datamodel = "second" }
                                    if error3~=nil or reply3[UAmapPath][1]==nil then
                                        result=1                               
                                    end
                                end, {datamodel="second"})

							local reply1, error1 = mbus.modify(
								function()
									local reply4, error4 = mbus.addObjects{ path = VoiceportmapPath, param = { ToUA = fromUAPath, FromUA = fromVoicePortPath }, datamodel = "second" }                                    
									if error4~=nil or reply4[VoiceportmapPath][1]==nil then
										result=1                                
									end
								end, {datamodel="second"})   

                         end
						end
					end
				end
				end 
			end
        else
            local posDECTConfigPath = "Device.Services.VoiceService.1.PhyInterface.3" 
            local pstnInStatus, pstnOutStatus = "false", "false"
            if POST["pstnDECTInChk"]=="ON" then
                pstnInStatus = "true"
            end

            if POST["pstnDECTOutChk"]=="ON" then
                pstnOutStatus = "true"
            end
            modify = {}
            table.insert(modify, {path=posDECTConfigPath, param={X_TELECOMITALIA_IT_SwitchToPSTNIn=pstnInStatus, X_TELECOMITALIA_IT_SwitchToPSTNOut=pstnOutStatus}, datamodel="second"})
            setMBUS_IGD(modify)

            --deal with the situation of DECT All.
            DECTAllObj = isDECTAllObjExistInUAMap()
            if DECTAllObj=="true" then
                --add other 3 objs after delete DECTAll obj
                -- addOtherThreeUAMapObj(portTypeValue)
            end

            DECTAllObj = isDECTAllObjExistInVpMap()
            if DECTAllObj=="true" then
                --add other 3 objs after delete DECTAll obj
                -- addOtherThreeVpMapObj(portTypeValue)
            end

            --delete all the uamap.
			local portTypeValue = switchPath1 .. "." .. count .. ".Line.1"	
			local deleteUAmapPath = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"
            local reply, error = mbus.modify(
                function()
                        local reply1, error1 = mbus.deleteObjects{path = deleteUAmapPath, filter="(== ToUA " .. portTypeValue .. ")", datamodel = "second"}
                end, {datamodel="second"})

            --delete all the voiceportmap.
			local deleteVoiceportmapPath = "Device.Services.VoiceService.3.X_TELECOMITALIA_IT_UAMapping"
            local reply, error = mbus.modify(
                function()
                        local reply2, error2 = mbus.deleteObjects{path = deleteVoiceportmapPath, filter="(== FromUA " .. portTypeValue .. ")", datamodel = "second"}
                end, {datamodel="second"})
		


			local UAmapPath = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"	    
			local VoiceportmapPath = "Device.Services.VoiceService.3.X_TELECOMITALIA_IT_UAMapping"
			local toVoicePortPath = portTypeValue
			local fromVoicePortPath = portTypeValue
	    
			local outRowNoPrty = {}
			local outRow = {}
			local outCount = 1
			local outCount1 = 1	
			--[[local UAmapPath = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"	    
			local VoiceportmapPath = "Device.Services.VoiceService.3.X_TELECOMITALIA_IT_UAMapping"
			local toVoicePortPath = "Device.Services.VoiceService.3.VoiceProfile.1.Line.1"
			local fromVoicePortPath = "Device.Services.VoiceService.3.VoiceProfile.1.Line.1"]]
	    
			local outRowNoPrty = {}
			local outRow = {}
			local outCount = 1
			local outCount1 = 1						
			local reply1, error1 = mbus.getParameters{ path = linePath1, datamodel = "second" }
			if reply1[linePath1]~=nil and reply1[linePath1][1]~=nil then
			local tmpPrty
			for h,f in pairs(reply1[linePath1]) do	

			local tempPath = f.path..".Line"
			local checkId = "numForUAMap"..h
			local checkVPId = "numForVPMap"..h
			local priorityId = "numPriority"..h
			local numForInputExist = tostring(POST["assoNum"])
	
            local reply, error = mbus.getParameters{ path = tempPath, param = "DirectoryNumber", filter="(== DirectoryNumber " .. numForInputExist .. ")", datamodel = "second" }
	   		
            if reply[tempPath]~=nil and reply[tempPath][1]~=nil then
				
                for j,w in pairs(reply[tempPath]) do
                --add the checked numbers to uamap.
				local inCheckId = checkId..j
				local inCheckVPId = checkVPId..j
				local inPriorityId = priorityId..j		
				    					
					if numForInputExist~="nil" and numForInputExist~="-" then
                    local fromUAPath = w.path
					local numLanManaged = isNumLanManaged(fromUAPath)
				    	
                     if numLanManaged~="true" then
						local reply, error = mbus.modify(
							function()
								local reply3, error3 = mbus.addObjects{ path = UAmapPath, param = { FromUA = fromUAPath, ToUA = toVoicePortPath }, datamodel = "second" }
								if error3~=nil or reply3[UAmapPath][1]==nil then
									result=1						   
								end
							end, {datamodel="second"})
						local reply1, error1 = mbus.modify(
							function()
								local reply4, error4 = mbus.addObjects{ path = VoiceportmapPath, param = { ToUA = fromUAPath, FromUA = fromVoicePortPath }, datamodel = "second" }                                    
								if error4~=nil or reply4[VoiceportmapPath][1]==nil then
									result=1                                
								end
							end, {datamodel="second"}) 
                          end
                     end
					end
				end
			end
			end
			end
    saveall(0, 1)
    cgilua.redirect("save_alert.lp", { u="voipStato.lp" })
    return
    end
end

-- CPE
local PSTNNumber = getFXONum()
local enablePath = "Device.Services.VoiceService.1.PhyInterface.4"
local replyEnable, error = mbus.getParameters{ path = enablePath, param = "X_TELECOMITALIA_IT_Enable", datamodel = "second" }
local PSTNEnable = replyEnable[enablePath][1].param["X_TELECOMITALIA_IT_Enable"]

local wrongPriority = translate([==[Warning: there are one or more priority input incorrect. Use only the allowed indexes (1-8).]==])
local noPstn = translate([==[Attention! Error in the field "Associated with fixed line."]==]) .. " " .. "<br/>" .. translate([==[Check the page "Telephone Numbers" if the Fixed Line is active or uncheck the Fixed Line association in incoming and outgoing direction from this page.]==])
countOfLineObj()
%>
</head>
<script type="text/javascript">
//<![CDATA[
function showErrorMsg(errorMsgStr)
{
    document.getElementById("conf_all_num").style.display="none";
    document.getElementById("resultKO").style.display="block";
    document.getElementById("errorMsg").innerHTML=errorMsgStr;
}

function submitSave()
{
   setTimeout(function() { alert('Please Wait!'); }, 1);
   var totalIds = '<%=rowIds%>';
    var idArr = totalIds.split(",");
    for (i=0;i<=idArr.length-1;i++)
    {
	if (document.getElementById(idArr[i])!=null && document.getElementById(idArr[i]) != "undefined") {
        	var priorityStr = document.getElementById(idArr[i]).value;
        	if(priorityStr!="") {
            		if(!priorityExam(priorityStr)) {
                		showErrorMsg('<%=wrongPriority%>');
                		return false;
            		}
        	}
    	}
    }
	
    	  
    var tmpId = '<%=pathId%>';	
    var pathId = parseInt(tmpId)
    var pstnInChk,pstnOutChk	
    if(pathId < 3) {		 
    	pstnInChk = document.getElementById("pstnInChk").checked
    	pstnOutChk = document.getElementById("pstnOutChk").checked
    } else {
	pstnInChk = document.getElementById("pstnDECTInChk").checked
    	pstnOutChk = document.getElementById("pstnDECTOutChk").checked
    }

    /*
    var pstnIn = document.getElementById("pstnConfIn").value
    var pstnOut = document.getElementById("pstnConfOut").value
    if (pstnInChk || pstnOutChk) {
	if( pstnIn == "false" || pstnOut == "false") {
	      showErrorMsg('<%=noPstn%>');
              return false;	
	}
    }		
    */

    var PSTNEnable = <%=PSTNEnable%>
    if (pstnInChk || pstnOutChk) {					
    	if (!PSTNEnable) {		
		showErrorMsg('<%=noPstn%>');
        	return false;
	} else if (PSTNEnable) {
		<% if PSTNNumber == "" then %>				
		showErrorMsg('<%=noPstn%>');
        	return false;
		<% end %>
	}		
    }	
    document.getElementById("saveFlag").value="1";
    document.configTelephony.submit();
}
function cancelConfirm()
{
    document.getElementById("conf_all_num").style.display = "";
    document.getElementById("confirm").style.display = "none";
    document.getElementById("resultKO").style.display="none";
}

function priorityExam(str)
{
    //exam the input box value is number or not.
    //var filter=/^\s*[.,0-9]{0,10240}\s*$/;
    var filter=/^\d/g;
    if ((str.indexOf(' ') != -1) || (!str.match(filter)) || (str > 8))
    {
        return false;
    }
    return true;
}
//]]>
</script>
<body>


<div class="contentContainer">
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li> <li><a href="voipStato.lp"><%=translate([==[Telephony]==])%></a></li> 
			</ul>
		</div>


	<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a href="voipStato.lp" class="current">
		<div class="tab">
			<span class="tabIcon_sttel"></span>  
			<span class="contTabTxt transform"><%=translate([==[Telephony services]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
		<% if isRemote==false then%> 
			<li><a class="margin15" href="telephonyNumber.lp">
		
		<div class="tab">
			<span class="contTabTxt transform"><%=translate([==[Telephone numbers]==])%></span></div></a></li>
		<% end %> 
			</ol>
	</div>

<div class='contentcontainer'>
<hr>
<div class='contentitem' id="conf_all_num">

<table border="0" width="100%">
<form id="configTelephony" name="configTelephony" action="" method="post">
<input type="hidden" id="pathId" name="pathId" value=""/>
<input type="hidden" id="saveFlag" name="saveFlag" value="0"/>
<input type="hidden" id="totalRC" name="totalRC" value="0"/>
<tr>
    <td class="padLeft37 verticalAlign">
        <table cellspacing='0' cellpadding='0' width="100%">
            <tr><td>
            <br><!-- Begin of showing Telephone Service-->
            <table cellspacing='0' cellpadding='0' width='100%' class="fontSize">
			<tr>
			<td width='0' class="verticalAlign">
			</td>
			<td class="verticalAlign">
            <span class='midarea2_telmain tableTitle'><%=translate([==[Telephone service Configuration]==])%></span><br>
            <table width='100%' class='edittable valueSpace ' cellspacing='0' cellpadding='0' style="line-height:150%;width:770px;">
                <tr><td colspan='7'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <tr><td align='left' class="width85 tableHeader"><div class="wordWrap width85"><%=translate([==[connection]==])%></div></td>
				<!--<th class='tableHd' align='left' width='5%'><%=translate([==[Identity SIP]==])%></th> -->
					<td align='left' class="width70 tableHeader"><div class="wordWrap width48"><%=translate([==[Extension ]==])%><br/><%=translate([==[Number]==])%></div></td>		      	
                    <td align='left' class="width110 tableHeader"><div class="wordWrap width60"><%=translate([==[Associated Number]==])%></div></td>
                <!--<td align='left' class="width110 tableHeader"><div class="wordWrap width60"><%=translate([==[Number of ]==])%><br/><%=translate([==[outgoing]==])%></div></td>
					<td align='left' class="tableHeader width65"><div class="wordWrap width65"><%=translate([==[Priority]==])%></div></td> 	-->
                    <td align='left' class="tableHeader width65"><div class="wordWrap width65">POS/FAX</div></td>                    
                    <td align='left' class="tableHeader wdth120px"><div class="wordWrap width130"><%=translate([==[Associated with fixed ]==])%><br/><%=translate([==[line]==])%></div></td>
                </tr>
                <tr><td colspan='7'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <%
		local linePath = "Device.Services.VoiceService.2.VoiceProfile"
		local dirNumPath = "Device.Services.VoiceService.1.VoiceProfile.1.Line"
                local rowStyle = "oddrow_firewall"
				--local count = 11
                local phoneType
		local pstnConfIn = false
		local pstnConfOut = false
		dirNumPath = dirNumPath .."." .. tostring(pathId)
		local replydir, error = mbus.getParameters{ path = dirNumPath, param = {"DirectoryNumber"}, datamodel = "second"}
		if replydir[dirNumPath]~=nil and replydir[dirNumPath][1]~=nil then
			dirNum = replydir[dirNumPath][1].param["DirectoryNumber"]
		end
                if tonumber(pathId)<3 then
					--[[if(tonumber(pathId) == 2) then
						count = count + 1
					else
						count = 1
					end]]
                    phoneType = "FXS" .. tostring(pathId)
					local switchPath = "Device.Services.VoiceService.1.PhyInterface."..tostring(pathId)
                    local replySwitch, error = mbus.getParameters{ path = switchPath, param = {"X_TELECOMITALIA_IT_POSConfig", "X_TELECOMITALIA_IT_SwitchToPSTNIn", "X_TELECOMITALIA_IT_SwitchToPSTNOut"}, datamodel = "second"}
                    if replySwitch[switchPath][1].param["X_TELECOMITALIA_IT_SwitchToPSTNIn"]=="true" then
                        incomingCallNum = translate([==[Fixed Line]==])
                    end
                    if replySwitch[switchPath][1].param["X_TELECOMITALIA_IT_SwitchToPSTNOut"]=="true" then
                        outgoingCallNum = translate([==[Fixed Line]==])
                    end
                    local posFAX = replySwitch[switchPath][1].param["X_TELECOMITALIA_IT_POSConfig"]
                    local PSTNIn = replySwitch[switchPath][1].param["X_TELECOMITALIA_IT_SwitchToPSTNIn"]
                    local PSTNOut = replySwitch[switchPath][1].param["X_TELECOMITALIA_IT_SwitchToPSTNOut"]
                %>
                
                <tr><td class="<%=rowStyle%> fontSize width85"><div class="wordWrap"><%=phoneType%></div></td> 
				<!--<td class="<%=rowStyle%>" style="word-break:break-all;"><div style="width:70px;word-wrap: break-word;"><%=sipUri%></div></td> -->
					<td class="<%=rowStyle%> wordWrap width70"><div class="wordWrap"><%=dirNum%></div></td>
					<td class="<%=rowStyle%> width110"><div class="wordWrap">
					<select id="assoNum" name="assoNum" class="fontSize inputClass">
					<option value="<%=tostring(assoNum)%>"><%=tostring(assoNum)%></option>
                <%
		local reply1, error1 = mbus.getParameters{ path = linePath, datamodel = "second" }
		local result = {}
		if reply1[linePath]~=nil and reply1[linePath][1]~=nil then
			for h,f in pairs(reply1[linePath]) do	
 			 local tempPath = f.path..".Line"
			 local checkId = "numForUAMap"..h
			 local lanManagedNumber  	
             local replyLineNum, error = mbus.getParameters{ path = tempPath, param = {"DirectoryNumber", "X_TELECOMITALIA_IT_LANManaged","Enable"}, datamodel = "second" }
             if replyLineNum[tempPath]~=nil and replyLineNum[tempPath][1]~=nil then
			  for i,v in pairs(replyLineNum[tempPath]) do
			  totalRowcount = totalRowcount +1
			  local enableFlag = "false"
              lanManagedNumber = v.param["X_TELECOMITALIA_IT_LANManaged"]
			  local enable = v.param["Enable"]			
              local numUsed = "false"
			  local switchPath2 = switchPath1 .. "." .. count .. ".Line.1"
			  local isNumExist = findUAMapNumExist1(switchPath2, v.path)
			   if isNumExist=="true" then
				numUsed = "true"
		       end
			   if enable == "Enabled" then
				enableFlag = "true"
			   end

			  local inCheckId = checkId..i
			   if (v.param["DirectoryNumber"]~="" and v.param["DirectoryNumber"]~=nil) then
			    pstnConfIn = true	
			    if result[i] == nil then
				 result[i] = {}		  		
			    end
				result[i].assoNum = tostring(v.param["DirectoryNumber"])
							if(result[i].assoNum ~= tostring(assoNum) and result[i].assoNum ~="nil" and v.path ~= "Device.Services.VoiceService.2.VoiceProfile.4.Line.1")then
							%>
							<option value="<%=result[i].assoNum%>"><%=result[i].assoNum%></option>
							<%
							end
               end 
              end
             end		
    		end
		end
					if(tostring(assoNum)~="-")then
                %>
						<option value="-">-</option>
				<%	end
				%>
				</select>
                </div></td>
               <!-- <td class="<%=rowStyle%> width110"><div class="wordWrap">
                <%
		local newPriority
		local reply1, error1 = mbus.getParameters{ path = linePath, datamodel = "second" }
		if reply1[linePath]~=nil and reply1[linePath][1]~=nil then
                    for h,f in pairs(reply1[linePath]) do	
			local tempPath = f.path..".Line"


		local checkId = "numForVPMap"..h
		local priorityId = "numPriority"..h


                local lanManagedNumber
                local replyLineNum, error = mbus.getParameters{ path = tempPath, param = {"DirectoryNumber", "X_TELECOMITALIA_IT_LANManaged","Enable"}, datamodel = "second" }
                if replyLineNum[tempPath]~=nil and replyLineNum[tempPath][1]~=nil then
                    for i,v in pairs(replyLineNum[tempPath]) do
			local enableFlag = "false"
                        lanManagedNumber = v.param["X_TELECOMITALIA_IT_LANManaged"]
			local enable = v.param["Enable"]		
                        local numUsed = "false"
                        local priority = ""	
			
                        local isNumExist = findVPMapNumExist1(switchPath1, v.path)
			
                        if isNumExist=="true" then
                            numUsed = "true"
                            priority = getVPMapNumPrio1(switchPath1,v.path)
                        end
			
			if enable == "Enabled" then
				enableFlag = "true"
			end
			if priority == nil then
				priority = ""
			end	

			local inCheckId = checkId..i
			local inPriorityId = priorityId..i

			if (v.param["DirectoryNumber"]~="" and v.param["DirectoryNumber"]~=nil) then
				pstnConfOut = true
                                cgilua.print("<div style='display:block';nowrap;>"..tostring(v.param["DirectoryNumber"]).."&nbsp;&nbsp;<input type='checkbox' "..isCheckedService(numUsed).." name='"..inCheckId.."' id='"..inCheckId.."' value='"..isCheckedService(numUsed).."' /></div>")
				if newPriority==nil then	
					newPriority = "<input type='text' size='1' name='"..inPriorityId.."' id='"..inPriorityId.."' value='"..tostring(priority).."'/><br>"
				else 
					newPriority = tostring(newPriority) .. "<input type='text' size='1' name='"..inPriorityId.."' id='"..inPriorityId.."' value='"..tostring(priority).."'/><br>"
				end
                   end

                   end
                end


		 end
		end

		if newPriority == nil then
			newPriority = ""
		end

                %>
                </div></td>
				<td class="<%=rowStyle%> width65" ><div class="wordWrap"><%cgilua.print(newPriority)%></div></td>-->
                <td class="<%=rowStyle%> wordWrap"><div class="wordWrap" style="width:70px;padding-left:20px">
                    <input type="checkbox" <%=isCheckedService(posFAX)%> name="posChk" size="8" value="ON" />
                    <input type="hidden" name="oldPosConfig" value="<%=posFAX%>" />
                </div></td>
                <td class="<%=rowStyle%> wordWrap"><div class="wordWrap">
                    <%=translate([==[in]==])%>&nbsp;<input type="checkbox" <%=isCheckedService(PSTNIn)%> id="pstnInChk"  name="pstnInChk" value="ON" class="alignMid" />
                    <%=translate([==[out]==])%>&nbsp;<input type="checkbox" <%=isCheckedService(PSTNOut)%> id="pstnOutChk"  name="pstnOutChk" value="ON" class="alignMid" />
                    <input type="hidden" name="oldPstnIn" value="<%=PSTNIn%>" />
                    <input type="hidden" name="oldPstnOut" value="<%=PSTNOut%>" />
                </div></td>
                </tr>
                <%
                else
                    phoneType = "DECT" .. tostring(tonumber(pathId)-2)
                    local DECTPath = "Device.Services.VoiceService.1.PhyInterface.3.X_TELECOMITALIA_IT_DECTHandset." .. tostring(tonumber(pathId)-2)
                %>
                <tr><td colspan='7'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <tr><td class="<%=rowStyle%> fontSize width85"><div class="wordWrap"><%=phoneType%></div></td>
				<!--<td class="<%=rowStyle%>" style="word-break:break-all;"><div style="width:70px;word-wrap: break-word;"><%=sipUri%></div></td> -->
					<td class="<%=rowStyle%> wordWrap width70"><div class="wordWrap"><%=dirNum%></div></td>
					<td class="<%=rowStyle%> width110"><div class="wordWrap">
					<select id="assoNum" name="assoNum" class="fontSize inputClass">
					<option value="<%=tostring(assoNum)%>"><%=tostring(assoNum)%></option>
                <%
		local reply1, error1 = mbus.getParameters{ path = linePath, datamodel = "second" }
		local result = {}
		if reply1[linePath]~=nil and reply1[linePath][1]~=nil then
            for h,f in pairs(reply1[linePath]) do	
			local tempPath = f.path..".Line"
			local checkId = "numForUAMap"..h
		    local lanManagedNumber
			local replyLineNum, error = mbus.getParameters{ path = tempPath, param = {"DirectoryNumber", "X_TELECOMITALIA_IT_LANManaged","Enable"}, datamodel = "second" }
			if replyLineNum[tempPath]~=nil and replyLineNum[tempPath][1]~=nil then
			 for i,v in pairs(replyLineNum[tempPath]) do
			 totalRowcount = totalRowcount +1
			 lanManagedNumber = v.param["X_TELECOMITALIA_IT_LANManaged"]
			 local numUsed = "false"
			 local enableFlag = "false"                        
			 local enable = v.param["Enable"]      
			 local switchPath2 = switchPath1 .. "." .. count .. ".Line.1"
			 local isNumExist = findUAMapNumExist1(switchPath2, v.path)
			  if isNumExist=="true" then
				numUsed = "true"
			  end
			
			  if enable == "Enabled" then
				enableFlag = "true"
			  end
			
			 local inCheckId = checkId..i
			  if (v.param["DirectoryNumber"]~="" and v.param["DirectoryNumber"]~=nil) then
			   pstnConfIn = true
			   if result[i] == nil then
				 result[i] = {}		  		
			   end
			   result[i].assoNum = tostring(v.param["DirectoryNumber"])
					if(result[i].assoNum ~= tostring(assoNum) and result[i].assoNum ~="nil" and v.path ~= "Device.Services.VoiceService.2.VoiceProfile.4.Line.1")then
					%>
					<option value="<%=result[i].assoNum%>"><%=result[i].assoNum%></option>
					<%
					end                    
               end
              end
             end
			 end
		 end	
               if(tostring(assoNum)~="-")then
                %>
						<option value="-">-</option>
				<%	
					end
				%>
				</select>
                </div>
				</td>
                <!--<td class="<%=rowStyle%> width110"><div class="wordWrap">
                <%
		local newPriority
		local reply1, error1 = mbus.getParameters{ path = linePath, datamodel = "second" }
		if reply1[linePath]~=nil and reply1[linePath][1]~=nil then
                    for h,f in pairs(reply1[linePath]) do	
			local tempPath = f.path..".Line"


		local checkId = "numForVPMap"..h
		local priorityId = "numPriority"..h
			
                local lanManagedNumber
                local replyLineNum, error = mbus.getParameters{ path = tempPath, param = {"DirectoryNumber", "X_TELECOMITALIA_IT_LANManaged","Enable"}, datamodel = "second" }
                if replyLineNum[tempPath]~=nil and replyLineNum[tempPath][1]~=nil then
                    for i,v in pairs(replyLineNum[tempPath]) do
			local enableFlag = "false"	
                        lanManagedNumber = v.param["X_TELECOMITALIA_IT_LANManaged"]
			local enable = v.param["Enable"]
                        local numUsed = "false"
                        local priority = ""

			local isNumExist = findVPMapNumExist1(switchPath1, v.path)
                        if isNumExist=="true" then
                            numUsed = "true"
			    priority = getVPMapNumPrio1(switchPath1,v.path)	
                        end

			if enable == "Enabled" then
				enableFlag = "true"
			end
			if priority == nil then
				priority = ""
			end
			
			local inCheckId = checkId..i
			local inPriorityId = priorityId..i
			if (v.param["DirectoryNumber"]~="" and v.param["DirectoryNumber"]~=nil) then
				pstnConfOut = true
                                cgilua.print("<div style='display:block'>"..tostring(v.param["DirectoryNumber"]).."&nbsp;&nbsp;<input type='checkbox' "..isCheckedService(numUsed).." name='"..inCheckId.."' id='"..inCheckId.."' value='"..isCheckedService(numUsed).."' /><br/></div>")
				if newPriority==nil then	
					newPriority = "<input type='text' size='1' name='"..inPriorityId.."' id='"..inPriorityId.."' value='"..tostring(priority).."'/><br>"
				else 
					newPriority = tostring(newPriority) .. "<input type='text' size='1' name='"..inPriorityId.."' id='"..inPriorityId.."' value='"..tostring(priority).."'/><br>"
				end
			end

                end
                end

		end
                end

		if newPriority == nil then
			newPriority = ""
                end
                %>
                </div></td>-->
				<%
                local DECTPSTNIn, DECTPSTNOut = getDECTPSTNInAndOut()
                %>
				<!--<td class="<%=rowStyle%> width65" ><div class="wordWrap"><%cgilua.print(newPriority)%></div></td>-->
                <td class="<%=rowStyle%> wordWrap txtAlignCenter"><div class="wordWrap" style="width:70px;padding-left:20px"></div></td>
                <td class="<%=rowStyle%> wordWrap"><div class="wordWrap">
                    <%=translate([==[in]==])%>&nbsp;<input type="checkbox" <%=isCheckedService(DECTPSTNIn)%>  id="pstnDECTInChk" name="pstnDECTInChk" value="ON" class="alignMid" />
                    <%=translate([==[out]==])%>&nbsp;<input type="checkbox" <%=isCheckedService(DECTPSTNOut)%> id="pstnDECTOutChk"  name="pstnDECTOutChk" value="ON" class="alignMid" />
                </div></td>
                </tr>
                <%end%>
				<tr><td colspan="7" class="padtop10">
                <table cellspacing='0' cellpadding='0' class="padtop10" width='100%'  style="text-align:center">
                <tr ><td style='padding-left:250px;'>
					<a style='color:black' onclick='javascript: submitSave();'><div class='midarea6-1 mainButton' name="thb10"><%=translate([==[Save]==])%></div></a></td>
					<td style='padding-right:250px;'>
					<a style='color:black' onclick='javascript:document.location.href="voipStato.lp";'><div class='midarea6-1 secondaryButton' name="thb7"><%=translate([==[Back]==])%></div></a></td>
                </tr>
				<input type="hidden" id="pstnConfIn" name="pstnConfIn" value="<%=pstnConfIn%>" />
                <input type="hidden" id="pstnConfOut" name="pstnConfIn" value="<%=pstnConfOut%>" />
                </table></td></tr>
            </table>
            </td></tr></table>
        </td></tr></table>
    </td>
</tr>
</form>
</table>
</div>
</div>
</div>
<script type="text/javascript">
	document.getElementById("totalRC").value=<%=tonumber(totalRowcount)%>;
</script>
<div id="resultKO" style="display:none">
<%cgilua.lp.include("webparts/resultKO_Priority.lp")%>
</div>
<div id="confirm" style="display:none">
<%cgilua.lp.include("webparts/confirmBack.lp")%>
</div>
<script src="js/antiCSRF.js" type="text/javascript"></script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Modem Telecom Italia</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<!-- <link rel="stylesheet" href="css/style.css" type="text/css"/> -->
<link rel="stylesheet" href="css/master.css" type="text/css" />
<script language="javascript" type="text/javascript" src="js/script.js"></script>
    <script language="JavaScript" type="text/javascript">
   if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="submenuselect1";
		window.parent.menu.document.getElementById("teleSub").style.display="block";	
	}
	
	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="";
	}

	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}

	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
		if(window.parent.menu.document.getElementById("ipv6list")) {
			window.parent.menu.document.getElementById("ipv6firewall").className="";
			window.parent.menu.document.getElementById("ipv6list").style.display="none";
		}
	}

	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {
		window.parent.menu.document.getElementById("port").className="";
	}

	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="";
	}
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {
		window.parent.menu.document.getElementById("urlfi").className="";
	}

	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {
		window.parent.menu.document.getElementById("waon").className="";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {
		window.parent.menu.document.getElementById("stru").className="";
	}	
  </script>

<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<% cgilua.lp.include("lp/style.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<% cgilua.lp.include("lp/form.lp")%>
<% cgilua.lp.include("lp/voip.lp")%>

<%
local tprint = require("tableprint")


local translate = translate
local QUERY = cgilua.QUERY
local POST=cgilua.POST

local isRemote = isRemoteAccess()
if cgilua.servervariable"REQUEST_METHOD" == "POST" then
    local rowIndex = POST["rowIndex"]
	local assoNum = POST["assoNum"]
    local rowIPIndex = POST["rowIPIndex"]
	local rowDelIPIndex = POST["rowDelIPIndex"]
	local delIPFlag = POST["delIPFlag"]
	
    local pageStr
	
    if rowIndex ~= nil then
		if assoNum ~= nil and assoNum ~= "-" and assoNum ~="" then
			pageStr = "voipConfig.lp?pathId="..(tonumber(rowIndex)).."&assoNum="..(tostring(assoNum))
		else
			pageStr = "voipConfig.lp?pathId="..(tonumber(rowIndex)).."&assoNum=-"
		end
		cgilua.redirect(tostring(pageStr))
	end	
	
	if delIPFlag == "true" then
		
		local linePath = "Device.Services.VoiceService.3.VoiceProfile."..rowDelIPIndex..".Line.1"
		
		local deleteUAmapPath = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"
		local reply, error = mbus.modify(
		function()
			local reply1, error1 = mbus.deleteObjects{path = deleteUAmapPath, filter="(== ToUA " .. linePath .. ")", datamodel = "second"}                    
        end, {datamodel="second"})
		
		local deleteVoiceportmapPath = "Device.Services.VoiceService.3.X_TELECOMITALIA_IT_UAMapping"
        local replyv1, errorv1 = mbus.modify(
        function()        
            local reply2, error2 = mbus.deleteObjects{path = deleteVoiceportmapPath, filter="(== FromUA " .. linePath .. ")", datamodel = "second"}
        end, {datamodel="second"})
		
		-- Fix for CPE_P00104073 : Reset the VoiceProfile Line Instance values to factory default values
		-- Sample default values taken for Voice Profile 2 after Factory reset
		-- Device.Services.VoiceService.3.VoiceProfile.2.Line.1.Enable: Enabled
		-- Device.Services.VoiceService.3.VoiceProfile.2.Line.1.DirectoryNumber: **02
		-- Device.Services.VoiceService.3.VoiceProfile.2.Line.1.SIP.AuthUserName: **02
  		-- Device.Services.VoiceService.3.VoiceProfile.2.Line.1.SIP.AuthPassword: 02
  		-- Device.Services.VoiceService.3.VoiceProfile.2.Line.1.SIP.URI: **02@192.168.1.1
		-- Device.Services.VoiceService.3.VoiceProfile.2.Line.1.X_TELECOMITALIA_IT_PhyAssignment: Not Assigned
		-- Device.Services.VoiceService.3.VoiceProfile.2.Line.1.X_TELECOMITALIA_IT_LineName: Telefono IP 1
		-- Device.Services.VoiceService.3.VoiceProfile.2.Line.1.X_TELECOMITALIA_IT_MACAddress: 
		
		-- Use Mbus Modify Parameters api
		--if rowDelIPIndex ~= "10" then
		--Changed this condition to have rowDelIPIndex as 11
		
		if tonumber(rowDelIPIndex) < 10 then
			directoryNumber = "**0"..rowDelIPIndex..""
			authUserName = "**0"..rowDelIPIndex..""
			authPassword = "0"..rowDelIPIndex..""
			--local sipURI = "**0"..rowDelIPIndex.."@192.168.1.1"
		elseif rowDelIPIndex == "11" then
			directoryNumber = "**01"
			authUserName = "**01"
			authPassword = "01"
		else
			directoryNumber = "**"..rowDelIPIndex..""
			authUserName = "**"..rowDelIPIndex..""
			authPassword = ""..rowDelIPIndex..""
		end
		
		--commented for CPE_P00121126
		--local lineInstanceCount = rowDelIPIndex - 1
		local lineInstanceCount = rowDelIPIndex
		local lineName
		if(lineInstanceCount=="11")then
			lineName = "Telefono IP 1"
		else
			lineName = "Telefono IP "..lineInstanceCount..""
		end
		local linePhyAlignment="Not Assigned"
		local macAddress=""
		
		-- Change the Factory Default values for Line Parameters
		local reply, error = mbus.modify(
			function()
				local reply, error = mbus.setParameters{path=linePath, param={Enable="Enabled",DirectoryNumber=directoryNumber}, datamodel = "second"}
				end, {datamodel="second"})

		-- Change the Factory Default values for Line Path SIP Parameters
		local linePathSIP = ""..linePath..".SIP"
		local reply, error = mbus.modify(
			function()
				local reply, error = mbus.setParameters{path=linePathSIP, param={AuthUserName=authUserName,AuthPassword=authPassword}, datamodel = "second"}
				end, {datamodel="second"})

		-- Change the LineName and PhyAssignment value to the Factory Default values
		local sipServerPath = "SIPServer.InternalUA."..rowDelIPIndex..""
		local reply, error = mbus.modify(
			function()
				local reply1, error1 = mbus.setParameters{path=sipServerPath,param={MacAddress=macAddress,Linename=lineName,PhyAssignment=linePhyAlignment},flags="KEYPATH"}
			end)
	else
		if rowIPIndex ~= nil then
			pageStr = "ipConfig.lp?pathId="..(tonumber(rowIPIndex))
			cgilua.redirect(tostring(pageStr))
		end	
    end	    
end

local userAgent = getUserAgent("Device.Services.VoiceService.3.VoiceProfile.1.SIP")
if(userAgent ~= nil)then
	userAgent = "<Numero interno>@" .. userAgent
end
--local sipUri,dirNum = getFXSDECTSIP("Device.Services.VoiceService.1.VoiceProfile.1.Line")

%>
</head>

<body>
<script type="text/javascript">

if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
	window.parent.menu.document.getElementById("tele").className="submenuselect1";
	window.parent.menu.document.getElementById("teleSubli").style.display="block";
	window.parent.menu.document.getElementById("teleSub").className="";
}


//<![CDATA[
function submitConf(pathId, rowIndex, assoNum)
{
    document.getElementById("rowIndex").value=rowIndex;
	document.getElementById("assoNum").value=assoNum;
    document.getElementById("configTelephony").submit();
}

function submitIPConf(pathId, rowIndex) {    
    document.getElementById("rowIPIndex").value=rowIndex;
    document.getElementById("configIP").submit();
}

function submitDeleteIP() {    
				
    document.getElementById("configIP").submit();
}

function showIPWarn(pathId, rowIndex) {
	document.getElementById("delIPFlag").value="true";
	document.getElementById("rowDelIPIndex").value=rowIndex;
    document.getElementById("voipStato").style.display = "none";
	document.getElementById("ipDelete").style.display = "block";    	    
}

function closeIPConfirm() {
	document.getElementById("delIPFlag").value="false";
	document.getElementById("rowDelIPIndex").value="";
    document.getElementById("voipStato").style.display = "block";
	document.getElementById("ipDelete").style.display = "none";    	    
}

function invokeIpPage_Check(pageName) {
<%
--Check for IP Phone configuration
local phyIntf_IPCheck = connectionInfo()
if(#phyIntf_IPCheck<10)then
%>
	window.location.href=pageName;
<%
else
%>
	document.getElementById("voipStato").style.display = "none";
	document.getElementById("newMax").style.display="block";  
<%
end
%>
}
function invokeIpPage(pageName) {
	window.location.href=pageName;
}
//]]>
</script>

<div class="contentContainer">

<div id="voipStato" style="display:block">

		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li> <li><a href="voipStato.lp"><%=translate([==[Telephony]==])%></a></li> 
			</ul>
		</div>

<!-- <table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
<tr><td align="left"><a href="advance.lp">Avanzate</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="voipStato.lp"><%=translate([==[Telephony services]==])%></a></td> -->

<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a href="voipStato.lp" class="current">
		<div class="tab">
			<span class="tabIcon_sttel"></span>  
			<span class="contTabTxt transform"><%=translate([==[Telephony services]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
		<% if isRemote==false then%> 
			<li><a class="margin15" href="telephonyNumber.lp">
		
		<div class="tab">
			<span class="contTabTxt transform"><%=translate([==[Telephone numbers]==])%></span></div></a></li>
		<% end %> 
			</ol>
		</div>


<!-- <%if isRemote==false then%>
<td align="right"><a href="telephonyNumber.lp">Numeri telefonici</a></td>
<%end%>
</tr>
</table> -->

<div class='contentcontainer' id='configNum'>

<div class='contentitem'>

<table border="0" width="100%">
<form id="configTelephony" name="configTelephony" action="" method="post">
<input type="hidden" id="pathId" name="pathId" value=""/>
<input type="hidden" id="assoNum" name="assoNum" value=""/>
<input type="hidden" id="rowIndex" name="rowIndex" value=""/>
<tr>
   <!--  <td class='icon' style='vertical-align:top' width='100px'><img src='images/tel___xl.gif' alt=''></td> -->
<td class="padLeft37 verticalAlign">
        <table cellspacing='0' cellpadding='0' width="100%">
        <!-- <tr>
            <td align='left'><span class='itemtitle'><%=translate([==[Telephony services]==])%></span></td>
        </tr> -->
        <tr><td>
            <br><!-- Begin of showing Telephone Service-->
            <table cellspacing='0' cellpadding='0' width='100%' class="fontSize">
			<tr>
			<td width='0' class="verticalAlign">
			</td>
			<td class="verticalAlign">
            <span class='midarea2_telmain tableTitle'><%=translate([==[Telephone service State]==])%></span><br>
            <table width='100%' class="edittable valueSpace width770 fontSize" cellspacing='0' cellpadding='0' style="line-height:150%;">
                <tr><td colspan='6'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                <tr><td align='left' class="width85 tableHeader"><div class="wordWrap width85"><%=translate([==[connection]==])%></div></td>
		
		      <td align='left' class="width70 tableHeader">
			  <div class="wordWrap width48"><%=translate([==[Extension ]==])%><%=translate([==[Number]==])%></div></td>		      	
                    <!--<td align='left' class="width110 tableHeader">
					<div class="wordWrap width60"><%=translate([==[Number of ]==])%><br/><%=translate([==[input]==])%></div></td>-->
                    <td align='left' class="width110 tableHeader">
					<div class="wordWrap width60"><div class="wordWrap width60">
				<%=translate([==[Associated Number]==])%></div></td>
		    <!--<td align='left' class="tableHeader width65"><div class="wordWrap width65"><%=translate([==[Priority]==])%></div></td> 	-->
                    <td align='left' class="tableHeader width85"><div class="wordWrap width85">POS/FAX</div></td>                    
                    <td align='left' class="tableHeader wdth120px"><div class="wordWrap width130"><%=translate([==[Associated with fixed ]==])%><br/><%=translate([==[line]==])%></div></td>

                    <td align='left' class="width70 tableHeader txtAlignCenter"><%if isRemote==false then%><div class="wordWrap"><%=translate([==[Configure]==])%></div><%end%></td>

                </tr>
                <tr><td colspan='6'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
                
                <%
                local rowStyle = "oddrow_firewall"
                local rowNum = 0
                local phoneType, phyInterfaceEnable
		local profilePath = "Device.Services.VoiceService.3.VoiceProfile."
		local FXSIndex = 1
				local phyIntf_T = getConnectionInfo()		
                for i=1, #phyIntf_T do
                    rowNum = rowNum + 1
                    if rowNum%2==1 then
                        rowStyle = "oddrow_firewall"
                    else
                        rowStyle = "evenrow_firewall"
                    end
                    local v = phyIntf_T[i]	                   
					if (v ~= nil) then
					if(v.name ~= nil)then
						 phoneType = v.name
					end
					
                    if phoneType=="FXS" then
                        phoneType = "FXS" .. tostring(i)
                    end
                    if phoneType~="FXO" then
						if(v.enable ~= nil)then
							phyInterfaceEnable = v.enable							 
						end
                        --if false, just show "Interface off"
                        if phyInterfaceEnable~="true" then
                %>
                 <tr><td class="<%=rowStyle%>"><%=phoneType%></td><td class="<%=rowStyle%>" align="left" colspan='6'><%=translate([==[Interface off]==])%></td></tr>
                <%
                        else
                            if phoneType~="DECT" then								
                                local incomingCallNum, outgoingCallNum, priority = "-", "-", "-"
                                local switchPath = "Device.Services.VoiceService.1.PhyInterface."..tostring(i)
                                -- local replySwitch, error = mbus.getParameters{ path = switchPath, param = {"X_TELECOMITALIA_IT_SwitchToPSTNIn", "X_TELECOMITALIA_IT_SwitchToPSTNOut"}, datamodel = "second"}
                                --if replySwitch[switchPath][1].param["X_TELECOMITALIA_IT_SwitchToPSTNIn"]=="true" then
                                    --incomingCallNum = translate([==[Fixed Line]==])
                                --end
                               -- if replySwitch[switchPath][1].param["X_TELECOMITALIA_IT_SwitchToPSTNOut"]=="true" then
                                    --outgoingCallNum = translate([==[Fixed Line]==])
                                --end
								local posFAX
                                if(v.posConfig ~= nil)then
									posFAX = v.posConfig
								end
                               local PSTNIn
								if(v.switchToPSTNIn ~= nil)then
									 PSTNIn = v.switchToPSTNIn
								end
                                local PSTNOut
								if(v.switchToPSTNOut ~= nil)then
									PSTNOut = v.switchToPSTNOut
								end
                                local posFAXValue = translate([==[Unsynchronized]==])
                                local PSTNInValue = translate([==[Unsynchronized]==])
                                local PSTNOutValue = translate([==[Unsynchronized]==])
                                if posFAX~="false" and posFAX~=nil then
                                    posFAXValue = translate([==[Actived]==])
                                end
                                if PSTNIn~="false" and PSTNIn~=nil then
                                    PSTNInValue = translate([==[Actived]==])
                                end
                                if PSTNOut~="false" and PSTNOut~=nil then
                                    PSTNOutValue = translate([==[Actived]==])
                                end
                                local fixedLineInfo = tostring(translate([==[ingress:]==])) .. tostring(PSTNInValue) .. "<br/>" .. tostring(translate([==[egress:]==])) .. tostring(PSTNOutValue)
								if(v.path ~= nil)then
									v.path=v.path
								end
                                local pathId = string.sub(v.path, -1)
				
				-- For CPE_P00106895 - Start
				--[[
				incomingCallNum = getAllInCallNum1(profilePath)
				outgoingCallNum = getAllOutCallNum1(profilePath)
				priority = getAllOutPriority(profilePath)	
				]]
				
				local inOutCall = getAllInOutCallNum1(FXSIndex)
				if(FXSIndex<12)then
					FXSIndex = FXSIndex+11
				end
				if inOutCall ~= nil and inOutCall ~= "" then
					local inOutCallArray = split(inOutCall,"##")					
					incomingCallNum = inOutCallArray[1]
					if(incomingCallNum == "" or incomingCallNum == nil)then
						incomingCallNum = "-"						
					end
					outgoingCallNum = inOutCallArray[2]
					priority	= inOutCallArray[3]
				end
				-- For CPE_P00106895 - End
                %>
                
                <tr>
                <td class="<%=rowStyle%> fontSize width85"><div class="wordWrap"><%=phoneType%><input type="hidden" id="phoneType<%=rowNum%>" name="phoneType<%=rowNum%>" value="<%=phoneType%>" /></div></td>
		   
	         <td class="<%=rowStyle%> wordWrap width70"><div class="wordWrap"><%=v.val%></div></td>     	

                <td class="<%=rowStyle%> width110 fontSize"><div class="wordWrap fontSize"><%=incomingCallNum%></div></td>
                <!--<td class="<%=rowStyle%> width110 fontSize"><div class="wordWrap fontSize"><%=outgoingCallNum%></div></td>-->

		  <!--<td class="<%=rowStyle%> width65" ><div class="wordWrap"><%=priority%></div></td>-->

                <td class="<%=rowStyle%>"><div class="wordWrap"><%=posFAXValue%></div></td>
                <td class="<%=rowStyle%> wdth120px"><div class="wordWrap"><%=fixedLineInfo%></div></td>

                <td class="<%=rowStyle%> txtAlignCenter">
				<%if isRemote==false then%>
				<a onclick='submitConf("<%=pathId%>", "<%=i%>", "<%=incomingCallNum%>")' class="linkPointer">
					<img src='images/rename_usb.png' alt=''/></a>
				<%end%>
                </td>

                </tr>
                    <%      end
                            if phoneType=="DECT" then
								local index = 13
								local dectNumber
                                for j=1,5 do

                                    rowNum = rowNum + 1
                                    if rowNum%2==1 then
                                        rowStyle = "evenrow_firewall"
                                    else
                                        rowStyle = "oddrow_firewall"
                                    end

                                    local incomingCallNum, outgoingCallNum, priority = "-", "-","-"
                                    phoneType = "DECT" .. tostring(j)
									if(v.path ~= nil)then
										v.path=v.path
									end
                                    local DECTPath = v.path .. ".X_TELECOMITALIA_IT_DECTHandset." .. j
                                    local pathId = string.sub(DECTPath, -1)

				    -- For CPE_P00106895 - Start
				    --[[	
                                    incomingCallNum = getAllInCallNum1(profilePath)
                                    outgoingCallNum = getAllOutCallNum1(profilePath)
				    priority = getAllOutPriority(profilePath)
                                    ]]

				    local inOutCall = getAllInOutCallNum1(index)
					index=index+1
				    if inOutCall ~= nil and inOutCall ~= "" then
					local inOutCallArray = split(inOutCall,"##")					
					incomingCallNum = inOutCallArray[1]
					outgoingCallNum = inOutCallArray[2]
					priority	= inOutCallArray[3]
				    end
                                    -- For CPE_P00106895 - end				    
 	
                                    local DECTPSTNInValue = translate([==[Unsynchronized]==])
                                    local DECTPSTNOutValue = translate([==[Unsynchronized]==])
                                    local DECTPSTNIn, DECTPSTNOut = getDECTPSTNInAndOut()
                                    if DECTPSTNIn~="false" then
                                        DECTPSTNInValue = translate([==[Actived]==])
                                    end
                                    if DECTPSTNOut~="false" then
                                        DECTPSTNOutValue = translate([==[Actived]==])
                                    end
									local posFAXValue = translate([==[Non]==]) .. "<br/>" .. translate([==[applicabile]==])	
                                    local fixedLineInfo = tostring(translate([==[ingress:]==])) .. tostring(DECTPSTNInValue) .. "<br/>" .. tostring(translate([==[egress:]==])) .. tostring(DECTPSTNOutValue)
                    %>
                <tr>
                <td class="<%=rowStyle%>"><%=phoneType%><input type="hidden" id="phoneType<%=i+j-1%>" name="phoneType<%=i+j-1%>" value="<%=phoneType%>" /></td>
                <%
                                    local DECTAssociato = getDECTHandsetAssociato(DECTPath)
                                    if DECTAssociato~="true" then
                %>
                <td class="<%=rowStyle%>" colspan='5'><%=translate([==[Terminal is not associated]==])%></td>
                <%
                                    else
				    dectNumber = phyIntf_T[(2+j)]
                %>

	         <td class="<%=rowStyle%> width70"><%if dectNumber.val ~=  nil then%><%=dectNumber.val%><%else%>-<%end%></td>


                <td class="<%=rowStyle%> wordWrap width110"><%=incomingCallNum%></td>
                <!--<td class="<%=rowStyle%> wordWrap width110"><%=outgoingCallNum%></td>-->
                <!--<td class="<%=rowStyle%> wordWrap width65"><%=priority%></td>-->

		<td class="<%=rowStyle%>  wordWrap width65"><div class="wordWrap width65"><%=posFAXValue%></div></td>

                <td class="<%=rowStyle%> wdth120px"><div class="wordWrap wdth120px"><%=fixedLineInfo%></div></td>
		
                <td class="<%=rowStyle%> txtAlignCenter">				
				<%if isRemote==false then%>
			<a onclick='submitConf("<%=pathId%>", "<%=(i+j-1)%>", "<%=incomingCallNum%>")' class="linkPointer">
			<img src='images/rename_usb.png' alt=''/></a>
				<%end%>
                </td>
		
                <%
                                    end
                %>
                </tr>
                <%
                                end
                            end
                        end
                    end
                end
				end
                %>
                <br>
            </table>
            </td></tr></table>
        </td></tr></table>
    </td>
</tr>
</form>
</table>
<br/><br/>

<%
   local phyIntf_IP = getIPConnectionInfo()
   if #phyIntf_IP > 0 then
%>
<!-- IP Phone -->
<table border="0" width="100%" cellspacing='0' cellpadding='0'>
<form id="configIP" name="configIP" action="" method="post">
<input type="hidden" id="pathIPId" name="pathIPId" value=""/>
<input type="hidden" id="rowIPIndex" name="rowIPIndex" value=""/>
<input type="hidden" id="rowDelIPIndex" name="rowDelIPIndex" value=""/>
<input type="hidden" id="delIPFlag" name="delIPFlag" value="false"/>
<input type="hidden" id="configFlag" name="configFlag" value="false"/>
<tr>

    <td class="verticalAlign">
        <table cellspacing='0' cellpadding='0' width="100%">        
        <tr>
		<td>
<!-- Begin of showing Telephone Service-->
            <table cellspacing='0' cellpadding='0' width='100%' border="0">
			<tr>
			
			<td class="verticalAlign fontSize padLeft37">
            <table width='100%' class='edittable valueSpace fontSize' cellspacing='0' cellpadding='0' style="line-height:150%;">
                <tr>
				<td colspan='6'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td>
				</tr>
                <tr>
				<td class="tableHeader width65 " align='left'><div class="wordWrap width65"><%=translate([==[IP Phone]==])%></div></td>
				
				<td class="tableHeader width65" align='left' >
				<div class="wordWrap width48"><%=translate([==[Extension ]==])%><%=translate([==[Number]==])%></div></td>		      	
                <td class="tableHeader width70" align='left' >
				<div class="wordWrap width60"><%=translate([==[Associated Number]==])%></div></td>
                <!--<td class="tableHeader width70" align='left' >
				<div class="wordWrap width60"><%=translate([==[Number of ]==])%><br/><%=translate([==[outgoing]==])%></div></td>
				<td class="tableHeader width55" align='left' ><div class="wordWrap width55"><%=translate([==[Priority]==])%></div></td>-->
                <td class="tableHeader width78" align='left' ><div class="wordWrap width78">POS/FAX</div></td>                    
              <!--  <td class="tableHeader wdth120px" align='left' >
				<div class="wordWrap width98"><%=translate([==[Associated with fixed ]==])%><br/><%=translate([==[line]==])%></div></td>
		
                <td class="tableHeader width65" align='left'><%if isRemote==false then%><div class="wordWrap width65"><%=translate([==[Configure]==])%></div><%end%></td>-->
		
				<td class="tableHeader width55"><div class="wordWrap width55"><%=translate([==[Status]==])%></div></td>	
				<td class="tableHeader width55 txtAlignCenter"><div class="wordWrap width55"><%=translate([==[Delete]==])%></div></td>	
                </tr>
                <tr><td colspan='6' class='black'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
                <%
                local rowIPStyle = "oddrow_firewall"
                local rowIPNum = 0
                local phoneIPType, phyIPInterfaceEnable

                for i=1, #phyIntf_IP do
                    rowIPNum = rowIPNum + 1
                    if rowIPNum%2==1 then
                        rowIPStyle = "oddrow_firewall"
                    else
                        rowIPStyle = "evenrow_firewall"
                    end
                    local v = phyIntf_IP[i]
						
                    phoneIPType = v.name
                    if phoneIPType == nil then
                        phoneIPType = v.directory
                    end
                    
                    phyIPInterfaceEnable = v.enable

                    local incomingCallNum, outgoingCallNum, priority = "-", "-", "-"
                    local switchPath = "Device.Services.VoiceService.1.PhyInterface."..tostring(i)
                    
                    local posFAXValue = translate([==[Non]==]) .. "<br/>" .. translate([==[applicabile]==])
                    
                    local fixedLineInfo = translate([==[Non]==]) .. "<br/>" .. translate([==[applicabile]==])
		    local ipStato = translate([==[Unsynchronized]==])
		    if(phyIPInterfaceEnable == "Enabled" ) then	
				ipStato = translate([==[Actived]==])
		    end	

                    local pathIPId = string.sub(v.path, -1)
		    local proInstance = v.proInstance
			
		    -- For CPE_P00106895 - Start
 		    --[[
		    incomingCallNum = getAllInCallNum1(v.path..".Line.1")
		    outgoingCallNum = getAllOutCallNum1(v.path..".Line.1")
		    priority = getAllOutPriority(v.path..".Line.1")		
		    ]]

		    local inOutCall = v.AllInOutCallNum1
		    if inOutCall ~= nil and inOutCall ~= "" then
			local inOutCallArray = split(inOutCall,"##")
			incomingCallNum = inOutCallArray[1]
			outgoingCallNum = inOutCallArray[2]
			priority	= inOutCallArray[3]
		     end
		     -- For CPE_P00106895 - End

                %>
              
                <tr>
				<td class='<%=rowIPStyle%>' colspan='6'>
				<img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br>
				</td>
				</tr>
                <tr>
                <td class="<%=rowIPStyle%> wordWrap fontSize width45"><div class="wordWrap width45"><%=phoneIPType%>
				<input type="hidden" id="phoneIPType<%=rowIPNum%>" name="phoneIPType<%=rowIPNum%>" value="<%=phoneIPType%>" />				  </div></td>
				<td class="<%=rowIPStyle%> wordWrap width65" ><div class="wordWrap width65"><%=v.directory%></div></td>     	

                <td class="<%=rowIPStyle%> wordWrap width70" ><div class="wordWrap width70 fontSize"><%=incomingCallNum%></div></td>
                <!--<td class="<%=rowIPStyle%> wordWrap width70"><div class="wordWrap width70 fontSize"><%=outgoingCallNum%></div></td>

				<td class="<%=rowIPStyle%> wordWrap width55" ><div class="wordWrap width55"><%=priority%></div></td>-->
				
                <td class="<%=rowIPStyle%> wordWrap width78"><div class="wordWrap width78" ><%=posFAXValue%></div></td>
               <!-- <td class="<%=rowIPStyle%> wordWrap wdth120px"><div class="wordWrap wdth120px" ><%=fixedLineInfo%></div></td>
				
                <td class="<%=rowIPStyle%> wordWrap txtAlignCenter width65">
				<%if isRemote==false then%>
				<a onclick='submitIPConf("<%=pathIPId%>", "<%=proInstance%>")' class="linkPointer">
					<img src='images/rename_usb.png' alt=''/>					
				</a>
				<%end%>
                </td>-->
				
			<td class="<%=rowIPStyle%> width55"><div class="wordWrap width55" ><%=ipStato%></div></td>
			<td class="<%=rowIPStyle%> txtAlignCenter width55">
			<a onclick='showIPWarn("<%=pathIPId%>", "<%=proInstance%>")' class="linkPointer ">
				<img src='images/delete_usb.png' alt=''/>
			</a>
			</td>
            </tr>
                    
                </tr>
                <%                   
                end
                %>
                <br>
            </table>
			<div class="fontSize padleft4 padngtop5px"><%=translate([==[Attention: To change the settings of IP phones act from Home Phone installed on your smartphone]==])%></div>
            </td></tr></table>
        </td></tr></table>
    </td>
</tr>
</form>
</table>
<br/><br/>

<%  end %>

		<!--  Vignesh: Fix for CPE_P00104074 -->
			<%
			local ipConf = checkIPConfBtn()
				if(ipConf=="true") then		
			%>
			<table cellspacing='0' cellpadding='0' width="100%">    
				<tr>
				<td width="40">&nbsp;</td><td>	
			<a onclick='invokeIpPage_Check("newIp.lp")'>
				<div class="midarea7-1 mainButton"><%=translate([==[Configure new terminal]==])%></div></a>
			</td></tr></table>
			<% end %>	

</div>
</div>

</div>

<div id="ipDelete" style="display:none">
	<%
	cgilua.lp.include("webparts/confirmIPDelete.lp")
	%>
</div>
<div id="newMax" style="display:none">
<%cgilua.lp.include("webparts/newIpMax.lp")%>
</div>

</div>




<script src="js/antiCSRF.js" type="text/javascript"></script>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
<link rel="stylesheet" href="css/master.css" type="text/css" />
<%
cgilua.lp.include("lp/mbus_util.lp")
cgilua.lp.include("lp/style.lp")
cgilua.lp.include("lp/util.lp")
cgilua.lp.include("lp/device.lp")

local translate = translate
local POST = cgilua.POST
local hostPath = "Hosts.Host"
local host_slen = string.len(hostPath) + 1
local wol_flag = 0

if cgilua.servervariable"REQUEST_METHOD" == "POST" then
  if (POST["wol_id"] ~= nil) and (POST["wol_id"] ~= "0") then
    local modify = {}
    table.insert(modify, { path = hostPath .. "." .. POST["wol_id"], param = {WolEnable = "true"} })
    setMBUS(modify)
    wol_flag = 1

  elseif (POST["remove_id"] ~= nil) and (POST["remove_id"] ~= "0") then
    local reply, error = mbus.modify(
      function()
        local reply1, error1 = mbus.deleteObjects{ path = hostPath .. "." .. POST["remove_id"] }
      end)
    saveall(0, 1)
    cgilua.redirect("save_alert.lp", { u="wakeOnLan.lp" })
    return
  end
end

local deviceList, error = getList(hostPath, nil, "Active", "HostName", "MACAddress", "IPAddress", "Interface", "IPv6Address")

local isRemote = isRemoteAccess()
%>

<script type="text/javascript">
//<![CDATA[
function submitWol(id)
{
  document.getElementById("wol_id").value = id;
  document.getElementById("wol_form").submit();
}

function removeHost(id)
{
  document.getElementById("remove_id").value = id;
  document.getElementById("wol_form").submit();
}

function cancelConfirm()
{
  document.getElementById("wolTable").style.display = "block";
  <% if wol_flag == 1 then %>
  document.getElementById("wolWarning").style.display = "none";
  <% end %>
}
//]]>
</script>
    <script language="JavaScript" type="text/javascript">
	if(window.parent.menu.document.getElementById("tele")!=null && 
		window.parent.menu.document.getElementById("tele") != "undefinded") {
		window.parent.menu.document.getElementById("tele").className="";
	}
	
	if(window.parent.menu.document.getElementById("teleSub")!=null && 
		window.parent.menu.document.getElementById("teleSub") != "undefinded") {
		window.parent.menu.document.getElementById("teleSub").style.display="none";	
	}

	if(window.parent.menu.document.getElementById("usbst")!=null && 
		window.parent.menu.document.getElementById("usbst") != "undefinded") {
		window.parent.menu.document.getElementById("usbst").className="";
	}

	if(window.parent.menu.document.getElementById("media")!=null && 
		window.parent.menu.document.getElementById("media") != "undefinded") {
		window.parent.menu.document.getElementById("media").className="";
	}

	if(window.parent.menu.document.getElementById("ipv6")!=null && 
		window.parent.menu.document.getElementById("ipv6") != "undefinded") {
		window.parent.menu.document.getElementById("ipv6").className="";
		if(window.parent.menu.document.getElementById("ipv6list")) {
			window.parent.menu.document.getElementById("ipv6firewall").className="";
			window.parent.menu.document.getElementById("ipv6list").style.display="none";
		}
	}

	if(window.parent.menu.document.getElementById("port")!=null && 
		window.parent.menu.document.getElementById("port") != "undefinded") {
		window.parent.menu.document.getElementById("port").className="";
	}

	if(window.parent.menu.document.getElementById("dns")!=null && 
		window.parent.menu.document.getElementById("dns") != "undefinded") {
		window.parent.menu.document.getElementById("dns").className="";
	}
	if(window.parent.menu.document.getElementById("firewa")!=null && 
		window.parent.menu.document.getElementById("firewa") != "undefinded") {
		window.parent.menu.document.getElementById("firewa").className="";
	}
	if(window.parent.menu.document.getElementById("urlfi")!=null && 
		window.parent.menu.document.getElementById("urlfi") != "undefinded") {
		window.parent.menu.document.getElementById("urlfi").className="";
	}

	if(window.parent.menu.document.getElementById("waon")!=null && 
		window.parent.menu.document.getElementById("waon") != "undefinded") {
		window.parent.menu.document.getElementById("waon").className="submenuselect1";
	}
	if(window.parent.menu.document.getElementById("stru")!=null && 
		window.parent.menu.document.getElementById("stru") != "undefinded") {
		window.parent.menu.document.getElementById("stru").className="";
	}
  </script>
</head>
<body>
<div class="contentContainer">
	 
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="advance.lp"><%=translate([==[Advanced Settings]==])%></a></li><li>|</li><li><a href="wakeOnLan.lp"><%=translate([==[Wake on LAN]==])%></a></li>
			</ul>
		</div>	
<div class="contentTab" id="content">
		<ol id="tocTab">
			<li><a href="wakeOnLan.lp" class="current">
				<div class="tab">
				<span class="tabIconWakeOnLan"></span>  
				<span class="contTabTxt transform"><%=translate([==[Wake on LAN]==])%></span>
				</div><div class="clrBth"></div></a>
			</li>
		</ol>
</div>
<div class='contentcontainer'>
<div class='contentitem' id="wolTable">
<form method="POST" id="wol_form" action="">
<input type="hidden" name="wol_id" id="wol_id" value="0" />
<input type="hidden" name="remove_id" id="remove_id" value="0" />
<table cellspacing='0' cellpadding='0' width='100%' class="fontSize">
  <tr>
    <td class="midarea4">
      <%=translate([==[The feature allows you to send the command to remotely switch Ethernet devices designed to Wake on LAN. Warning: are activated a maximum of 8 devices for each Ethernet port]==])%>
    </td>
  </tr>
  <tr><td>&nbsp;</td></tr>
  <tr><td>
<% 
  writeBlockRowNoTitle()
  local ipv6Enable = getIPv6("Device.IP")
  if ipv6Enable == "true" then 
	writeTableContHeader(7, translate([==[HOST Name]==]), translate([==[MAC Address]==]), translate([==[IP Address]==]), translate([==[IPv6 Address]==]), translate([==[Ethernet Port]==]), "", "")
  else
	writeTableContHeader(6, translate([==[HOST Name]==]), translate([==[MAC Address]==]), translate([==[IP Address]==]), translate([==[Ethernet Port]==]), "", "")
  end
	
  local rowStyle = "oddrow"
  local count = 0
  for i,v in pairs(deviceList) do
    if v["Active"] == "false" and (v["Interface"] == "ETH.Phys.1" or v["Interface"] == "ETH.Phys.2" or v["Interface"] == "ETH.Phys.3" or v["Interface"] == "ETH.Phys.4") then
      local pathId = string.sub(v.path, host_slen + 1)
      local intf = "Ethernet " .. string.sub(v["Interface"], -1)
      count = count + 1
      if count%2==1 then
        rowStyle = "oddrow"
      else
        rowStyle = "evenrow"
      end

	if count <= 8 then
	 if isRemote==false then
		if ipv6Enable == "true" then 
			writeTableBlockRow(7, rowStyle, v["HostName"], v["MACAddress"], v["IPAddress"], v["IPv6Address"], intf, [[<a onclick="submitWol(]] .. pathId .. [[)" href="#"><div class="midarea6-1 mainButton">]] .. translate([==[Wake on LAN]==]) .. [[</div></a>]], [[<a onclick="removeHost(]] .. pathId .. [[)"><div class="midarea_WakeOnLan mainButton mainButton">]] .. translate([==[Remove]==]) .. [[</div></a>]])
		else
			writeTableBlockRow(6, rowStyle, v["HostName"], v["MACAddress"], v["IPAddress"], intf, [[<a onclick="submitWol(]] .. pathId .. [[)" href="#"><div class="midarea6-1 mainButton">]] .. translate([==[Wake on LAN]==]) .. [[</div></a>]], [[<a onclick="removeHost(]] .. pathId .. [[)"><div class="midarea_WakeOnLan mainButton mainButton">]] .. translate([==[Remove]==]) .. [[</div></a>]])
		end
	else
		if ipv6Enable == "true" then 
			writeTableBlockRow(7, rowStyle, v["HostName"], v["MACAddress"], v["IPAddress"], v["IPv6Address"], intf)
		else
			writeTableBlockRow(6, rowStyle, v["HostName"], v["MACAddress"], v["IPAddress"], intf)
		end
     end
    end
    end
  end
  endBlock()
%>
</td></tr></table>

<%
endPage()
%>
</form>
</div>
</div>
<script src="js/antiCSRF.js" type="text/javascript"></script>

<% if wol_flag == 1 then %>
<div id="wolWarning" style="display:none" class="contentitem">
  <table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Warning]==])%></td></tr>
              <tr><td class="errorDesc"><p><%=translate([==[Power Control sent successfully. Warning: Wake on LAN does not provide a confirmation of receipt of the command from the remote device. In case of power failure, verify the correctness of the MAC address and the correct configuration / connection of the remote device.]==])%></p><br/>
        </td></tr></table>
        </td></tr>
		<tr><td>
         <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
          <tr><td class="width340">&nbsp;</td>
            <td class="verticalAlign">
				<a style="color:black" onclick="cancelConfirm()">
				<div class="midarea6-1 mainButton"><%=translate([==[Continue]==])%></div></a>
				</td>
			</tr>
		</table>
  </td></tr></table>
</div>
<script type="text/javascript">
document.getElementById("wolTable").style.display="none";
document.getElementById("wolWarning").style.display="";
</script>
<% end %>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Modem Telecom Italia</title>
	<link rel="stylesheet" href="css/master.css" type="text/css" />
         <script language="JavaScript" type="text/javascript">
    if(window.parent.menu.document.getElementById("stcon")!=null && 
		window.parent.menu.document.getElementById("stcon") != "undefinded") {
		window.parent.menu.document.getElementById("stcon").className="submenuselect";
	}
	
	if(window.parent.menu.document.getElementById("serte")!=null && 
		window.parent.menu.document.getElementById("serte") != "undefinded") {
		window.parent.menu.document.getElementById("serte").className="";
	}

	if(window.parent.menu.document.getElementById("lanst")!=null && 
		window.parent.menu.document.getElementById("lanst") != "undefinded") {
		window.parent.menu.document.getElementById("lanst").className="";
	}

	if(window.parent.menu.document.getElementById("wifist")!=null && 
		window.parent.menu.document.getElementById("wifist") != "undefinded") {
		window.parent.menu.document.getElementById("wifi2li").style.display="none";
		window.parent.menu.document.getElementById("wifi2li").style.display="none";
		window.parent.menu.document.getElementById("wifi5li").style.display="none";
		window.parent.menu.document.getElementById("wifist").className="";
		window.parent.menu.document.getElementById("wifi2").className="";
		window.parent.menu.document.getElementById("wifi5").className="";
		window.parent.menu.document.getElementById("wifi_guest").className="";
	}

	if(window.parent.menu.document.getElementById("asst")!=null && 
		window.parent.menu.document.getElementById("asst") != "undefinded") {
		window.parent.menu.document.getElementById("asst").className="";
	}

	if(window.parent.menu.document.getElementById("stat")!=null && 
		window.parent.menu.document.getElementById("stat") != "undefinded") {
		window.parent.menu.document.getElementById("stat").className="";
	}
	if(window.parent.menu.document.getElementById("loac")!=null && 
		window.parent.menu.document.getElementById("loac") != "undefinded") {
		window.parent.menu.document.getElementById("loac").className="";
	}



  </script>
</head>
<% cgilua.lp.include("lp/language.lp") %>
<% cgilua.lp.include("lp/common.lp") %>
<% cgilua.lp.include("lp/device.lp") %>
<% cgilua.lp.include("lp/ppp.lp") %>
<% cgilua.lp.include("lp/dsl.lp") %>
<% cgilua.lp.include("lp/connectionService.lp") %>
<%
local translate = translate

if cgilua.servervariable"REQUEST_METHOD" == "POST" then
	local info2 = getPPP("PPP.Intf.2")
	local PPP_Device = getDevice_PPP()
	if PPP_Device~=nil and info2~=nil then
		local modify ={}
		if PPP_Device.connectionStatus ~= "Connected" then

			setDataPPP(info2.ppp_path, "enabled", "true")
			sleep(5)
			saveall(15, 1)
			--If the ppp is still not active, it should be redirected to the helpLinkDown page.
			if isDataPPPNotConnected() then
				cgilua.print("<body><script language='JavaScript'>window.parent.location.href='noconnect.html';</script></body></html>")
				return
			end
		else

			setDataPPP(info2.ppp_path, "disabled", "false")
			sleep(2)
			saveall(15, 1)
		end
	end

end


function get_iptv_active()
 local result={}
 local active, error =  mbus.getParameters{path = "TI_STORE.TiUserIntf", param = "IPTV_Active"}
 return active["TI_STORE.TiUserIntf"][1].param["IPTV_Active"] 
end


-- get handler
local TI_info = getTIInfo()
local PPP_Device = getDevice_PPP()
local TI_Device = getTIInfo_Device()
local info2 = getPPP("PPP.Intf.2")
local dsl = getDSLInfo()
local iptv_active = get_iptv_active()
local board = getBoardInfo()
local wanEthIntf = getLanStat("ethif5")

--WAN ETH Connection 
local wanConnType, wanConnTitle = getWANConnectionType()	

--ADSL Status
local dslState, dslStateColor = translateDSLState(dsl.dsl_status)

--ADSL Mode
local dslModulationType = translateDSLMode(dsl.dsl_ModulationType)

--Management PPP of Telecom_Italia
local pppManagementState = getPPPManagementState()
local pppManagementStateColor = "tdRed"
if pppManagementState=="Connected" then
	pppManagementStateColor = "tdGreen"
	pppManagementState=translate([==[Connected]==])
elseif pppManagementState=="Connecting" then
	pppManagementStateColor = "tdOrange"
	pppManagementState=translate([==[Connecting]==])
else
	pppManagementState=translate([==[Disconnected]==])
end

--Data PPP of User session
local pppPPPStatus = translate([==[Not active]==])
local pppPPPStatusColor = "tdRed"
local connectType = "Automatica"
local connProtocol = "PPPoE"
if info2~=nil then
	pppPPPStatus, pppPPPStatusColor, connectType = translateDataPPPState(info2.ppp_status, info2.connectionTrigger, pppPPPStatus, pppPPPStatusColor, connectType)
end

--Get the wanEtherIntf state color
local wanStatusColor = "tdRed"
if wanEthIntf.state=="Active" then
    wanStatusColor = "tdGreen"
end
%>
<body>

<div class="contentContainer">
	 
		<div class="breadCrumbContainer">
			<ul class="brdCrumb">
				<li><a href="standard.lp">Impostazioni Base</a></li><li>|</li><li><a href="wanStatus.lp"><%=translate([==[Connection Status]==])%></a></li>
			</ul>
		</div>	

		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a class="current">
		<div class="tab">
			<span class="tabIcon_stcon"></span>  
			<span class="contTabTxt transform"><%=translate([==[Connection Status]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
			</ol>
		</div>
		
<div class='contentcontainer'>	
<div class='contentitem'> 
<table cellspacing='0' cellpadding='0' class="fontSize">
<tr>
<td>
<table  cellspacing='0' cellpadding='0' width='100%' >
	 <%if isDefaultConf() then%> 
			<br><!-- Begin of warning events-->
			<table cellspacing='0' cellpadding='0' width='100%'>
			<tr><td width="40" valign="top">&nbsp;</td><td class='midareainfo'>Info</td></tr>
			<tr>
			<td width='40' class="verticalAlign"></td>
			<td class="verticalAlign"> 
			<table width='100%' class='midarea4' cellspacing='0' cellpadding='0' style="line-height:150%;padding-left:0px;"> 
			<tr><td><%=translate([==[Attention: Research and WAN interface configuration in progress]==])%>.</td></tr> 
			</table> 
			</td></tr></table>
			<!-- <tr><td class="midarea3" style="font-weight:bold"><%=translate([==[Attention: Research and WAN interface configuration in progress]==])%>.</td></tr> -->
			 <!-- End of warning events-->
<%else%> 
			<!-- Begin of DeviceInfo-->
	<tr>
	<td class="verticalAlign"> <table cellspacing='0' cellpadding='0' class="martop5">
	<tr>
	<td class="midarea2 tableTitle">
		        <%=translate([==[Identification data modem]==])%></td></tr></table></td>
				</tr>
<tr><td>
			<table width='100%'  cellspacing='0' cellpadding='0' class='servizitable fontSize' style="line-height:150%;"> 
			
			 <tr><td class="sectionArea-1 padleft40"><%=translate([==[Model]==])%>:</td><td colspan='3' class="sectionArea-2"><%=board.pname%></td></tr> 
			 <tr><td class="sectionArea-1 padleft40"><%=translate([==[Seriale Modem]==])%>:</td><td colspan='3' class="sectionArea-2"><%=board.sn%></td></tr>		
			 <tr><td class="sectionArea-1 padleft40"><%=translate([==[Hardware Version]==])%>:</td><td colspan='3' class="sectionArea-2"><%=board.bversion%></td></tr> 
			 <tr>
			 <td class="sectionArea-1 padleft40"><%=translate([==[Software Version]==])%>:</td><td colspan='3' class="sectionArea-2"><%=board.sversion%></td></tr> 
			</table> </td></tr>
			</table> <!-- End of DeviceInfo-->

		<!-- Begin of WAN Connection-->
		<table  cellspacing='0' cellpadding='0' width='100%' class="fontSize padtop10"><tr>
		<td class="verticalAlign"> 
			<table cellspacing='0' cellpadding='0'>
 <tr>
	<td class="midarea2 tableTitle"><%=wanConnTitle%></td></tr>
	</table>
			<table width='100%' cellspacing='0' class='servizitable fontSize' cellpadding='0' style="line-height:150%;"> 
					<%if wanConnType=="ETH" then%><!-- WAN Ethernet -->
			 <tr><td class="sectionArea-1 padleft40"><%=translate([==[Interface]==])%> WAN Ethernet:</td><td colspan='3' class="sectionArea-2">WAN Ethernet</td></tr>
			<tr ><td class="sectionArea-1 padleft40"><%=translate([==[Status]==])%>:</td><td colspan='3' class="<%=wanStatusColor%>"><%=translate(wanEthIntf.state)%></td></tr>	
		<%else%><!-- ADSL & VDSL -->
			<tr><td class="sectionArea-1 padleft40"><%=translate([==[DSL Driver Version]==])%>:</td>
			<td colspan='3'   class="sectionArea-2"><%=dsl.dsl_version%></td>
			</tr>
			<tr>
			<td class="sectionArea-1 padleft40"><%=translate([==[Status]==])%>:</td>
			<td colspan='3' class="<%=dslStateColor%>"><%=dslState%></td>
			</tr>
			<tr><td class="sectionArea-1 padleft40"><%=translate([==[Transmission system]==])%>:</td>
			<td colspan='3' class="sectionArea-2 verticalAlign" ><%=dslModulationType%></td>
			</tr>
			<tr><td class="sectionArea-1 padleft40"><%=translate([==[Mode of transmission]==])%>:</td>
			<td colspan='3'   class="sectionArea-2 verticalAlign"><%=dsl.latency_type%></td></tr>  
			<% if wanConnType=="VDSL" then%>
				<tr>
				<td class="sectionArea-1 padleft40"><%=translate([==[Profile]==])%>:</td><td colspan='3'  class="sectionArea-2"><%=dsl.dsl_profile%></td></tr>
			<%end%>

			<% if dsl.dsl_enable=="1" then%>
			<tr><td class="sectionArea-1 padleft40">Encapsulation Type:</td>
				<td colspan='3'  class="sectionArea-2"><% if wanConnType=="VDSL" then cgilua.print("PTM") else cgilua.print("ATM") end%></td></tr> 
			<%end%>
			<tr>
			<td class="sectionArea-1 padleft40">Impulse Noise Protection (INP):</td><td colspan='3'  class="sectionArea-2"><%=dsl.up_impulsemargin%></td></tr> 
			<tr>
			<td class="sectionArea-1 padleft40"><%=translate([==[Speed in transmission]==])%>(Kbps):</td>
			<td colspan='3'  class="sectionArea-2"><%=dsl.upstream%></td></tr> 
			<tr>
			<td class="sectionArea-1 padleft40"><%=translate([==[Receiving speeds]==])%>(Kbps):</td>
			<td colspan='3'  class="sectionArea-2"><%=dsl.downstream%></td></tr>
			<% if wanConnType~="VDSL" then%>
			<% if dsl.atmStatus=="Connected" then%>
			<tr ><td class="sectionArea-1 padleft40">VPI/VCI:</td><td colspan='3'  class="sectionArea-2"><%=dsl.pvc%></td></tr>
			<%end%>
			<% if dsl.atmStatus_1=="Connected" and iptv_active=="true" then %>
			<tr ><td class="sectionArea-1 padleft40">VPI/VCI:</td><td colspan='3' class="sectionArea-2"><%=dsl.pvc_1%></td></tr>
			<%end%>
			<%end%>
		<%end%>
			</table> 
			</td></tr></table> <!-- End of WAN Connection-->
			
			<!-- Begin of Internet connection-->
			<table  cellspacing='0' cellpadding='0' width='100%' class="fontSize padtop10"><tr>
			<td style='vertical-align:top'> 
			<table cellspacing='0' cellpadding='0'>
<tr>
	<td class="midarea2 tableTitle">
			<%=translate([==[Internet Link]==])%></td></tr></table> 
			<table width='100%' cellspacing='0' cellpadding='0' style="line-height:150%;" class='servizitable fontSize'> 
			
			<tr><td class="sectionArea-1 padleft40"><%=translate([==[rate profile]==])%>:</td><td colspan='3' class="sectionArea-2"><%=TI_info.profile%></td></tr>
			<tr><td class="sectionArea-1 padleft40"><%=translate([==[Mode]==])%>:</td><td colspan='3' class="sectionArea-2"><%=TI_info.connectMode%></td></tr> 		
			
<%
if info2~=nil then
if (TI_Device.lanOption == "res-rt-napt" or TI_Device.lanOption == "biz-rt-napt-ena" or TI_Device.lanOption == "res-rt-napt-ipv6" or TI_Device.lanOption == "biz-rt-napt-ipv6") and info2.name== "User session" then %>
			<tr><td class="sectionArea-1 padleft40"><%=translate([==[Connection protocol]==])%>:</td>
			<td colspan='3' class="sectionArea-2"><%=connProtocol%></td></tr>
			<tr><td class="sectionArea-1 padleft40"><%=translate([==[Connection Mode]==])%>:</td>
			<td colspan='3' class="sectionArea-2"><%=connectType%></td></tr>			
			<tr><td class="sectionArea-1 padleft40"><%=translate([==[Public IP address from your modem connection]==])%>:</td>
			<td colspan='3' class="sectionArea-2"><%=info2.ipaddr%></td></tr>
<%end
end
%>			
			</table> 
			</td></tr></table><!-- End of Internet connection-->
 			
			<!-- Begin of Management Connection-->
			<table cellspacing='0' cellpadding='0' width='100%' class="fontSize padtop10">
			<tr><td class="verticalAlign"> 
			<table cellspacing='0' cellpadding='0' >
<tr>
	<td class="midarea2 tableTitle">Telecom Italia</td></tr></table>
			<table width='100%' cellspacing='0' cellpadding='0' style="line-height:150%;"  class='servizitable fontSize'> 
						<tr><td class="sectionArea-1 padleft40"><%=translate([==[telemanagement]==])%>:</td>
						<td  class="<%=pppManagementStateColor%>" colspan='3' ><% =pppManagementState %></td></tr>
			</table> 
			</td></tr></table> <!-- End of Management Connection-->

			<!-- Begin of Connection Details-->
			<form method="POST" id="modemState" name="modemState" action="">
			<table  cellspacing='0' cellpadding='0' width='100%' class="fontSize padtop10">
			<tr>
			<td class="verticalAlign"> 
			<table cellspacing='0' cellpadding='0'>
<tr>
	<td class="midarea2 tableTitle"><%=translate([==[Connection Details]==])%></td></tr></table>
			<table width='100%' cellspacing='0' cellpadding='0' style="line-height:150%;" class='servizitable fontSize'> 
			
<%if PPP_Device~=nil then
	
	if (((TI_Device.lanOption == "res-rt-napt" or TI_Device.lanOption == "res-rt-napt-ipv6") and PPP_Device.connectionTrigger == "X_TELECOMITALIA_IT_Conditional") or (TI_Device.lanOption == "biz-rt-napt-ena" or TI_Device.lanOption == "biz-rt-napt-ipv6")and PPP_Device.connectionTrigger == "AlwaysOn") and PPP_Device.name == "User session" then
	
		-- if PPP_Device.enable == "true" then
		%>
		
			<tr><td class="sectionArea-1 padleft40 padtop5"><%=translate([==[Automatic connection by modem]==])%>:</td>
			
			<%if PPP_Device.connectionStatus == "Unconfigured" then%>
				<td colspan='2' class="tdRed padtop5"><%=translate([==[Unconfigured]==])%></td>
			<%elseif PPP_Device.connectionStatus == "Connecting" then%>
				<td colspan='2' class="tdOrange padtop5"><%=translate([==[Connecting]==])%></td>
			<%elseif PPP_Device.connectionStatus == "Authenticating" then%>
				<td colspan='2' class="tdRed padtop5"><%=translate([==[Authenticating]==])%></td>
			<%elseif PPP_Device.connectionStatus == "Connected" then%>
				<td colspan='2' class="tdGreen padtop5"><%=translate([==[Connected]==])%></td>
			<%elseif PPP_Device.connectionStatus == "PendingDisconnect" or PPP_Device.connectionStatus == "Disconnecting" then%>
				<td colspan='2' class="tdRed padtop5"><%=translate([==[Disconnecting]==])%></td>
			<%else%>
				<td colspan='2' class="tdRed padtop5"><%=translate([==[Disconnected]==])%></td>
			<%end%>
			<td class="verticalAlign">
			
			<%if (TI_Device.lanOption == "res-rt-napt" or TI_Device.lanOption == "res-rt-napt-ipv6") and PPP_Device.connectionTrigger == "X_TELECOMITALIA_IT_Conditional" then
				if isRemoteAccess()==false then
					if PPP_Device.connectionStatus == "Connected" then%>
						<a href ="javascript:submitStatus()"><div class="midarea6-1 mainButton" name="thbA4"><%=translate([==[Disable]==])%></div></a>
					<%else%>						
						<a href ="javascript:submitStatus()"><div class="midarea6-1 mainButton" name="thbA5"><%=translate([==[Active]==])%></div></a>
					<%end
				end
			end%>
		</tr>
		<%--end 
	end
end
			
local numberOfEntries = getAllDNSCount()%>

		<tr><td  class="sectionArea-1 padleft40"><%=translate([==[Primary DNS default]==])%>:</td>
		<td colspan='3' class="sectionArea-2"><%=getAllDNS(1)%></td></tr> 
		<tr><td  class="sectionArea-1 padleft40"><%=translate([==[Secondary DNS default]==])%>:</td>
		<td colspan='3' class="sectionArea-2"><%=getAllDNS(2)%></td></tr>
		
		<tr><td  class="sectionArea-1 padleft40"><%=translate([==[Others DNS]==])%>:</td>
		<td colspan='3' class="sectionArea-2"><table>
	<%if tonumber(numberOfEntries) >= 2 then
		local otherDNS_value = ""%>
		<%for i=3, tonumber(numberOfEntries) do
			otherDNS_value = getAllDNS(i)
			if otherDNS_value ~= nil and otherDNS_value ~= "" then%>			
				<tr><td><%=otherDNS_value%></td></tr>
			<%end
		end%>
	<%end%>
	<%if tonumber(numberOfEntries) == 0 then%>
			<%otherDNS_value = getAllDNS(98)
			if otherDNS_value ~= nil and otherDNS_value ~= "" then%>
				<tr><td><%=otherDNS_value%></td></tr>
			<%end%>
			<%otherDNS_value = getAllDNS(99)
			if otherDNS_value ~= nil and otherDNS_value ~= "" then%>
				<tr><td><%=otherDNS_value%></td></tr>
			<%end%>
		</td></tr></table>
	<%end%>
		
		</table> 
		</td></tr></table></form> <!-- End of Connection Details-->

<%end%>
		</td>
</tr>
</table>
</div> 
</div>	
</div>		
<script language="javascript">
function submitStatus() {
	document.modemState.submit();
}
</script>		

<script src="js/antiCSRF.js"></script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Modem Telecom Italia</title>
<link rel="stylesheet" href="css/master.css" type="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<% cgilua.lp.include("lp/wlan.lp") %>
<% cgilua.lp.include("lp/util.lp") %>
<% cgilua.lp.include("lp/mbus_util.lp") %>
<% cgilua.lp.include("lp/style.lp") %>
<%
local translate = translate
local QUERY = cgilua.QUERY
local POST = cgilua.POST

local sectionName = translate([==[Basic Settings]==])
local tprint = require("tableprint")
local print=cgilua.print

local wlanPath = "WLAN.Intf.wlif1"  
local name = "2.4 GHz"
local intfPath = "Device.WiFi.Radio.1"
local titlePic = "iwla24xl.gif"
local page = "wifi2"
if QUERY["id"]=="2" then
  wlanPath = "WLAN.Intf.wle_radio1_ssid0"  
  name = "5 GHz"
  intfPath = "Device.WiFi.Radio.2"
  titlePic = "iwla50xl.gif"
  page = "wifi5"
else
  QUERY["id"] = "1"
end
local aclMacPath = wlanPath .. ".ACL.MAC"
local result=getWlanMain(wlanPath)

local reply, error = mbus.getParameters{ path = intfPath, param = "Enable", datamodel = "second"}			
local wlanState = reply[intfPath][1].param["Enable"]
local wlanChannel = result.channel
local channelMode = result.channelmode
local wpaVersion = string.gsub(result.wpaversion,"&","-")
local wepKeyEncryption = result.wep
local wpaKeyEncryption = result.wpa

local wpaEncryption = result.encryption
if wpaVersion=="WPA" then
  wpaEncryption = "TKIP"
end
local pos = string.find(wpaEncryption,"&")
if pos~=nil then
  wpaEncryption = string.gsub(wpaEncryption,"&","-")
end

local wepKeyStyle="none"
local wpaKeyStyle="none"
local keyEncryptionStyle="none"
local wpsRegistrationStyle = "none"
local secMode = "disable"
if result.secmode=="WEP" then 
  secMode = "WEP 128 bit"
  wepKeyStyle = "block"
  keyEncryptionStyle=""
elseif result.secmode=="WPA-PSK" then
  secMode = result.secmode .. " " .. wpaEncryption .. " 256 bit"
  wpaKeyStyle = "block"
  keyEncryptionStyle=""
  wpsRegistrationStyle = ""
end

local ssid = result.ssid
local anyssid = result.anyssid
local adminState = result.adminState
local aclControl = result.control
local pageDisplay = false
local aclList, error
local numberOfMAC=0
if aclControl=="unlock" then
    aclList, error = mbus.getParameters{ path=aclMacPath, param={"MACAddress", "Permission"}, flags="KEYPATH" }
    numberOfMAC =  #aclList[aclMacPath]
end

if cgilua.servervariable"REQUEST_METHOD" == "POST" then


for i=1, tonumber(POST["changeNum"]) do
    wlanPath = POST["wlanPath"]
	if tonumber(POST["changeNum"])>1 then
	    sleep(2)
	    if( i == 2 ) then
			--incase i value becomes 2 , then avoid accessing WLAN.Intf.2
			i = 3 
		end		
	    if(i==3)  then
		wlanPath = "WLAN.Intf.wle_radio1_ssid0" 
	    elseif(i==1) then
	        wlanPath = "WLAN.Intf.wlif1"
	    elseif(i==4) then 
	        wlanPath = "WLAN.Intf.wle_radio1_ssid1"
	    end
		aclMacPath = wlanPath .. ".ACL.MAC"
	end
	local deviceID
	local intfstr = string.sub(tostring(wlanPath), 11)
	if intfstr == "wlif1" then
		deviceID = 1
	elseif( intfstr == "wl_ssid1_local0"  ) then
		deviceID = 2
	elseif( intfstr == "wle_radio1_ssid0"  ) then
		deviceID = 2
	elseif( intfstr == "wle_radio1_ssid1"  ) then
		deviceID = 4
	end

   	local modify ={}
	if POST["wpsSubmitFlag"]~="0" then
		local wps_reg_path = wlanPath..".WPS.REGISTRAR"
		if POST["wpsSubmitFlag"]=="1" and POST["pin"] ~= "" then
			table.insert(modify, {path = wps_reg_path, param = {Pin = POST["pin"], Event = "start"}, flags="KEYPATH"})
			setMBUS(modify)
		elseif POST["wpsSubmitFlag"]=="2" then
			table.insert(modify, {path = wps_reg_path, param = {Pin = "0", Event = "start"}, flags="KEYPATH"})
			setMBUS(modify)
		end
        saveall(0, 1)
        cgilua.redirect("wlanStatus.lp", { wifiPage = page })
		return
	end

	
	if POST["aclSubmitFlag"]=="1" then
		
		if aclControl=="disabled" then
			table.insert(modify, {path=wlanPath..".ACL", param= {Control="unlock"}, flags="KEYPATH"})
			
			setMBUS(modify)
			modify ={}
			aclList, error = mbus.getParameters{ path=aclMacPath, param={"MACAddress", "Permission"} ,flags="KEYPATH"}
			
			numberOfMAC =  #aclList[aclMacPath]
		end

		if numberOfMAC >= 50 then
			cgilua.redirect("resultKO.lp?pageDisplay=enough")
			return
		else
			local isAclMacExistFlag, permission = isAclMacExist(aclMacPath, POST["aclMAC"])
			if isAclMacExistFlag == true then
				if permission ~= POST["aclOption"] then
					local resultACL = macRestrictionUpdate(aclMacPath, POST["aclOption"], POST["aclMAC"])
					cgilua.redirect("wlanStatus.lp", { wifiPage = page })
					return
				else
					cgilua.redirect("resultKO.lp?pageDisplay=exist")
	                                return
				end
			end
		end
    
		local aclAddErr = macRestrictionCreate(aclMacPath, POST["aclOption"], POST["aclMAC"])
		if aclAddErr ~= false then
			cgilua.redirect("resultKO.lp")
			return
		else
            saveall(0, 1)
            cgilua.redirect("wlanStatus.lp", { wifiPage = page })
			return
		end
    	end

	if POST["wlanState"] == "true" then
		if POST["wlanState"] ~= wlanState then	
            table.insert(modify, {path = "Device.WiFi.Radio."..deviceID, param = {Enable="true"}, datamodel = "second"})
			setMBUS_IGD(modify)
				saveall(0, 1)
				cgilua.redirect("wlanStatus.lp", { wifiPage = page })
				return
		end

		if POST["wlanChannel"] ~= "Auto" then
			if (channelMode  ~= "Auto" and POST["wlanChannel"]~=wlanChannel) or (channelMode  == "Auto") then
				modify ={}
				--Set ChannelMode just to trigger notification of ChannelMode node
				table.insert(modify, {path=wlanPath, param= {ChannelMode="Manual"}, flags="KEYPATH"})
				table.insert(modify, {path=wlanPath, param= {Channel=POST["wlanChannel"]}, flags="KEYPATH"})
				setMBUS(modify)				
			end
		else
			if channelMode  ~= "Auto" then
				modify ={}					
				table.insert(modify, {path=wlanPath, param= {ChannelMode="Auto"}, flags="KEYPATH"})
				setMBUS(modify)					
			end
		end
			
		--if POST["channelWidth"] ~= nil and POST["channelWidth"] ~= result.channelwidth and (POST["secMode"] == "disable" or POST["secMode"] == "WPA-PSK AES 256 bit") then
		if POST["channelWidth"] ~= nil and POST["channelWidth"] ~= result.channelwidth then
			modify ={}
			table.insert(modify, {path=wlanPath, param= {ChannelWidth=POST["channelWidth"]}, flags="KEYPATH"})
			setMBUS(modify)
		end
   
		if POST["secMode"]~=secMode or POST["wepKey"]~=wepKeyEncryption or POST["wpaKey"]~=wpaKeyEncryption then
			modify ={}
			if POST["secMode"]=="disable" then
				local wpaVersionEncrypt = "WPA"
				table.insert(modify, {path=wlanPath..".Security", param= {Mode="disabled"}, flags="KEYPATH"})
				table.insert(modify, {path=wlanPath..".Security.WPAPSK", param={WPAVersion=wpaVersionEncrypt}, flags="KEYPATH"})
			elseif POST["secMode"]=="WEP 128 bit" then
				local wpaVersionEncrypt = "WPA"
				table.insert(modify, {path=wlanPath..".Security", param= {Mode="WEP"}, flags="KEYPATH"})
				table.insert(modify, {path=wlanPath..".Security.WEP", param= {WEPKey=POST["wepKey"]}, flags="KEYPATH"})
				table.insert(modify, {path=wlanPath..".Security.WPAPSK", param={WPAVersion=wpaVersionEncrypt}, flags="KEYPATH"})
			else					
				table.insert(modify, {path=wlanPath..".Security", param= {Mode="WPA-PSK"}, flags="KEYPATH"})
				table.insert(modify, {path=wlanPath..".Security.WPAPSK", param= {KeyPassPhrase=POST["wpaKey"]}, flags="KEYPATH"})
				local wpaVersionEncrypt = "WPA&WPA2"

				if POST["secMode"]=="WPA-PSK TKIP 256 bit" then
					wpaVersionEncrypt = "WPA"
				elseif POST["secMode"]=="WPA-PSK AES 256 bit" then
					wpaVersionEncrypt = "WPA2"
				end

				table.insert(modify, {path=wlanPath..".Security.WPAPSK", param={WPAVersion=wpaVersionEncrypt}, flags="KEYPATH"})
			end
			setMBUS(modify)				
		end
		
		if POST["aclControl"]~=aclControl then 
			modify ={}	
			local aclPath = wlanPath..".ACL"
			table.insert(modify, {path=aclPath, param= {Control=POST["aclControl"]}, flags="KEYPATH"})
			setMBUS(modify)
			if POST["aclControl"]=="disabled" then
				macRestrictionDeleteAll(aclMacPath)
			end
		end
		
		
		
		if POST["aclControl"]=="unlock" then
			for i=1,tonumber(POST["macNum"]) do
				local resultACL = false
				if POST["delMac"..i]=="ON" then
					resultACL = macRestrictionDelete(aclMacPath, POST["mac"..i])
				else
					local isAclMacExistFlag, permission = isAclMacExist(aclMacPath, POST["mac"..i])
					if isAclMacExistFlag == true and permission ~= POST["permission"..i] then
						resultACL = macRestrictionUpdate(aclMacPath, POST["permission"..i], POST["mac"..i])
					end
				end
  
				if resultACL == true then
					cgilua.redirect("resultKO.lp")
					return
				end
			end
		end

		if POST["anySSID"]~=anyssid then				
			modify ={}					
			table.insert(modify, {path=wlanPath, param= {AnySSID=POST["anySSID"]}, flags="KEYPATH"})					
			setMBUS(modify)						
		end

		if POST["ssid"] ~= ssid and POST["ssid"] ~= "" then
			modify = {}
			table.insert(modify, {path = wlanPath, param = {SSID = POST["ssid"]}, flags="KEYPATH"})
			
			setMBUS(modify)
		end

	else
		if POST["wlanState"] ~= wlanState then	
		--	table.insert(modify, {path = wlanPath, param = {Enable="false"}, flags = "KEYPATH"})
		--	setMBUS_IGD(modify)
			modify = {}
			table.insert(modify, {path = "Device.WiFi.Radio."..deviceID, param = {Enable="false"}, datamodel = "second"})
		        setMBUS_IGD(modify)
		                        
		end
	end
end
    saveall(0, 1)
    cgilua.redirect("wlanStatus.lp", { wifiPage = page })
	return

end

local errMsgInvalidWEPKey = "<p>" .. translate([==[Invalid WEP key: use only permitted characters (a-z, A-Z, 0-9) and comply with the length]==]).. "</p>"
local errMsgInvalidWPAKey = "<p>" .. translate([==[Encryption key is invalid: verify that it contains at least one character of each of the following three sets:]==]).." [a-z, A - Z], [0 - 9], [!@#$%^&*()_+-={},./<>?`~[]|;:&#92;], "..translate([==[that does not contain characters or symbols not allowed and respects the minimum and maximum length allowed (12 to 32 characters)]==]).. "</p>"
local aclEmptyMsg = "<p>" .. translate([==[Warning: You must enter at least one valid MAC address]==]) .. "</p>"

local errMsgInvalidMAC = "<p>" .. translate([==[Not valid MAC: only use hexadecimal characters (0-9, a-f) and respect the length of 12 characters]==]).. "</p>"
local errMsgMACExist = "<p>" .. translate([==[Can not add MAC Address which already exists in Authorized Devices list.]==]).. "</p>"
local errMsgMACEnough= "<p>" .. translate([==[Can not add MAC Address. Maximum size of Authorized Devices is 50.]==]).. "</p>"

local errMsgWrongPIN = "<p>" .. translate([==[Wrong PIN! The PIN must have 8 digits]==]).. "</p>"
local errMsgInvalidPIN = "<p>" .. translate([==[Invalid PIN! Enter a different PIN]==]).. "</p>"

local confMsgwifi2 = "<p>" .. translate([==[Warning: After turning off the Wi-Fi interface 2.4 GHz, Wi-Fi connected devices will be disconnected and you can not connect to the modem wirelessly.]==]) .. "</p>"
local confMsgwifi5 = "<p>" .. translate([==[Warning: After turning off the Wi-Fi interface 5 GHz, the Wi-Fi devices connected will be disconnected and you can not connect to the modem wirelessly.]==]) .. "</p>"

local errMsgConfirmChange = "<p>" .. translate([==[Warning: you also want to apply the change to the Wi-Fi 5GHz.]==]) .. "</p>"
if QUERY["id"]=="2" then
	errMsgConfirmChange = "<p>" .. translate([==[Warning: you also want to apply the change to the Wi-Fi 2.4GHz.]==]) .. "</p>"
end
local errMsgLowEncrKey = "<p>" ..translate( [==[Warning: the level of password security is not adequate.]==] ).."</p>"
local warningMsgMediumKeyStrength = "<p>"..translate( [==[Warning: the level of security of the password may not be appropriate]==] ).."</p>"


local low = translate([==[Low]==])
local medium =  translate([==[Medium]==])
local high = translate([==[High]==])

%>

<script language="JavaScript" type="text/javascript">
//<![CDATA[
function changeSecMode(secMode)
{
	if(secMode != "disable"){
		if(secMode=="WEP 128 bit"){			
			document.getElementById("wepKeyEncryption").style.display="block";
			document.getElementById("wpaKeyEncryption").style.display="none";
			document.getElementById("keyStrength").style.display="none";
		}else{
			document.getElementById("wepKeyEncryption").style.display="none";
			document.getElementById("wpaKeyEncryption").style.display="block";
		}
		document.getElementById("keyEncryption").style.display="";
	}else{
		document.getElementById("keyEncryption").style.display="none";
		document.getElementById("keyStrength").style.display="none";
	}
}

var symbols = " !\"#$%&'()*+,-./0123456789:;<=>?@";
var loAZ = "abcdefghijklmnopqrstuvwxyz";
symbols+= loAZ.toUpperCase();
symbols+= "[\\]^_`";
symbols+= loAZ;
symbols+= "{|}~";

function toHex(webKeyVal)
{	
	var valueStr = webKeyVal;
	var hexChars = "0123456789abcdef";
	var text = "";
	for( i=0; i<valueStr.length; i++ )
	{
		var oneChar = valueStr.charAt(i);
		var asciiValue = symbols.indexOf(oneChar) + 32;
		var index1 = asciiValue % 16;
		var index2 = (asciiValue - index1)/16;
		if ( text != "" ) text += " ";
		text += hexChars.charAt(index2);
		text += hexChars.charAt(index1);
	}

	return text;	
}

function toAscii(hex)
{
  var str = '';
  for (var i=0; i < hex.length; i +=2)
      str+=String.fromCharCode(parseInt(hex.substr(i,2),16));
  return str;
}

function format_hex(hex)
{
	var str = '';
	for(var i = 0; i < hex.length; i += 2)
		str += hex.substr(i, 2) + ' ';
	return str;
}

function asciiToHex(wepKeyVal){
	document.getElementById("wepHex").innerHTML=toHex(wepKeyVal);
}

function isEncrWepKey(str)
{
	var reg = /^[\da-zA-Z]{13}$/; 
	return reg.test(str);        
}

function isEncrWpaKey(str)
{


	var reg = /^[0-9a-zA-Z!@#$%^&*()_+\-={}.,\/<>?`~\[\]|;:\\]*$/; 	
	return reg.test(str);

}

function addMACACL()
{
  var vh = '0123456789aAbBcCdDeEfF';
  var mac = document.getElementById("aclMAC").value;
  var invalid = 0;
  if((mac=="") || (mac.length != 17)) {
    invalid = 1;
  } else {
    for(var i=0; i < mac.length; i++) {
      if(i%3==2) {
        if(mac.charAt(i) != ':') {
          invalid = 1;
          break;
        }
      }
      else {
        if(vh.indexOf(mac.charAt(i)) < 0) {
          invalid = 1;
          break;
        }
      }
    }
  }
  if(invalid)
  {
    document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgInvalidMAC%>";
    document.getElementById("wifiConfig").style.display="none";
    document.getElementById("keyConfig").style.display="block";
    return false;
  }
  <%if aclControl=="unlock" then%>
    if (<%=numberOfMAC%> >= 50)
    {
      document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgMACEnough%>";
      document.getElementById("wifiConfig").style.display="none";
      document.getElementById("keyConfig").style.display="block";
      return false;
    }
    <%for i,v in pairs(aclList[aclMacPath]) do%>
      if(mac == "<%=v.param["MACAddress"]%>")
      {
        document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgMACExist%>";
        document.getElementById("wifiConfig").style.display="none";
        document.getElementById("keyConfig").style.display="block";
        return false;
      }
    <%end%>
  <%end%>
  document.getElementById("aclSubmitFlag").value = 1;
  document.wlanConfig.submit();
}

function changeACL()
{
  if(document.getElementById("aclControl").value == "disabled")
    document.getElementById("addACL").style.display="none";
  else
    document.getElementById("addACL").style.display="";
}

function confirmConfig(){
	if("<%=wlanState%>"!="true")
	{		
		document.wlanConfig.submit();
		return true;
	}

	var isWlanStateOff = document.getElementById("wlanState2").checked;
	if(isWlanStateOff){
        <% if QUERY["id"]~="2" then %>
        {
          document.getElementById("WlanRadioOffMsg").innerHTML = "<%=confMsgwifi2%>";
          document.getElementById("wifiConfig").style.display="none";
          document.getElementById("confirmOff").style.display="block";
          return false;
        }
        <% else %>
        {
          document.getElementById("WlanRadioOffMsg").innerHTML = "<%=confMsgwifi5%>";
          document.getElementById("wifiConfig").style.display="none";
          document.getElementById("confirmOff").style.display="block";
          return false;
        }
        <% end %>
	}
	
	
	var anySSID = document.getElementById("anySSID").value;
	if(anySSID=="false" && "<%=anyssid%>"!="false"){
		document.getElementById("wifiConfig").style.display="none";
		document.getElementById("wpsConfig").style.display="block";
		return false;
	}
	confirmSSID();
}

function confirmSSID()
{
	document.getElementById("wpsConfig").style.display="none";
	var ssid = document.getElementById("ssid").value;
	if(ssid != "<%=ssid%>"){
		document.getElementById("wifiConfig").style.display="none";
		document.getElementById("ssidConfig").style.display="block";
		return false;
	}
	confirmSecurity();
}


function confirmSecurity()
{
	var retValue = checkAclList();
	if( retValue == false )
	{
		return false;
	}	
	
	document.getElementById("ssidConfig").style.display="none";
	var secMode = document.getElementById("secMode").value;
	if(secMode != "disable")
	{
		if(secMode=="WEP 128 bit")
		{
				<% if QUERY["id"]~="2" then %>
							var wepKey = document.getElementById("wepKey").value;
							if(isEncrWepKey(wepKey)==false) {
								document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgInvalidWEPKey%>";
								document.getElementById("wifiConfig").style.display="none";
								document.getElementById("keyConfig").style.display="block";
								return false;
							}
				<% end %>
		}
		else
		{
			//if the key is invalid throw M17 error message.
			var wpaKey = document.getElementById("wpaKey").value;
			if( wpaKey.length < 12) {
				document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgInvalidWPAKey%>";
				document.getElementById("wifiConfig").style.display="none";
				document.getElementById("keyConfig").style.display="block";
				return false;
			}
			//check for key strength.
			
			var wpaKeyStrength  = indicateEncryptionKeyStrength(wpaKey,false);
			//if the encryption key is at strength low throw an error message.
			if( isEncrWpaKey(wpaKey)==false || wpaKeyStrength == 1 ){		
			
				//alert("The wpa key strenth is in low");
				document.getElementById("invalidKeyStrengthMsg").innerHTML = "<%=errMsgInvalidWPAKey%>";
				document.getElementById("wifiConfig").style.display="none";
				document.getElementById("keyStrengthError").style.display="block";
				return false;
			} //if the key strength is meidium thorw a warning and execute further..
			else if ( wpaKeyStrength == 2)
			{
				
				//alert("The wpa key strenth is with medium");
				document.getElementById("wifiConfig").style.display="none";
				document.getElementById("keyStrengthWarning").style.display="block";
				return false;
			}		
		}
	}
	confirmSecurityKeyWarning();
}
	
function confirmSecurityKeyWarning()
{
    document.getElementById("keyStrengthWarning").style.display="none";
	//alert("in confirm security warning");
	var secMode = document.getElementById("secMode").value;
	if(secMode == "disable")
	{
		document.getElementById("wifiConfig").style.display="none";
		document.getElementById("encrOffConfig").style.display="block";			
	}else if(secMode == "WEP 128 bit")
	{		
		<% if QUERY["id"]=="2" then %>
					document.wlanConfig.submit();
		<% else %>
					document.getElementById("wifiConfig").style.display="none";
					document.getElementById("encrWepConfig").style.display="block";
		<% end %>			
	}else
	{			
		//document.getElementById("wifiConfig").style.display="none";
		//document.getElementById("confirmConfig").style.display="block";
		submit_ok();
	}
}

function isDigit(str)
{
  var reg = /^\d{8}$/; 
  return reg.test(str);
}

function pbcSubmit()
{
  document.getElementById("wpsSubmitFlag").value = "2";
  document.wlanConfig.submit();
}

function pinSubmit(){
  var pinVal = document.getElementById("pin").value;
  var pinLen = pinVal.length;
  
  if(pinLen != 8)
  {
    document.getElementById("pinKOMsg").innerHTML = "<%=errMsgWrongPIN%>";
    document.getElementById("wifiConfig").style.display="none";
    document.getElementById("pinConfig").style.display="block";
    return false;
  }
  if(isDigit(pinVal))
  {
    document.getElementById("wpsSubmitFlag").value="1";
    document.wlanConfig.submit();
  }else{
    document.getElementById("pinKOMsg").innerHTML = "<%=errMsgInvalidPIN%>";
    document.getElementById("wifiConfig").style.display="none";
    document.getElementById("pinConfig").style.display="block";
  }
}

function closeConfirm(){
	document.getElementById("wifiConfig").style.display="block";
	document.getElementById("confirmConfig").style.display="none";
	document.getElementById("keyConfig").style.display="none";
	document.getElementById("encrOffConfig").style.display="none";
	document.getElementById("encrWepConfig").style.display="none";
	document.getElementById("pinConfig").style.display="none";
	document.getElementById("confirmOff").style.display="none";
	document.getElementById("wpsConfig").style.display="none";
	document.getElementById("ssidConfig").style.display="none";
	document.getElementById("keyStrengthError").style.display="none";
	document.getElementById("keyStrengthWarning").style.display="none";
	document.getElementById("confirmConfigApplyChangesOtherIntf").style.display="none";
	
	wlanInit();	
	changeSecMode("<%=secMode%>");
}

function submit_ok()
{
	var anyssid = document.getElementById("anySSID").value;
	var ssid = document.getElementById("ssid").value;
	var secMode = document.getElementById("secMode").value;
	var wpaKey = document.getElementById("wpaKey").value;
	var aclControl = document.getElementById("aclControl").value;
	var changeOtherIntf = document.getElementById("changeOtherIntfFlag").value;
	if((anyssid!="<%=anyssid%>" || ssid!="<%=ssid%>" || secMode != "<%=secMode%>" || wpaKey != "<%=wpaKeyEncryption%>" || aclControl != "<%=aclControl%>") && secMode!="WEP 128 bit" && changeOtherIntf=="0")
	{		
		document.getElementById("msgChangeConfirm").innerHTML = "<%=errMsgConfirmChange%>";
		document.getElementById("wifiConfig").style.display="none";
		document.getElementById("encrOffConfig").style.display="none";

		document.getElementById("confirmOff").style.display="none";
		document.getElementById("confirmConfigApplyChangesOtherIntf").style.display="block";
		document.getElementById("changeOtherIntfFlag").value="1";
		document.getElementById("changeNum").value="2";
		return false;
	}
	showConfirmConfig();
}

// introduced this method for fixing CPE_P00106015.
function showConfirmConfig(){
		document.getElementById("wifiConfig").style.display="none";
		document.getElementById("encrOffConfig").style.display="none";
		document.getElementById("encrWepConfig").style.display="none";
		document.getElementById("confirmOff").style.display="none";
		document.getElementById("confirmConfigApplyChangesOtherIntf").style.display="none";
		document.getElementById("confirmConfig").style.display="block";
}

// introduced this method for fixing CPE_P00106015.
function submit_ok_confirm()
{
	document.wlanConfig.submit();
}
function cancel()
{
	if(document.getElementById("changeOtherIntfFlag").value=="1")
	{
		document.getElementById("changeNum").value="1";
		showConfirmConfig();
	}else{		
		document.getElementById("changeOtherIntfFlag").value="0";
		closeConfirm();
	}
	
}


function checkAclList()
{
	if(document.getElementById("aclControl").value != "disabled") 
	{
		<%
		if( aclList ~= nil ) then
			numberOfMAC =  #aclList[aclMacPath]
		end
		%>
		var aclSize=<%=numberOfMAC%>;
		if( aclSize == 0 ) 
		{
			document.getElementById("chiaveKOMsg").innerHTML = "<%=aclEmptyMsg%>";
			document.getElementById("wifiConfig").style.display="none";
			document.getElementById("ssidConfig").style.display="none";
			document.getElementById("keyConfig").style.display="block";
			return false;
		}	
	}	
	return true;
}

var desc = new Array();
	
desc[1] = "<%=low%>";
desc[2] = "<%=medium%>";
desc[3] = "<%=high%>";
	
function indicateEncryptionKeyStrength(password,style)
{
    if( style == true)
	{
		document.getElementById("keyStrength").style.display="block";
	}
	
	var score   = 1;
	var isSpecialCharExists = false;	
	var isAlphaNumericCharExists = false;
	var length =  password.length;
	
	//is any uppercase, lowervase and a number presents
	isAlphaNumericCharExists = ( ( password.match(/[a-zA-Z]/) )  && ( password.match(/\d+/) ) );
	
	//if password has at least one special caracther give 1 point
	isSpecialCharExists =  password.match(/.[!,@,#,$,%,^,&,*,(,),_,+,\-,=,{,},\,,.,\/,<,>,?,`,~,\[,\],|,;,:,\\]/);

	
	if ( length >= 12 && isAlphaNumericCharExists && isSpecialCharExists ) {
			score = 2;
		}
   if ( length >= 24 ) {
		score = 2;
		if ( isAlphaNumericCharExists && isSpecialCharExists ){
			score = 3;
		}
	}	

	//Chect at the last
	if( isEncrWpaKey(password) == false )
	{
		score=1;
	}
	document.getElementById("encryptionKeyStrengthDesc").innerHTML = desc[score];
	document.getElementById("encryptionKeyStrength").className = "strength" + score;
	return score;
}

//]]>
</script>
</head>
<body>

<!-- <table cellspacing='0' cellpadding='0' width="100%" class="NavBar"> -->

<div class="contentContainer fontSize">
<% if QUERY["id"]=="2" then %>
  <!-- <tr><td align="left"><a href="standard.lp">Standard</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="wlanStatus.lp?wifiPage=wifi">Wi-Fi</a> &nbsp;&nbsp;>&nbsp;&nbsp;<a href="wlanConfig.lp?id=2">Configura</a></td><td align="right"><a href="wlanStatus.lp?wifiPage=wifi5">Stato</a>&nbsp;&nbsp;|&nbsp;&nbsp;<em>Configura</em></td></tr> -->
  
	<div class="breadCrumbContainer">
		<ul class="brdCrumb">
			<li><a href="standard.lp"><%=sectionName%></a></li><li>|</li><li><a href="wlanStatus.lp?wifiPage=wifi">Wi-Fi</a></li><li>|</li>
			<li><a href="wlanConfig.lp?id=2">Wi-Fi 5 GHz</a></li>
		</ul></div>
		
		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a href="wlanStatus.lp?wifiPage=wifi5" >
					<div class="tab">
					<span class="tabIcon_stwifi5"></span>  
					<span class="contTabTxt">WI-FI 5GH</span><span class="contTabTxt" style="text-transform:lowercase">z</span>
				</div><div class="clrBth"></div></a></li>
				<li><a href="wlanConfig.lp?id=2" class="current margin15">
					<div class="tab">
						<span class="contTabTxt transform"><%=translate([==[Configure]==])%> Wi-Fi 5 GH</span><span class="contTabTxt" style="text-transform:lowercase">z</span>
						</div></a></li>			
			</ol>
		</div>
<% else %>
  <!-- <tr><td align="left"><a href="standard.lp">Standard</a>&nbsp;&nbsp;>&nbsp;&nbsp; <a href="wlanStatus.lp?wifiPage=wifi">Wi-Fi</a> &nbsp;&nbsp;>&nbsp;&nbsp;<a href="wlanConfig.lp">Configura</a></td><td align="right"><a href="wlanStatus.lp?wifiPage=wifi2">Stato</a>&nbsp;&nbsp;|&nbsp;&nbsp;<em>Configura</em></td></tr> -->
  
  <div class="breadCrumbContainer">
		<ul class="brdCrumb">
			<li><a href="standard.lp"><%=sectionName%></a></li><li>|</li><li><a href="wlanStatus.lp?wifiPage=wifi">Wi-Fi</a></li><li>|</li>
			<li><a href="wlanConfig.lp">Wi-Fi 2.4 GHz</a></li>
		</ul></div>
	<div class="contentTab" id="content">
	<ol id="tocTab">
		<li><a href="wlanStatus.lp?wifiPage=wifi2" >
			<div class="tab">
			<span class="tabIcon_stwifi2"></span>  
			<span class="contTabTxt">WI-FI 2.4 GH</span><span class="contTabTxt" style="text-transform:lowercase">z</span>
		</div><div class="clrBth"></div></a></li>
		<li><a href="wlanConfig.lp" class="current margin15">
			<div class="tab">
				<span class="contTabTxt transform"><%=translate([==[Configure]==])%> Wi-Fi 2.4 GH</span><span class="contTabTxt" style="text-transform:lowercase">z</span>
				</div></a></li>			
	</ol>
	</div>
  
<% end %>
<!-- </table> -->

<div id="wifiConfig" class='contentcontainer'>
<div class='contentitem'>
<form method="post" id="wlanConfig" name="wlanConfig" action="">
<input type="hidden" id="aclSubmitFlag" name="aclSubmitFlag" value="0" />
<input type="hidden" id="wpsSubmitFlag" name="wpsSubmitFlag" value="0" />
<input type="hidden" id="changeOtherIntfFlag" name="changeOtherIntfFlag" value="0" />
<input type="hidden" id="wlanPath" name="wlanPath" value="<%=wlanPath%>" />
<input type="hidden" id="changeNum" name="changeNum" value="1" />

<br>
<%
	writePageHeader_new()

	--writeBlockNoTitle()
	writeBlockTitle_Guest(translate([==[Configuration]==]) .. " Wi-Fi " .. name)
	writeBlockRowCtrl_Config(translate([==[Radio Interface]==]),"<input class='inputClass' type='radio' value='true' id='wlanState1' name='wlanState' />&nbsp;"..translate([==[Active]==]).."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='radio' value='false' id='wlanState2' name='wlanState' />&nbsp;"..translate([==[Not active]==]))

if wlanState~="true" then
	--end of the disable block 
	endBlock()
else
	--Start of the enable block
	writeBlockRowCtrl_Config(translate([==[Wi-Fi network (SSID)]==]), "<select class='inputClass' size='1' id='anySSID' name='anySSID' ><option value='true'>"..translate([==[Visible]==]).."</option><option value='false'>"..translate([==[Hidden]==]).."</option></select>&nbsp;&nbsp;<input class='inputClass' type='text' id='ssid' name='ssid' size='20' maxlength='32' value='.. tostring(ssid) ..' />")

if QUERY["id"]=="2" then
 	writeBlockRowCtrl_Config(translate([==[Radio Channel]==]), "<select class='inputClass' size='1' id='wlanChannel' name='wlanChannel'><option value='Auto'>Automatico</option><option value='36'>36</option><option value='40'>40</option><option value='44'>44</option><option value='48'>48</option></select>")
%>
	  <tr><td style='vertical-align:middle;' class="wifiWarning"  colspan='4' ><font color="#FF0000"><%=translate([==[Warning]==])%></font><%=translate([==[: Manual selection is available a limited number of channels., We recommend using automatic mode for best performance]==])%></td></tr>
<%
else
	writeBlockRowCtrl_Config(translate([==[Radio Channel]==]), "<select class='inputClass' size='1' id='wlanChannel' name='wlanChannel'><option value='Auto'>Automatico</option><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option><option value='13'>13</option></select>")
end

--if secMode == "disable" or secMode == "WPA-PSK AES 256 bit" then
	writeBlockRowCtrl_newConfig(translate([==[Bandwidth (Channel)]==]), "<select class='inputClass' size='1' id='channelWidth' name='channelWidth'><option value='20'>20 MHz</option><option value='20/40'>Auto 20 MHz/40 MHz</option></select>")
--end

local wepOption = "<option value='WEP 128 bit'>WEP (128-bit)</option>"
if QUERY["id"]=="2" then
  wepOption = ""
end
	writeBlockRowCtrl_newConfig(translate([==[Methods of encryption]==]), "<select class='inputClass' size='1' id='secMode' name='secMode'  onchange='changeSecMode(this.value)'><option value='disable'>"..translate([==[disable]==]).."</option>"..wepOption.."<option value='WPA-PSK TKIP 256 bit'>WPA-PSK TKIP 256-bit</option><option value='WPA-PSK AES 256 bit'>WPA-PSK AES 256-bit</option><option value='WPA-PSK TKIP-AES 256 bit'>WPA-PSK TKIP-AES 256-bit</option></select>")	
	
%>
<tr id="keyEncryption" style="display:<%=keyEncryptionStyle%>;"><td class="midarea4-2 verticalAlign"><%=translate([==[Encryption key]==])%>:</td><td colspan='3' class="verticalAlign" style="padding-top:7px;">
			<div id="wepKeyEncryption" style="display:<%=wepKeyStyle%>">
			<table border="0" cellpadding="0" cellspacing="0">
				<tr>			
				<td class="tdBianca_new" style="width:100%;"><input class='inputClass' type="text" id="wepKey" name="wepKey" size="13" maxlength="13" value="" onkeypress="asciiToHex(this.value)" /> [13 caratteri ASCII] </td></tr>

				<tr><td class="tdBianca_new" style="width:100%"><span id="wepHex"></span>&nbsp;[HEX]</td></tr>
			</table></div>
			<div id="wpaKeyEncryption" style="display:<%=wpaKeyStyle%>">
				<table border="0" cellspacing="0" cellpadding="0">
				<tr><td class="tdBianca_new" style="width:100%;">
				<input class="inputClass" type="text" id="wpaKey" name="wpaKey" size="25" maxlength="32" value="<%=wpaKeyEncryption%>" onchange="indicateEncryptionKeyStrength(this.value,true)" onkeyup="indicateEncryptionKeyStrength(this.value,true)"  />
				[12 - 32 <%=translate([==[characters]==])%> ASCII]
				</td></tr>
			</table></div>			
</td></tr>


<tr>	
	<td width='330' class="midarea4-2" style="height:0px"></td>
	<td width='330' colspan='3' class="midarea4-3" style="height:0px">	
		<table border="0" cellspacing="0" cellpadding="0" id="keyStrength" style="display:none">
		<tr>
		<td style="vertical-align:middle;white-space:nowrap" >&nbsp;<%=translate([==[Key strength]==])%>&nbsp;:&nbsp;&nbsp;</td>
		<td>				
			<table>
				<tr>
					<td>
					<div id="encryptionKeyStrengthDesc" value="Low">Low</div>
					</td>
				</tr>
				<tr>
					<td>
					<div id="encryptionKeyStrength" class="strength0"></div>	
					</td>
				</tr>
			</table>
		</td>
		</table>
	</td>	
</tr>

<tr><td class="midarea2 tableTitle" style="font-weight:bold;padding-left:30px" width='250px'><%=translate([==[Access Control]==])%></td></tr>
<%
	-- writeBlockTitle_Guest(translate([==[Access Control]==]))
	writeBlockRowCntrl_Access(translate([==[Access Control: The feature allows you to restrict access to the Wi-Fi network to devices indicated]==]), "<select class='inputClass' size='1' id='aclControl' name='aclControl' onchange='changeACL();'><option value='disabled'>"..translate([==[Disabled]==]).."</option><option value='unlock'>"..translate([==[Enabled]==]).."</option></select>")

	endBlock()
%>
<br/>
<div id="addACL" style="display:none">
<%
	
	writeTableBlockTitle_Authdevices(translate([==[Authorized Devices]==]),40)
	local macNum = 0
	local rowStyle = "oddrow"
	
	if aclControl=="unlock" then
		if #aclList[aclMacPath] > 0 then
			
			writeWifiBlockHeader(3, translate([==[MAC Address]==]), translate([==[Access Management]==]), translate([==[Delete]==]))
	
			for i, v in pairs(aclList[aclMacPath]) do
				local authorized, unauthorized
				local mac=v.param["MACAddress"]
                if v.param["MACAddress"] ~= nil then
                    if v.param["Permission"]=="allow" then
                        authorized = 'checked="checked"'
                        unauthorized = ""
                    else
                        unauthorized = 'checked="checked"'
                        authorized = ""
                    end
                    macNum = macNum+1			
                    if macNum%2==1 then				
                        rowStyle = "oddrow"
                    else 
                        rowStyle = "evenrow"
                    end		

                    writeTableBlockRow(3, rowStyle, tostring(mac .. "<input type='hidden' id='mac".. i .."' name='mac".. i .."' value='"..mac.."'/>"), "<input class='inputClass' type='radio' value='allow' ".. authorized .." name='permission".. i .."' />&nbsp;".. translate([==[Authorized]==]) .."&nbsp;&nbsp;&nbsp;<input class='inputClass' type='radio' value='deny' ".. unauthorized .." name='permission".. i .."' />&nbsp;" .. translate([==[Unauthorized]==]), "<input class='inputClass' type='checkbox' name='delMac".. i .."' value='ON' />")
                end
			end
			--[[
			if rowStyle == "oddrow" then
			rowStyle = "evenrow"
			else
				rowStyle = "oddrow"
			end		
			
			writeTableBlockRowCtrl_wifihidden(3, rowStyle, tostring("<table><tr><td style='width:250px'><input class='inputClass' type='text' id='aclMAC' name='aclMAC' size='17' maxlength='17' value='' />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style='width:250px'><select class='inputClass' size='1' id='aclOption' name='aclOption'><option value='allow'>"..translate([==[Authorized]==]).."</option><option value='deny' selected='true'>"..translate([==[Unauthorized]==]).."</option></select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style='width:250px' class='addButton'><a href='#' onclick='addMACACL();'><div class='midarea6-1 secondaryButton' name='thb8'>"..translate([==[Add]==]).."</div></a></td></tr></table>"))
			]]
		end
	end

	if rowStyle == "oddrow" then
		rowStyle = "evenrow"
	else
		rowStyle = "oddrow"
	end
	
	
	writeTableRow_wifihidden(3, rowStyle, tostring("<table><tr><td style='width:250px;padding-left:0px;'><input class='inputClass' type='text' id='aclMAC' name='aclMAC' size='17' maxlength='17' value='' />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style='width:250px'><select class='inputClass' size='1' id='aclOption' name='aclOption' ><option value='allow'>"..translate([==[Authorized]==]).."</option><option value='deny' selected='true'>"..translate([==[Unauthorized]==]).."</option></select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style='width:250px' class='addButton'><a href='#' onclick='addMACACL();'><div class='midarea6-1 secondaryButton' name='thb8'>"..translate([==[Add]==]).."</div></a></td></tr></table>"))


	endBlock()
%>
<input type='hidden' id='macNum' name='macNum' value='<%=macNum%>'/>
</div>

<div id="wpsRegistration" style="display:<%=wpsRegistrationStyle%>">
	<% writeBlockTitle_GuestConnect(translate([==[Connect a new host with WPS button]==])) %>
	<tr><td colspan='4' class="wifiMidareaNoHeight4-2" style="padding-left:30px;padding-top:0px"><span>[<%=translate([==[Mode only available with WPA-PSK]==])%>]</span></td></tr>
	
		<tr>
			<td style='vertical-align:middle;padding-top:0px;' class="wifiMidarea4-2"><%=translate([==[Enable WPS process]==])%>:</td>
			<td style='vertical-align:middle;padding-top:0px;' colspan='3'>
				<a style='color:black' href='#' onclick='pbcSubmit()'><div class='midarea6-1 secondaryButton' name="thb5"><%=translate([==[Run]==])%></div></a>
			</td>
		</tr>
		<tr><td  colspan='4'>&nbsp;</td></tr>
	<% endBlock() %>
	<% writeBlockTitle_GuestConnect(translate([==[Connect a new host with the PIN]==])) %>
	<tr><td colspan='4' class="wifiMidareaNoHeight4-2" style="padding-left:30px;padding-top:0px"><span>[<%=translate([==[Mode only available with WPA-PSK]==])%>]</span> </td></tr>
	
	<tr>
		<td style='vertical-align:top;padding-left:30px;padding-top:15px' class="wifiMidarea4-2"><%=translate([==[Client PIN]==])%>:
      			<input type="text" id="pin" name="pin" size="8" maxlength="8" class="inputClass" />
      			<div><span id="pinDesc">[<%=translate([==[Only numeric characters]==])%>]</span></div>
		</td>
		<td style='vertical-align:middle;padding-left:0px;padding-top:15px'>
			<a href='#' onclick='pinSubmit()'><div class='midarea6-1 secondaryButton' name="thb5"><%=translate([==[Run]==])%></div></a>
    	</td>
  	</tr>
	
	<!--
	<tr>
		<td style='vertical-align:top;padding-left:30px' class="clientPin"><%=translate([==[Client PIN]==])%>:</td>
  		<td style='vertical-align:top' colspan='3' class="midarea4-3">
      			<input type="text" id="pin" name="pin" size="8" maxlength="8" />&nbsp;&nbsp;
      			<span id="pinDesc">[<%=translate([==[Only numeric characters]==])%>]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</td><td><a href='#' onclick='pinSubmit()'><div class='midarea6-1 secondaryButton' name="thb5"><%=translate([==[Run]==])%></div></a>
    		</td>
  	</tr> -->
	<% endBlock() %>
</div>

<%end%>
<!-- end of the enable block-->
<br/><br/>
<table cellspacing='0' cellpadding='0' width='100%' style="text-align:center">

<tr><td style="text-align:left;">
<table cellspacing='0' cellpadding='0'><tr>
	<td style='padding-left:280px'>
	
		<a style='color:black' href='#' onclick='confirmConfig()'><div class='midarea6-1 mainButton' name="thb6"><%=translate([==[Save]==])%></div></a></td>
	<td style='padding-left:50px'><a style='color:black' onclick='javascript: document.location.href="wlanStatus.lp?wifiPage=<%=page%>";'><div class='midarea6-1 mainButton' name="thb7"><%=translate([==[Cancel]==])%></div></a></td>
		<!-- <input type="button" class="button" onclick='confirmConfig()' value="<%=translate([==[Save]==])%>" name="thb6" />&nbsp;&nbsp;&nbsp;&nbsp;
		<input type="button" class="button" onclick='javascript: document.location.href="wlanStatus.lp?wifiPage=<%=page%>";' value="<%=translate([==[Cancel]==])%>" name="thb7" /> -->                	
	
</tr></table>
</td></tr>
</table>
<%
endPage()
%>
</form>
</div>
</div>

<div id="confirmConfig" style="display:none">
<%cgilua.lp.include("webparts/confirmWlan.lp")%>
</div>

<div id="confirmConfigApplyChangesOtherIntf" style="display:none">
<%cgilua.lp.include("webparts/wlanConfirmChangeOnOtherIntf.lp")%>
</div>

<div id="keyConfig" style="display:none">
<%cgilua.lp.include("webparts/chiaveKO.lp")%>
</div>
<div id="pinConfig" style="display:none">
<%cgilua.lp.include("webparts/pinKO.lp")%>
</div>
<div id="encrOffConfig" style="display:none">
<%cgilua.lp.include("webparts/WlanEncrOff.lp")%>
</div>
<div id="encrWepConfig" style="display:none">
<%cgilua.lp.include("webparts/WlanEncrWEP.lp")%>
</div>	
<div id="confirmOff" style="display:none">
<%cgilua.lp.include("webparts/WlanRadioOff.lp")%>
</div>
<div id="wpsConfig" style="display:none">
<%cgilua.lp.include("webparts/WPS_warning.lp")%>
</div>
<div id="keyStrengthError" style="display:none">
<%cgilua.lp.include("webparts/keyStrengthKO.lp")%>
</div>

<div id="keyStrengthWarning" style="display:none">
<%cgilua.lp.include("webparts/wpaKeyStrengthWarning.lp")%>
</div>

<div id="ssidConfig" style="display:none">
  <div class='contentcontainer'>
  <div class='contentitem'>
  <table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[Warning]==])%>.</td></tr>
            <tr><td class="errorDesc">
            <% if QUERY["id"]=="2" then %>
              <p><%=translate([==[Warning: the SSID for the Wi-Fi at 5 GHz will be changed. And 'advisable to maintain the same SSID for both identifcativo Wi-Fi at 2.4 GHz and 5 GHz, unless special needs. proceed?]==])%></p>
            <% else %>
              <p><%=translate([==[Warning: the SSID for the Wi-Fi at 2.4 GHz will be changed. And 'advisable to maintain the same SSID for both identifcativo Wi-Fi at 2.4 GHz and 5 GHz, unless special needs. proceed?]==])%></p>
            <% end %>
              <br/>
                 </td></tr></table>
                   </td></tr>
                   <tr><td>
                      <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
                         <tr><td class="verticalAlign fright">
                            <a class="fright" style='color:black' onclick='confirmSecurity()' href="#" ><div class='midarea6-1 mainButton' name="thb11"><%=translate([==[Next]==])%></div></a></td>
			<td  class="verticalAlign" style="padding-left:15px;">
				   <a style='color:black' onclick="closeConfirm()" href="#" ><div class='midarea6-1 mainButton' name="thb12"><%=translate([==[Cancel]==])%></div></a>
             
            </td></tr></table>
        </td></tr></table>
  </div>
  </div>
</div>

<script src="js/antiCSRF.js" type="text/javascript"></script>
<script language="javascript" type="text/javascript">
function wlanInit()
{
var wlanState = "<%=wlanState%>";

if(wlanState=="true"){
	document.getElementById("wlanState1").checked = true;
}else{
	document.getElementById("wlanState2").checked = true;
	return true;
}

var wlanChannel = "<%=wlanChannel%>";
var channelMode = "<%=channelMode%>";
if(channelMode=="Auto")
{
	document.getElementById("wlanChannel").value = "Auto";
}else{
	document.getElementById("wlanChannel").value = wlanChannel;
}

var secMode = "<%=secMode%>";
document.getElementById("secMode").value = secMode;
var wepKey = "<%=wepKeyEncryption%>";
var wepKeyHex;
var wepKeyAscii;

if (wepKey.length==13)
{
 wepKeyHex=toHex(wepKey);
 wepKeyAscii=wepKey;
}
else
{
 //why Ascii then hex, just add whitespace in 2 digit in HEX format, TI requrest
 wepKeyHex=format_hex(wepKey);
 wepKeyAscii=toAscii(wepKey);
}

document.getElementById("wepKey").value=wepKeyAscii;
document.getElementById("wepHex").innerHTML=wepKeyHex;

var aclControl = "<%=aclControl%>";
document.getElementById("aclControl").value = aclControl;
changeACL();

var anyssid = "<%=anyssid%>";
document.getElementById("anySSID").value = anyssid;
document.getElementById("ssid").value = "<%=ssid%>";


var cwidth = "<%=result.channelwidth%>";
//alert(cwidth);

if( cwidth == "20" )
{
	
	document.getElementById("channelWidth").options[0].selected = true;
}else
{
	document.getElementById("channelWidth").options[1].selected = true;
}

}

wlanInit();
</script>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
<!-- <link rel="stylesheet" href="css/style.css" type="text/css" /> -->
<link rel="stylesheet" href="css/master.css" type="text/css" />

<%
cgilua.lp.include("lp/wlan.lp")
cgilua.lp.include("lp/util.lp")
cgilua.lp.include("lp/mbus_util.lp")
cgilua.lp.include("lp/style.lp")
cgilua.lp.include("lp/device.lp")
cgilua.lp.include("lp/wlanGuestUtil.lp")
cgilua.lp.include("lp/portmap.lp")
cgilua.lp.include("lp/common.lp")


local translate = translate
local POST = cgilua.POST
local tprint = require("tableprint")

local tempreply, temperror = mbus.getParameters{ path = "TI_STORE.TiUserIntf", param = "PasswordRequired"}
local isPasswordRequired = tempreply["TI_STORE.TiUserIntf"][1].param["PasswordRequired"]

if( cgilua.QUERY["display"] == nil or cgilua.QUERY["display"] ~= "fromStartup" )	then
    --normal launch
	
	local isDontShowChecked = ""
	
	local reply, error = mbus.getParameters{ path = "ENV", param = "Value", filter = "(== Name ".. "isDontShowChecked" ..")" }
	
	if reply["ENV"][1]~=nil and reply["ENV"][1].param~=nil then
		isDontShowChecked = reply["ENV"][1].param["Value"]
	end
	
	if( isPasswordRequired == "false" and(  isDontShowChecked == "" or isDontShowChecked ~= "true" ) ) then
	cgilua.redirect("startupConfig.lp?fromPage=wlanGuestConfig")
	return
	end
end
local wifi2Index = 1
local wifi2GuestIndex = 2
local wifi5GuestIndex = 4

local wifiGuestIndexList = {wifi2GuestIndex,wifi5GuestIndex}

local result = {}
local wlanInfo = {}

local wifi2GuestPath = "WLAN.Intf.wl_ssid1_local0"  
local wifi5GuestPath = "WLAN.Intf.wle_radio1_ssid1"  

local accessPoint3Path = "Device.WiFi.AccessPoint.3"	
local accessPoint4Path = "Device.WiFi.AccessPoint.4"

local aclMacPath = wifi2GuestPath .. ".ACL.MAC"
local result=getWlanMain(wifi2GuestPath)

local ssid = result.ssid
local anyssid = result.anyssid
local wlanState = getGuestStatus()
local frequency = getWifiFrequency()
local disconnectTime = getDisconnectTimeForConfig()



local wpaVersion = string.gsub(result.wpaversion,"&","-")
local wepKeyEncryption = result.wep
local wpaKeyEncryption = result.wpa

local wpaEncryption = result.encryption

if wpaVersion=="WPA" then
	wpaEncryption = "TKIP"
end

local pos = string.find(wpaEncryption,"&")
if pos~=nil then
	wpaEncryption = string.gsub(wpaEncryption,"&","-")
end

local wepKeyStyle="none"
local wpaKeyStyle="none"
local keyEncryptionStyle="none"
local wpsRegistrationStyle = "none"
local secMode = "disable"
if result.secmode=="WEP" then 
	secMode = "WEP 128 bit"
	wepKeyStyle = "block"
	keyEncryptionStyle=""
elseif result.secmode=="WPA-PSK" then
	secMode = result.secmode .. " " .. wpaEncryption .. " 256 bit"
	wpaKeyStyle = "block"
	keyEncryptionStyle=""
	wpsRegistrationStyle = ""
end


local adminState = result.adminState
local aclControl = result.control
local pageDisplay = false
local aclList, error
local aclListGuest5, error2
local numberOfMAC = 0
local aclMacPathGuest5 = wifi5GuestPath .. ".ACL.MAC"


if aclControl=="unlock" then
    aclList, error = mbus.getParameters{ path=aclMacPath, param={"MACAddress", "Permission"} ,flags="KEYPATH"}
	aclListGuest5, error2 = mbus.getParameters{ path=aclMacPathGuest5, param={"MACAddress", "Permission"},flags="KEYPATH" }
	aclList = getMergedList(aclList,aclListGuest5)
    numberOfMAC =  #aclList[aclMacPath]
end


--local function
function addACL(aclSubmitFlag,wlanPath,tempAclMacPath,aclMAC,aclOption)
	local aclList,error
	local modify = {}
	
	if aclControl=="disabled" then
		table.insert(modify, {path=wlanPath..".ACL", param= {Control="unlock"}, flags="KEYPATH"})		
		aclList, error = mbus.getParameters{ path=tempAclMacPath, param={"MACAddress", "Permission"} ,flags="KEYPATH"}
		numberOfMAC =  #aclList[tempAclMacPath]
	end

	if numberOfMAC >= 50 then
		if aclSubmitFlag == "1" then
			cgilua.redirect("resultKO.lp?pageDisplay=enough")
		end
		return false
	else
		local isAclMacExistFlag = isAclMacExist(tempAclMacPath, aclMAC)
		if isAclMacExistFlag == true  then
			if aclSubmitFlag == "1"  then
				cgilua.redirect("resultKO.lp?pageDisplay=exist")
				return false
			else
				return true
			end
		end
	end

	local aclAddErr = macRestrictionCreate(tempAclMacPath, aclOption, aclMAC)
	if aclAddErr ~= false then 
		cgilua.redirect("resultKO.lp")
		return false
	end
	setMBUS(modify)
	return true
end


if cgilua.servervariable"REQUEST_METHOD" == "POST" then
	
	local modify = {}
		
	local tempAclMacPath
	local wlanPath
	local time,val_time,val_env
	local env_time = "Wlan_Time"
        local WIntfPath		
	if POST["aclSubmitFlag"]=="1" then
	
		for itr = 1, #wifiGuestIndexList do
			i = wifiGuestIndexList[itr]
			if i==1 then
			        WIntfPath ="WLAN.Intf.wlif1"
			elseif i==2 then
			        WIntfPath="WLAN.Intf.wl_ssid1_local0"
			elseif i==3 then
			        WIntfPath="WLAN.Intf.wle_radio1_ssid0"
			elseif i==4 then
			        WIntfPath="WLAN.Intf.wle_radio1_ssid1"
			end

			--wlanPath = "WLAN.Intf."..i
			tempAclMacPath = WIntfPath .. ".ACL.MAC"
			local retval = addACL(POST["aclSubmitFlag"],WIntfPath,tempAclMacPath,POST["aclMAC"],POST["aclOption"] )
			if retval == false then
				return
			end			
		end
				
		saveall(0, 1)		
		cgilua.redirect("save_alert.lp", { u = "wlanGuestStatus.lp" })
		return
    end
	

	--setting frequency value
	local selectedFreq = POST["frequency"]
		
	-- enable/disable the guest status based on the frequency set  in previous statement
	if POST["wlanState"] == "enabled" then
		enableGuestStateWithFreq(selectedFreq)
		if( wlanState ~= true ) then
		        -- fix for CPE_P00118328, use Time.SystemUpTime instead of os.time for countdown timer calculations
			local currentTime = 0
			local reply1,error1 = mbus.getParameters{path = "Time",param = "SystemUpTime"}
			if reply1["Time"][1] ~= nil and reply1["Time"][1].param ~= nil and reply1["Time"][1].param["SystemUpTime"] ~= nil then
				currentTime = tonumber( reply1["Time"][1].param["SystemUpTime"] )
			end
			local reply,error = mbus.getParameters{path ="ENV",param = "Value",filter = "(== Name "..env_time..")"}
			mbus.modify(	
				function()
					if reply["ENV"][1] ~= nil and reply["ENV"][1].param ~= nil and reply["ENV"][1].param["Value"] ~= "" then
						mbus.setParameters{path = "ENV.Wlan_Time" , param = {Value = tostring(currentTime)},flags = "KEYPATH"}
					else
						mbus.addObjects{ path = "ENV",param = {Name = "Wlan_Time",Value = tostring(currentTime)},flags = "KEYPATH"}
					end
				end)	
		else
		--if previous staue is also enabled..
			cgilua.redirect("save_alert.lp", { u = "wlanGuestStatus.lp" })
			return
		end		
	elseif  POST["wlanState"] == "disabled" then
		disableGuestAccess()
		saveall(0, 1)
		cgilua.redirect("save_alert.lp", { u = "wlanGuestStatus.lp" })
		return
	end
	
	--setting disconnect value
	
	if (POST["disconnectTime"] ~= nil ) then
		
		setDisconnectTime(POST["disconnectTime"])
		-- fix for CPE_P00118328, use Time.SystemUpTime instead of os.time for countdown timer calculations
		local currentTime = 0
		local reply1,error1 = mbus.getParameters{path = "Time",param = "SystemUpTime"}
		if reply1["Time"][1] ~= nil and reply1["Time"][1].param ~= nil and reply1["Time"][1].param["SystemUpTime"] ~= nil then
			currentTime = tonumber( reply1["Time"][1].param["SystemUpTime"] )
		end
		local reply,error = mbus.getParameters{path ="ENV",param = "Value",filter = "(== Name "..env_time..")"}
		local modreply,moderror = mbus.modify(	
			function()
				if reply["ENV"][1] ~= nil and reply["ENV"][1].param ~= nil and reply["ENV"][1].param["Value"] ~= "" then
					mbus.setParameters{path = "ENV.Wlan_Time" , param = {Value = tostring(currentTime)},flags = "KEYPATH"}
				else
				    mbus.addObjects{ path = "ENV",param = {Name = "Wlan_Time",Value = tostring(currentTime)},flags = "KEYPATH"}
				end
			end)
	end
	
	if POST["anySSID"]~=anyssid then				
		setAnySSID(POST["anySSID"])					
	end

	if POST["ssid"] ~= ssid and POST["ssid"] ~= "" then
		setSSID(POST["ssid"])		
	end
	
	if POST["secMode"]~=secMode or POST["wepKey"]~=wepKeyEncryption or POST["wpaKey"]~=wpaKeyEncryption then
		setSecurityMode(POST["secMode"],POST["wepKey"], POST["wpaKey"] )
	end
	
	if POST["aclControl"]~=aclControl then 
		
		for itr = 1, #wifiGuestIndexList do
			i = wifiGuestIndexList[itr]
			modify ={}	
			if i==1 then
			   WIntfPath ="WLAN.Intf.wlif1"
			elseif i==2 then
			   WIntfPath="WLAN.Intf.wl_ssid1_local0"
			elseif i==3 then
			   WIntfPath="WLAN.Intf.wle_radio1_ssid0"
			elseif i==4 then
			   WIntfPath="WLAN.Intf.wle_radio1_ssid1"
			end

			--wlanPath = "WLAN.Intf."..i
			aclPath = WIntfPath .. ".ACL"
			tempAclMacPath = WIntfPath .. ".ACL.MAC"
			
			table.insert(modify, {path=aclPath, param= {Control=POST["aclControl"]}, flags="KEYPATH"})
			setMBUS(modify)
			if POST["aclControl"]=="disabled" then
			macRestrictionDeleteAll(tempAclMacPath)
			end	
		end
	end
		
	if POST["aclControl"]=="unlock" then
		for itr = 1, #wifiGuestIndexList do
			i = wifiGuestIndexList[itr]
			if i==1 then
			   WIntfPath ="WLAN.Intf.wlif1"
			elseif i==2 then
			   WIntfPath="WLAN.Intf.wl_ssid1_local0"
			elseif i==3 then
			   WIntfPath="WLAN.Intf.wle_radio1_ssid0"
			elseif i==4 then
			   WIntfPath="WLAN.Intf.wle_radio1_ssid1"
			end
			--wlanPath = "WLAN.Intf."..i
			tempAclMacPath = WIntfPath .. ".ACL.MAC"
			for i=1,tonumber(POST["macNum"]) do
				local resultACL = false
				if POST["delMac"..i]=="ON" then
					resultACL = macRestrictionDelete(tempAclMacPath, POST["mac"..i])
				else
					local isAclMacExistFlag, permission = isAclMacExist(tempAclMacPath, POST["mac"..i])
					if isAclMacExistFlag == true and permission ~= POST["permission"..i] then
						resultACL = macRestrictionUpdate(tempAclMacPath, POST["permission"..i], POST["mac"..i])
					else
						addACL("false",WIntfPath,tempAclMacPath,POST["mac"..i],POST["permission"..i])
					end
				end

				if resultACL == true then
					cgilua.redirect("resultKO.lp")
					return
				end
			end
		end
	end

	saveall(0, 1)
	cgilua.redirect("save_alert.lp", { u = "wlanGuestStatus.lp" })
	
end


--temp var
local n=1


local errMsgOff1 = "<p>" .. translate([==[The Wi-Fi at 2.4 GHz is turned off. Wi-Fi will be detected only at 5 GHz networks.]==]).. "</p>"
local errMsgOff2 = "<p>" .. translate([==[The Wi-Fi at 5 GHz is turned off. Wi-Fi will be detected only at 2.4 GHz networks.]==]).. "</p>"

local wifistatus = "disabled"
local errMsgInvalidMAC = "<p>" .. translate([==[Device not valid: only use hexadecimal characters (0-9, a-f) and respect the length of 12 characters]==]).. "</p>"
local errMsgMACExist = "<p>" .. translate([==[Can not add MAC Address which already exists in Authorized Devices list.]==]).. "</p>"
local errMsgMACEnough= "<p>" .. translate([==[Can not add MAC Addressr. Maximum size of Authorized Devices is 50.]==]).. "</p>"

local guestStateEnableWarningMsg = "<p>" .. translate([==[Warning : Enabling Wi-Fi Guests will cause the automatic switching of radio interfaces Wi-Fi match, if not already active]==]).. "</p>"
local guestStateDisableWarningMsg = "<p>" .. translate([==[Warning : After disabling Wi-Fi guests,the Wi-Fi guest users will be disconnected. interfaces Wi-Fi radio will remain active for the Wi-Fi key]==]).. "</p>"

local errMsgInvalidWEPKey = "<p>" .. translate([==[Invalid WEP key: use only permitted characters (a-z, A-Z, 0-9) and comply with the length]==]).. "</p>"
local errMsgInvalidWPAKey = "<p>" .. translate([==[Encryption key is invalid: verify that it contains at least one character of each of the following three sets:]==]).." [a-z, A - Z], [0 - 9], [!@#$%^&*()_+-={},./<>?`~[]|;:&#92;], "..translate([==[that does not contain characters or symbols not allowed and respects the minimum and maximum length allowed (12 to 32 characters)]==]).. "</p>"
local aclEmptyMsg = "<p>" .. translate([==[Warning: You must enter at least one valid MAC address]==]) .. "</p>"
local errMsgLowEncrKey = "<p>" ..translate( [==[Warning: the level of password security is not adequate.]==] ).."</p>"

local wepNotAllowedMsg = "<p>" .. translate([==[Warning: WEP mode is not applicable to the 5 GHz network]==]) .. "</p>"
local encrOffMessage = "<p>" .. translate([==[Warning: Disabling Wi-Fi encryption can connect unwanted devices. Proceed?]==]) .. "</p>"


local low = translate([==[Low]==])
local medium =  translate([==[Medium]==])
local high = translate([==[High]==])

--To get the random key from /dev/random
local wepKeyPwd = getRandomKey(13)
local wpaKeyPwd = getRandomKey(24)
local wpaKeyPwdBak = getRandomKey(24)

%>
<script language="JavaScript" type="text/javascript">
var isGuestToBeDisabled = false;
var currentState = "<%=wlanState%>"
function confimConfig()
{
	isGuestToBeDisabled = document.getElementById("wlanState2").checked;
	if( isGuestToBeDisabled == true )
	{
		document.getElementById("WlanGuestStateWarningMsg").innerHTML = "<%=guestStateDisableWarningMsg%>";		
		document.getElementById("wifiConfig").style.display="none";
		document.getElementById("guestStateWarning").style.display="block";
		return true;
	}
	else
	{
		
		if(currentState == "true")
		{
			isAccessPasswordSet();
			return true;
		}
	}
	
	
	var retValue = checkAclList();
	if( retValue == true )
	{
		confirmSecurity();		
	}	
}


function confirmSecurity()
{	
	var secMode = document.getElementById("secMode").value;
	var frequency = document.getElementById("frequency").value;
	if(secMode != "disable")
	{
		if(secMode=="WEP 128 bit")
		{
				if( frequency == "5 GHz" || frequency == "2.4 GHz e 5 GHz" )
				{
					document.getElementById("chiaveKOMsg").innerHTML = "<%=wepNotAllowedMsg%>";
					document.getElementById("wifiConfig").style.display="none";
					document.getElementById("keyConfig").style.display="block";
					return false;
				} else
				{								
					var wepKey = document.getElementById("wepKey").value;
					if(isEncrWepKey(wepKey)==false) {
						document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgInvalidWEPKey%>";
						document.getElementById("wifiConfig").style.display="none";
						document.getElementById("keyConfig").style.display="block";
						return false;
					}
				}
		}
		else
		{
			//if the key is invalid throw M17 error message.
			var wpaKey = document.getElementById("wpaKey").value;
			if( wpaKey.length < 12) {
				document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgInvalidWPAKey%>";

				document.getElementById("wifiConfig").style.display="none";
				document.getElementById("keyConfig").style.display="block";
				return false;
			}
			
			//check for key strength.
			var wpaKeyStrength  = indicateEncryptionKeyStrength(wpaKey,false);
			//if the encryption key is at strength low throw an error message.
			if( wpaKeyStrength == 1  ){		
			
				//alert("The wpa key strenth is in low");
				document.getElementById("invalidKeyStrengthMsg").innerHTML = "<%=errMsgInvalidWPAKey%>";
				document.getElementById("wifiConfig").style.display="none";
				document.getElementById("keyStrengthError").style.display="block";
				return false;
			} //if the key strength is meidium thorw a warning and execute further..
			else if ( wpaKeyStrength == 2 )
			{				
				//alert("The wpa key strenth is with medium");
				document.getElementById("wifiConfig").style.display="none";
				document.getElementById("keyStrengthWarning").style.display="block";
				return false;
			}		
		}
	} 
	confirmSecurityKeyWarning();
}

function  confirmSecurityKeyWarning()
{
	document.getElementById("keyStrengthWarning").style.display="none";
	isAccessPasswordSet();

}

function isAccessPasswordSet()
{
	<%if( isPasswordRequired == "false" ) then%>
		document.getElementById("wifiConfig").style.display="none";
		document.getElementById("accessPasswordWarning").style.display="block";
		return false;	
	<%end%>	
	checkGuestState();
}
function checkGuestState()
{
	document.getElementById("accessPasswordWarning").style.display="none";
	var guestEnabled = document.getElementById("wlanState1").checked;
	if( guestEnabled == true )
	{
		document.getElementById("WlanGuestStateWarningMsg").innerHTML = "<%=guestStateEnableWarningMsg%>";		
	}
	else
	{
		document.getElementById("WlanGuestStateWarningMsg").innerHTML = "<%=guestStateDisableWarningMsg%>";		
	}
	document.getElementById("wifiConfig").style.display="none";
	document.getElementById("guestStateWarning").style.display="block";
	return true;
}

function confirmGuestStateWarning()
{
	if( (isGuestToBeDisabled == true) || ( isGuestToBeDisabled == false  && currentState == "true"))
	{
		submit_ok_confirm();
		return true;
	}
	document.getElementById("guestStateWarning").style.display="none";
	//alert("in confirm security warning");
	var secMode = document.getElementById("secMode").value;
	if(secMode == "disable")
	{
		document.getElementById("encrOffMessage").innerHTML="<%=encrOffMessage%>";	
		document.getElementById("wifiConfig").style.display="none";
		document.getElementById("encrOffConfig").style.display="block";	
		
	}else if(secMode == "WEP 128 bit")
	{		
		document.getElementById("wifiConfig").style.display="none";
		document.getElementById("encrWepConfig").style.display="block";		
	}
	else{
		submit_ok();
	}
}

//this method is called from other warning files like WlanEncrOff.lp
function submit_ok()
{
	document.getElementById("wifiConfig").style.display="none";
	document.getElementById("encrWepConfig").style.display="none";	
	document.getElementById("encrOffConfig").style.display="none";	
	document.getElementById("confirmConfig").style.display="block";		
}

/* This method is invoked from confirmwlan.
 * CPE_P00106015- introduced this method.
 * To make minimal changes introduced this method instead of updating all other files.
*/
function submit_ok_confirm()
{	
	document.wlanGuestConfig.submit();	
}

function checkAclList()
{
	if(document.getElementById("aclControl").value != "disabled") 
	{
		<%
		if( aclList ~= nil ) then
			numberOfMAC =  #aclList[aclMacPath]
		end
		%>
		var aclSize=<%=numberOfMAC%>;
		if( aclSize == 0 ) 
		{
			document.getElementById("chiaveKOMsg").innerHTML = "<%=aclEmptyMsg%>";
			document.getElementById("wifiConfig").style.display="none";
			document.getElementById("keyConfig").style.display="block";
			return false;
		}
	}		
	return true;
}


function changeSecMode(secMode)
{
	if(secMode != "disable"){
		if(secMode=="WEP 128 bit"){			
			document.getElementById("wepKeyEncryption").style.display="block";
			document.getElementById("wpaKeyEncryption").style.display="none";
			document.getElementById("keyStrength").style.display="none";
		}else{
			document.getElementById("wepKeyEncryption").style.display="none";
			document.getElementById("wpaKeyEncryption").style.display="block";
		}
		document.getElementById("keyEncryption").style.display="";
	}else{
		document.getElementById("keyEncryption").style.display="none";
		document.getElementById("keyStrength").style.display="none";
	}
}

var symbols = " !\"#$%&'()*+,-./0123456789:;<=>?@";
var loAZ = "abcdefghijklmnopqrstuvwxyz";
symbols+= loAZ.toUpperCase();
symbols+= "[\\]^_`";
symbols+= loAZ;
symbols+= "{|}~";

function toHex(webKeyVal)
{	
	var valueStr = webKeyVal;
	var hexChars = "0123456789abcdef";
	var text = "";
	for( i=0; i<valueStr.length; i++ )
	{
		var oneChar = valueStr.charAt(i);
		var asciiValue = symbols.indexOf(oneChar) + 32;
		var index1 = asciiValue % 16;
		var index2 = (asciiValue - index1)/16;
		if ( text != "" ) text += " ";
		text += hexChars.charAt(index2);
		text += hexChars.charAt(index1);
	}

	return text;	
}

function toAscii(hex)
{
  var str = '';
  for (var i=0; i < hex.length; i +=2)
      str+=String.fromCharCode(parseInt(hex.substr(i,2),16));
  return str;
}

function format_hex(hex)
{
	var str = '';
	for(var i = 0; i < hex.length; i += 2)
		str += hex.substr(i, 2) + ' ';
	return str;
}

function asciiToHex(wepKeyVal){
	document.getElementById("wepHex").innerHTML=toHex(wepKeyVal);
}

function isEncrWepKey(str)
{
	var reg = /^[\da-zA-Z]{13}$/; 
	return reg.test(str);        
}

function isEncrWpaKey(str)
{

	var reg = /^[0-9a-zA-Z!@#$%^&*()_+\-={}.,\/<>?`~\[\]|;:\\]*$/; 	
	return reg.test(str);
}

var desc = new Array();
desc[1] = "<%=low%>";
desc[2] = "<%=medium%>";
desc[3] = "<%=high%>";

function indicateEncryptionKeyStrength(password,style)
{
	var secMode = document.getElementById("secMode").value;
    if( (style == true) && (secMode != "disable") )
	{
		document.getElementById("keyStrength").style.display="";
	}
	
	var score   = 1;
	var isSpecialCharExists = false;	
	var isAlphaNumericCharExists = false;
	var length =  password.length;
	

	//is any uppercase, lowervase and a number presents
	isAlphaNumericCharExists = ( ( password.match(/[a-zA-Z]/) )  && ( password.match(/\d+/) ) );
	
	//if password has at least one special caracther give 1 point
	isSpecialCharExists =  password.match(/.[!,@,#,$,%,^,&,*,(,),_,+,\-,=,{,},\,,.,\/,<,>,?,`,~,\[,\],|,;,:,\\]/);
	
	
	if ( length >= 12 && isAlphaNumericCharExists && isSpecialCharExists ) {
			score = 2;
		}
    if ( length >= 24 ) {
		score = 2;
		if ( isAlphaNumericCharExists && isSpecialCharExists ){
			score = 3;
		}
	}	

	//Chect at the last
	if( isEncrWpaKey(password) == false )
	{
		score=1;
	}
	document.getElementById("encryptionKeyStrengthDesc").innerHTML = desc[score];
	document.getElementById("encryptionKeyStrength").className = "strength" + score;
	return score;
}

function changeACL()
{
  if(document.getElementById("aclControl").value == "disabled")
    document.getElementById("addACL").style.display="none";
  else
    document.getElementById("addACL").style.display="";
}

function addMACACL()
{
  var vh = '0123456789aAbBcCdDeEfF';
  var mac = document.getElementById("aclMAC").value;
  var invalid = 0;
  if((mac=="") || (mac.length != 17)) {
    invalid = 1;
  } else {
    for(var i=0; i < mac.length; i++) {
      if(i%3==2) {
        if(mac.charAt(i) != ':') {
          invalid = 1;
          break;
        }
      }
      else {
        if(vh.indexOf(mac.charAt(i)) < 0) {
          invalid = 1;
          break;
        }
      }
    }
  }
  if(invalid)
  {
    document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgInvalidMAC%>";
    document.getElementById("wifiConfig").style.display="none";
    document.getElementById("keyConfig").style.display="block";
    return false;
  }
  <%if aclControl=="unlock" then%>
    if (<%=numberOfMAC%> >= 50)
    {
      document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgMACEnough%>";
      document.getElementById("wifiConfig").style.display="none";
      document.getElementById("keyConfig").style.display="block";
      return false;
    }
    <%for i,v in pairs(aclList[aclMacPath]) do%>
      if(mac == "<%=v.param["MACAddress"]%>")
      {
        document.getElementById("chiaveKOMsg").innerHTML = "<%=errMsgMACExist%>";
        document.getElementById("wifiConfig").style.display="none";
        document.getElementById("keyConfig").style.display="block";
        return false;
      }
    <%end%>
  <%end%>
  document.getElementById("macAdd_submit").removeAttribute("href");
  document.getElementById("macAdd_submit").onclick = null;
  document.getElementById("macAdd_submit_con").className = "addMAC_disable";
  document.getElementById("aclSubmitFlag").value = 1;
  document.wlanGuestConfig.submit();
}
//just added to invoke closeconfirm since this method is invoked from confirmwlan.
function cancel()
{
	closeConfirm();
}

function closeConfirm(){
	document.getElementById("wifiConfig").style.display="block";
	document.getElementById("keyConfig").style.display="none";
	document.getElementById("guestStateWarning").style.display="none";
	document.getElementById("keyStrengthError").style.display="none";
	document.getElementById("keyStrengthWarning").style.display="none";
	document.getElementById("encrOffConfig").style.display="none";
	document.getElementById("confirmConfig").style.display="none";
	document.getElementById("encrWepConfig").style.display="none";
	document.getElementById("accessPasswordWarning").style.display="none";
	
	wlanInit();
	var wlanState = "<%=wlanState%>";
	if(wlanState != "true"){	
		changeSecMode("<%=secMode%>");
	}
}
function getRandomString() {
	
	if("<%=wepKeyEncryption%>"=="" && document.getElementById("wepKey").value=="")
	{
		document.getElementById("wepKey").value = "<%=wepKeyPwd%>";
		asciiToHex("<%=wepKeyPwd%>");
	}	

	if("<%=wpaKeyEncryption%>"=="" && document.getElementById("wpaKey").value=="")
	{
		var wpaKeyStr = "<%=wpaKeyPwd%>";
		var level = indicateEncryptionKeyStrength(wpaKeyStr, true);
		if(level<3)
		{
			wpaKeyStr = "<%=wpaKeyPwdBak%>";
			indicateEncryptionKeyStrength(wpaKeyStr, true);
		}
		document.getElementById("wpaKey").value = wpaKeyStr;    
	}
}
</script>
</head>
<body>

<div class="contentContainer">
	 
		<div class="breadCrumbContainer" style="width:90%">
			<ul class="brdCrumb">
				<li><a href="standard.lp"><%=translate([==[Basic Settings]==])%></a></li><li>|</li>
				<li><a href="wlanStatus.lp?wifiPage=wifi">Wi-Fi</a></li><li>|</li>
				<li><a href="wlanGuestConfig.lp"><%=translate([==[Wi-Fi Guests]==])%></a></li>
			</ul>
		</div>	

		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a href="wlanGuestStatus.lp" >
			<div class="tab">
				<span class="tabIcon_stwifi"></span>  
				<span class="contTabTxt"><%=translate([==[Wi-Fi Guests]==])%></span>
			</div>
			<div class="clrBth"></div></a></li>
			<li><a href="wlanGuestConfig.lp" class="current margin15">
			<div class="tab">
				<span class="contTabTxt"><%=translate([==[Configure Wi-Fi Guests]==])%></span></div></a></li>	
			</ol>
		</div>

<div  id="wifiConfig" class='contentcontainer'>
<div class='contentitem fontSize'>
<form method="post" id="wlanGuestConfig" name="wlanGuestConfig" action="">
<!--aclSubmit flag is used -->
<input type="hidden" id="aclSubmitFlag" name="aclSubmitFlag" value="0" />

<input type="hidden" id="changeOtherIntfFlag" name="changeOtherIntfFlag" value="0" />


<%
		writePageHeader_new()
		
		--writeBlockNoTitle()		

		writeBlockTitle_Guest(translate([==[Wi-Fi Guests Configuration]==]))
		
		if wlanState == true then
			writeTableRow_Guest(translate([==[Configure Wi-Fi Guests]==]), "<input type='radio' value='enabled' id='wlanState1' name='wlanState' />&nbsp;"..translate([==[Actived]==]).."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='radio' value='disabled' id='wlanState2' name='wlanState' />&nbsp;"..translate([==[Inactived]==]))
			endBlock()
		else
			writeBlockRow_Guest1(translate([==[Wi-Fi Network]==]) .. " (SSID)", "<select size='1' id='anySSID' name='anySSID' class='inputClass' ><option value='true'>"..translate([==[Visible]==]).."</option><option value='false'>"..translate([==[Hidden]==]).."</option></select>&nbsp;&nbsp;<input type='text' id='ssid' name='ssid' size='20'  class='inputClass' maxlength='32' value='.. tostring(ssid) ..' />")
			
			writeBlockRow_Guest1(translate([==[Configure Wi-Fi Guests]==]), "<input type='radio' value='enabled' id='wlanState1' name='wlanState' onclick='getRandomString()'/>&nbsp;"..translate([==[Actived]==]).."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='radio' value='disabled' id='wlanState2' name='wlanState' />&nbsp;"..translate([==[Inactived]==]))

			writeBlockRow_Guest1(translate([==[Frequency]==]), "<select size='1' id='frequency' name='frequency' class='inputClass'><option value='2.4 GHz'>2.4 GHz</option><option value='5 GHz'>5 GHz</option><option value='2.4 GHz e 5 GHz'>2.4 GHz e 5 GHz</option></select>")
			
writeBlockRow_Guest1(translate([==[Automatically turn off after]==]), "<select size='1' id='disconnectTime' name='disconnectTime' class='inputClass'><option value='0'>"..translate([==[Never]==]).."</option><option value='1800'>30 "..translate([==[minutes]==]).."</option><option value='3600'>1 "..translate([==[hour]==]).."</option><option value='7200'>2 "..translate([==[hours]==]).."</option><option value='18000'>5 "..translate([==[hours]==]).."</option><option value='86400'>1 "..translate([==[day]==]).."</option></select>")

			local wepOption = "<option value='WEP 128 bit'>WEP (128-bit)</option>"		
			writeBlockRow_Guest1(translate([==[Methods of encryption]==]), "<select size='1' id='secMode' name='secMode' class='inputClass'  onchange='changeSecMode(this.value)'><option value='disable'>"..translate([==[disable]==]).."</option>"..wepOption.."<option value='WPA-PSK TKIP 256 bit'>WPA-PSK TKIP 256-bit</option><option value='WPA-PSK AES 256 bit'>WPA-PSK AES 256-bit</option><option value='WPA-PSK TKIP-AES 256 bit'>WPA-PSK TKIP-AES 256-bit</option></select>")	
				
			%>
			<tr  id="keyEncryption" style="display:<%=keyEncryptionStyle%>;"><td class="midarea4-2"  style="vertical-align: top;"><%=translate([==[Encryption key]==])%>:</td><td class="midarea4-3">
						<div id="wepKeyEncryption" style="display:<%=wepKeyStyle%>">
						<table border="0" cellpadding="0" cellspacing="0">
							<tr>			
							<td class="tdBianca_new" style="width:100%;"><input type="text" id="wepKey" name="wepKey" size="13" maxlength="13" value="" onkeypress="asciiToHex(this.value)" class='inputClass' /> [13 caratteri ASCII] </td></tr>

							<tr><td class="tdBianca_new" style="width:100%"><span id="wepHex"></span>&nbsp;[HEX]</td></tr>
						</table></div>
						<div id="wpaKeyEncryption" style="display:<%=wpaKeyStyle%>">
							<table border="0" cellspacing="0" cellpadding="0">
							<tr><td class="tdBianca_new" style="width:100%;">
							<input type="text" id="wpaKey" name="wpaKey" size="25" maxlength="32" value="<%=wpaKeyEncryption%>" onchange="indicateEncryptionKeyStrength(this.value,true)" onkeyup="indicateEncryptionKeyStrength(this.value,true)" class='inputClass' />
							[12 - 32 <%=translate([==[characters]==])%> ASCII]
							</td></tr>
						</table></div>			
			</td><td>&nbsp;</td></tr>

			<tr id="keyStrength" style="display:none">
			<td class="midarea4-2">&nbsp;</td>
				<td class="midarea4-3 verticalAlign" colspan='2'>	
					<table border="0" cellspacing="0" cellpadding="0" >
					<tr>
					<td style="vertical-align:middle;white-space:nowrap" >&nbsp;<%=translate([==[Key strength]==])%>&nbsp;:&nbsp;&nbsp;</td>
					<td>				
						<table>
							<tr>
								<td>
								<div id="encryptionKeyStrengthDesc" value="Low">Password not entered</div>
								</td>
							</tr>
							<tr>
								<td>
								<div id="encryptionKeyStrength" class="strength0"></div>	
								</td>
							</tr>
						</table>
					</td>
					</tr>
					</table>
				</td>	
			</tr>

			
			<%
			writeBlockRowCntrl_Access(translate([==[Access Control]==])..translate([==[: The feature allows you to restrict access to the Wi-Fi network to devices indicated]==]), "<select size='1' id='aclControl' class='inputClass' name='aclControl' onchange='changeACL();'><option value='disabled'>"..translate([==[Disabled]==]).."</option><option value='unlock'>"..translate([==[Enabled]==]).."</option></select>")

			endBlock()
		%>
		
		<div id="addACL" style="display:none">
		<%
			writeTableBlockTitle_Authdevices(translate([==[Authorized Devices]==]),40)
			local macNum = 0
			local rowStyle = "oddrow"
			if aclControl=="unlock" then
				if #aclList[aclMacPath] > 0 then
					writeWifiBlockHeader(3, translate([==[MAC Address]==]), translate([==[Access Management]==]), translate([==[Delete]==]))
			
					for i, v in pairs(aclList[aclMacPath]) do
						local authorized, unauthorized
						local mac=v.param["MACAddress"]
						if v.param["MACAddress"] ~= nil then
							if v.param["Permission"]=="allow" then
								authorized = 'checked="checked"'
								unauthorized = ""
							else
								unauthorized = 'checked="checked"'
								authorized = ""
							end
							macNum = macNum+1			
							if macNum%2==1 then				
								rowStyle = "oddrow"
							else 
								rowStyle = "evenrow"
							end		

							writeTableBlockRow(3, rowStyle, tostring(mac .. "<input type='hidden' id='mac".. i .."' name='mac".. i .."' value='"..mac.."'/>"), "<input type='radio' value='allow' ".. authorized .." name='permission".. i .."' />&nbsp;".. translate([==[Authorized]==]) .."&nbsp;&nbsp;&nbsp;<input type='radio' value='deny' ".. unauthorized .." name='permission".. i .."' />&nbsp;" .. translate([==[Unauthorized]==]), "<input type='checkbox' name='delMac".. i .."' value='ON' />")
						end
					end
					
				end
			end
			
			if rowStyle == "oddrow" then
				rowStyle = "evenrow"
			else
				rowStyle = "oddrow"
			end
			
			
			writeTableBlockRowCtrl_wifihidden(3, rowStyle, tostring("<table><tr><td style='width:250px;padding-left:0px;'><input type='text' id='aclMAC' class='inputClass' name='aclMAC' size='17' maxlength='17' value='' />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style='width:250px'><select size='1' id='aclOption' name='aclOption' class='inputClass' ><option value='allow'>"..translate([==[Authorized]==]).."</option><option value='deny' selected='true'>"..translate([==[Unauthorized]==]).."</option></select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style='width:250px' class='padtop5'><a id='macAdd_submit' href='#' onclick='addMACACL();' class=''><div id='macAdd_submit_con' class='addMAC' name='thb8'>"..translate([==[Add]==]).."</div></a></td></tr></table>"))
			

			endBlock()
		%>
		<input type='hidden' id='macNum' name='macNum' value='<%=macNum%>'/>
		</div>
	
	<%end%>
	<!-- end of disable block -->
	<!-- Message added as CPE_P00106455 -->
	<table>
	<tr><td style='vertical-align:top;height:50px;width:750px;padding-left:34px;' class="midarea4-2" ><%=translate([==[The configuration of parameters for Guest Wi-Fi is only possible when enabling the interface at the same time]==])%></td></tr></table>
	<!-- end of message -->
	<br>
	<table cellspacing='0' cellpadding='0' width='100%' style="text-align:center">
				<tr><td style="text-align:left;">
				<table cellspacing='0' cellpadding='0'><tr>
				<td style='padding-left:250px'>
				<a  onclick='confimConfig()' style='color:black' href='#'>
					<div class='midarea6-1 mainButton' name="thb6" ><%=translate([==[Save]==])%>
					</div></a>
					</td>

					<td style='padding-left:50px'>
						<a style="color:black" onclick='javascript: document.location.href="wlanGuestStatus.lp";'>
							<div class='midarea6-1 mainButton' name="thb7"><%=translate([==[Cancel]==])%></div>
						</a>
					</td>
				</tr>	
	</table>
	</td></tr></table>
	<%	
	endPage()
	%>
	
</form>
</div>
</div>

<div id="guestStateWarning" style="display:none">
<%cgilua.lp.include("webparts/wlanGuestStateWarning.lp")%>
</div>

<div id="keyConfig" style="display:none">
<%cgilua.lp.include("webparts/chiaveKO.lp")%>
</div>

<div id="keyStrengthError" style="display:none">
<%cgilua.lp.include("webparts/keyStrengthKO.lp")%>
</div>

<div id="keyStrengthWarning" style="display:none">
<%cgilua.lp.include("webparts/wpaKeyStrengthWarning.lp")%>
</div>

<div id="encrOffConfig" style="display:none">
<%cgilua.lp.include("webparts/WlanEncrOff.lp")%>
</div>

<div id="encrWepConfig" style="display:none">
<%cgilua.lp.include("webparts/WlanEncrWEP.lp")%>
</div>	
<div id="confirmConfig" style="display:none">
<%cgilua.lp.include("webparts/confirmWlan.lp")%>
</div>

<div id="accessPasswordWarning" style="display:none">
<div class='contentcontainer'>
<div class='contentitem'>
	<table cellspacing='0' cellpadding='0' width='100%' class="width790 marleft5 martop5">
                  <tr>
                    <td class="verticalAlign padleft35">
                      <div class="width50 fleft"><img src='images/warn__xl.png' alt='Technicolor Gateway'></div>
					  <div class="errInfo"><%=translate([==[Info]==])%></div>
                    </td>
                  </tr>
                  <tr>
                    <td class="verticalAlign">
                      <table width='100%' cellspacing='0' cellpadding='0' class="PageMessage" style="text-align:left">
                        <tr>
                          <td class="errorMessage"><%=translate([==[You are about to make changes]==])%>.</td></tr>
            <tr><td class="errorDesc" id="accessPwdWarningMesg">
			<p><%=translate([==[Warning: Before enabling Wi-Fi Guest it is recommended for safety reasons to set the password for access to the pages of Management Modem.It is must to enter the password each time you access the pages in Management modem.]==])%></p>
		<br/>
                 </td></tr></table>
                   </td></tr>
                   <tr><td>
                      <table  cellspacing='0' cellpadding='0' class="fontSize padtop10 width790">
                         <tr><td class="verticalAlign fright">
                            <a class="fright" href="#" onclick="checkGuestState()"><div class='midarea6-1 mainButton' name="thb11"><%=translate([==[Next]==])%> </div></a></td>
				   <td  class="verticalAlign" style="padding-left:15px;">
				   <a href="#" onclick="closeConfirm()"><div class='midarea6-1 mainButton' name="thb12"><%=translate([==[Cancel]==])%></div></a>               
			</td></tr>
                   </table>
        </td></tr>
		</table>
</div>
</div>
</div>

<script src="js/antiCSRF.js" type="text/javascript"></script>
<script language="javascript" type="text/javascript">
function wlanInit()
{

var wlanState = "<%=wlanState%>";
if(wlanState == "true"){
	document.getElementById("wlanState1").checked = true;
	return true;
}else{	
	document.getElementById("wlanState2").checked = true;
}

var anyssid = "<%=anyssid%>";
document.getElementById("anySSID").value = anyssid;
document.getElementById("ssid").value = "<%=ssid%>";

var frequency = "<%=frequency%>";
if(frequency=="Not applicable")
{
	frequency = "2.4 GHz e 5 GHz"
}
document.getElementById("frequency").value = frequency;

var disconnectTime = "<%=disconnectTime%>";
document.getElementById("disconnectTime").value=disconnectTime;

var secMode = "<%=secMode%>";
document.getElementById("secMode").value = secMode;
var wepKey = "<%=wepKeyEncryption%>";
var wepKeyHex;
var wepKeyAscii;

if (wepKey.length==13)
{
 wepKeyHex=toHex(wepKey);
 wepKeyAscii=wepKey;
}
else
{
 //why Ascii then hex, just add whitespace in 2 digit in HEX format, TI requrest
 wepKeyHex=format_hex(wepKey);
 wepKeyAscii=toAscii(wepKey);
}

document.getElementById("wepKey").value=wepKeyAscii;
document.getElementById("wepHex").innerHTML=wepKeyHex;

var aclControl = "<%=aclControl%>";
document.getElementById("aclControl").value = aclControl;
changeACL();


}
wlanInit();


</script>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
<!-- <link rel="stylesheet" href="css/style.css" type="text/css" /> -->
<link rel="stylesheet" href="css/master.css" type="text/css" />
</head>
<%
cgilua.lp.include("lp/wlan.lp")
cgilua.lp.include("lp/util.lp")
cgilua.lp.include("lp/mbus_util.lp")
cgilua.lp.include("lp/style.lp")
cgilua.lp.include("lp/device.lp")
cgilua.lp.include("lp/wlanGuestUtil.lp")
local tprint = require("tableprint")
local translate = translate
local POST = cgilua.POST

local wifi2Index = 1
local wifi2GuestIndex = 2
local wifi5GuestIndex = 4
local wifiIndexList = {wifi2Index,wifi2GuestIndex,wifi5GuestIndex}
local currentTime
local savedTime
local result = {}
local wlanInfo = {}

result[wifi2Index] = getWlanMain("WLAN.Intf.wlif1")
result[wifi2GuestIndex] = getWlanMain("WLAN.Intf.wl_ssid1_local0")
result[wifi5GuestIndex] = getWlanMain("WLAN.Intf.wle_radio1_ssid1")

for itr=1,#wifiIndexList do
	i=wifiIndexList[itr]
	wlanInfo[i] = {}
	if result[i].ssid ~= nil then
		wlanInfo[i].ssid = result[i].ssid .. " (" .. translate([==[Visible]==]) .. ")"
		if result[i].anyssid == "false" then
			wlanInfo[i].ssid = result[i].ssid .. " (" .. translate([==[Hidden]==]) .. ")"
		end
		
		wlanInfo[i].wpaVersion = string.gsub(result[i].wpaversion,"&","-")
		wlanInfo[i].wpaEncryption = result[i].encryption
		if wlanInfo[i].wpaVersion=="WPA" then
			wlanInfo[i].wpaEncryption = "TKIP"
		end
		
		local pos = string.find(wlanInfo[i].wpaEncryption,"&")
		if pos~=nil then
			wlanInfo[i].wpaEncryption = string.gsub(wlanInfo[i].wpaEncryption,"&","-")
		end
	
		wlanInfo[i].wpsRegistrationStyle = "none"
		wlanInfo[i].keyEncryption = ""
		wlanInfo[i].secMode = translate([==[disable]==])
		
		if result[i].secmode=="WEP" then 
			wlanInfo[i].secMode = "WEP (128 bit)"
			if string.len(result[i].wep) == 13 then
				wlanInfo[i].keyEncryption = result[i].wep .. " [ASCII]"
			elseif string.len(result[i].wep) == 26 then
				-- insert a space in 2 hex digit as TI spec require
				wlanInfo[i].keyEncryption = string.gsub(result[i].wep,"%x%x","%0 ", 12) .. " [HEX]"
			end	
		elseif result[i].secmode=="WPA-PSK" then
			wlanInfo[i].secMode = result[i].secmode .. " " .. wlanInfo[i].wpaEncryption .. " 256 bit"
			if string.len(result[i].wpa) == 64 then
				wlanInfo[i].keyEncryption = result[i].wpa .. " [HEX]"
			else
				wlanInfo[i].keyEncryption = result[i].wpa .. " [ASCII]"
			end
			wlanInfo[i].wpsRegistrationStyle = ""
		end
   		if i==1 then
   		    WIntfAclMacPath ="WLAN.Intf.wlif1.ACL.MAC"
   		elseif i==2 then
   		    WIntfAclMacPath="WLAN.Intf.wl_ssid1_local0.ACL.MAC"
   		elseif i==3 then
   		    WIntfAclMacPath="WLAN.Intf.wle_radio1_ssid0.ACL.MAC"
   		elseif i==4 then
   		    WIntfAclMacPath="WLAN.Intf.wle_radio1_ssid1.ACL.MAC"
   		end 
		wlanInfo[i].aclMacPath = WIntfAclMacPath
		wlanInfo[i].aclControl = translate([==[Disabled]==])
		if result[i].control=="unlock" then
			wlanInfo[i].aclControl = translate([==[Enabled]==]) 
		end		
	end
end
	
--temp var
local n=1

local tprint = require("tableprint")
local print = cgilua.print

local errMsgOff1 = "<p>" .. translate([==[The Wi-Fi at 2.4 GHz is turned off. Wi-Fi will be detected only at 5 GHz networks.]==]).. "</p>"
local errMsgOff2 = "<p>" .. translate([==[The Wi-Fi at 5 GHz is turned off. Wi-Fi will be detected only at 2.4 GHz networks.]==]).. "</p>"

local wifistatus = "disabled"

local SSID3Path = "Device.WiFi.SSID.3"
local SSID4Path = "Device.WiFi.SSID.4"

local accessPoint3Path = "Device.WiFi.AccessPoint.3"	
local accessPoint3SecurityPath = "Device.WiFi.AccessPoint.3.Security"
local accessPoint3WPSPath = "Device.WiFi.AccessPoint.3.WPS"

local accessPoint4Path = "Device.WiFi.AccessPoint.4"
local accessPoint4SecurityPath = "Device.WiFi.AccessPoint.4.Security"
local accessPoint4WPSPath = " Device.WiFi.AccessPoint.4.WPS"

local radio1Path = "Device.WiFi.Radio.1"
local radio2Path = "Device.WiFi.Radio.2"
local wifi2GuestPath = "WLAN.Intf.wl_ssid1_local0"  
local wifi5GuestPath = "WLAN.Intf.wle_radio1_ssid1"  
local aclMacPathGuest5 = wifi5GuestPath .. ".ACL.MAC"

--getAccessPointData(accessPoint3Path)

local ap3PointResult, accessPoint3Error = mbus.getParameters{ 	{ path=accessPoint3Path, param={"SSIDAdvertisementEnabled","Enable","X_TELECOMITALIA_IT_DisconnectTime"} },
																{ path = accessPoint3SecurityPath,param={"ModesSupported","ModeEnabled","WEPKey","KeyPassphrase"} },
																{ path = accessPoint3WPSPath, param="Enable" }, datamodel = "second" }

local ap4PointResult, accessPoint4Error = mbus.getParameters{	{ path=accessPoint4Path, param={"SSIDAdvertisementEnabled","Enable","X_TELECOMITALIA_IT_DisconnectTime"}},
																{ path = accessPoint4SecurityPath,param={"ModesSupported","ModeEnabled","WEPKey","KeyPassphrase"}},
																{ path = accessPoint4WPSPath, param="Enable"}, datamodel = "second" }


local tempResult, tempError = mbus.getParameters{ { path=SSID3Path, param="Enable"},
													{ path=SSID4Path, param="Enable"},
													{ path=radio1Path, param="Enable"},
													{ path=radio2Path, param="Enable"}, datamodel = "second" }


wlanInfo[wifi2GuestIndex].apEnabled = ap3PointResult[accessPoint3Path][1].param["Enable"]
wlanInfo[wifi5GuestIndex].apEnabled = ap4PointResult[accessPoint4Path][1].param["Enable"]

wlanInfo[wifi2GuestIndex].ssidEnabled = tempResult[SSID3Path][1].param["Enable"]
wlanInfo[wifi5GuestIndex].ssidEnabled = tempResult[SSID4Path][1].param["Enable"]
wlanInfo[wifi2GuestIndex].radioEnabled = tempResult[radio1Path][1].param["Enable"]
wlanInfo[wifi5GuestIndex].radioEnabled = tempResult[radio2Path][1].param["Enable"]

wlanInfo[wifi2GuestIndex].disconnectTime = ap3PointResult[accessPoint3Path][1].param["X_TELECOMITALIA_IT_DisconnectTime"]

--get guest enabled status
local guestEnabled = getGuestStatus()

--get frequency
local frequency = getWifiFrequency()

--[[calculate time
local reply,error = mbus.getParameters{path = "Time",param = "Time"}
currentTime = reply["Time"][1].param["Time"]
]]

local reply1,error1 = mbus.getParameters{path = "ENV.Wlan_Time",param = "Value",flags = "KEYPATH"}
if reply1["ENV.Wlan_Time"][1] ~= nil and reply1["ENV.Wlan_Time"][1].param ~= nil and reply1["ENV.Wlan_Time"][1].param["Value"] ~= nil then
savedTime = tonumber( reply1["ENV.Wlan_Time"][1].param["Value"] )
end

-- For Time display

local disconnect_time = "00:00:00"

if (wlanInfo[wifi2GuestIndex].disconnectTime == "0") then
	--BHS TESSA 630
	disconnect_time = translate([==[Never]==])
	--CPE_P00110356
	--disconnect_time = "01:00:00"	
elseif (wlanInfo[wifi2GuestIndex].disconnectTime == "1800") then
	disconnect_time = "00:30:00"
elseif (wlanInfo[wifi2GuestIndex].disconnectTime == "3600") then
	disconnect_time = "01:00:00"
elseif (wlanInfo[wifi2GuestIndex].disconnectTime == "7200") then
	disconnect_time = "02:00:00"
elseif (wlanInfo[wifi2GuestIndex].disconnectTime == "18000") then
	disconnect_time = "05:00:00"
elseif (wlanInfo[wifi2GuestIndex].disconnectTime == "86400") then
	disconnect_time = "24:00:00"
end


%>

<body>
<script language="JavaScript" type="text/javascript">
var symbols = " !\"#$%&'()*+,-./0123456789:;<=>?@";
var loAZ = "abcdefghijklmnopqrstuvwxyz";
symbols+= loAZ.toUpperCase();
symbols+= "[\\]^_`";
symbols+= loAZ;
symbols+= "{|}~";


function hour_sec(param) {
var a = param.split(":");
var seconds = (+a[0])*60*60 + (+a[1])*60 + (+a[2]);
return seconds
}
function sectohr(sec) {

var numhours = Math.floor((sec%86400)/3600);
var nummin = Math.floor(((sec%86400)%3600)/60);
var numsec = ((sec%86400)%3600)%60;
if(numhours <= 9)
{
numhours = "0"+numhours;
}
if(nummin <= 9)
{
nummin = "0"+nummin;
}
if(numsec <= 9)
{
numsec = "0"+numsec;
}
return numhours + ":" + nummin + ":" + numsec;
			
}
function toHex(webKeyVal)
{	
	var valueStr = webKeyVal;
	var hexChars = "0123456789abcdef";
	var text = "";
	for( i=0; i<valueStr.length; i++ )
	{
		var oneChar = valueStr.charAt(i);
		var asciiValue = symbols.indexOf(oneChar) + 32;
		var index1 = asciiValue % 16;
		var index2 = (asciiValue - index1)/16;
		if ( text != "" ) text += " ";
		text += hexChars.charAt(index2);
		text += hexChars.charAt(index1);
	}
	return text;	
}

function toAscii(hex)
{
  var str = '';
  for (var i=0; i < hex.length; i +=2)
    str+=String.fromCharCode(parseInt(hex.substr(i,2),16));
  return str;
}
</script>
<div class="contentContainer">
	 
		<div class="breadCrumbContainer" style="width:90%">
			<ul class="brdCrumb">
				<li><a href="standard.lp"><%=translate([==[Basic Settings]==])%></a></li><li>|</li>
				<li><a href="wlanStatus.lp?wifiPage=wifi">Wi-Fi</a></li><li>|</li>
				<li><a href="wlanGuestStatus.lp"><%=translate([==[Wi-Fi Guests]==])%></a></li>
			</ul>
		</div>	

		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a href="wlanGuestStatus.lp" class="current">
		<div class="tab">
			<span class="tabIcon_stwifi"></span>  
			<span class="contTabTxt"><%=translate([==[Wi-Fi Guests]==])%></span>
		</div>
		<div class="clrBth"></div></a></li>
		<% if isRemoteAccess() == false then %>
		<li><a class="margin15" href="wlanGuestConfig.lp">
			<div class="tab">
				<span class="contTabTxt"><%=translate([==[Configure Wi-Fi Guests]==])%></span></div></a></li>
		<% end %>	
			</ol>
		</div>

<div class='contentcontainer'>
<div id="wifiStatus">
	<div class='contentitem' class="fontSize">
	<%
		writePageHeader_new()
		--writeBlockNoTitle()
		
		writeBlockRowTitle_Guest(translate([==[Wi-Fi Guests Settings]==]))
			
		writeBlockRow_WifiGuest(translate([==[Wi-Fi Network]==]) .. " (SSID)", wlanInfo[wifi2GuestIndex].ssid)

		
		if( guestEnabled == true ) then
			writeBlockRow_WifiGuest(translate([==[Wi-Fi Guests Status]==]), translate( [==[Actived]==] ) )
		else
			writeBlockRow_WifiGuest(translate([==[Wi-Fi Guests Status]==]), translate( [==[Inactived]==] ) )
		end
		
		writeBlockRow_WifiGuest(translate([==[Frequency]==]), frequency)
%>
	
	<tr><td class="wifiMidarea4-2" style="padding-top:0px;"><%=translate([==[Auto Shut-off between]==])%>:</td><td class="midarea4-3" style="padding-top:0px;" id = 'test'></td><td>&nbsp;</td></tr>

<%		
		writeBlockRow_WifiGuest(translate([==[Methods of encryption]==]), wlanInfo[wifi2GuestIndex].secMode)
		
		if result[wifi2GuestIndex].secmode ~= "disabled" then
	%>
		<tr><td class="wifiMidarea4-2" style="padding-top:0px;"><%=translate([==[Encryption key]==])%>:</td>
		<td class="midarea4-3" colspan='3' style="padding-top:0px;"><%=wlanInfo[wifi2GuestIndex].keyEncryption%>
		<%if result[wifi2GuestIndex].secmode=="WEP" then%>
			<div id="wepHex<%=wifi2GuestIndex%>"></div>		
		<%end%>
		</td>
		</tr>
	<%	
		end
		writeBlockRow_WifiGuest(translate([==[Access Control]==]), wlanInfo[wifi2GuestIndex].aclControl)
		 
		endBlock()	
		endPage()
		
		if result[wifi2GuestIndex].control=="unlock" then
			
			local aclList, error = mbus.getParameters{ path=wlanInfo[wifi2GuestIndex].aclMacPath, param={"MACAddress", "Permission"} ,flags="KEYPATH"}
			local aclListGuest5, error2 = mbus.getParameters{ path=aclMacPathGuest5, param={"MACAddress", "Permission"} ,FLAGS="KEYPATH"}
			aclList = getMergedList(aclList,aclListGuest5)
			if #aclList[wlanInfo[wifi2GuestIndex].aclMacPath] > 0 then
				writeTableBlockTitle_Wifidevices(translate([==[Authorized Devices]==]),40)
%>
  <tr><td colspan='2'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
  <tr><td colspan='2'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
  <tr>
        <td class="macAddTitle tableHd" style="padding-left: 0px;" ><%=translate([==[MAC Address]==])%></td>
        <td class="tableHd" style="padding-left: 0px;"><%=translate([==[Access Management]==])%></td>
  </tr>
  <tr><td colspan='2'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr>
  <tr><td colspan='2'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>

<%				local rowStyle = "oddrow"
				local rowNum = 0
				for i, v in pairs(aclList[wlanInfo[wifi2GuestIndex].aclMacPath]) do
					local str = translate([==[Authorized]==])
					if v.param["Permission"]=="deny" then
						str = translate([==[Unauthorized]==])
					end
					if v.param["MACAddress"] ~= nil then
						rowNum = rowNum + 1
						if rowNum%2==1 then
							rowStyle = "oddrow"
						else
							rowStyle = "evenrow"
						end
						writeTableBlockRow_Guest(2, rowStyle, v.param["MACAddress"], str)
					end
				end
				endBlock()
			end
		end 
	endBlock()
	%>

</div>
<script language="javascript" type="text/javascript">
<%if result[wifi2GuestIndex].secmode=="WEP" then%>
var wepKey = "<%=result[wifi2GuestIndex].wep%>";

if (wepKey.length==13)
  document.getElementById("wepHex<%=wifi2GuestIndex%>").innerHTML=toHex(wepKey)+" [HEX]";


<%end%>
function time_config() {
	var time
	
	<%if ( guestEnabled == true and wlanInfo[wifi2GuestIndex].disconnectTime ~= "0" ) then
	        -- fix for CPE_P00118328, use Time.SystemUpTime instead of os.time for countdown timer calculations
		local CurrTime = 0
	        local reply1,error1 = mbus.getParameters{path = "Time",param = "SystemUpTime"}
	        if reply1["Time"][1] ~= nil and reply1["Time"][1].param ~= nil and reply1["Time"][1].param["SystemUpTime"] ~= nil then
	        	CurrTime = tonumber( reply1["Time"][1].param["SystemUpTime"] )
	        end
	    if savedTime == nil then
	       savedTime = CurrTime
	    end
		local diffTime = CurrTime - savedTime
		local diff = tonumber(wlanInfo[wifi2GuestIndex].disconnectTime)- diffTime
		--local time = translate([==[Never]==])
		local time = "01:00:00"
		if( diff > 0 ) then
			local baseTime = os.time{year=1970, month=1, day=1, hour=0, min=0, sec=0}
			local tt = os.date("*t", baseTime+diff)
			--cgilua.errorlog("diff Time is...")
				if(tt["hour"] <= 9) then					
					tt["hour"] = "0" .. tt["hour"]
				end
				if(tt["min"] <= 9) then					
					tt["min"] = "0" .. tt["min"]
				end
				if(tt["sec"] <= 9) then					
					tt["sec"] = "0" .. tt["sec"]
				end
			time = tt["hour"]..":"..tt["min"]..":"..tt["sec"]
			--cgilua.errorlog(tt["hour"]..":"..tt["min"]..":"..tt["sec"])
		end
	%>
		time = "<%=time%>"
	<%else%>
		time="<%=disconnect_time%>";
	<%end%>
	
	document.getElementById("test").innerHTML = time;
}
time_config();
</script>

</div>
</div>
</div>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Modem Telecom Italia</title>
<!-- <link rel="stylesheet" href="css/style.css" type="text/css" /> -->
<link rel="stylesheet" href="css/master.css" type="text/css" />
<script type="text/javascript">
function enableWifi()
{	
	if(window.parent.menu.document.getElementById("home")!=null && 
		window.parent.menu.document.getElementById("home") != "undefinded") {
		window.parent.menu.document.getElementById("home").style.display="block";
		window.parent.menu.document.getElementById("home").className="";
	}
	
	if(window.parent.menu.document.getElementById("base")!=null && 
		window.parent.menu.document.getElementById("base") != "undefinded") {
		window.parent.menu.document.getElementById("base").className="Icons";
	}

	if(window.parent.menu.document.getElementById("d2")!=null && 
		window.parent.menu.document.getElementById("d2") != "undefinded") {
		window.parent.menu.document.getElementById("d2").style.display="block";
	}

	if(window.parent.menu.document.getElementById("stcon")!=null && 
		window.parent.menu.document.getElementById("stcon") != "undefinded") {
		window.parent.menu.document.getElementById("stcon").className="";
	}

	if(window.parent.menu.document.getElementById("serte")!=null && 
		window.parent.menu.document.getElementById("serte") != "undefinded") {
		window.parent.menu.document.getElementById("serte").className="";
	}

	if(window.parent.menu.document.getElementById("lanst")!=null && 
		window.parent.menu.document.getElementById("lanst") != "undefinded") {
		window.parent.menu.document.getElementById("lanst").className="";
	}


	if(window.parent.menu.document.getElementById("asst")!=null && 
		window.parent.menu.document.getElementById("asst") != "undefinded") {
		window.parent.menu.document.getElementById("asst").className="";
	}
	if(window.parent.menu.document.getElementById("stat")!=null && 
		window.parent.menu.document.getElementById("stat") != "undefinded") {
		window.parent.menu.document.getElementById("stat").className="";
	}
	if(window.parent.menu.document.getElementById("loac")!=null && 
		window.parent.menu.document.getElementById("loac") != "undefinded") {
		window.parent.menu.document.getElementById("loac").className="";
	}
	if(window.parent.menu.document.getElementById("advance")!=null && 
		window.parent.menu.document.getElementById("advance") != "undefinded") {
		window.parent.menu.document.getElementById("advance").style.display="block";
	}
	
}
</script>
</head>
<%
cgilua.lp.include("lp/wlan.lp")
cgilua.lp.include("lp/util.lp")
cgilua.lp.include("lp/mbus_util.lp")
cgilua.lp.include("lp/style.lp")
cgilua.lp.include("lp/device.lp")
cgilua.lp.include("lp/wlanGuestUtil.lp")

local translate = translate
local POST = cgilua.POST

local wifi2Index = 1
local wifi5Index = 3
local wifiIndexList = {wifi2Index,wifi5Index}

--temp var
local n=1

local tprint = require("tableprint")
local print = cgilua.print

if cgilua.servervariable"REQUEST_METHOD" == "POST" then
	local modify = {}

	-- Change WiFi radio state
	local state = "true"
	if POST["wlanState"]=="0" then
		state = "false"
	end
	table.insert(modify, { path="Device.WiFi.Radio.1", param = {Enable = state}, datamodel = "second" })
	table.insert(modify, { path="Device.WiFi.Radio.2", param = {Enable = state}, datamodel = "second" })
	
	setMBUS_IGD(modify)
	
	saveall(0, 1)
	cgilua.redirect("save_alert.lp", { u = "wlanStatus.lp?wifiPage=wifi"})
	return
end

--scan list should be updated before getting the list info.
local showStyle = "block"
local linkStyle = cgilua.QUERY["linkStyle"] 

if cgilua.QUERY["linkStyle"]~=nil then
  showStyle = "none"
  --aplist scan update
  local modify = {}
  local ret, error = mbus.getParameters{ path = "WLAN.Intf", param= "Status" }

  if ret["WLAN.Intf"][wifi2Index].param["Status"]=="enabled" then
    table.insert(modify,{path="WLAN.Intf.wlif1.ACS", param= {Rescan="1"}})
  end
  if ret["WLAN.Intf"][wifi5Index].param["Status"]=="enabled" then
    table.insert(modify,{path="WLAN.Intf.wle_radio1_ssid0.ACS", param= {Rescan="1"}})
  end
  if #modify > 0 then
    setMBUS(modify)
  end
else
  linkStyle = "none"
end

local isRemote = isRemoteAccess()
local board = getBoardInfo()

local result = {}
local linkInfo = {}
local wlanInfo = {}
--[[
result[wifi2Index] = getWlanMain("WLAN.Intf.wlif1")
linkInfo[wifi2Index] = getLinkInfo("WLAN.Intf.wlif1")
result[wifi5Index] = getWlanMain("WLAN.Intf.wle_radio1_ssid0")
linkInfo[wifi5Index] = getLinkInfo("WLAN.Intf.wle_radio1_ssid0")
]]
local tempPath
local radio_IntfPath
local reply, error
local intf_Status = {}
local radio_Status = {}
local WIntfaclMACPath
local WIntfPath
for i = 1, 4 do
	if i==1 then
	   WIntfPath ="WLAN.Intf.wlif1"
	elseif i==2 then
	   WIntfPath="WLAN.Intf.wl_ssid1_local0"
	elseif i==3 then
	   WIntfPath="WLAN.Intf.wle_radio1_ssid0"
	elseif i==4 then
	   WIntfPath="WLAN.Intf.wle_radio1_ssid1"
	end

	--tempPath = "WLAN.Intf."..i
	radio_IntfPath = "Device.WiFi.Radio."..i
	result[i] = getWlanMain(WIntfPath)
	linkInfo[i] =  getLinkInfo(WIntfPath)

	local reply, error = mbus.getParameters{ path = radio_IntfPath, param = "Status", datamodel = "second"}		
	intf_Status[i] = reply[radio_IntfPath][1].param["Status"]
	if intf_Status[i] ~= nil and intf_Status[i] == "Up" then
		radio_Status[i] = translate([==[Active]==])
	else
		radio_Status[i] = translate([==[Not active]==])
	end
	
end

--temp var
local i = 1

for itr=1,#wifiIndexList do
  i=wifiIndexList[itr]

  wlanInfo[i] = {}
  --print("wifiIndex ",i)
  if result[i].ssid ~= nil then
    wlanInfo[i].status = result[i].status
    wlanInfo[i].wlanState = translate([==[Active]==])
    if result[i].status=="disabled" then
      wlanInfo[i].wlanState = translate([==[Not active]==])
    end

    wlanInfo[i].ssid = result[i].ssid .. " (" .. translate([==[Visible]==]) .. ")"
    if result[i].anyssid == "false" then
      wlanInfo[i].ssid = result[i].ssid .. " (" .. translate([==[Hidden]==]) .. ")"
    end

     --[[ wlanInfo[i].channelWidth = result[i].channelwidth .. " MHz (" .. translate([==[Manual]==]) .. ")"
    if result[i].channelwidth == "20/40" then
      wlanInfo[i].channelWidth = result[i].channelwidth .. " MHz (" .. translate([==[Automatic]==]) .. ")"
    end 
	]]
	
	--print("Current Channel Width"..result[i].channelwidth)

    wlanInfo[i].channelWidth = result[i].channelwidth .. " MHz"
    if result[i].channelwidth == "20" then
                wlanInfo[i].channelWidth = result[i].channelwidth .. " MHz"
    elseif result[i].channelwidth == "20/40" then
                wlanInfo[i].channelWidth = "Auto 20 MHz / 40 MHz"
    end
	
    wlanInfo[i].wlanChannel = result[i].channel .. " (" .. translate([==[Manual]==]) .. ")"
    if result[i].channelmode=="Auto" then
      wlanInfo[i].wlanChannel = result[i].channel .. " (" .. translate([==[Automatic]==]) .. ")"
    end
    wlanInfo[i].wpaVersion = string.gsub(result[i].wpaversion,"&","-")
    wlanInfo[i].wpaEncryption = result[i].encryption
    if wlanInfo[i].wpaVersion=="WPA" then
      wlanInfo[i].wpaEncryption = "TKIP"
    end
    local pos = string.find(wlanInfo[i].wpaEncryption,"&")
    if pos~=nil then
      wlanInfo[i].wpaEncryption = string.gsub(wlanInfo[i].wpaEncryption,"&","-")
    end
    
    wlanInfo[i].wpsRegistrationStyle = "none"
    wlanInfo[i].keyEncryption = ""
    wlanInfo[i].secMode = translate([==[disable]==])
    if result[i].secmode=="WEP" then 
      wlanInfo[i].secMode = "WEP (128 bit)"
      if string.len(result[i].wep) == 13 then
        wlanInfo[i].keyEncryption = result[i].wep .. " [ASCII]"
      elseif string.len(result[i].wep) == 26 then
        -- insert a space in 2 hex digit as TI spec require
        wlanInfo[i].keyEncryption = string.gsub(result[i].wep,"%x%x","%0 ", 12) .. " [HEX]"
      end	
    elseif result[i].secmode=="WPA-PSK" then
      wlanInfo[i].secMode = result[i].secmode .. " " .. wlanInfo[i].wpaEncryption .. " 256 bit"
      if string.len(result[i].wpa) == 64 then
        wlanInfo[i].keyEncryption = result[i].wpa .. " [HEX]"
      else
        wlanInfo[i].keyEncryption = result[i].wpa .. " [ASCII]"
      end
      wlanInfo[i].wpsRegistrationStyle = ""
    end
    if i==1 then
           WIntfaclMACPath ="WLAN.Intf.wlif1"
    elseif i==2 then
           WIntfaclMACPath="WLAN.Intf.wl_ssid1_local0"
    elseif i==3 then
           WIntfaclMACPath="WLAN.Intf.wle_radio1_ssid0"
    elseif i==4 then
           WIntfaclMACPath="WLAN.Intf.wle_radio1_ssid1"
    end
    wlanInfo[i].aclMacPath = WIntfaclMACPath..".ACL.MAC"
    wlanInfo[i].aclControl = translate([==[Disabled]==])
    if result[i].control=="unlock" then
      wlanInfo[i].aclControl = translate([==[Enabled]==]) 
    end
    local WIntfSTAPath
    --Wi-Fi Links of station signal
     if i==1 then
           WIntfSTAPath ="WLAN.Intf.wlif1"
     elseif i==2 then
           WIntfSTAPath="WLAN.Intf.wl_ssid1_local0"
     elseif i==3 then
           WIntfSTAPath="WLAN.Intf.wle_radio1_ssid0"
     elseif i==4 then
           WIntfSTAPath="WLAN.Intf.wle_radio1_ssid1"
     end
    wlanInfo[i].stationList=getList_keystr(WIntfSTAPath..".Station",nil,"MACAddress","RssiLevel", "RxPhyRate", "Capabilities")
   
    --Wi-Fi Networks(aplist scan)
    wlanInfo[i].scanList={}
    
    if linkStyle ~= "none" and result[i].status=="enabled" then
    for apList in string.gmatch(tostring(result[i].apList_T), "([^;]+)") do
      for bssidVal, ssidVal, channelVal, rssiVal, secmode, unknown in string.gmatch(apList, "([^:]*):([^:]*):([^:]*):([^:]*):([^:]*):([^:]*)") do
        table.insert(wlanInfo[i].scanList, {ssid=ssidVal, channel=channelVal, bssid=bssidVal, rssi=rssiVal})
      end
    end
    end
  end
end

wlanInfo[wifi2Index].name = "2.4 GHz"
wlanInfo[wifi5Index].name = "5 GHz"


local errMsgOff1 = "<p>" .. translate([==[The Wi-Fi at 2.4 GHz is turned off. Wi-Fi will be detected only at 5 GHz networks.]==]).. "</p>"
local errMsgOff2 = "<p>" .. translate([==[The Wi-Fi at 5 GHz is turned off. Wi-Fi will be detected only at 2.4 GHz networks.]==]).. "</p>"

%>

<body onload="javascript:enableWifi();">

<script language="JavaScript" type="text/javascript">
<%
if (cgilua.QUERY["wifiPage"] == "wifi") then
%>
if(window.parent.menu.document.getElementById("wifist")!=null && 
		window.parent.menu.document.getElementById("wifist") != "undefinded") {
	window.parent.menu.document.getElementById("wifist").className="submenuselect";
	window.parent.menu.document.getElementById("wifi2").className="";
	window.parent.menu.document.getElementById("wifi5").className="";
	window.parent.menu.document.getElementById("wifi_guest").className="";
	window.parent.menu.document.getElementById("stat").className="";
}
<%
end
%>
if(window.parent.menu.document.getElementById("wifist")!=null && 
		window.parent.menu.document.getElementById("wifist") != "undefinded") {	
	window.parent.menu.document.getElementById("wifi2li").style.display="block";
	window.parent.menu.document.getElementById("wifi5li").style.display="block";
	window.parent.menu.document.getElementById("wifi_guestli").style.display="block";
}	

//<![CDATA[
function doShowList()
{
  document.location.href="wlanStatus.lp?wifiPage=wifi&linkStyle=block";
  return false;
}

function ShowLista()
{
  if("<%=linkStyle%>"=="none")
  {
    var state1 = "<%=wlanInfo[wifi2Index].status%>";
    var state2 = "<%=wlanInfo[wifi5Index].status%>";
    if(state1=="disabled")
    {
      document.getElementById("WlanIntfOffMsg").innerHTML = "<%=errMsgOff1%>";
      document.getElementById("wifiStatus").style.display="none";
      document.getElementById("intfOff").style.display="block";
      return false;
    }
    else if(state2=="disabled")
    {
      document.getElementById("WlanIntfOffMsg").innerHTML = "<%=errMsgOff2%>";
      document.getElementById("wifiStatus").style.display="none";
      document.getElementById("intfOff").style.display="block";
      return false;
    }
    document.location.href="wlanStatus.lp?wifiPage=wifi&linkStyle=block";
    return false;
  }
  var el = document.getElementById("listawifi");
  var bt = document.getElementById("buttonlista");
  el.style.display = "";
  bt.style.display = "none";
  return false;
}

function HideLista()
{
	var el = document.getElementById("listawifi");
	var bt = document.getElementById("buttonlista");
	el.style.display = "none";
	bt.style.display = "";	
	return false;
}

var symbols = " !\"#$%&'()*+,-./0123456789:;<=>?@";
var loAZ = "abcdefghijklmnopqrstuvwxyz";
symbols+= loAZ.toUpperCase();
symbols+= "[\\]^_`";
symbols+= loAZ;
symbols+= "{|}~";

function toHex(webKeyVal)
{	
	var valueStr = webKeyVal;
	var hexChars = "0123456789abcdef";
	var text = "";
	for( i=0; i<valueStr.length; i++ )
	{
		var oneChar = valueStr.charAt(i);
		var asciiValue = symbols.indexOf(oneChar) + 32;
		var index1 = asciiValue % 16;
		var index2 = (asciiValue - index1)/16;
		if ( text != "" ) text += " ";
		text += hexChars.charAt(index2);
		text += hexChars.charAt(index1);
	}
	return text;	
}

function toAscii(hex)
{
  var str = '';
  for (var i=0; i < hex.length; i +=2)
    str+=String.fromCharCode(parseInt(hex.substr(i,2),16));
  return str;
}

function refreshChannel(n)
{
  document.location.href = "refresh_chan.lp?intf=" + n;
}

function confirmConfig()
{
  var isWlanStateOff = document.getElementById("disableWLAN").checked;
  if(isWlanStateOff){
    document.getElementById("wifiStatus").style.display="none";
    document.getElementById("confirmOff").style.display="block";
    return false;
  }
  document.wlanStatus.submit();
}

function submit_ok()
{
  document.wlanStatus.submit();
}

function closeConfirm()
{
  document.getElementById("wifiStatus").style.display="block";
  document.getElementById("confirmOff").style.display="none";
  document.getElementById("intfOff").style.display="none";
}
//]]>
</script>

<div class="contentContainer fontSize">
	<div class="breadCrumbContainer">
		<ul class="brdCrumb">
			<li><a href="standard.lp"><%=translate([==[Basic Settings]==])%></a></li><li>|</li><li><a href="wlanStatus.lp?wifiPage=wifi">Wi-Fi</a></li>
				
		
			


<!-- <table cellspacing='0' cellpadding='0' width="100%" class="NavBar">
<tr><td align="left"><a href="standard.lp">Standard</a>&nbsp;&nbsp;>&nbsp;&nbsp;<a href="wlanStatus.lp?wifiPage=wifi">Wi-Fi</a> -->
<%
if isRemote==false then
        if cgilua.QUERY["wifiPage"] ~= "wifi" then
%>
<li>|</li>
        <%if cgilua.QUERY["wifiPage"] == "wifi2" then%>
		
        <li><a href="wlanStatus.lp?wifiPage=wifi2">Wi-Fi 2.4 GHz</a></li>
		
		<!-- </td><td align="right"><em>Stato</em>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="wlanConfig.lp">Configura</a> -->
        <%else%>
		
        <li><a href="wlanStatus.lp?wifiPage=wifi5">Wi-Fi 5 GHz</a></li>		
		
		<!-- </td><td align="right"><em>Stato</em>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="wlanConfig.lp?id=2">Configura</a> -->
        <%end
        end
end%>
<!-- </td></tr>
</table> -->
	</ul></div>
					
<div class='contentcontainer'>
<div id="wifiStatus">
<form method="post" id="wlanStatus" name="wlanStatus" action="">
<!-- Wifi common start -->
<%
if cgilua.QUERY["wifiPage"] == "wifi" then
%>

<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a class="current">
		<div class="tab">
			<span class="tabIcon_stwifi"></span>  
			<span class="contTabTxt">WI-FI</span>
		</div>
		<div class="clrBth"></div></a></li>
			</ol>
		</div>
<div class='contentitem'>

<%
	writePageHeader_new()
	writeBlockNoTitle()
%>

<tr class='midarea3' style="padding-left:0px;">
  <td width="300px"><%=translate([==[Radio Interfaces]==])%>:</td>
  <td width="430px"colspan='2'>
<%
if isRemote then
        if result[wifi2Index].status=="enabled" and result[wifi5Index].status=="enabled" then
                cgilua.print(translate([==[Active]==]))
        else
                cgilua.print(translate([==[Disable]==]))
        end
else
%>
    <input type="radio" value="1" id="enableWLAN" name="wlanState">&nbsp;<%=translate([==[Active]==])%>&nbsp;&nbsp;&nbsp;&nbsp;    
    <input type="radio" value="0" id="disableWLAN" name="wlanState">&nbsp;<%=translate([==[Disable]==])%>
<%end%>
  </td>
</tr>
<% endBlock() %>

<% if isRemote==false then%>

	<table><tr class='' style='padding-left:0px'>
			<td style='padding-left:250px'>
			<a style='color:black' onclick='confirmConfig()' href="#">
			<div class="midarea6-1 mainButton" name="thb6"><%=translate([==[Save]==])%></div></a></td>
			
			<td style='padding-left:50px'>
			<a style='color:black' href='standard.lp'>
			<div class="midarea6-1 mainButton" name="thb7"><%=translate([==[Cancel]==])%></div></a></td>
			</tr>
	</table>

<%end%>


<% if wlanInfo[wifi2Index].status == "enabled" or wlanInfo[wifi5Index].status == "enabled" then %>
<div id="buttonlista" style="display:<%=showStyle%>">

<%
  writeItemTitle(translate([==[Show nearby Wi-Fi networks]==]))
  endBlock()
%>
  <table cellspacing='0' cellpadding='0' width='100%' style="text-align:center" class="fontSize">
    <!-- <tr class='midarea6'> -->
      <td style='vertical-align:top; padding-left: 270px;'>
		<a style='color:black' onclick="return ShowLista();">
		<div class="midarea7-1 secondaryButton" name="thb7"><%=translate([==[List Wi-Fi Networks]==])%></div></a>
      </td>
    <!-- </tr> -->
  </table>
</div>

<div width="600px" id="listawifi" style="display:<%=linkStyle%>">

<%
  writeItemTitle(translate([==[Show nearby Wi-Fi networks]==]))
  endBlock()
%>
  <br>
  <table cellspacing='0' cellpadding='0' width='100%' style="text-align:center" class="fontSize">
    <tr style="width:750px;padding-top:10px;">
      <td style="width:390px;vertical-align:top">
		<a style='color:black;float:right;padding-right:50px;' onclick='javascript: document.location.href="wlanStatus.lp?wifiPage=wifi&linkStyle=block"'>
		<div class='midarea6-1 mainButton' name="thb11"><%=translate([==[Update]==])%></div></a></td>
		
		<td style="vertical-align:top">
		<a style='color:black' onclick="return HideLista();">
		<div class="midarea7-1 secondaryButton" name="thb7"><%=translate([==[Hide List Wi-Fi Networks]==])%></div></a></td>
    </tr>
  </table>
<%
--for n=wifiIndex, wifi5Index do
for itr=1,#wifiIndexList do
  n=wifiIndexList[itr]
  if wlanInfo[n].status == "enabled" then
    writeTableWifiWithoutPic(translate([==[Wi-Fi Networks]==]) .. " " .. wlanInfo[n].name)
    writeTableBlockHeader_WiFi(4, translate([==[Wi-Fi Network]==]) .. " (SSID)", translate([==[BSSID]==]), translate([==[Channel]==]), translate([==[Level Field]==]))

    --list the Wi-Fi Networks
    local rowStyle = "oddrow"
    local rowNum = 0
    for k,v in pairs(wlanInfo[n].scanList) do
      if v["rssi"]~="" then
        local level = rssiToLevel(tonumber(v["rssi"]))
        
        rowNum = rowNum + 1
        if rowNum%2==1 then
          rowStyle = "oddrow"
        else
          rowStyle = "evenrow"
        end
%>
        <!-- <tr><td width='33%' class='<%=rowStyle%>' colspan='4'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr> -->
        <tr>
          <td class="<%=rowStyle%> width150 contentSSID">
            <%
            --fix bug 75495, when ssid is empty, must show a empty box
            if v["ssid"]=="" then
              cgilua.print("&nbsp;&nbsp;")
            else
              cgilua.print(cgilua.html_escape(v["ssid"]))
            end
            %>
          </td>
          <td class="<%=rowStyle%> width150"><%=v["bssid"]%></td>
          <td class="<%=rowStyle%> width150"><%=v["channel"]%></td>
          <td class="<%=rowStyle%> width150">
            <table class="tablePB" cellspacing="0" width="100"><!--display the signals -->
              <tbody>
                <tr>
                <%for i=0, level do%>
                  <td class="pbtdcolor<%=i%>">&nbsp;</td>
                <%end%>
                <%for i=1, 5-level do%>
                  <td class="pbtdwhite">&nbsp;</td>
                <%end%>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
        <!-- <tr><td class="<%=rowStyle%>" colspan='4'><img src='images/spacer.gif' border='0' width='1' height='3' alt=''><br></td></tr> -->
<% 
      end
    end
    endBlock()
  end
end
%>
   <br/>
  <table cellspacing='0' cellpadding='0' width='100%' style="text-align:center">
    <tr style="width:750px;padding-top:10px;" >
      <td style="width:390px;vertical-align:top">
<% if isRemote==false then%>
		<a style="color:black;float:right;padding-right:50px" onclick="javascript:document.location.href='wlanStatus.lp?wifiPage=wifi&linkStyle=block'"><div class='midarea6-1 mainButton' name="thb11"><%=translate([==[Update]==])%></div></a></td>
		
		<td style="vertical-align:top"><a onclick="return HideLista();"><div class='midarea7-1 secondaryButton' name="thb7"><%=translate([==[Hide List Wi-Fi Networks]==])%></div></a>
<% end%>
      </td>
    </tr>
  </table>
</div>
<%
	local tprint = require("tableprint")
	local print = cgilua.print
	local indexList
	local writeGuestBlock = false
	local ipv6Enable = getIPv6("Device.IP")
	local activeGuestFrequency
	
	--this loop itereate twice to write wifi tables and wifiguest tables.
	for loopItr = 1,2 do
	
		if ( loopItr == 1 ) then
			--For Wifi Block
			writeItemTitle(translate([==[Wi-Fi Links]==]))
			endBlock()
			indexList = wifiIndexList
		else
			--For Wifi Guest Block
			
			if( getGuestStatus() == true ) then
				
				writeItemTitle(translate([==[Wi-Fi Guests Links]==]))
				endBlock()
				-- guestIndexList available in wlanGuestUtil.lp
				indexList = getWifiGuestIndexList()
				activeGuestFrequency = getWifiFrequency()
				writeGuestBlock = true
			end
			
		end
		
		local writeBlock
		local wifiPath
	
		--for n=wifi2Index, wifi5Index do
		for itr=1,#indexList do
		
			n=indexList[itr]
			writeBlock = false
			if n==1 then
			   wifiPath ="WLAN.Intf.wlif1"
			elseif n==2 then
			   wifiPath="WLAN.Intf.wl_ssid1_local0"
			elseif n==3 then
			   wifiPath="WLAN.Intf.wle_radio1_ssid0"
			elseif n==4 then
			   wifiPath="WLAN.Intf.wle_radio1_ssid1"
			end

			--wifiPath = "WLAN.Intf."..tonumber(n)
			if( loopItr == 1 ) then			
				local reply, error = mbus.getParameters{ path = wifiPath, param = "RadioEnable",flags="KEYPATH"}			
				if reply[wifiPath][1].param["RadioEnable"]=="true" then
					writeBlock = true
					writeTableBlockTitleWithoutPic(translate([==[Wi-Fi Links]==]) .. " " .. wlanInfo[n].name)
				end
			else				
				if( writeGuestBlock == true ) then
				   
					wlanInfo[n] = {}
					if( n == 2 and ( activeGuestFrequency == "2.4 GHz" or activeGuestFrequency == "2.4 GHz e 5 GHz") ) then
						wlanInfo[n].name = "2.4 GHz"
						writeBlock = true						
					elseif( n==4 and ( activeGuestFrequency == "5 GHz" or activeGuestFrequency == "2.4 GHz e 5 GHz") ) then
						wlanInfo[n].name = "5 GHz"
						writeBlock = true
					end
					
					--Wi-Fi Links of station signal
					if( writeBlock == true ) then
						wlanInfo[n].stationList=getList_keystr(wifiPath..".Station",nil,"MACAddress","RssiLevel", "RxPhyRate", "Capabilities")
						writeTableBlockTitleWithoutPic(translate([==[Wi-Fi Guests Links]==]) .. " " .. wlanInfo[n].name)
					end					
				end
			end
		
			if ( writeBlock == true ) then
			
				if ipv6Enable == "true" then
					writeWiFiTableBlockHeader(6, translate([==[Type]==]), translate([==[Speed]==]), translate([==[Host Name]==]), translate([==[MAC Address]==]), translate([==[Address IP]==]), translate([==[IPv6 Address]==]))
				else
					writeWiFiTableBlockHeader(5, translate([==[Type]==]), translate([==[Speed]==]), translate([==[Host Name]==]), translate([==[MAC Address]==]), translate([==[Address IP]==]))
				end
				
				local rowStyle = "oddrow"
				local rowNum = 0
		 
				for i, v in pairs(linkInfo[n]) do
					v.param["PhyMode"] = ""
					v.param["PhyRate"] = ""
					for j,m in pairs(wlanInfo[n].stationList) do
						if m["MACAddress"]==v.param["MACAddress"] then
							if m["Capabilities"] ~= nil then
								-- get 802.11b, 802.11g or 802.11n
								v.param["PhyMode"] = string.sub(m["Capabilities"], 1, 7)
							end
							if m["RxPhyRate"] ~= nil then
								v.param["PhyRate"] = tonumber(m["RxPhyRate"])/1000 .. " Mbit/s"
							end
						end
					end
					rowNum = rowNum + 1
					if rowNum%2==1 then
						rowStyle = "oddrow"
					else
						rowStyle = "evenrow"
					end
					if ipv6Enable == "true" then
						writeWiFiTableBlockRow(6, rowStyle, v.param["PhyMode"], v.param["PhyRate"], v.param["HostName"], v.param["MACAddress"], v.param["IPAddress"], v.param["IPv6Address"])
					else
						writeWiFiTableBlockRow(5, rowStyle, v.param["PhyMode"], v.param["PhyRate"], v.param["HostName"], v.param["MACAddress"], v.param["IPAddress"])
					end
				end  
		  
				if #linkInfo[n]==0 then
					if ipv6Enable == "true" then
						writeWiFiTableBlockRow(6, "oddrow", translate([==[No Wi-Fi host connected.]==]), "", "", "", "", "")
					else
						writeWiFiTableBlockRow(5, "oddrow", translate([==[No Wi-Fi host connected.]==]), "", "", "", "")
					end
				end
				endBlock()
			else
				--cgilua.print("no information")
			end
		end
	end
end
end
%>
</div>
<!-- Wifi common end -->

<!-- Wifi 2.4G and 5G start -->
<%
--for n=wifi2Index, wifi5Index do
for itr=1,#wifiIndexList do
  n=wifiIndexList[itr]
	if (cgilua.QUERY["wifiPage"] == "wifi2" and n==wifi2Index) or (cgilua.QUERY["wifiPage"] == "wifi5" and n==wifi5Index) then
		local titlePic = "iwla24xl.gif"
		if cgilua.QUERY["wifiPage"] == "wifi5" then
			titlePic = "iwla50xl.gif" 
		end
		
		if( cgilua.QUERY["wifiPage"] == "wifi2" ) then
		%>
		
		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a href="wlanStatus.lp?wifiPage=wifi2" class="current">
		<div class="tab">
			<span class="tabIcon_stwifi2"></span>  
			<span class="contTabTxt">WI-FI 2.4GH</span><span class="contTabTxt" style="text-transform:lowercase">z</span>
		</div>
		<div class="clrBth"></div></a></li>
		<% if isRemoteAccess() == false then %>
			<li><a class="margin15" href="wlanConfig.lp">
		<div class="tab">
			<span class="contTabTxt transform"><%=translate([==[Configure]==])%> Wi-Fi 2.4 GH</span><span class="contTabTxt" style="text-transform:lowercase">z</span>
			</div></a></li>	
		<% end %>		
			</ol>
		</div>
		
		<% else if ( cgilua.QUERY["wifiPage"] == "wifi5" ) then
		%>
		<div class="contentTab" id="content">
			<ol id="tocTab">
				<li><a href="wlanStatus.lp?wifiPage=wifi5" class="current">
		<div class="tab">
			<span class="tabIcon_stwifi5"></span>  
			<span class="contTabTxt">WI-FI 5GH</span><span class="contTabTxt" style="text-transform:lowercase">z</span>
		</div>
		<div class="clrBth"></div></a></li>
		<% if isRemoteAccess() == false then %>
			<li><a class="margin15" href="wlanConfig.lp?id=2">
		<div class="tab">
			<span class="contTabTxt transform"><%=translate([==[Configure]==])%> Wi-Fi 5 GH</span><span class="contTabTxt" style="text-transform:lowercase">z</span>
			</div></a></li>	
		<% end %>		
			</ol>
		</div>
		
		<%
	end
 end
		%>
		<div class='contentitem'>
		<%
		
		writePageHeader_new()
		
		--writeBlockNoTitle()
		writeBlockTitle_Wifi(translate([==[Wi-Fi Settings]==]) .. " " .. wlanInfo[n].name)
		--writeItemTitle(translate([==[Wi-Fi Settings]==]) .. " " .. wlanInfo[n].name)
		local j=1
		if n == 3 then j=2 end
		writeBlockRow5(translate([==[Radio Interface]==]), radio_Status[j])
		writeBlockRow5(translate([==[Wi-Fi network (SSID)]==]), wlanInfo[n].ssid)
%>
  <tr><td style='vertical-align:top' class="midarea4-9"><%=translate([==[Radio Channel]==])%>:</td><td style='vertical-align:top'  class="channelButton" ><%=wlanInfo[n].wlanChannel%>
<% if isRemote==false then%>
    <%if result[n].channelmode=="Auto" then%>
      </td><td class="alignMid">
	  <a style='color:black' onclick='refreshChannel(<%=n%>);'><div class='midarea7-2 secondaryButton' name="thb9" style="padding-top:3px;width:120px;height:20px;"><%=translate([==[Search Channel]==])%></div></a>
    <%end%>
<%end%>
  </td></tr>
<%
  writeBlockRow5(translate([==[Bandwidth (Channel)]==]), wlanInfo[n].channelWidth)
  writeBlockRow5(translate([==[Methods of encryption]==]), wlanInfo[n].secMode)
  if result[n].secmode ~= "disabled" then
%>
  <tr style="width:750px;"><td class="midarea4-9"><%=translate([==[Encryption key]==])%>:</td>
    <%
    local remoteAccessStatus = isRemoteAccess()
    if remoteAccessStatus==false then
    %>
    <td colspan='2' class="midarea4-8"><%=wlanInfo[n].keyEncryption%>
    <%if result[n].secmode=="WEP" then%>
      <div id="wepHex<%=n%>"></div>
    <%end%>
    </td>
    <%end%>
  </tr>
<%
  end
  writeBlockRow5(translate([==[Access Control]==]), wlanInfo[n].aclControl)
  endBlock()

  if result[n].control=="unlock" then
    local aclList, error = mbus.getParameters{ path=wlanInfo[n].aclMacPath, param={"MACAddress", "Permission"},flags="KEYPATH" }
    if #aclList[wlanInfo[n].aclMacPath] > 0 then
      writeTableBlockTitle_Wifidevices(translate([==[Authorized Devices]==]),40)
	  
	  %>
  <tr><td colspan='2'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>
  <tr>
        <td class="authHeader tableHd" style="padding-left: 0px;"><%=translate([==[MAC Address]==])%></td>
        <td class="tableHd" style="padding-left: 0px;"><%=translate([==[Access Management]==])%></td>
  </tr>
  <tr><td colspan='2'><img src='images/spacer.gif' border='0' width='1' height='1' alt=''><br></td></tr>

<%
	  
      --writeTableBlockHeader(2, translate([==[MAC Address]==]), translate([==[Access Management]==]))
      local rowStyle = "oddrow"
      local rowNum = 0
      for i, v in pairs(aclList[wlanInfo[n].aclMacPath]) do
        local str = translate([==[Authorized]==])
        if v.param["Permission"]=="deny" then
          str = translate([==[Unauthorized]==])
        end
        if v.param["MACAddress"] ~= nil then
            rowNum = rowNum + 1
            if rowNum%2==1 then
              rowStyle = "oddrow"
            else
              rowStyle = "evenrow"
            end
            writeTableBlockRow_Guest(2, rowStyle, v.param["MACAddress"], str)
        end
      end
      endBlock()
    end
  end 

endBlock() %>
</div>
<!-- Wifi 2.4G and 5G end -->

<%if result[n].secmode=="WEP" then%>
<script language="javascript" type="text/javascript">
var wepKey = "<%=result[n].wep%>";
if (wepKey.length==13)
  document.getElementById("wepHex<%=n%>").innerHTML=toHex(wepKey)+" [HEX]";
else
  document.getElementById("wepHex<%=n%>").innerHTML=toAscii(wepKey)+" [ASCII]";
</script>
<% end 
 end 
 end 
 endPage() %>
</form>
</div>
</div>
</div>

<% if cgilua.QUERY["wifiPage"] == "wifi" then %>
<div id="confirmOff" style="display:none">
<%cgilua.lp.include("webparts/WlanRadioOff.lp")%>
</div>
<div id="intfOff" style="display:none">
<%cgilua.lp.include("webparts/WlanIntfOff.lp")%>
</div>
<script src="js/antiCSRF.js" type="text/javascript"></script>
<script language="javascript" type="text/javascript">
<% if isRemote==false then%>
var radioState = "<%=result[wifi2Index].status%>";
var radioState2 = "<%=result[wifi5Index].status%>";
if((radioState=="enabled") || (radioState2=="enabled")){
  document.getElementById("enableWLAN").checked = true;
}else{
  document.getElementById("disableWLAN").checked = true;
}
<%end%>
</script>
<% end %>
</div>

</body>
</html>
<%
    cgilua.lp.include("lp/xml.lp")
    cgilua.contentheader("text","xml")

    local configurationData = cgilua.QUERY["ConfigurationData"]
    local open=io.open

    if configurationData=="Device" then
    	httperror(400, "Bad Request")
    end 

    if configurationData=="WidgetAssurance" then
        xmlCreate(configurationData)
        local fh = open ("/tmp/Widget.xml")
        if fh~=nil then
            src = fh:read("*a")    
            cgilua.put(src)
        end 
        fh:close()
        --cgilua.redirect("/Widget.xml")
    end
%>
<%
	require "lfs"
	
    cgilua.lp.include("lp/mbus_util.lp")
    cgilua.contentheader ("text", "xml")
    local action = cgilua.POST["Action"]
    local callLogType = cgilua.POST["Filter"]
    if callLogType=="Missed" then
        callLogType = "None"
    end
	
	local function unlock()
	
      lfs.rmdir("/tmp/lockcallLogdir")
    end

    local function lock()
		local i = 0
		while true do
		
			if lfs.mkdir("/tmp/lockcallLogdir") == true then
			break
			end
			
			sleep(1)
			i = i + 1

			if i == 120 then
				trace("SIPGwCallLog: Unable to capture the lock. Other script instance still in progress? Forcing unlock and continuing")
				unlock()
			end
		end
    end
	
	-- try to get a lock
	lock()
	
    local callLogPath = "SIPServer.CallLog.MergedList.Entry"

    if action~="" then
        --judge the device's WIFI method is WPA or WPA2 in the WLAN.
        local ipOfDevice = cgilua.servervariable"REMOTE_ADDR"
        local replyHost, errorHost = mbus.getParameters{path="Hosts.Host", param="Interface", filter="(== IPAddress "..ipOfDevice..")"}
        if replyHost["Hosts.Host"][1]~=nil and replyHost["Hosts.Host"][1].param~=nil then
            local ethPath = replyHost["Hosts.Host"][1].param["Interface"]
            local replyEth, errorEth = mbus.getParameters{path=ethPath, param={"Technology", "Reference"}}
            if replyEth[ethPath][1]~=nil and replyEth[ethPath][1].param~=nil then
                local ethTech = replyEth[ethPath][1].param["Technology"]
                if ethTech=="WLAN" then
                    local referenceWlan = replyEth[ethPath][1].param["Reference"]
                    local wlanPath = tostring(referenceWlan) .. ".Security"
                    local replyWlan, errorWlan = mbus.getParameters{path=wlanPath, param="Mode"}
                    if replyWlan[wlanPath][1]~=nil and replyWlan[wlanPath][1].param~=nil then
                        local wifiMode = replyWlan[wlanPath][1].param["Mode"]
                        if wifiMode=="disabled" or wifiMode=="WEP" then
                            httperror(550, "Insecure connection")
			    unlock()
                            return
                        end
                    end
                end
            end
        end
    end

    local error = mbus.getParameters{path =callLogPath,flags = {"SYNC"}}
    if action == "GetLog" then
        local xmlStart="\<?xml version=\"1.0\" encoding=\"UTF-8\"?\>"
        local xmlStr, caller, called, direction, startTime, duration = "", "", "", "", "", ""
        if callLogType == "All" then
            local callLogPath = "SIPServer.CallLog.MergedList.Entry"
            local reply, error = mbus.getParameters{path=callLogPath, param={"CallingNumber", "CalledNumber","Direction","StartTime","Duration"}}
            for i,v in pairs(reply[callLogPath]) do
                caller = v.param["CallingNumber"]
                called = v.param["CalledNumber"]
                direction = v.param["Direction"]
                startTime = v.param["StartTime"]
                duration = v.param["Duration"]
	        if caller == nil or called == nil or direction == nil or startTime == nil or duration == nil  then
		        break
		    end 
                xmlStr = xmlStr .. "\<Call\>\<CallingPartyNumber\>"..caller.."\</CallingPartyNumber\>".."\<CalledPartyNumber\>"..called.."\</CalledPartyNumber\>".."\<Direction\>"..direction.."\</Direction\>".."\<Start\>"..startTime.."\</Start\>".."\<Duration\>"..duration.."\</Duration\>\<\/Call\>"
            end
        elseif callLogType~="" then
            local reply, error = mbus.getParameters{path=callLogPath, param={"CallingNumber", "CalledNumber","Direction","StartTime","Duration"}}
            for i,v in pairs(reply[callLogPath]) do
                callLogType = cgilua.POST["Filter"]
                if callLogType=="Missed" then
                    callLogType = "None"
                end
                caller = v.param["CallingNumber"]
                called = v.param["CalledNumber"]
                direction = v.param["Direction"]
                startTime = v.param["StartTime"]
                duration = v.param["Duration"]
                if tostring(duration)=="0" and direction=="Incoming" then
                    direction = "None"
                end
                if tostring(direction)==callLogType then
                    if tostring(duration)=="0" and direction=="None" then
                        direction = "Incoming"
                    end
                    xmlStr = xmlStr .. "\<Call\>\<CallingPartyNumber\>"..caller.."\</CallingPartyNumber\>".."\<CalledPartyNumber\>"..called.."\</CalledPartyNumber\>".."\<Direction\>"..direction.."\</Direction\>".."\<Start\>"..startTime.."\</Start\>".."\<Duration\>"..duration.."\</Duration\>\<\/Call\>"
                end
            end
        end
        xmlStr = "\<CallLog\>" .. xmlStr .. "\<\/CallLog\>"
        cgilua.print(xmlStart ..  tostring(xmlStr))
    elseif action == "RemoveLog" then
        local reply, error = mbus.deleteObjects{path=callLogPath, filter="(== Direction " ..callLogType.. ")"}
		unlock()
        return
    end
    unlock()
%>
<%
    require "lfs"

    cgilua.lp.include("lp/mbus_util.lp")
    cgilua.lp.include("lp/common.lp")
    cgilua.lp.include("lp/util.lp")
    cgilua.lp.include("lp/style.lp")
    cgilua.lp.include("lp/device.lp")
    cgilua.lp.include("lp/form.lp")
    cgilua.lp.include("lp/voip.lp")
    cgilua.contentheader ("text", "xml")
    local action = cgilua.POST["Action"]
    local clientID = string.sub(tostring(cgilua.POST["ClientID"]), 1, 32)
    local cliNumber = cgilua.POST["Cli"]
    local modify = {}

    local provisionPath = "SIPServer.Autoprovisioning"
    local uamap2Path = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"
    local uamap3Path = "Device.Services.VoiceService.3.X_TELECOMITALIA_IT_UAMapping"
    local actionState, intuaPath

    local function unlock()

      lfs.rmdir("/tmp/lockdir")
      
    end

    local function lock()

      local i = 0

      while true do
	if lfs.mkdir("/tmp/lockdir") == true then
	  break
	end
	
	sleep(1)
	
	i = i + 1
	
	if i == 120 then
	  trace("SIPGwConfig: Unable to capture the lock. Other script instance still in progress? Forcing unlock and continuing")
	  unlock()
	end
      end

    end

    --get the extua path for registrar and exam the input number by user is valid or not.
    function getExtPath(cli)
        for i=1, 4 do
	    local final
            local ePath = "Device.Services.VoiceService.2.VoiceProfile." .. i ..".Line.1.SIP"
            local replyExtua, errorExtua = mbus.getParameters{path=ePath, param="AuthUserName", datamodel="second"}
            local extuaMap = replyExtua[ePath][1].param["AuthUserName"]
            local extuaMapPath = "Device.Services.VoiceService.2.VoiceProfile." .. i ..".Line.1"
	    --Fix for CPE_P00118695
	    local extua_num = tostring(extuaMap)
	    local result = string.match(extua_num,"+39",1)
	    if result == "+39"
	    then
	    final = string.sub (extua_num,4)
	    else 
	    final = extua_num
	    end
            if tostring(cli) == final then
                return extuaMapPath
            end
        end
        return false
    end

    --judge if the extua had exist mapping relationship.
    function isMapExist(path)
        local uamapPath = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"
        local defaultIntua = "Device.Services.VoiceService.3.VoiceProfile.1.Line.1"
        local replyUamap, errorUamap = mbus.getParameters{path=uamapPath, param={"FromUA", "ToUA"}, datamodel="second"}
        for i,v in pairs(replyUamap[uamapPath]) do
            if v.param["FromUA"]==path and v.param["ToUA"]~=defaultIntua then
                return true
            end
        end
        return false
    end

    --judge if the uamap object is exist or not.
    function existOfUamap(intPath, extPath)
        local isExist = false
        local uamapPath = "Device.Services.VoiceService.2.X_TELECOMITALIA_IT_UAMapping"
        local reply, error = mbus.getParameters{path=uamapPath, param={"FromUA", "ToUA"}, datamodel="second"}
        if reply~=nil and reply[uamapPath][1]~=nil and reply[uamapPath][1].param["FromUA"]~=nil and reply[uamapPath][1].param["ToUA"]~=nil then
            local fromUa = reply[uamapPath][1].param["FromUA"]
            local toUa = reply[uamapPath][1].param["ToUA"]
            if tostring(fromUa)==tostring(extPath) and tostring(toUa)==tostring(intPath) then
                isExist = true
            end
        end
        return isExist
    end

    --judge if the vpmap object is exist or not.
    function existOfVpmap(intPath, extPath)
        local isExist = false
        local vpmapPath = "Device.Services.VoiceService.3.X_TELECOMITALIA_IT_UAMapping"
        local reply, error = mbus.getParameters{path=vpmapPath, param={"FromUA", "ToUA"}, datamodel="second"}
        if reply~=nil and reply[vpmapPath][1]~=nil and reply[vpmapPath][1].param["FromUA"]~=nil and reply[vpmapPath][1].param["ToUA"]~=nil then
            local fromUa = reply[vpmapPath][1].param["FromUA"]
            local toUa = reply[vpmapPath][1].param["ToUA"]
            if tostring(fromUa)==tostring(intPath) and tostring(toUa)==tostring(extPath) then
                isExist = true
            end
        end
        return isExist
    end

    --delete the exist mapping relationship on the same intua.
    function delExistIntuaMapping(intPath)
        local reply, error = mbus.getParameters{path=uamap2Path, datamodel="second"}
        if reply[uamap2Path][1]~=nil then
            local replyDel, errorDel = mbus.modify(
            function()
                local replyDelete, errorDelete = mbus.deleteObjects{path = uamap2Path, filter="(== ToUA " .. intPath .. ")", datamodel = "second"}
            end, {datamodel="second"})
        end
        local reply, error = mbus.getParameters{path=uamap3Path, datamodel="second"}
        if reply[uamap3Path][1]~=nil then
            local replyDel, errorDel = mbus.modify(
            function()
                local replyDelete, errorDelete = mbus.deleteObjects{path = uamap3Path, filter="(== FromUA " .. intPath .. ")", datamodel = "second"}
            end, {datamodel="second"})
        end
        return
    end
        
    if action~="" then
	--judge the ISP is Telecom Italia or not.
	local ISPPath = "Device.UserInterface"
	local replyISP, errorISP = mbus.getParameters{path=ISPPath, param="ISPName", datamodel="second"}
	if replyISP[ISPPath][1]~=nil and replyISP[ISPPath][1].param~=nil then
	    local ISPName = replyISP[ISPPath][1].param["ISPName"]
	    if ISPName~="Telecom Italia" then
		httperror(553, "ISP is not correct")
		return
	    end
	else
	    httperror(553, "ISP is not correct")
	    return
	end
	
	
	-- try to get a lock
	lock()
  	
	--Exam the number which user used to autoprovisioning is can be used or not.
	local teleNumExist = getExtPath(cliNumber)
	if teleNumExist ~= false then
	    local extuaMapPath = getExtPath(cliNumber)
	    local isUamapExist = isMapExist(extuaMapPath)
	    if isUamapExist == false then
		--there is no uamap, so add the map relationship between intua and extua.
		for i=2, 11 do
		    local intuaMapPath = "Device.Services.VoiceService.3.VoiceProfile." .. i .. ".Line.1"
		    local extPath, intPath
		    local replyIntua, errorIntua = mbus.getParameters{path=intuaMapPath, param="X_TELECOMITALIA_IT_PhyAssignment", datamodel="second"}
		    local intuaNotAssign = replyIntua[intuaMapPath][1].param["X_TELECOMITALIA_IT_PhyAssignment"]
		    local replyIntua1, errorIntua1 = mbus.getParameters{path=intuaMapPath, param="X_TELECOMITALIA_IT_MACAddress", datamodel="second"}
            local intuaNotAssign1 = replyIntua1[intuaMapPath][1].param["X_TELECOMITALIA_IT_MACAddress"]
		    if intuaNotAssign == "Not Assigned" or intuaNotAssign1 == clientID then
			intPath = replyIntua[intuaMapPath][1].path
			extPath = getExtPath(cliNumber)

			--when add a new intua mapping, just delete the old mapping in this intua if exist.
			delExistIntuaMapping(intuaMapPath)

			local reply, error = mbus.modify(
			function()
			    local reply1, error1 = mbus.addObjects{path=uamap2Path, param={FromUA=extPath, ToUA=intPath}, datamodel = "second" }
			    if error1~=nil or reply1[uamap2Path][1]==nil then
				result=1
				cgilua.errorlog("error1 is not nil:")
			    end
			end, {datamodel="second"})

			local reply2, error2 = mbus.modify(
			function()
			    local reply3, error3 = mbus.addObjects{path=uamap3Path, param={FromUA=intPath, ToUA=extPath}, datamodel = "second" }
			    if error3~=nil or reply3[uamap3Path][1]==nil then
				result=1
				cgilua.errorlog("error3 is not nil:")
			    end
			end, {datamodel="second"})
			saveall(0, 1)
			break
		    end
		end
	    else --if exist, that means already some phones had been registered, new phone need to autoprovisioning
		local replyTotal, errorTotal = mbus.getParameters{path=uamap2Path, param="ToUA", filter="(== FromUA " .. extuaMapPath .. ")", datamodel="second"}
		--no matter if there is mapping between intua and extua, just select the first valid intua mapped to the extua.
		local totalnum = #replyTotal[uamap2Path]
		--if 9 object had existed, means from intua2 to intua10 all of them had been registered, no valid intua for the phone to autoprovisioning.
		if tostring(totalnum) ~= "10" then
		    for i=2, 11 do
			local intuaMapPath = "Device.Services.VoiceService.3.VoiceProfile." .. i .. ".Line.1"
			local extPath, intPath
			local replyIntua, errorIntua = mbus.getParameters{path=intuaMapPath, param="X_TELECOMITALIA_IT_PhyAssignment", datamodel="second"}
			local intuaNotAssign = replyIntua[intuaMapPath][1].param["X_TELECOMITALIA_IT_PhyAssignment"]
			local replyIntua1, errorIntua1 = mbus.getParameters{path=intuaMapPath, param="X_TELECOMITALIA_IT_MACAddress", datamodel="second"}
            local intuaNotAssign1 = replyIntua1[intuaMapPath][1].param["X_TELECOMITALIA_IT_MACAddress"]
			if intuaNotAssign == "Not Assigned" or intuaNotAssign1 == clientID then
			    intPath = replyIntua[intuaMapPath][1].path
			    extPath = getExtPath(cliNumber)

			    --when add a new intua mapping, just delete the old mapping in this intua if exist.
			    delExistIntuaMapping(intuaMapPath)

			    local isUamapExist = existOfUamap(intPath, extPath)
			    if isUamapExist==false then
				local reply, error = mbus.modify(
				function()
				    local reply1, error1 = mbus.addObjects{path=uamap2Path, param={FromUA=extPath, ToUA=intPath}, datamodel = "second" }
				    if error1~=nil or reply1[uamap2Path][1]==nil then
					result=1
					cgilua.errorlog("error1 is not nil:")
				    end
				end, {datamodel="second"})
			    end

			    local isVpmapExist = existOfVpmap(intPath, extPath)
			    if isVpmapExist==false then
				local reply2, error2 = mbus.modify(
				function()
				    local reply3, error3 = mbus.addObjects{path=uamap3Path, param={FromUA=intPath, ToUA=extPath}, datamodel = "second" }
				    if error3~=nil or reply3[uamap3Path][1]==nil then
					result=1
					cgilua.errorlog("error3 is not nil:")
				    end
				end, {datamodel="second"})
			    end
			    saveall(0, 1)
			    break
			end
		    end

		else  --fix bug of CPE_P00111316:Autoprovisioned IP phone overwrittes another IP Phone.
		    for i=2, 11 do
			local intuaMapPath = "Device.Services.VoiceService.3.VoiceProfile." .. i .. ".Line.1"
			local extPath, intPath
			local replyIntua, errorIntua = mbus.getParameters{path=intuaMapPath, param="X_TELECOMITALIA_IT_PhyAssignment", datamodel="second"}
			local intuaNotAssign = replyIntua[intuaMapPath][1].param["X_TELECOMITALIA_IT_PhyAssignment"]
			local replyIntua1, errorIntua1 = mbus.getParameters{path=intuaMapPath, param="X_TELECOMITALIA_IT_MACAddress", datamodel="second"}
            local intuaNotAssign1 = replyIntua1[intuaMapPath][1].param["X_TELECOMITALIA_IT_MACAddress"]
			if intuaNotAssign == "Not Assigned" or intuaNotAssign1 == clientID then
			    intPath = replyIntua[intuaMapPath][1].path
			    extPath = getExtPath(cliNumber)

			    --when add a new intua mapping, just delete the old mapping in this intua if exist.
			    delExistIntuaMapping(intuaMapPath)

			    local reply, error = mbus.modify(
			    function()
				local reply1, error1 = mbus.addObjects{path=uamap2Path, param={FromUA=extPath, ToUA=intPath}, datamodel = "second" }
				if error1~=nil or reply1[uamap2Path][1]==nil then
				    result=1
				    cgilua.errorlog("error1 is not nil:")
				end     
			    end, {datamodel="second"})

			    local reply2, error2 = mbus.modify(
			    function()
				local reply3, error3 = mbus.addObjects{path=uamap3Path, param={FromUA=intPath, ToUA=extPath}, datamodel = "second" }
				if error3~=nil or reply3[uamap3Path][1]==nil then
				    result=1
				    cgilua.errorlog("error3 is not nil:")
				end
			    end, {datamodel="second"})
			    saveall(0, 1)
			    break
			end
		    end
		end
	    end
	end

	--judge the device's WIFI method is WPA or WPA2 in the WLAN.
	local ipOfDevice = cgilua.servervariable"REMOTE_ADDR"
	local replyHost, errorHost = mbus.getParameters{path="Hosts.Host", param="Interface", filter="(== IPAddress "..ipOfDevice..")"}
	if replyHost["Hosts.Host"][1]~=nil and replyHost["Hosts.Host"][1].param~=nil then
	    local ethPath = replyHost["Hosts.Host"][1].param["Interface"]
	    local replyEth, errorEth = mbus.getParameters{path=ethPath, param={"Technology", "Reference"}}
	    if replyEth[ethPath][1]~=nil and replyEth[ethPath][1].param~=nil then
		local ethTech = replyEth[ethPath][1].param["Technology"]
		if ethTech=="WLAN" then
		    local referenceWlan = replyEth[ethPath][1].param["Reference"]
		    local wlanPath = tostring(referenceWlan) .. ".Security"
		    local replyWlan, errorWlan = mbus.getParameters{path=wlanPath, param="Mode"}
		    if replyWlan[wlanPath][1]~=nil and replyWlan[wlanPath][1].param~=nil then
			local wifiMode = replyWlan[wlanPath][1].param["Mode"]
			if wifiMode=="disabled" or wifiMode=="WEP" then
			    httperror(550, "Insecure connection")
			    unlock()
			    return
			end
		    end
		end
	    end
	end

	if action=="GetConfig" then
	    local cliNumber = cgilua.POST["Cli"]
	    local reply, error = mbus.modify(
		function()
		    local reply1, error1 = mbus.setParameters{path=provisionPath, param={ActionType=action, MAC=clientID, CLI=cliNumber}}
		end)
	    local reply2, error2 = mbus.modify(
		function()
		    local reply3, error3 = mbus.setParameters{path=provisionPath, param={ActionState="Requested"}}
		end)
	    saveall(0, 1)
	elseif action=="DisableConfig" then
	    local reply, error = mbus.modify(
		function()
		    local reply1, error1 = mbus.setParameters{path=provisionPath, param={ActionType=action}}
		end)
	    local reply2, error2 = mbus.modify(
		function()
		    local reply3, error3 = mbus.setParameters{path=provisionPath, param={ActionState="Requested"}}
		end)
	    saveall(0, 1)
	end
	local reply4, error4 = mbus.getParameters{path=provisionPath, param={"ActionState", "InternalUAReference"}}
	actionState = reply4[provisionPath][1].param["ActionState"]
	intuaPath = reply4[provisionPath][1].param["InternalUAReference"]
	--Get the value of xml parameters when the param of "ActionState" is "Completed"
	if actionState=="Completed" then
	    local reply5, error5 = mbus.getParameters{path=provisionPath, param="ActionStatus"}
	    local resStatus = reply5[provisionPath][1].param["ActionStatus"]
	    --error code exam.
	    if resStatus == "CLI is not correct" then
		httperror(551, "CLI is not correct")
		unlock()
		return
	    end
	    if resStatus == "Unable to find ClientID" then
		httperror(552, "Unable to find ClientID")
		unlock()
		return
	    end
	    if resStatus == "No available accounts" then
		httperror(554, "No available accounts")
		unlock()
		return
	    end
	    if resStatus == "OK" then
		--action successful.
		if action == "GetConfig" then
		    local xmlStart="\<?xml version=\"1.0\" encoding=\"UTF-8\"?\>"
		    local xmlStr, transportProtocol = "", "UDP"
		    local name, password, realm, realmPath, registrar, registrarPort, outboundProxy, proxyPort, regPath = "", "", "", "", "", "", "", "", ""
		    local uaPath = "SIPServer.InternalUA"
		    local registrarPath = "SIPServer.Registrar.Bind"

		    local reply, error = mbus.getParameters{path=uaPath, param={"Username", "Password", "Realm" , "UserAgentDomain" , "UserAgentPort"}}
		    for i,v in pairs(reply[uaPath]) do
			if v.path==tostring(intuaPath) then
			    name = v.param["Username"]
			    password = v.param["Password"]
			    realmPath = v.param["Realm"]
							registrar = v.param["UserAgentDomain"]
							outboundProxy = registrar
							registrarPort = v.param["UserAgentPort"]
							
			    local replyRealm, error = mbus.getParameters{path=realmPath, param="realm"}
			    if replyRealm[realmPath][1]~=nil and replyRealm[realmPath][1].param~=nil then
				realm = replyRealm[realmPath][1].param["realm"]
			    end

			    --local replyRegistrar, errorRegistrar = mbus.getParameters{path=registrarPath, param={"IPIntf", "SIPPort"}}
			    --regPath = replyRegistrar[registrarPath][1].param["IPIntf"]
			    --registrarPort = replyRegistrar[registrarPath][1].param["SIPPort"]

			    --local intfPath = tostring(regPath) .. ".Addr.1"
			    --local replyIntfPath, errorIntfPath = mbus.getParameters{path=intfPath, param="IPAddress"}
			    --registrar = replyIntfPath[intfPath][1].param["IPAddress"]
			    --outboundProxy = registrar
			    proxyPort = registrarPort
			end
		    end

		    xmlStr = xmlStr .. "\<AuthUserName\>"..name.."\</AuthUserName\>".."\<AuthPassword\>"..password.."\</AuthPassword\>".."\<AuthRealm\>"..realm.."\</AuthRealm\>".."\<Registrar\>"..registrar.."\</Registrar\>".."\<RegistrarPort\>"..registrarPort.."\</RegistrarPort\>".."\<OutboundProxy\>"..outboundProxy.."\</OutboundProxy\>".."\<OutboundProxyPort\>"..proxyPort.."\</OutboundProxyPort\>".."\<TransportProtocol\>"..transportProtocol.."\</TransportProtocol\>"
		    xmlStr = "\<SIPClientConfig\>" .. xmlStr .. "\<\/SIPClientConfig\>"
		    cgilua.print(xmlStart ..  tostring(xmlStr))
		    unlock()
		    return
		elseif action == "DisableConfig" then
		    local proPath = "Device.Services.VoiceService.3.VoiceProfile"
		    local reply, error = mbus.getParameters{path = proPath, datamodel = "second"}
		    for i,v in pairs(reply[proPath]) do
			local macPath = v.path .. ".Line.1"
			local reply1, error1 = mbus.getParameters{path = macPath, param = {"Enable", "X_TELECOMITALIA_IT_MACAddress"}, filter = "(== X_TELECOMITALIA_IT_MACAddress " .. clientID .. ")", datamodel = "second"}
			if reply1[macPath]~=nil and reply1[macPath][1]~=nil then
			    local reply, error = mbus.modify(
				    function()    
					    local reply2, error2 = mbus.setParameters{path = macPath, param = {Enable="Disabled"}, datamodel = "second"}
				    end, {datamodel="second"})
			    saveall(0, 1)
			end
		    end
		    unlock()
		    return
		end
	    end
	end
	
	unlock()
    end
%>
config modemoption=0010040220c00000a60000000000000000ae
config modemoption=0002030120c00000a60000000000000000c9
config state=enabled
ifadd intf=atm_8_35
ifconfig intf=atm_8_35 dest=atm_pvc_8_35 clp=classification clpthresh=14 ulp=mac encaps=llc
ifattach intf=atm_8_35
ifadd intf=atm_8_36
ifconfig intf atm_8_36 dest atm_pvc_8_36 ulp mac
ifattach intf atm_8_36
config mode=passive
ifadd intf=ethport2 logging=disabled
ifadd intf=ethport3 logging=disabled
ifadd intf=ethport4 logging=disabled
ifadd intf=br_video logging=disabled
ifadd intf=bri_ge logging=disabled 
ifadd intf=vdsl2 logging=disabled 
ifadd intf=WLAN dest=wlif1 logging=disabled
ifadd intf=WLAN5G dest=wle_radio1_ssid0 logging=disabled
ifadd intf=WLAN2 dest=wl_ssid1_local0 logging=disabled
ifadd intf=WLAN5 dest=wle_radio1_ssid1 logging=disabled
ifadd intf=virt logging=disabled
ifconfig intf=ethport1 logging=disabled dynvlan=enabled prioconfig=overwrite ipprec=dscp
ifconfig intf=ethport2 dest=ethif2 logging=disabled dynvlan=enabled prioconfig=overwrite ipprec=dscp
ifconfig intf=ethport3 dest=ethif3 logging=disabled dynvlan=enabled prioconfig=overwrite ipprec=dscp
ifconfig intf=ethport4 dest=ethif4 logging=disabled dynvlan=enabled prioconfig=overwrite ipprec=dscp
ifconfig intf=br_video dest=atm_8_36 logging=disabled
ifconfig intf=vdsl2 dest=efmif1 acceptvlanonly=enabled  wan=enabled logging=disabled
ifconfig intf=bri_ge dest=ethif5 acceptvlanonly=enabled wan=enabled logging=disabled
ifconfig intf=WLAN logging=disabled
ifconfig intf=virt dest=ethif6 logging=disabled
ifconfig brname=bridge intf=vdsl2 prioconfig=overwrite ipprec=dscp
ifconfig brname=bridge intf=bri_ge prioconfig=overwrite ipprec=dscp
ifconfig brname=bridge intf=br_video prioconfig=overwrite ipprec=dscp
ifconfig brname=bridge intf=WLAN prioconfig=overwrite ipprec=dscp
ifconfig brname=bridge intf=WLAN5G prioconfig=overwrite ipprec=dscp
ifconfig brname=bridge intf=WLAN2 prioconfig=overwrite ipprec=dscp
ifconfig brname=bridge intf=WLAN5 prioconfig=overwrite ipprec=dscp
ifconfig brname=bridge intf=OBC prioconfig=overwrite ipprec=dscp
ifattach intf=ethport2 logging=disabled
ifattach intf=ethport3 logging=disabled
ifattach intf=ethport4 logging=disabled
ifattach intf=bri_ge logging=disabled
ifattach intf=br_video logging=disabled
ifattach intf=vdsl2 logging=disabled
ifattach intf=WLAN logging=disabled
ifattach intf=WLAN5G logging=disabled
ifattach intf=WLAN2 logging=disabled
ifattach intf=WLAN5 logging=disabled
ifattach intf=virt logging=disabled
config age=300 filter=none vlan=enabled
dynvlan config timeout=180
ippriomap brname=bridge type=dscp dscpidx=dscp_0_7 precedencemap=4,4,4,4,4,4,4,4
ippriomap brname=bridge type=dscp dscpidx=dscp_16_23 precedencemap=0,0,0,0,0,0,0,0
ippriomap brname=bridge type=dscp dscpidx=dscp_32_39 precedencemap=11,11,11,11,11,11,11,11
ippriomap brname=bridge type=dscp dscpidx=dscp_48_55 precedencemap=15,15,15,15,15,15,15,15
ippriomap brname=bridge type=dscp dscpidx=dscp_56_63 precedencemap=15,15,15,15,15,15,15,15
ippriomap brname=bridge type=tos tostable=Default precedencemap=4,0,0,4,10,10,15,15
ippriomap brname=bridge type=tos tostable=MinimizeDelay precedencemap=4,0,0,4,10,10,15,15
ippriomap brname=bridge type=tos tostable=MaximizeThroughput precedencemap=4,0,0,4,10,10,15,15
ippriomap brname=bridge type=tos tostable=MaximizeReliability precedencemap=4,0,0,4,10,10,15,15
ippriomap brname=bridge type=tos tostable=MinimizeCost precedencemap=4,0,0,4,10,10,15,15
ippriomap brname=bridge type=dscp dscpidx=dscp_8_15 precedencemap=4,4,4,4,4,4,4,4
ippriomap brname=bridge type=dscp dscpidx=dscp_24_31 precedencemap=10,10,10,10,10,10,10,10
ippriomap brname=bridge type=dscp dscpidx=dscp_40_47 precedencemap=15,15,15,15,15,15,15,15
ifconfig intf bri_ge priotransparent=enabled dynprio=enabled
ifconfig intf vdsl2 priotransparent=enabled dynprio=enabled
[ env.ini ]
set var=CONF_REGION value="tr(0,World)"
set var=CONF_PROVIDER value="tr(1,Basic)"
set var=CONF_DESCRIPTION value="tr(2,Bridged Connection.)"
set var=CONF_SERVICE value="tr(3,Bridge)"
set var=CONF_DATE value=""
set var=CONF_DATETIME value=0000-00-00T00:00:00
set var=CONF_TPVERSION value="2.0.0"
set var=HOST_SETUP value="auto"
set var=HOST_LANGUAGE value="en"
set var=ATM_addr value="8.35"
set var=ST_V4_DHCP_SRV value="enabled"
set var=ST_V6_DHCP_SRV value="enabled"
set var=ST_SYS_USERNAME value="Administrator"
set var=%ST_SYS_PASSWORD value=""
set var=CWMPUSER value=${_OUI}-${_PROD_SERIAL_NBR}
set var=WL0_SSID_PREFIX_CUSTOM value=$_WL0_SSID_PREFIX
set var=WL1_SSID_PREFIX_CUSTOM value=${_WL0_SSID_PREFIX}Com
set var=WL2_SSID_PREFIX_CUSTOM value=${_WL0_SSID_PREFIX}Mob
set var=WL3_SSID_PREFIX_CUSTOM value=${_WL0_SSID_PREFIX}Gst
set var=WL0_SSID value=${WL0_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL1_SSID value=${WL1_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL2_SSID value=${WL2_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL3_SSID value=${WL3_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}

[ wizard.ini ]
' ATM PVC
'--------
def var=ATM type=grp desc="tr(4,Specify the details of the Internet connection. All information should be provided by your ISP.)" alias="tr(5,Bridged Internet Connection)"
def var=ATM_addr type=combo grp=ATM alias="VPI/VCI" data="0.32,0.33,0.34,0.35,0.36,0.37,0.38,0.100,1.32,1.33,1.100,8.32,8.35,8.36,8.37,8.48,8.81" desc="tr(6,Choose a VPI/VCI from the list)"
' LAN=Settings
'-------------
def var=LAN type=grp desc="tr(7,Specify the Local Area Network settings.)" alias="tr(8,LAN Settings)"
def var=ST_V4_DHCP_SRV type=bool grp=LAN alias="tr(9,DHCPv4 Server)" data="disabled,enabled" desc="tr(10,Start the DHCPv4 server on the Technicolor Gateway)" default=enabled
def var=ST_V6_DHCP_SRV type=bool grp=LAN alias="tr(19,Stateless DHCPv6 Server)" data="disabled,enabled" desc="tr(20,Start the stateless DHCPv6 server on the Technicolor Gateway)" default=enabled

'ST Security
'-----------
def var=ST type=grp desc="tr(11,Specify user name and password to prevent unwanted access to the Technicolor Gateway management interface.)" alias="tr(12,Access Control)"
def var=ST_SYS_USERNAME type=string grp=ST alias="tr(13,User Name)" req=yes desc="tr(14,Enter a user name.)"
def var=%ST_SYS_PASSWORD type=passw grp=ST alias="tr(15,Password)" desc="tr(16,Enter a password.)" max=32
def var=dummy2 type=passwcheck grp=ST alias="tr(17,Confirm Password)" desc="tr(18,Re-enter the password.)" linkvar=%ST_SYS_PASSWORD max=32

[ phone.ini ]
add name=usb_port addr=usb.0.35 logging=disabled
add name=pvc_Internet addr=$ATM_addr

[ ipqos.ini ]
config dest=pvc_Internet state=enabled maxbytes=128

queue config dest=pvc_Internet queue=0 maxbytes=64 hold=2000
queue config dest=pvc_Internet queue=1 ackfiltering=enabled maxpackets=40 maxbytes=100 hold=2000
queue config dest=pvc_Internet queue=2 hold=2000
queue config dest=pvc_Internet queue=3 hold=2000
queue config dest=pvc_Internet queue=4 hold=2000
queue config dest=pvc_Internet queue=5 maxpackets=30 maxbytes=12 hold=2000

[ atm.ini ]
ifadd intf=usbif1 dest=usb_port logging=disabled
ifconfig intf=usbif1 ulp=mac retry=0 logging=disabled
ifattach intf=usbif1 logging=disabled
ifadd intf=atm_Internet
ifconfig intf=atm_Internet dest=pvc_Internet
ifconfig intf=atm_Internet ulp=mac encaps=llc
ifattach intf=atm_Internet

[ bridge.ini ]
ifadd intf=ethport2 dest=ethif2 logging=disabled
ifadd intf=ethport3 dest=ethif3 logging=disabled
ifadd intf=ethport4 dest=ethif4 logging=disabled
ifadd intf=usbport dest=usbif1 logging=disabled
ifadd intf=virt dest ethif6 logging=disabled
ifadd intf=WLAN dest=wlif1 logging=disabled
ifconfig intf=ethport2 logging=disabled
ifconfig intf=ethport3 logging=disabled
ifconfig intf=ethport4 logging=disabled
ifconfig intf=usbport retry=0 logging=disabled
ifconfig intf=virt logging=disabled
ifconfig intf=WLAN logging=disabled
ifattach intf=ethport2 logging=disabled
ifattach intf=ethport3 logging=disabled
ifattach intf=ethport4 logging=disabled
ifattach intf=usbport logging=disabled
ifattach intf=virt logging=disabled
ifattach intf=WLAN logging=disabled
ifadd intf=Internet dest=atm_Internet
ifattach intf=Internet
config age=300 filter=none

[ eth.ini ]

[ ppprelay.ini ]

[ ppp.ini ]

[ dnss.ini ]
config domain=lan timeout=15 suppress=0 trace=disabled WANDownSpoofing=disabled WDSpoofedIP=198.18.1.1
host add name=speedtouch addr=0.0.0.0 ttl=1200
host add name=dsldevice addr=0.0.0.0 ttl=1200

[ dsd.ini ]
config state=disabled

[ servmgr.ini ]
mapadd name=HTTPI intf=LocalNetwork port=www-http
mapadd name=HTTPI intf=LocalNetwork port=1080
mapadd name=HTTPI intf=LocalNetwork port=httpproxy
ifadd name=AppWeb group=lan
ifadd name=AppWebS group=lan
ifadd name=HTTP group=lan
ifadd name=HTTPs group=lan
ifadd name=FTP group=lan
ifadd name=TELNET group=lan
ifadd name=DNS-S group=lan
ifadd name=DNS-S-TCP group=lan
ifadd name=SNMP_AGENT group=lan
ifadd name=PING_RESPONDER group=lan
ifadd name=PPTP group=lan
ifadd name=SSDP group=lan
ifadd name=MDAP group=lan
modify name=AppWeb state=enabled
modify name=AppWebS state=enabled
modify name=DNS-C state=enabled qoslabel=Management
modify name=DHCP-S state=$ST_V4_DHCP_SRV
modify name=DHCPv6-S state=$ST_V6_DHCP_SRV
modify name=SNTP state=disabled
modify name=HTTP state=enabled
modify name=HTTPs state=enabled
modify name=HTTPI state=enabled
modify name=FTP state=enabled
modify name=TELNET state=enabled
modify name=RIP state=disabled
modify name=IGMP-Proxy state=enabled qoslabel=Management
modify name=DNS-S state=enabled qoslabel=Management
modify name=DNS-S-TCP state=enabled qoslabel=Management
modify name=SNMP_AGENT state=disabled
modify name=IP_COMMANDS state=enabled
modify name=PING_RESPONDER state=enabled
modify name=MDAP state=enabled
modify name=CWMP-C state=disabled qoslabel=Management
modify name=SSDP state=enabled
modify name=PPTP state=enabled


[ mlpuser.ini ]
#if $%ST_SYS_PASSWORD=""
add name=$ST_SYS_USERNAME password="" role=Administrator defuser=enabled
#else
add name=$ST_SYS_USERNAME password=$%ST_SYS_PASSWORD role=Administrator defuser=enabled
#endif
add name=tech password=$_PROD_SERIAL_NBR role=TechnicalSupport defremadmin=enabled
config name=tech password=$__SEC_MODEM_ACCESS_CODE

[ language.ini ]
langdef lang=nl
t r="0, Wereld"
t r="1, Basis"
t r="2, Bridged-verbinding."
t r="3, Bridge"
t r="4, Geef de details van de Internetverbinding. Alle informatie wordt door uw Internet-provider verstrekt."
t r="5, Bridged-Internetverbinding"
t r="6, Kies een VPI/VCI uit de lijst"
t r="7, Geef de instellingen voor het lokale netwerk (LAN)."
t r="8, LAN-instellingen"
t r="9, DHCPv4-server"
t r="10, Start de DHCPv4-server op de Technicolor Gateway"
t r="11, Geef gebruikersnaam en wachtwoord om ongewenste toegang tot de beheersinterface van de Technicolor Gateway te voorkomen."
t r="12, Toegangscontrole"
t r="13, Gebruikersnaam"
t r="14, Voer een gebruikersnaam in."
t r="15, Wachtwoord"
t r="16, Voer een wachtwoord in."
t r="17, Bevestig wachtwoord"
t r="18, Voer het wachtwoord opnieuw in."
t r="19, Stateless DHCPv6-Server"
t r="20, Start de staatloze DHCPv6-server op de Technicolor Gateway"
langdef lang=de
t r="0, Welt"
t r="1, Standard"
t r="2, Bridge-Verbindung."
t r="3, Bridge"
t r="4, Geben Sie Informationen zu der Internetverbindung an. Sie erhalten alle ntigen Informationen bei Ihrem Internetdienstanbieter."
t r="5, Bridge-Internetverbindung"
t r="6, Whlen Sie einen VPI/VCI aus der Liste aus"
t r="7, Legen Sie die Einstellungen fr das LAN (Local Area Network) fest."
t r="8, LAN-Einstellungen"
t r="9, DHCPv4-Server"
t r="10, Starten Sie den DHCPv4-Server des Technicolor Gateway"
t r="11, Geben Sie einen Benutzernamen und ein Kennwort ein, um unerwnschten Zugriff auf die Technicolor Gateway-Verwaltungsschnittstelle zu vermeiden."
t r="12, Zugangskontrolle"
t r="13, Benutzername"
t r="14, Geben Sie einen Benutzernamen ein."
t r="15, Kennwort"
t r="16, Geben Sie ein Kennwort ein."
t r="17, Kennwort besttigen"
t r="18, Geben Sie das Kennwort erneut ein."
t r="19, Stateless DHCPv6 Server"
t r="20, Starten Sie den staatenlosen DHCPv6-Server des Technicolor Gateway"
langdef lang=pt
t r="0, Mundial"
t r="1, Bsico"
t r="2, Conexo com ponte."
t r="3, Com ponte"
t r="4, Especifique os detalhes da conexo com a Internet. Todas as informaes devem ser obtidas com o provedor."
t r="5, Conexo com a Internet com ponte"
t r="6, Escolha uma VPI/VCI na lista"
t r="7, Especifique as configuraes da Rede local."
t r="8, Configuraes da LAN"
t r="9, Servidor DHCPv4"
t r="10, Iniciar servidor DHCPv4 no Technicolor Gateway"
t r="11, Especifique o nome de usurio e a senha para impedir o acesso no desejado  interface de gerenciamento do Technicolor Gateway."
t r="12, Controle de acesso"
t r="13, Nome de usurio"
t r="14, Digite um nome de usurio."
t r="15, Senha"
t r="16, Digite uma senha."
t r="17, Confirmar senha"
t r="18, Digite novamente a senha."
t r="19, Servidor DHCPv6 aptridas"
t r="20, Iniciar servidor DHCPv6 aptridas no Technicolor Gateway"
langdef lang=es
t r="0, Mundo"
t r="1, Bsico"
t r="2, Conexin con puente."
t r="3, Puente"
t r="4, Especifique los detalles de la conexin a Internet. Toda la informacin debe proporcionarla su proveedor de servicios de Internet."
t r="5, Conexin a Internet con puente"
t r="6, Elegir un VPI/VCI de la lista"
t r="7, Especifique la configuracin de la red de rea local."
t r="8, Configuracin de la LAN"
t r="9, Servidor DHCPv4"
t r="10, Iniciar el servidor DHCPv4 en Technicolor Gateway"
t r="11, Especifique el nombre de usuario y la contrasea para impedir el acceso no autorizado a la interfaz de administracin de Technicolor Gateway."
t r="12, Control de acceso"
t r="13, Nombre de usuario"
t r="14, Escriba un nombre de usuario."
t r="15, Contrasea"
t r="16, Escriba una contrasea."
t r="17, Confirmar contrasea"
t r="18, Vuelva a escribir la contrasea."
t r="19, Aptridas servidor DHCPv6"
t r="20, Iniciar el servidor sin estado DHCPv6 en Technicolor Gateway"
langdef lang=it
t r="0, Mondiale"
t r="1, Modello base"
t r="2, Connessione Bridged."
t r="3, Bridge"
t r="4, Specificare i dettagli della connessione Internet. Tutte le informazioni devono essere fornite dal proprio ISP."
t r="5, Connessione Internet Bridged"
t r="6, Scegliere un VPI/VCI dall'elenco"
t r="7, Specificare le impostazione per la LAN (Local Area Network)."
t r="8, Impostazioni LAN"
t r="9, Server DHCPv4"
t r="10, Avvia il server DHCPv4 sullo Technicolor Gateway"
t r="11, Specificare nome utente e password per impedire accessi non autorizzati all'interfaccia di gestione dello Technicolor Gateway."
t r="12, Controllo di accesso"
t r="13, Nome utente"
t r="14, Immettere un nome utente"
t r="15, Password"
t r="16, Immettere una password."
t r="17, Conferma password"
t r="18, Reimmettere la password."
t r="19, Apolide Server DHCPv6"
t r="20, Avvia il apolidi server DHCPv6 sullo Technicolor Gateway"
langdef lang=fr
t r="0, Monde"
t r="1, Basic"
t r="2, Connexion drive."
t r="3, Pont"
t r="4, Spcifiez les dtails de la connexion Internet. Toutes les informations doivent tre fournies par votre fournisseur de services Internet."
t r="5, Connexion Internet drive."
t r="6, Choisissez un VPI/VCI dans la liste"
t r="7, Spcifiez les paramtres LAN (rseau local)."
t r="8, Paramtres LAN"
t r="9, Serveur DHCPv4"
t r="10, Dmarrez le serveur DHCPv4 sur le Technicolor Gateway"
t r="11, Spcifiez un nom d'utilisateur et un mot de passe pour empcher les accs non voulus  l'interface de gestion du Technicolor Gateway."
t r="12, Contrle d'accs"
t r="13, Nom d'utilisateur"
t r="14, Entrez un nom d'utilisateur."
t r="15, Mot de passe"
t r="16, Entrez un mot de passe."
t r="17, Confirmer le mot de passe"
t r="18, Entrez  nouveau le mot de passe."
t r="19, Apatrides serveur DHCPv6"
t r="20, Dmarrez le serveur DHCPv6 apatrides sur le Technicolor Gateway"
langdef lang=sv
t r="0, Vrlden"
t r="1, Grunder"
t r="2, Bridged-anslutning."
t r="3, Bridge"
t r="4, Ange information om Internet-anslutningen. Du fr all information som behvs av Internet-leverantren."
t r="5, Bridged Internet-anslutning"
t r="6, Vlj en VPI/VCI i listan"
t r="7, Ange instllningar fr LAN (Local Area Network)"
t r="8, LAN-instllningar"
t r="9, DHCPv4-server"
t r="10, Starta DHCPv4-servern p Technicolor Gateway"
t r="11, Ange anvndarnamn och lsenord fr att frhindra onskad tkomst till hanteringsgrnssnittet fr Technicolor Gateway."
t r="12, tkomstkontroll"
t r="13, Anvndarnamn"
t r="14, Ange ett anvndarnamn."
t r="15, Lsenord"
t r="16, Ange ett lsenord."
t r="17, Bekrfta lsenordet"
t r="18, Ange lsenordet igen."
t r="19, Statslsa DHCPv6-server"
t r="20, Starta statslsa DHCPv6-server p Technicolor Gateway"

[ endofarch ]
:expr add name VoIP-Inc-SIPS type serv proto udp dstport 5060
:expr add name VoIP-Inc-SIP type serv proto udp dstport 5070
:label rule add chain qos_user_labels index=6 name incoming-sips-sip srcintf wan serv VoIP-Inc-SIPS state enabled label VoIP
:label rule add chain qos_user_labels index=7 name incoming-voice-sip srcintf wan serv VoIP-Inc-SIP state enabled label VoIP
:sipserver extua modify id=1 intf=Telecom_Italia sipport=sip outboundregistrar=1 outboundproxy=1 Realm=2  
:sipserver extua modify id=2 intf=Telecom_Italia sipport=sip outboundregistrar=2 outboundproxy=2 Realm=2  
:sipserver extua modify id=3 intf=Telecom_Italia sipport=sip outboundregistrar=3 outboundproxy=3 Realm=2  
:sipserver extua modify id=4 intf=Telecom_Italia sipport=sip outboundregistrar=4 outboundproxy=4 Realm=2  
:connection bind application CONE(UDP) port=3074
:connection bind application CONE(UDP) port=88
:nat tmpladd intf=ppp_0 type=nat outside_addr=0.0.0.1 inside_addr=127.0.0.2 access_list=127.0.0.2 protocol=icmp outside_port=8-8 inside_port=8-8 weight=10 creator_name=Undefined
:pwr config eco-manager=enabled cpu-microsleep=disabled cpu-lowspeed=disabled usb-controller=enabled wlan-pwrcontrol=enabled
:wansensing config state=disabled
:wansensing mode delete name=NONE
:wansensing mode delete name=ADSL
:wansensing mode delete name=VDSL
:wansensing mode delete name=ETH
:wansensing mode add name=NONE maininterval=25 scriptname=TI-auto-sensing-script
:wansensing mode add name=ADSL maininterval=25 scriptname=TI-adsl-script
:wansensing mode add name=ETH maininterval=25 scriptname=TI-eth-script
:wansensing mode add name=VDSL maininterval=25 scriptname=TI-vdsl-script
:wansensing config state=enabled
:voice services config mwi_phone both
:voice tone patterntable add id 65 tone on freq1 425 power1 -6 duration 100 nextentry 66
:voice tone patterntable add id 66 tone on freq1 0 power1 0 duration 100 nextentry 67
:voice tone patterntable add id 67 tone on freq1 425 power1 -6 duration 100 nextentry 0
:voice tone descrtable modify tone=mwi status=enabled patternentryid=65 maxduration=3000 repeatafter=1000 delay 400 nexttone dial
:firewall rule flush chain=sink_fire
:firewall rule add chain=sink_fire index=1 srcintf=lan serv=cwmp-s log=disabled state=enabled action=deny



:dns server route add dns 0.0.0.0 label modemToACS intf Telecom_Italia  metric  0 domain reteims.telecomitalia.it
:dns server route add dns 0.0.0.0 label modemToACS intf Telecom_Italia  metric  0 domain imswline.telecomitalia.it
:dns server route add dns 0.0.0.0 label modemToACS intf Telecom_Italia  metric  0 domain imsw.telecomitalia.it
:label rule add chain=rt_user_labels srcintf=from_loop serv=extua state=enabled label modemToACS
:connection bind application CONE(UDP) port 3544
:connection bind application CONE(UDP) port 4500
:service host add name="Xbox One Live" mode=server
:service host rule add name="Xbox One Live" protocol=any portrange=88 mode=auto
:service host rule add name="Xbox One Live" protocol=any portrange=3074 mode=auto
:service host rule add name="Xbox One Live" protocol=any portrange=3544 mode=auto
:service host rule add name="Xbox One Live" protocol=any portrange=4500 mode=auto

:dhcp server option instdelete name=option60
:dhcp rule delete name=option60rule
:dhcp rule add name=option60rule type=option option=vendor-class-identifier value=(ascii)dslforum.org match=as_substring
:dhcp server option instadd name=option60 tmplname=VendorClassId policy=rules value="(ascii)dslforum.org"
:dhcp server option ruleadd name=option60 rulename=option60rule
:dhcp server option instdelete name=option43 suboption=2
:dhcp server option instdelete name=option43 suboption=3
:dhcp server option instdelete name=option43 suboption=4
:dhcp server option instdelete name=option43 suboption=5
:dhcp server option instadd name=option43 tmplname=VendorSpecificInf suboption=2 value=(env)CONF_PROVIDER
:dhcp server option ruledelete name=option43 rulename=option43rule
:dhcp server option ruleadd name=option43 rulename=option60rule
:dhcp server pool config name LocalNetwork_default state disabled
:dhcp server pool optadd name=LocalNetwork_default instname=option43
:dhcp server pool optadd name=LocalNetwork_default instname=option60
:dhcp server pool config name LocalNetwork_default state enabled

:voice services deactivate  type=transfer
appconfig application=JABBER trace=disabled timeout=120
appconfig application=CU/SeeMe trace=enabled
appconfig application=RAUDIO(PNA) trace=enabled
appconfig application=RTSP trace=enabled
appconfig application=ILS timeout=300
appconfig application=H245 timeout=300
appconfig application=H323 trace=enabled
appconfig application=IRC trace=enabled timeout=300
appconfig application=LOOSE(UDP) trace=enabled timeout=300
appconfig application=FTP trace=enabled
appconfig application=PPTP trace=enabled
appconfig application=ESP timeout=900
appconfig application=IKE trace=disabled timeout=900 floating=enabled
bind application=PPTP port=1723-1723
bind application=CU/SeeMe port=7648-7648
bind application=RAUDIO(PNA) port=7070-7070
bind application=RTSP port=554-554
bind application=ILS port=389-389
bind application=ILS port=1002-1002
bind application=H323 port=1720-1720
bind application=IRC port=6660-6669
bind application=FTP port=21-21
bind application=JABBER port=5222-5222
bind application=JABBER port=15222-15222
bind application=GAME(UDP) port=27010-27011
bind application=LOOSE(UDP) port=67
bind application=LOOSE(UDP) port=69
bind application=CONE(UDP) port=3478
bind application CONE(UDP) port=3074
bind application CONE(UDP) port=88
bind application CONE(UDP) port=3544
bind application CONE(UDP) port=4500
bind application=ESP port=0
bind application=IKE port=500-500
bind application=HTTPI port=80
bind application=HTTPI port=1080
bind application=HTTPI port=8080
config configchangemode=immediate probes=disabled 
debug trace=disabled
timerconfig timer=tcpidle value=5
timerconfig timer=tcpneg value=120
timerconfig timer=tcpkill value=5
timerconfig timer=udpidle value=5
timerconfig timer=udpkill value=5
timerconfig timer=icmpkill value=60
timerconfig timer=ipidle value=10
timerconfig timer=ipkill value=1
cifs config state=enabled workgroup=WORKGROUP name=modemtelecom comment="TI Alice Gateway"
upnp config state=enabled friendlyname=ModemTelecom
config state=enabled mode=full periodicInform=disabled periodicInfInt=43200 sessionTimeout=60 noIpTimeout=180 maxEnvelopes=1 connectionRequest=enabled connectionReqPath=ConnectionRequest connectionReqUserName="" connectionReqPsswd="" connectionReqAuth=none qos-class=12 bootdelayrange=0 persistentSubscription=enabled am1Termination=enabled upgradedelay=enabled rpcupload=enabled
server config url=https://regman-tl.interbusiness.it:10500/acs/ username=0018F6-Thomson-AGBasAdv password=C72hjT7Bol8x76hnKoP3Yi2a
debug traceconfig level=0
runtimevar softwareVersion=Unknown bootstrap=disabled
config showPasswords enabled
ifadd intf IPTV
rqoptions add intf=IPTV option=classfull-static-routes index=1
rqoptions add intf=IPTV option=classless-static-routes index=2
txoptions add intf=IPTV option=vendor-specific_info value=(clientid)666c617368 index=1
txoptions add intf=IPTV option=vendor-class-id value=(clientid)706972656c6c692d737462 index=2

ifadd intf=ppp_0
ifconfig intf=ppp_0 iana=0 iapd=1 listenra=disabled rapidcommit=enabled dnsmetric 50
oro add intf=ppp_0 option=domain-name-servers
oro add intf=ppp_0 option=dhcp-reconfigure-accept
ifattach intf=ppp_0

debug traceconfig state=disabled
ifconfig intf=LocalNetwork relay=enabled
add name=LocalNetwork_to_127.0.0.1
modify name=LocalNetwork_to_127.0.0.1 addr=127.0.0.1 intf=LocalNetwork giaddr=192.168.1.1
ruleadd name=LocalNetwork_to_127.0.0.1 rulename=noIPTV
add name=dhcp_to_iptv
modify name dhcp_to_iptv addr 10.0.0.1 intf LocalNetwork script video
ruleadd name=dhcp_to_iptv rulename=IPTV
add name=option43rule type=option option=vendor-specific_info
add name=option60rule type=option option=vendor-class-identifier value="(ascii)dslforum.org" match=as_substring
add name=option125rule type=option option=vi-vendor-specific-info
add name IPTV type option option vendor-class-identifier value (ascii)stb match as_substring
add name noIPTV type option option !vendor-class-identifier value (ascii)stb match as_substring
debug traceconfig state=disabled
ifconfig intf=LocalNetwork status=enabled interfaceid=enabled 
add name=LocalNetwork_to_loop
modify name=LocalNetwork_to_loop addr=::1 intf=LocalNetwork
debug traceconfig state=disabled
policy verifyfirst=enabled trustclient=enabled rtbehaviour=traditional
option tmpladd name=VI-VendorSpecificInf optionid=125
option tmpladd name=VendorClassId optionid=60
option tmpladd name=VendorSpecificInf optionid=43
option instadd name=option125 tmplname=VI-VendorSpecificInf policy=rules enterprise=3561 suboption=4 value=(env)_OUI
option instadd name=option125 tmplname=VI-VendorSpecificInf enterprise=3561 suboption=5 value=(env)_PROD_SERIAL_NBR
option instadd name=option125 tmplname=VI-VendorSpecificInf enterprise=3561 suboption=6 value=(env)_PROD_NAME
option ruleadd name=option125 rulename=option125rule
option instadd name=option60 tmplname=VendorClassId policy=rules value="(ascii)dslforum.org"
option ruleadd name=option60 rulename=option60rule
option instadd name=option43 tmplname=VendorSpecificInf policy=rules suboption=1 value=(env)ACS_URL
option instadd name=option43 tmplname=VendorSpecificInf suboption=2 value="(env)CONF_PROVIDER"
option ruleadd name=option43 rulename=option60rule
pool config name=LocalNetwork_default intf=LocalNetwork poolstart=192.168.1.2 poolend=192.168.1.254 netmask=24 gateway=192.168.1.1 server=192.168.1.1 leasetime=21600
lease add clientid=$_LMACADDR pool=LocalNetwork_default addr=192.168.1.254 expirytime=0
pool optadd name=LocalNetwork_default instname=option125
pool optadd name=LocalNetwork_default instname=option60
pool optadd name=LocalNetwork_default instname=option43
pool add name=LocalNetwork_default
debug traceconfig state=disabled
option add name=dns-search-list
option modify name=dns-search-list policy=requested
option fieldadd name=dns-search-list option=domain-name-search value=homenet.telecomitalia.it
pool add name=LAN6_pool
pool config name=LAN6_pool state=enabled intf=LocalNetwork localdns=enabled
pool optionadd name=LAN6_pool optionname=dns-search-list

config pingtimeout=1000 pingpacketsize=32
-----BEGIN CERTIFICATE-----
MIID4jCCAsqgAwIBAgICKHAwDQYJKoZIhvcNAQEFBQAwbDELMAkGA1UEBhMCSVQx
FTATBgNVBAoMDEkuVC4gVGVsZWNvbTEiMCAGA1UECwwZU2Vydml6aSBkaSBjZXJ0
aWZpY2F6aW9uZTEiMCAGA1UEAwwZSS5ULiBUZWxlY29tIFByaXZhdGUgQ0EgMTAe
Fw0xMjAzMjgxNDE0MjhaFw0zMjAzMjgxNDE0MjhaMGwxCzAJBgNVBAYTAklUMRUw
EwYDVQQKDAxJLlQuIFRlbGVjb20xIjAgBgNVBAsMGVNlcnZpemkgZGkgY2VydGlm
aWNhemlvbmUxIjAgBgNVBAMMGUkuVC4gVGVsZWNvbSBQcml2YXRlIENBIDEwggEi
MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCqr3sVmdwLsoiX282QIcpQu3I0
KjR3ReI9Zv8s+LP9yovn9ZcYvocs37BgQJPeXnm2TH6tLVESfWJSpnW7FmgXQ1qJ
cKzzUl5+PpAgc5AV0pXDQOMXDirScqlDHsIogqpdhoUjeVMsLTE30H1IyclYSUta
BZ9rczXG4kwVl8x76Fh1rqkFOjK9dP/50WtHpbv/FtNnCFzT8Zc34+VnBnxLVATC
5Xz6QLj7u4iMSwTdhfNspqXtm42r7ly5I0Q2eZrAzII2JvK13fPg57S6Ehu7zyTj
h8zf9knwtTQESC1wWKTf4m4Z6DYMnf2nKzFwYUpPiJ+964v+S3k3KNAdYqJNAgMB
AAGjgY0wgYowDwYDVR0TAQH/BAUwAwEB/zBIBgNVHSAEQTA/MD0GBitMIQEBBDAz
MDEGCCsGAQUFBwIBFiVodHRwOi8vY2EuaXR0ZWxlY29tLml0L1ByaXZhdGVDQTEv
Q1BTMA4GA1UdDwEB/wQEAwIBBjAdBgNVHQ4EFgQUJL9zfEnK91+EuB4RRQBAZ95e
cyswDQYJKoZIhvcNAQEFBQADggEBAJLlOLFNQu9XnvxN71hRxLxtSHzJv7baZQ5p
9mRExUq0jQ2dLt7GQtiOmE4ezsb5pn1psegLw8mAhwNQCJkUIiKXPlrQyEqNfORx
1G5nViUT1NfuJXO1DGYaToGElHOfv2LZIpCOMrV0G3C2uKs0hBlLIGoYdBKPoMP0
ooPXdAUqk/1IPngp6yoH6I99Og/ojeyWxU/73k32h3NFX0W+KpyxvYdwWYGBp9LH
zBxML82I0sUYWwyoUo5GCqzDMZuanYndSGYXHNwk64iWPLOp3J84c7SHU5btfVcI
l8pTrgI5p5veVXc1sqmmLABXAKAcDp5+j5I0FDGLa0bQfi7FZvA=
-----END CERTIFICATE-----
config configFileName=$BSFTConfigFileName serverURI https://dmvpbx20.impresasemplice.it/dms/AG_Plus_TCH maxretries 5
config timeout=5 retry=4 search=enabled trace=disabled
dnsadd addr=127.0.0.1 port=53
config domain=homenet.telecomitalia.it timeout=15 suppress=2 trace=disabled WANDownSpoofing=enabled WDSpoofedIP=198.18.1.1 filter=disabled
host add name=modemtelecom addr=0.0.0.0 ttl=1200
route add dns=0.0.0.0 domain=ntp-tr069-1.interbusiness.it label=modemToACS intf=Telecom_Italia
route add dns=0.0.0.0 domain=ntp-tr069-2.interbusiness.it label=modemToACS intf=Telecom_Italia
route add dns=0.0.0.0 domain=regman-tl.interbusiness.it label=modemToACS intf=Telecom_Italia
route add dns 0.0.0.0 label modemToACS intf Telecom_Italia  metric 0 domain reteims.telecomitalia.it
route add dns 0.0.0.0 label modemToACS intf Telecom_Italia  metric 0 domain imswline.telecomitalia.it
route add dns 0.0.0.0 label modemToACS intf Telecom_Italia  metric 0 domain imsw.telecomitalia.it
route add dns=151.99.0.100 domain="" metric=50 intf=ppp_0 
route add dns=151.99.125.1 domain="" metric=50 intf=ppp_0 
:mbus debug loadobjects dmtree=atomic path=DNS.Server.Route
forward dnsset add set=100 dns=2001:4b18:1050:916f::53:c001 label=modemToACS intf=Telecom_Italia metric 50
forward dnsset add set=100 dns=2001:4b18:1050:916f::53:c002 label=modemToACS intf=Telecom_Italia metric 50
forward dnsset add set=106 dns=0.0.0.0 metric=10 intf=ppp_0

syslog config syslog=unauthorized
intercept config WDSpoofedIP=198.18.1.1 servertimeout=10 connecterrorurl=/noconnect.html categoryerrorurl=/noconnect.html monitorintercepturl=/noconnect.html unauthorizedrequrl=/urlfilter.html imageredirect=enabled imageredirecturl=/images/spacer.gif alwaysuseip=disabled
urlfilter config state=disabled blockproxy=disabled blockipaddress=disabled blockobscuredip=disabled defaultaction=accept
config state=automatic

service modify name=dyndns server=dyndns.it port=www-http request=/nic/update updateinterval=86400 retryinterval=30 max_retry=3
service modify name=statdns server=members.dyndns.org port=www-http request=/nic/update updateinterval=86400 retryinterval=30 max_retry=3
service modify name=No-IP server=dynupdate.no-ip.com port=www-http request=/ducupdate.php updateinterval=86400 retryinterval=30 max_retry=3
service modify name=DtDNS server=www.dtdns.com port=www-http request=/api/autodns.cfm updateinterval=86400 retryinterval=30 max_retry=3
qos config intf efmif1 queues 4 priority strict
qos queue config intf queue_e0 subprio 0 maxpackets 900 loprio 0 hiprio 4
qos queue config intf queue_e1 subprio 1 maxpackets 800 loprio 5 hiprio 9
qos queue config intf queue_e2 subprio 2 maxpackets 600 loprio 10 hiprio 13
qos queue config intf queue_e3 subprio 3 maxpackets 500 loprio 14 hiprio 15
set var=CONF_REGION value=---
set var=CONF_PROVIDER value=""
set var=CONF_DESCRIPTION value="Vendor config file"
set var=CONF_SERVICE value=""
set var=CONF_DATE value=""
set var=HOST_SETUP value=auto
set var=UPGRADE_URL value=http://downloads.technicolor.com/GCD/upgrade/upgrade.htm
set var=CONF_DATETIME value=""
set var=CONF_TPVERSION value=2.0.0
set var=CWMPUSER value=${_OUI}-${_PROD_SERIAL_NBR}
set var=WL0_SSID_PREFIX_CUSTOM value=Telecom-
set var=WL1_SSID_PREFIX_CUSTOM value=Telecom2-
set var=WL2_SSID_PREFIX_CUSTOM value=Telecom3-
set var=WL3_SSID_PREFIX_CUSTOM value=Telecom4-
set var=WL_SSID_PREFIX_GUEST value=Ospiti-Telecom-
set var=WL0_SSID value=${WL0_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL1_SSID value=${WL1_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL2_SSID value=${WL2_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL3_SSID value=${WL3_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL_GUEST_SSID value=${WL_SSID_PREFIX_GUEST}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=MDNotificationLimit value=10
set var=SESSIONTIMEOUT value=0
set var=ISPName value="Telecom Italia"
set var=ISPHomePage value="http://www.telecomitalia.it"
set var=ISPHelpPage value="http://assistenzatecnica.telecomitalia.it/"
set var IsFXONum value "Linea Fissa"
set var=PPPLL_Telecom_Italia value="Device.Ethernet.Link.4,Device.Ethernet.VLANTermination.1"
set var=PPPLL_ppp_0 value="Device.Ethernet.Link.4,Device.Ethernet.VLANTermination.2"
set var=USB_Port1_Enable value=1
set var=USB_Port2_Enable value=1
set var=DSL_LINE_ENABLE value="true"
set var=DSL_CHANNEL_ENABLE value="true"
set var=PPP_0_ENABLE value="false"
set var=BSFTConfigFileName value=${_MACADDR_SHORT}".xml"
set var IPv6UserConfigurable value false
set var=GUI_New_Modem_IP value=""
set var=GUI_New_Modem_IP_Mask value=""
root:x:0:
daemon:x:1:
bin:x:2:
sys:x:3:
adm:x:4:
tty:x:5:
disk:x:6:
lp:x:7:lp
mail:x:8:
news:x:9:
uucp:x:10:
nobody:x:11:
proxy:x:13:
kmem:x:15:
dialout:x:20:
fax:x:21:
voice:x:22:
cdrom:x:24:
floppy:x:25:
tape:x:26:
sudo:x:27:
audio:x:29:
dip:x:30:
postgres:x:32:
www-data:x:33:
backup:x:34:
operator:x:37:
list:x:38:
irc:x:39:
src:x:40:
gnats:x:41:
shadow:x:42:
utmp:x:43:
video:x:44:
staff:x:50:
games:x:60:
users:x:100:
nogroup:x:65534:
root::0:0:Super User:/:/bin/sh
nobody:*:1:1:nobody:/:/bin/sh
nameserver 192.168.1.254
/usr/bin/nmonshell
/bin/sh
ifadd intf=mgmt_837
ifconfig intf=mgmt_837 dest bridge vlan mgmt wan enabled priomap=disabled
ifattach intf=mgmt_837
ifadd intf=user_835
ifconfig intf=user_835 dest bridge vlan data priomap=disabled
ifattach intf=user_835
ifadd intf=dummy
ifadd intf=ethoa_8_35
ifconfig intf=ethoa_8_35 dest=atm_8_35 vlan=default priotag=disabled
ifattach intf=ethoa_8_35
ifconfig intf=mgmt_837 priority=5
ifconfig intf=user_835 priority=0
ifadd intf=ethoa_8_36
ifconfig intf=ethoa_8_36 dest=atm_8_36 vlan=default priotag=disabled
ifadd intf=video_836
ifconfig intf=video_836 priority=3
ifconfig intf=video_836 dest bridge vlan video wan enabled
fap map tmprio=0 intlowprio=0 inthiprio=7
fap map tmprio=1 intlowprio=8 inthiprio=11
fap map tmprio=3 intlowprio=12 inthiprio=15
add name=wan type=intf intfgroup=wan
add name=local type=intf intfgroup=local
add name=lan type=intf intfgroup=lan
add name=tunnel type=intf intfgroup=tunnel
add name=dmz type=intf intfgroup=dmz
add name=guest type=intf intfgroup=guest
add name IPTV_wan type intf intf IPTV
add name=from_loop type=intf intf=loop
add name=private type=ip addr=10.0.0.0/8
add name=private type=ip addr=172.[16-31].*.*
add name=private type=ip addr=192.168.1.0/24
add name=ping_diag_dst type=ip addr=1.1.1.1/32 
add name=lanSubnet type=ip addr=192.168.1.0/24
add name=icmp type=serv proto=icmp
add name=igmp type=serv proto=igmp
add name=ftp type=serv proto=tcp dstport=ftp
add name=telnet type=serv proto=tcp dstport=telnet
add name=http type=serv proto=tcp dstport=www-http
add name=httpproxy type=serv proto=tcp dstport=httpproxy
add name=https type=serv proto=tcp dstport=443
add name=RPC type=serv proto=tcp dstport=135
add name=NBT type=serv proto=udp dstport=netbios-ns
add name=NBT type=serv proto=udp dstport=netbios-dgm
add name=NBT type=serv proto=tcp dstport=netbios-ssn
add name=SMB type=serv proto=tcp dstport=445
add name=imap type=serv proto=tcp dstport=imap2
add name=imap3 type=serv proto=tcp dstport=imap3
add name=imap4-ssl type=serv proto=tcp dstport=585
add name=imaps type=serv proto=tcp dstport=993
add name=pop2 type=serv proto=tcp dstport=pop2
add name=pop3 type=serv proto=tcp dstport=pop3
add name=pop3s type=serv proto=tcp dstport=995
add name=smtp type=serv proto=tcp dstport=smtp
add name=ssh type=serv proto=tcp dstport=22
add name=dns type=serv proto=tcp dstport=dns
add name=dns type=serv proto=udp dstport=dns
add name=nntp type=serv proto=tcp dstport=nntp
add name=ipsec type=serv proto=ah
add name=ipsec type=serv proto=esp
add name=ipsec type=serv proto=udp dstport=ike
add name=ipsec type=serv proto=udp dstport=4500
add name=esp type=serv proto=esp
add name=ah type=serv proto=ah
add name=ike type=serv proto=udp dstport=ike
add name=DiffServ type=serv dscp=!cs0
add name=h323 type=serv proto=tcp dstport=h323
add name=h323 type=serv proto=udp dstport=h323
add name=h323 type=serv proto=tcp dstport=1718
add name=h323 type=serv proto=udp dstport=1718
add name=h323 type=serv proto=tcp dstport=1719
add name=h323 type=serv proto=udp dstport=1719
add name=dhcp type=serv proto=udp dstport=bootpc
add name=dhcp type=serv proto=udp dstport=bootps
add name=rtsp type=serv proto=udp dstport=554
add name=rtsp type=serv proto=tcp dstport=554
add name=ssdp_ip type=ip addr=239.255.255.250
add name=ssdp_serv type=serv proto=udp dstport=1900
add name=mdap_ip type=ip addr=224.0.0.103
add name=mdap_serv type=serv proto=udp dstport=3235
add name=syslog type=serv proto=udp dstport=syslog
add name=Serv_CS5 type=serv dscp=cs5
add name=Serv_CS1 type=serv dscp=cs1
add name=Serv_CS3 type=serv dscp=cs3
add name=mgmt_route_targets type=ip addr=0.0.0.0/32
add name=cwmp-s type=serv proto=tcp dstport=7170
add name=stb_hosts type=ip addr=0.0.0.0/32
add name=ntp type=serv proto=udp dstport=123
add name=VoIP-Inc-SIP-UDP type=serv proto=udp dstport=5060
add name=VoIP-Inc-SIP-TCP type=serv proto=tcp dstport=5060
add name=extua type=serv  proto=udp srcport=sip
add name incoming-sips-rtp type serv proto udp dstport 16384 dstportend 32767
add name incoming-voice-rtp type serv proto udp dstport 1024 dstportend 1151
add name VoIP-Inc-SIPS type serv proto tcp dstport 5060
add name VoIP-Inc-SIP type serv proto tcp dstport 5070
add name=ipv4_traffic type=ip addr=*.*.*.*
add name=ipv6_traffic type=ip addr=::/0
add name=data_ip type=ip addr=1.1.1.1 mask 255.255.255.255
add name=mgmt_ip type=ip addr=2.2.2.2 mask 255.255.255.255

add brname=bridge name=br_filter filter=ModifyIPHeader state=disabled
ifadd brname=bridge name=br_filter intf=ethport1
ifadd brname=bridge name=br_filter intf=ethport2
ifadd brname=bridge name=br_filter intf=ethport3
ifadd brname=bridge name=br_filter intf=ethport4
add brname=bridge name=PPP_LAN_BLOCK filter=ppp_lan_block state=enabled
ifadd brname=bridge name=PPP_LAN_BLOCK intf=OBC
forwarding brname=bridge name=PPP_LAN_BLOCK mode=ToFwdIntfsOnly
fwdintfadd intf=vdsl2 brname=bridge name=PPP_LAN_BLOCK
fwdintfadd intf=bri_ge brname=bridge name=PPP_LAN_BLOCK
attach brname=bridge name=PPP_LAN_BLOCK
add operand=CheckPPP
add operand=CheckIP
add operand=ModifyDSCP
config operand=CheckPPP type=Match offset=12 value=8864 mask=ffff length=2 protocollevel=EthernetFrame operator=Equal
config operand=CheckIP type=Match offset=20 value=0021 mask=ffff length=2 protocollevel=EthernetFrame operator=Equal
config operand=ModifyDSCP type=Modify protocollevel=EthernetFrame length=1 mask=ff value=20 action=Modify offset=23
add operand=pppd_blk
add operand=pppd_blk_padi
config operand=pppd_blk type=Match operator=Equal protocollevel=EthernetFrame length=2 mask=ffff value=8863 offset=12
config operand=pppd_blk_padi type=Match operator=Equal protocollevel=EthernetFrame length=1 mask=ff value=09 offset=15
add filter=ModifyIPHeader
config filter=ModifyIPHeader mark=enabled
ruleadd filter=ModifyIPHeader operand=CheckPPP
ruleadd filter=ModifyIPHeader operand=CheckIP
ruleadd filter=ModifyIPHeader operand=ModifyDSCP
add filter=ppp_lan_block location=Ingress level=0 tracing=disabled mark=enabled
ruleadd filter=ppp_lan_block operand=pppd_blk negate=disabled order=0 operator=AND
ruleadd filter=ppp_lan_block operand=pppd_blk_padi negate=disabled order=0 operator=AND
config state=enabled ipver any keep=disabled tcpchecks=none udpchecks=enabled icmpchecks=disabled logdefault=disabled logthreshold=enabled tcpwindow=65536 syslog=enabled
debug traceconfig tcpchecks=disabled icmpchecks=disabled sink=none forward=none source=none
rule add chain=forward_level_BlockAll index=1  name=AnyTraffic                                          log=disabled state=enabled action=drop
rule add chain=forward_level_Standard index=1  name=FromLAN    srcintf=lan                               log=disabled state=enabled action=accept
rule add chain=forward_level_Disabled index=1  name=AnyTraffic                                           log=disabled state=enabled action=accept
rule add chain=source_fire            index=1  name=AnyTraffic                                           log=disabled state=enabled action=accept
chain add chain=forward_dmz
rule add chain=forward_custom clink=forward_dmz action=link
rule add chain=sink_fire index=1 srcintf=lan serv=cwmp-s log=disabled state=enabled action=deny
rule add chain=sink_fire index=2 srcintf=lan dstip=data_ip serv=http log=disabled state=enabled action=deny
rule add chain=sink_fire index=3 srcintf=lan dstip=mgmt_ip serv=http log=disabled state=enabled action=deny
level set name ipv4lowipv6off 
chain add chain=TIAccessList
rule add chain=forward index=1 clink=TIAccessList log=enabled state=enabled action=link
chain add chain=TIExcludedIPList
rule add chain=forward index=1 clink=TIExcludedIPList log=enabled state=enabled action=link
chain add chain=forward_public_lan
rule add chain=forward index=1 clink=forward_public_lan state=enabled action=link name=publiclan2wan
chain add chain=lan2publiclan
rule add chain=forward index=1 clink=lan2publiclan state=enabled action=link name=lan2publiclan
chain add chain=block_wan2lan_private
rule add chain=forward index=5 clink=block_wan2lan_private state=enabled action=link name=block_wan2lan_priv
rule add chain=block_wan2lan_private index=1 srcip=lanSubnet srcintf=wan dstintf=lan state=enabled action=drop
chain add chain TI_IPV6ACL_chain
rule add chain=forward_level_ipv4lowipv6off name=IPv4Low srcintf=lan srcip= ipv4_traffic action=accept
rule add chain=forward_level_ipv4lowipv6off name=IPv6OFF srcip="ipv6_traffic" dstip="ipv6_traffic" action=accept
rule add chain=forward_level_ipv4lowipv6on  name=wan_ACL clink=TI_IPV6ACL_chain srcintf=wan action=link
rule add chain=forward_level_ipv4lowipv6on name=IPv4Low srcintf=lan srcip= ipv4_traffic action=accept
rule add chain=forward_level_ipv4lowipv6on name=IPv6ON  srcintf=lan srcip="ipv6_traffic"  action=accept
rule add chain=forward_level_ipv4offipv6on  name=wan_ACL clink=TI_IPV6ACL_chain srcintf=wan action=link
rule add chain=forward_level_ipv4offipv6on name=IPv6ON  srcintf=lan srcip="ipv6_traffic"  action=accept
rule add chain=forward_level_ipv4offipv6on name=IPv4OFFD srcip= ipv4_traffic dstip= ipv4_traffic action=accept
rule add chain=forward_level_ipv4offipv6off name IPv6OFF_IPV4OFF action=accept
add name=BlockAll index=1 readonly=enabled udptrackmode=strict service=disabled proxy=disabled text="Use this Security Level to block all traffic from and to the Internet. Game and Application sharing is not allowed by the firewall."
add name=Standard index=2 readonly=enabled udptrackmode=loose service=enabled proxy=enabled text="Use this Security Level to allow all outgoing connections and block all incoming traffic. Game and Application sharing is allowed by the firewall.."
add name=Disabled index=3 readonly=enabled udptrackmode=loose service=enabled proxy=enabled text="Disable the firewall. All traffic is allowed to pass through your SpeedTouch. Game and Application sharing is allowed by the firewall."
add name=ipv4offipv6off index=4 readonly=enabled udptrackmode=loose service=enabled proxy=enabled text="All traffic is allowed to pass through your SpeedTouch." 
add name=ipv4offipv6on index=5 readonly=enabled udptrackmode=loose service=enabled proxy=enabled text="Use this Security Level to accept all ipv4 traffic and accept all ipv6 traffic from lan and accept all ipv6 traffic from wan defined in ACL chain ."
add name=ipv4lowipv6on index=6 readonly=enabled udptrackmode=loose service=enabled proxy=enabled text="accept all ipv4 traffic from lan.accept all ipv6 traffic from lan.accept all ipv6 traffic from wan defined in ACL chain"
add name=ipv4lowipv6off index=7 readonly=enabled udptrackmode=loose service=enabled proxy=enabled text="accept all ipv4 traffic from lan and accept all ipv6 traffic"
set name=Disabled
config state=enabled scantime=10 autosave=disabled trace=disabled
config state=enabled
signature modify signature=spoofed_packet state=disabled
config state=disabled qi=125 qri=10 lmqi=1 rv=2 requirera=disabled localgroup=disabled
ifconfig intf=LocalNetwork state=downstream version=IGMPv3 fastleave=disabled exptrack=disabled
ifconfig intf=Telecom_Italia state=inactive
ifconfig intf=IPTV state=upstream
ifconfig brname=bridge intf=OBC portmode=Auto fastleave=enabled exptrack=disabled mrdp=enabled rgmp=disabled
ifconfig brname=bridge intf=ethport1 portmode=Auto fastleave=disabled exptrack=disabled mrdp=enabled rgmp=disabled
ifconfig brname=bridge intf=ethport2 portmode=Auto fastleave=disabled exptrack=disabled mrdp=enabled rgmp=disabled
ifconfig brname=bridge intf=ethport3 portmode=Auto fastleave=disabled exptrack=disabled mrdp=enabled rgmp=disabled
ifconfig brname=bridge intf=ethport4 portmode=Auto fastleave=disabled exptrack=disabled mrdp=enabled rgmp=disabled
ifconfig brname=bridge intf=bri_ge portmode=Router fastleave=disabled exptrack=disabled mrdp=enabled rgmp=disabled
ifconfig brname=bridge intf=vdsl2 portmode=Router fastleave=disabled exptrack=disabled mrdp=enabled rgmp=disabled
ifconfig brname=bridge intf=virt portmode=Auto fastleave=disabled exptrack=disabled mrdp=enabled rgmp=disabled
config brname=bridge state=enabled floodrp=disabled floodmcast=disabled queryto=140
config forwarding=enabled redirects=enabled netbroadcasts=disabled ttl=64 fraglimit=64 defragmode=enabled addrcheck=dynamic mssclamping=enabled
config checkoptions=enabled natloopback=enabled acceleration=enabled
config arpcachetimeout=180 arpclass=15
ifadd intf=LocalNetwork dest=bridge
ifconfig intf=LocalNetwork mtu=1500 group=lan linksensing=disabled primary=enabled symmetric=enabled arpcachetimeout 180
ifattach intf=LocalNetwork
ipadd intf=LocalNetwork addr=192.168.1.1/24
ipconfig addr=192.168.1.1 preferred=enabled primary=enabled
ifconfig intf=ppp_0 autoconf=disabled ipv4 disabled
ifconfig intf Telecom_Italia ipv6 disabled
rtadd dst=255.255.255.255/32 gateway=127.0.0.1
rtadd dst 192.168.1.0 dstmsk 255.255.255.0 label labelppp_0 intf LocalNetwork
rtadd dst 192.168.1.0 dstmsk 255.255.255.0 label modemToACS intf LocalNetwork
rtadd dst=5.97.116.128/26 intf=Telecom_Italia
rtadd dst=5.97.116.0/26 intf=Telecom_Italia 
rtadd dst=5.97.54.0/26 intf=Telecom_Italia
rtadd dst=5.97.52.0/26 intf=Telecom_Italia
config ipv6 disabled
aip hw fap prio=10
aip hw config ipv6=enabled


config dest=atm_pvc_8_35 state=enabled discard=tail realtimerate=100
config dest=atm_pvc_8_36 state=enabled discard=tail realtimerate=100
queue config dest=atm_pvc_8_35 queue=0 ackfiltering=enabled loprio=0 hiprio=4
queue config dest=atm_pvc_8_35 queue=1 ackfiltering=enabled loprio=5 hiprio=6
queue config dest=atm_pvc_8_35 queue=2 ackfiltering=enabled loprio=7 hiprio=8
queue config dest=atm_pvc_8_35 queue=3 ackfiltering=enabled loprio=9 hiprio=10
queue config dest=atm_pvc_8_35 queue=4 ackfiltering=enabled loprio=11 hiprio=11
queue config dest=atm_pvc_8_35 queue=5 ackfiltering=enabled loprio=12 hiprio=15
queue config dest=atm_pvc_8_36 queue=0 loprio=0 hiprio=3
queue config dest=atm_pvc_8_36 queue=1 loprio=4 hiprio=7
queue config dest=atm_pvc_8_36 queue=2 loprio=8 hiprio=9
queue config dest=atm_pvc_8_36 queue=3 loprio=10 hiprio=11
queue config dest=atm_pvc_8_36 queue=4 loprio=12 hiprio=13
queue config dest=atm_pvc_8_36 queue=5 loprio=14 hiprio=15
a d="" l=yes
add name=Management
add name=VoIP
add name=modemToACS
add name=labelTelecom_Italia
add name=label_ping_diag
add name=IPTV
modify name=Management classification=increase defclass=15 ackclass=15 tosmarking=enabled precedence=5 inheritance=enabled fapprio=enabled
modify name=VoIP classification=overwrite defclass=14 ackclass=14 bidirectional=enabled inheritance=enabled tosmarking=enabled precedence=5 fapprio=enabled
modify name=modemToACS inheritance=enabled
modify name=label_ping_diag
modify name=IPTV classification=overwrite defclass=10 ackclass=10 bidirectional=enabled inheritance=enabled tosmarking=enabled precedence=flash fapprio=enabled

chain add chain=rt_user_labels
chain add chain=rt_default_labels
chain add chain=qos_user_labels
chain add chain=qos_default_labels
chain add chain=cc_routing_labels
rule add chain=rt_user_labels dstip=mgmt_route_targets state=enabled log=disabled label=modemToACS
rule add chain=rt_user_labels dstip=ping_diag_dst serv=icmp log=disabled state=enabled label=label_ping_diag
rule add chain=rt_user_labels srcintf=from_loop serv=extua state=enabled label modemToACS
rule add chain=rt_default_labels index=1 clink=cc_routing_labels log=disabled state=enabled label=link
rule add chain=qos_user_labels index=1  serv=dns state=enabled label=Management
rule add chain=qos_user_labels index=2  serv=icmp state=enabled label=Management
rule add chain=qos_user_labels index=3  serv=ntp  state=enabled label=Management
rule add chain qos_user_labels index 4 name incoming-sips-rtp srcintf wan serv incoming-sips-rtp state enabled label VoIP
rule add chain qos_user_labels index 5 name incoming-voice-rtp srcintf wan serv incoming-voice-rtp state enabled label VoIP
rule add chain qos_user_labels index 6 name incoming-sips-sip srcintf wan serv VoIP-Inc-SIPS state enabled label VoIP
rule add chain qos_user_labels index 7 name incoming-voice-sip srcintf wan serv VoIP-Inc-SIP state enabled label VoIP
rule add chain=qos_user_labels index 8  name=IPTV_labels state=enabled label=IPTV srcintf IPTV_wan

config language it
config infotimeout=6 alwayson=disabled checkinternetservice=enabled checkvoiceservice=enabled checkvideoservice=disabled

/////////////////////////////////
// DELETE ALL CURRENT LEDS
//////////////////////////////////
cmd = resetctx

//////////////////////////////////
// ADD LEDS
//////////////////////////////////


cmd = addbspled
led_name = SERV
led_id = 0
bsp_id = 14
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = POWER
led_id = 1
bsp_id = 1
up_color = GREEN
down_color = RED
up = 1

cmd = addbspled
led_name = ETH
led_id = 2
bsp_id = 2
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = WIRELESS
led_id = 3
bsp_id = 4
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = BROADBAND
led_id = 4
bsp_id = 6
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = INTERNET
led_id = 5
bsp_id = 7
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = VOICE
led_id = 6
bsp_id = 8
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = DECTPAIR
led_id = 7
bsp_id = 12
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = WPS
led_id = 8
bsp_id = 10
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = DECT
led_id = 9
bsp_id = 20
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = ECO
led_id = 10
bsp_id = 13
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = VIDEO
led_id = 11
bsp_id = 17
up_color = GREEN
down_color = BLACK
up = 0

cmd = addbspled
led_name = VOICE2
led_id = 12
bsp_id = 9
up_color = GREEN
down_color = BLACK
up = 0

//////////////////////////////////
// ADD PATTERNS FOR SERV LED
//////////////////////////////////
cmd = addpattern
led_name = SERV 
pattern_name = FLASH 
level = 2
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125


//////////////////////////////////
// ADD PATTERNS FOR POWER LED
//////////////////////////////////
cmd = addpattern
led_name = POWER
pattern_name = FLASH
level = 2
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

//////////////////////////////////
// ADD PATTERNS FOR ETH LED
//////////////////////////////////
cmd = addpattern
led_name = ETH
pattern_name = TRAFFIC
level = 2
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

//////////////////////////////////
// ADD PATTERNS FOR WIRELESS LED
//////////////////////////////////
cmd = addpattern
led_name = WIRELESS
pattern_name = FLASH
level = 2
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

cmd = addpattern
led_name = WIRELESS
pattern_name = TRAFFIC
level = 3
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

//////////////////////////////////
// ADD PATTERNS FOR VOICE LEDS
//////////////////////////////////
cmd = addpattern
led_name = VOICE
pattern_name = TRAFFIC
level = 2
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

cmd = addpattern
led_name = VOICE2
pattern_name = TRAFFIC
level = 2
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

//////////////////////////////////
// ADD PATTERNS FOR BROADBAND LED
//////////////////////////////////
cmd = addpattern
led_name = BROADBAND
pattern_name = CARRIER
level = 2
statecount = 2
color = BLACK
time = 250
color = GREEN
time = 250

cmd = addpattern
led_name = BROADBAND
pattern_name = SYNCING
level = 1
statecount = 2
color = BLACK
time = 128
color = GREEN
time = 125

cmd = addpattern
led_name = BROADBAND
pattern_name = TRAFFIC
level = 3
statecount = 2
color = BLACK
time = 128
color = GREEN
time = 125

//////////////////////////////////
// ADD PATTERNS FOR INTERNET LED
//////////////////////////////////
cmd = addpattern
led_name = INTERNET
pattern_name = TRAFFIC
level = 2
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

cmd = addpattern
led_name = INTERNET
pattern_name = CONNECTING
level = 1
statecount = 1
color = RED
time = 400

//////////////////////////////////
// ADD PATTERNS FOR DECT LED
//////////////////////////////////
cmd = addpattern
led_name = DECT
pattern_name = TRAFFIC
level = 2
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

//////////////////////////////////
// ADD PATTERNS FOR WPS LED
//////////////////////////////////
cmd = addpattern
led_name = WPS
pattern_name = SETUP
level = 3
statecount = 2
color = BLACK
time = 400
color = ORANGE
time = 400

cmd = addpattern
led_name = WPS
pattern_name = ERROR
level = 2
statecount = 2
color = BLACK
time = 125
color = RED
time = 125

cmd = addpattern
led_name = WPS
pattern_name = OVERLAP
level = 4
statecount = 7
color = BLACK
time = 125
color = RED
time = 125
color = BLACK
time = 125
color = RED
time = 125
color = BLACK
time = 125
color = RED
time = 125
color = BLACK
time = 1000

//////////////////////////////////
// ADD PATTERNS FOR DECTPAIR LED
//////////////////////////////////
cmd = addpattern
led_name = DECTPAIR
pattern_name = PAIRING
level = 1
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

cmd = addpattern
led_name = DECTPAIR
pattern_name = FAIL
level = 3
statecount = 1
color = RED
time = 1000

cmd = addpattern
led_name = DECTPAIR
pattern_name = SUCCESS
level = 2
statecount = 1
color = GREEN
time = 1000

//////////////////////////////////
// ADD PATTERNS FOR VIDEO LED
//////////////////////////////////
cmd = addpattern
led_name = VIDEO
pattern_name = TRAFFIC
level = 2
statecount = 2
color = BLACK
time = 125
color = GREEN
time = 125

//////////////////////////////////
// ADD GLOBAL PATTERN FOR SERV
//////////////////////////////////
cmd = addglobpattern
led_name = SERV 
pattern_name = ALLISWELL
level = 1
statecount = 1
color = GREEN
time = 400

cmd = addglobpattern
led_name = POWER
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = ETH
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = WIRELESS
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = VOICE
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = VOICE2
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = BROADBAND
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = INTERNET
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = DECT
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = DECTPAIR
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = VIDEO
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = ECO
pattern_name = ALLISWELL
level = 1
statecount = 1
color = BLACK
time = 400
//////////////////////////////////
// ADD GLOBAL PATTERN FOR ECO MODE
//////////////////////////////////
cmd = addglobpattern
led_name = SERV
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLUE
time = 400

cmd = addglobpattern
led_name = POWER
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = ETH
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = WIRELESS
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = VOICE
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = VOICE2
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = BROADBAND
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = INTERNET
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = DECT
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = DECTPAIR
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = VIDEO
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

cmd = addglobpattern
led_name = ECO
pattern_name = ECOACTIVE
level = 2
statecount = 1
color = BLACK
time = 400

//////////////////////////////////
// ENABLE PATTERN GENERATOR
//////////////////////////////////
cmd = enable
------------------------------------------------------------------------

                             ______  $_PROD_FRIENDLY_NAME$
                         ___/_____/\ 
                        /         /\\  $_BUILD$
                  _____/__       /  \\ 
                _/       /\_____/___ \  $_COPYRIGHT$
               //       /  \       /\ \
       _______//_______/    \     / _\/______ 
      /      / \       \    /    / /        /\
   __/      /   \       \  /    / /        / _\__ 
  / /      /     \_______\/    / /        / /   /\
 /_/______/___________________/ /________/ /___/  \ 
 \ \      \    ___________    \ \        \ \   \  /
  \_\      \  /          /\    \ \        \ \___\/
     \      \/          /  \    \ \        \  /
      \_____/          /    \    \ \________\/
           /__________/      \    \  /
           \   _____  \      /_____\/
            \ /    /\  \    /___\/
             /____/  \  \  /
             \    \  /___\/
              \____\/

------------------------------------------------------------------------
local wsd = require("wsd")
local print=print
--local tprint = require("tableprint")


function DeleteExtuaToIntuaMappings()

	 mbus.modify(
                 function()
          print ("Deleting mapping for all voice application INTUAs")

          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver intua map delete intua 1 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver intua map delete intua 12 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver intua map delete intua 13 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver intua map delete intua 14 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver intua map delete intua 15 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver intua map delete intua 16 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver intua map delete intua 17 extua 1"}}
     
	  mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver extua map delete intua 1 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver extua map delete intua 12 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver extua map delete intua 13 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver extua map delete intua 14 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver extua map delete intua 15 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver extua map delete intua 16 extua 1"}}
          mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="sipserver extua map delete intua 17 extua 1"}}

       end)


end


--Fix for Tessa 472
-- [ Sensing code ] ------------------------------------------------------------
function iptvconfig(argv)
	local mode, msg = "NONE", nil 
	local res, err = nil, nil
	local res1, err1 = nil, nil
	local t = nil
	local wan_ll_up = nil
	local cur_mode = nil

	print("entering iptv config function")

	res, err = mbus.get(
		{ dsl_type='DSL.ModulationType_Value', ge_status='ETH.Phys.ethif5.Status', dsl_status='DSL.Status_Value', }, 'KEYPATH')
	if err then
		print("ERROR when trying to get DSL.ModulationType_Value")
		mode = "NONE"
		return mode, msg
	end
	if res.dsl_type ~= 'VDSL' and res.dsl_status == 'Up' then
		print(" mode is now ADSL")
		mode = 'ADSL'
	elseif res.dsl_type=='VDSL' and res.dsl_status=='Up' then
		print("mode is now VDSL")
		mode = 'VDSL'
	elseif res.ge_status=='Connected' and res.dsl_status~='Up' then
		print("mode is now ETH")
		mode = 'ETH'
	end

        res, err = mbus.get({provisioningCode = 'ENV.CONF_PROVIDER.Value'}, 'KEYPATH')
        if err then
                print("ERROR when trying to get ENV.CONF_PROVIDER.Value")
        end

	    print("Before checking provisioningCode")

       res1, err1 = mbus.get(
                {extua_status='SIPServer.ExternalUA.1.Status'}, 'KEYPATH')
        if err1 then
                print("ERROR when trying to get SipServer.ExternalUA")
	end

        if res.provisioningCode ~= nil and res.provisioningCode ~= "" then
                print("ProvisioningCode present")
		print(res.provisioningCode)
		if res1.extua_status ~= nil and res1.extua_status == "Disabled" then
		 print ("EXTUA Status Disabled")
		 DeleteExtuaToIntuaMappings()
		end

	else
	
          print ("Not Provisioned Before deleting the mappings")
	  DeleteExtuaToIntuaMappings()
        
	end

        res, err = mbus.get({iptvconfigpresent = 'ENV.IPTVConfigPresent.Value'}, 'KEYPATH')
        if err then
                print("ERROR when trying to get ENV.IPTVConfigPresent.Value")
        end
        if res.iptvconfigpresent ~= nil then
                print("IPTV stack configuration present")
		return
	end


-- setup adsl senario --------------------------------------------------------------
	if mode == 'ADSL' then
		print('enter adsl IPTV config')
		t = {}
		table.insert(t, 'ip ifadd intf=IPTV dest=ethoa_8_36')
		table.insert(t, 'ip ifconfig intf=IPTV mtu=1500 group=wan linksensing=disabled hwaddr=$_WL_MACADDR ipv6=disabled arpcachetimeout=1800 ipv4=disabled')
		table.insert(t, 'dhcp client ifadd intf IPTV')
		table.insert(t, 'dhcp client rqoptions add intf=IPTV option=classfull-static-routes index=1')
		table.insert(t, 'dhcp client rqoptions add intf=IPTV option=classless-static-routes index=2')
		table.insert(t, 'dhcp client txoptions add intf=IPTV option=vendor-specific_info value=(clientid)666c617368 index=1')
		table.insert(t, 'dhcp client txoptions add intf=IPTV option=vendor-class-id value=(clientid)706972656c6c692d737462 index=2')
		table.insert(t, 'igmp proxy ifconfig intf=IPTV state=upstream')
		table.insert(t, 'nat tmpladd intf=IPTV type=nat inside_addr=192.168.1.2-192.168.1.254 outside_addr=0.0.0.1')
		table.insert(t, 'nat ifconfig intf IPTV translation disabled')	
		table.insert(t, 'env set var IPTVConfigPresent value 1')
		local res1, err1
		local res, err = mbus.modify(
		function()
		  --local cli = 'ppp relay ifdelete intf user_835'
		  for i, cli in pairs(t) do
			res1, err1 = mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd=cli}}
		  	if err1 then
				print("ADSL mbus error")
				return
			end
		  end
		end)

-- setup vdsl senario --------------------------------------------------------------
	elseif  mode == 'VDSL' then
		print('enter vdsl IPTV config')
		t = {}
                table.insert(t, 'ip ifadd intf=IPTV dest=video_836')
                table.insert(t, 'ip ifconfig intf=IPTV mtu=1500 group=wan linksensing=disabled hwaddr=$_WL_MACADDR ipv6=disabled arpcachetimeout=1800 ipv4=disabled')
                table.insert(t, 'dhcp client ifadd intf IPTV')
                table.insert(t, 'dhcp client rqoptions add intf=IPTV option=classfull-static-routes index=1')
                table.insert(t, 'dhcp client rqoptions add intf=IPTV option=classless-static-routes index=2')
                table.insert(t, 'dhcp client txoptions add intf=IPTV option=vendor-specific_info value=(clientid)666c617368 index=1')
                table.insert(t, 'dhcp client txoptions add intf=IPTV option=vendor-class-id value=(clientid)706972656c6c692d737462 index=2')
                table.insert(t, 'igmp proxy ifconfig intf=IPTV state=upstream')
                table.insert(t, 'nat tmpladd intf=IPTV type=nat inside_addr=192.168.1.2-192.168.1.254 outside_addr=0.0.0.1')
                table.insert(t, 'nat ifconfig intf IPTV translation disabled')
		table.insert(t, 'env set var IPTVConfigPresent value 1')

		local res1, err1
		local res, err = mbus.modify(
		function()
		  for i, cli in pairs(t) do
			  --print(cli)
			  res1, err1 = mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd=cli}}
			  if err1 then
				print("VDSL mbus error")
				return
			  end
		  end
		end)

-- setup eth senario --------------------------------------------------------------
	elseif mode == 'ETH' then
		print('enter eth IPTV config')
		t = {}
                table.insert(t, 'ip ifadd intf=IPTV dest=video_836')
                table.insert(t, 'ip ifconfig intf=IPTV mtu=1500 group=wan linksensing=disabled hwaddr=$_WL_MACADDR ipv6=disabled arpcachetimeout=1800 ipv4=disabled')
                table.insert(t, 'dhcp client ifadd intf IPTV')
                table.insert(t, 'dhcp client rqoptions add intf=IPTV option=classfull-static-routes index=1')
                table.insert(t, 'dhcp client rqoptions add intf=IPTV option=classless-static-routes index=2')
                table.insert(t, 'dhcp client txoptions add intf=IPTV option=vendor-specific_info value=(clientid)666c617368 index=1')
                table.insert(t, 'dhcp client txoptions add intf=IPTV option=vendor-class-id value=(clientid)706972656c6c692d737462 index=2')
                table.insert(t, 'igmp proxy ifconfig intf=IPTV state=upstream')
                table.insert(t, 'nat tmpladd intf=IPTV type=nat inside_addr=192.168.1.2-192.168.1.254 outside_addr=0.0.0.1')
                table.insert(t, 'nat ifconfig intf IPTV translation disabled')
		table.insert(t, 'env set var IPTVConfigPresent value 1')

		local res1, err1
		local res, err = mbus.modify(
		function()
		for i, cli in pairs(t) do
			--print(cli)
			res1, err1 = mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd=cli}}
			if err1 then
				print("ETH mbus error")
				return
			end
		end
		end)
	end
    


end

-- [ Main code ] ---------------------------------------------------------------
local argv = argv
--Enable logging by removing comments on next line
wsd.log()
return iptvconfig(argv)
local wsd = require("wsd")
dofile("TI-creds.lua")

--local dbgtrc = 1

-- [ Mode entry configuration ] ------------------------------------------------

local entry_cfg = {

}



-- [ Mode exit configuration ] -------------------------------------------------

local exit_cfg = {
   
}

-- [ Main code ] ---------------------------------------------------------------

local argv = argv
--Enable logging by removing comments on next line
wsd.log()
return wsd.entry_exit(argv, entry_cfg, exit_cfg)




local wsd = require("wsd")
dofile("TI-creds.lua")
-- [ Main code ] ---------------------------------------------------------------

local argv = 'ADSL'
--Enable logging by removing comments on next line
wsd.log()
return sensing_changed(argv)




local wsd = require("wsd")
dofile("TI-creds.lua")

local entry_cfg = {
	{  
		path = 'System',
		set = { system = { WANMode='ADSL' } } 
	}, 
	{  
		path = 'ENV', key='Name', 
		set = { IS_NOT_DSL_DEVICE = { Value='0' } } 
	},
}

local exit_cfg = {
 
}

-- [ Main code ] ---------------------------------------------------------------

local argv = argv
--Enable logging by removing comments on next line
wsd.log()
return wsd.entry_exit(argv, entry_cfg, exit_cfg)
local wsd = require("wsd")
local print=print
--local tprint = require("tableprint")

-- [ Sensing code ] ------------------------------------------------------------
function sense(argv)
	local mode, msg = "NONE", nil 
	local res, err = nil, nil
	local t = nil
	local wan_ll_up = nil
	local cur_mode = nil

	res, err = mbus.get(
		{ dsl_type='DSL.ModulationType_Value', ge_status='ETH.Phys.ethif5.Status', dsl_status='DSL.Status_Value', }, 'KEYPATH')
	if err then
		print("ERROR when trying to get DSL.ModulationType_Value")
		mode = "NONE"
		return mode, msg
	end
	if res.dsl_type ~= 'VDSL' and res.dsl_status == 'Up' then
		--print(" mode is now ADSL")
		mode = 'ADSL'
	elseif res.dsl_type=='VDSL' and res.dsl_status=='Up' then
		--print("mode is now VDSL")
		mode = 'VDSL'
	elseif res.ge_status=='Connected' and res.dsl_status~='Up' then
		--print("mode is now ETH")
		mode = 'ETH'
	end

	res, err = mbus.get({ws_mode = 'ENV.%ws_mode.Value'}, 'KEYPATH')
	if err then
		--print("ERROR when trying to get ENV.%ws_mode.Value")
	end
	if res.ws_mode ~= nil then
		--print("res.ws_mode ~= nil")
		cur_mode = res.ws_mode
	else
		--print("res.ws_mode == nil,setting cur_mode to NONE")
		cur_mode = 'NONE' 
	end

	-- mode and cur_mode are obtained. First try the switch now, when successful
	-- do the set of "env set var %ws_mode" to mode at the end of this function
	-- because otherwise we will not try again upon mbus errors between here and the ending of this script

	if mode ~= cur_mode then
		print('ws: restore setting')
		t = {}
		table.insert(t, 'ppp ifdetach intf Telecom_Italia')
		table.insert(t, 'ppp ifconfig intf Telecom_Italia dest RELAY')
		table.insert(t, 'eth bridge vlan ifadd intf vdsl2 name mgmt untagged=disabled')
		table.insert(t, 'eth bridge vlan ifadd intf vdsl2 name data untagged=disabled')
		table.insert(t, 'eth bridge vlan ifadd intf bri_ge name mgmt untagged=disabled')
		table.insert(t, 'eth bridge vlan ifadd intf bri_ge name data untagged=disabled')
		table.insert(t, 'ppp relay ifadd intf ethoa_8_35')
		table.insert(t, 'ppp relay ifadd intf user_835')
		local res1, err1
		local res, err = mbus.modify(
		function()
		  for i, cli in pairs(t) do
			  --print(cli)
			  res1, err1 = mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd=cli}}
			  if err1 then
				print("restore setting mbus error")
				return
			  end
		  end
		  res1, err1 = mbus.setParameters{path = "TI_STORE", param = {WANLowerLayerUp = "0",}}
		end)
		if err or err1 then
			print("ERROR when trying to restore settings!!!!")
			mode = "NONE"
			return mode, msg
		end
	else
		--print("ws: return because mode ="..mode.."  == cur_mode   "..cur_mode) 
		return mode, msg
	end

-- setup adsl senario --------------------------------------------------------------
	if mode == 'ADSL' then
		print('enter adsl ws')
		local res1, err1
		local res, err = mbus.modify(
		function()
		  local cli = 'ppp relay ifdelete intf user_835'
		  res1, err1 = mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd=cli}}
		  if err1 then
			print("ADSL mbus error")
			return
		  end
		  res1, err1 = mbus.setParameters{path = "TI_STORE", param = {WANLowerLayerUp = "1",}}
		end)
		if err or err1 then
			print("ERROR when trying to set TI STORE settings!!!!")
			mode = "NONE"
			return mode, msg
		end


-- setup vdsl senario --------------------------------------------------------------
	elseif  mode == 'VDSL' then
		print('enter vdsl ws')
		t = {}
		table.insert(t, 'ppp ifdetach intf Telecom_Italia')
		table.insert(t, 'ppp ifconfig intf Telecom_Italia dest mgmt_837')
		table.insert(t, 'eth bridge vlan ifdelete intf bri_ge name mgmt')
		table.insert(t, 'eth bridge vlan ifdelete intf bri_ge name data')
		table.insert(t, 'ppp relay ifdelete intf ethoa_8_35')
		local res1, err1
		local res, err = mbus.modify(
		function()
		  for i, cli in pairs(t) do
			  --print(cli)
			  res1, err1 = mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd=cli}}
			  if err1 then
				print("VDSL mbus error")
				return
			  end
		  end
		  res1, err1 = mbus.setParameters{path = "TI_STORE", param = {WANLowerLayerUp = "1",}}
		end)
		if err or err1 then
			print("ERROR when trying to enter vdsl ws!!!!!!")
			mode = "NONE"
			return mode, msg
		end

-- setup eth senario --------------------------------------------------------------
	elseif mode == 'ETH' then
		print('enter eth ws')
		t = {}
		table.insert(t, 'ppp ifdetach intf Telecom_Italia')
		table.insert(t, 'ppp ifconfig intf Telecom_Italia dest mgmt_837')
		table.insert(t, 'eth bridge vlan ifdelete intf vdsl2 name mgmt')
		table.insert(t, 'eth bridge vlan ifdelete intf vdsl2 name data')
		table.insert(t, 'ppp relay ifdelete intf ethoa_8_35')
		local res1, err1
		local res, err = mbus.modify(
		function()
		for i, cli in pairs(t) do
			--print(cli)
			res1, err1 = mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd=cli}}
			if err1 then
				print("ETH mbus error")
				return
			end
		end
		res1, err1 = mbus.setParameters{path = "TI_STORE", param = {WANLowerLayerUp = "1",}}
		end)
		if err or err1 then
			print("ERROR when trying to enter eth ws!!!!!!")
			mode = "NONE"
			return mode, msg
		end
	end

	if cur_mode ~= mode then
		local res1, err1
		local res, err = mbus.modify(
		function()
			  --print('mode is ' .. mode)
			  --print('cur_mode is '.. cur_mode)
			  res1, err1 = mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="env set var %ws_mode value " .. mode}}
			  if err1 then
			    print("error setting env for wansensing mode cur_mode "..cur_mode.." mode "..mode)
			    return
			  else
			     res1, err1 = mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="system config WANMode " .. mode .. " WANEthPort ethif5"}}
			  end
		end)
		if err or err1 then
			print("Error when trying to set TI_STORE values!!!!! curmode "..cur_mode.." mode "..mode)
			mode = "NONE"
			return mode, msg
		end
		print("Wansensing successfull switch cur_mode "..cur_mode.." mode "..mode)
	end
end

-- [ Main code ] ---------------------------------------------------------------
local argv = argv
--Enable logging by removing comments on next line
wsd.log()
return sense(argv)
local xmlStr = ""
local xmlFile = ""

local function mysplit(inputstr, sep)
  local t={} 
  local i=1
  for str in string.gmatch(inputstr, "([^"..sep.."]+)") do
    t[i] = str
    i = i + 1
  end
  return t
end


local function writeChanMeasDataToXmlFile()
  local reply, error =  mbus.getParameters{ path = "ENV", param = "Value", filter = "(== Name _PROD_SERIAL_NBR)" }
  local sn = reply["ENV"][1].param["Value"]
  reply, error =  mbus.getParameters{ path = "Time", param = "DateTime" }
  local datetime = reply["Time"][1].param["DateTime"]
  datetime = string.gsub(datetime, ":", "")

  xmlFile = tostring(sn .. "_channelmeasurements_" .. datetime .. ".xml")
  local fh = io.open ("/tmp/" .. xmlFile, "w")
  if fh~=nil then
    local xmlStart="\<?xml version=\"1.0\" encoding=\"UTF-8\"?\>\n"
    fh:write(xmlStart .. tostring(xmlStr))
    fh:close()
  end

  reply, error = mbus.getParameters{path = "ENV", param = "Value", filter = "(== Name %Vendor_Log_File_4)"}
  mbus.modify(
    function()
      if reply["ENV"][1]~=nil and reply["ENV"][1].param~=nil and reply["ENV"][1].param["Value"]~=nil then
        mbus.setParameters{path = "ENV", param = {Value = xmlFile}, filter = "(== Name %Vendor_Log_File_4)" }
      else
        mbus.addObjects{path = "ENV", param = {Name = "%Vendor_Log_File_4", Value = xmlFile} }
      end
    end)

end

ret, error = mbus.getParameters{ path = "WLAN.Intf", param= "RadioEnable" }
if ret["WLAN.Intf"][1].param["RadioEnable"]~="true" and ret["WLAN.Intf"][3].param["RadioEnable"]~="true" then
  return "NOK"
end


local radioinfoList = {}
local avlblchanneldataList_24ghz = {}
local samplesdataList_24ghz = {}
local avlblchanneldataList_5ghz = {}
local samplesdataList_5ghz = {}
local measdurationVal = 0
local WIntfPath
for n=1, 3, 2 do
  if ret["WLAN.Intf"][n].param["RadioEnable"] == "true" then
    if n==1 then
        WIntfPath ="WLAN.Intf.wlif1"
    elseif n==2 then
        WIntfPath="WLAN.Intf.wl_ssid1_local0"
    elseif n==3 then
        WIntfPath="WLAN.Intf.wle_radio1_ssid0"
    elseif n==4 then
        WIntfPath="WLAN.Intf.wle_radio1_ssid1"
    end

    local acs_path = WIntfPath .. ".ACS"
    local wlan_acs_data, error = mbus.getParameters{ path = acs_path, param= "ChanMeasData",flags="KEYPATH" }
    local chanmeasdataList = wlan_acs_data[acs_path][1].param["ChanMeasData"]

    if chanmeasdataList == "ERROR: Channel measurement data not available" then
      return "NOK"
    end

    local avlblchanneldataList = avlblchanneldataList_24ghz
    if n==3 then avlblchanneldataList = avlblchanneldataList_5ghz end

    local samplesdataList = samplesdataList_24ghz
    if n==3 then samplesdataList = samplesdataList_5ghz end

    --Channel measurement data will occur in the following format
    --avlblchannelcount:measduration:channum1,chanload1,noisepower1;channum2,chanload2,noisepower2;...channumN,chanloadN,noisepowerN:currchannelnum:currchannelmeasduration:samplingperiod:numsamples:chanload1,noisepwr1;chanload2,noisepwr2;...chanloadM,noiseprwM
    for avlblchannelcountVal, measdurationVal,avlblchanneldata,currchannelnumVal,currchannelmeasdurationVal,samplingperiodVal,numsamplesVal,samplesdata  in string.gmatch( chanmeasdataList, "([^:]*):([^:]*):([^:]*):([^:]*):([^:]*):([^:]*):([^:]*):([^:]*)") do
      local temp1 = {}
      temp1 = mysplit(avlblchanneldata, ";")
      for i,v in ipairs(temp1) do
        local temp2 = {}
        temp2 = mysplit(v,",")
        table.insert(avlblchanneldataList, {channelnum=temp2[1], channelload=temp2[2], noisepower=temp2[3]})
      end

      temp1 = {}
      temp1 = mysplit(samplesdata, ";")
      for i,v in ipairs(temp1) do
        local temp2 = {}
        temp2 = mysplit(v,",")
        table.insert(samplesdataList, {channelload=temp2[1], noisepower=temp2[2]})
      end
      
      table.insert(radioinfoList, {currchannelnum=currchannelnumVal, currchannelmeasduration=currchannelmeasdurationVal, samplingperiod=samplingperiodVal, numsamples=numsamplesVal, samplesData_T=samplesdataList})
    end
  end
end

local avlblchancount = (#avlblchanneldataList_24ghz+#avlblchanneldataList_5ghz)

xmlStr = xmlStr .. "\t<WiFiChannelMeasurements>\n"
xmlStr = xmlStr .. "\t\t<SupportedChannelsNumberOfEntries>" .. avlblchancount .. "</SupportedChannelsNumberOfEntries>\n"
xmlStr = xmlStr .. "\t\t<OperatingChannelNumberOfEntries>" .. #radioinfoList .. "</OperatingChannelNumberOfEntries>\n"

local count = 1

for n=1, 3, 2 do
  local avlblchanneldataList = avlblchanneldataList_24ghz
  if n==3 then avlblchanneldataList = avlblchanneldataList_5ghz end
  if #avlblchanneldataList > 0 then
    for i,v in pairs(avlblchanneldataList) do
      xmlStr = xmlStr .. "\t\t<SupportedChannels id=\"" .. count .. "\">\n"
      xmlStr = xmlStr .. "\t\t\t<Channel>" .. v["channelnum"] .. "</Channel>\n"
      xmlStr = xmlStr .. "\t\t\t<MeasDuration>" .. measdurationVal .. "</MeasDuration>\n"
      xmlStr = xmlStr .. "\t\t\t<ChannelLoad>" .. v["channelload"] .. "</ChannelLoad>\n"
      xmlStr = xmlStr .. "\t\t\t<NoisePower>" .. v["noisepower"] .. "</NoisePower>\n"
      xmlStr = xmlStr .. "\t\t</SupportedChannels>\n"
      count = count + 1
    end
  end
end


if #radioinfoList > 0 then
  for i,v in pairs(radioinfoList) do
    local samplesdataList = v["samplesData_T"]

    xmlStr = xmlStr .. "\t\t<OperatingChannel id=\"" .. i .. "\">\n"
    xmlStr = xmlStr .. "\t\t\t<Channel>" .. v["currchannelnum"] .. "</Channel>\n"
    xmlStr = xmlStr .. "\t\t\t<MeasDuration>" .. v["currchannelmeasduration"] .. "</MeasDuration>\n"
    xmlStr = xmlStr .. "\t\t\t<MeasSamplingPeriod>" .. v["samplingperiod"] .. "</MeasSamplingPeriod>\n"
    xmlStr = xmlStr .. "\t\t\t<MeasNumberOfEntries>" .. v["numsamples"] .. "</MeasNumberOfEntries>\n"

    if #samplesdataList > 0 then
      for k,s in pairs(samplesdataList) do
        xmlStr = xmlStr .. "\t\t\t<Meas id=\"" .. k .. "\">\n"
        xmlStr = xmlStr .. "\t\t\t\t<ChannelLoad>" .. s["channelload"] .. "</ChannelLoad>\n"
        xmlStr = xmlStr .. "\t\t\t\t<NoisePower>" .. s["noisepower"] .. "</NoisePower>\n"
        xmlStr = xmlStr .. "\t\t\t</Meas>\n"
      end 
    end
    xmlStr = xmlStr .. "\t\t</OperatingChannel>\n"
  end
end



 xmlStr = xmlStr .. "\t</WiFiChannelMeasurements>\n"
writeChanMeasDataToXmlFile()

return "OK"
-- [ Utility functions ] -------------------------------------------------------

local dbgtrc = 1

local function get_mac_address()
   local res, err = mbus.get({  MAC = 'ENV._MACADDR.Value'}, 'KEYPATH')
   if err then
      return false, nil
   else
      return true, res.MAC
   end
end

local function get_serial()
   local res, err = mbus.get({  SERIAL = 'ENV._BOARD_SERIAL_NBR.Value'}, 'KEYPATH')
   if err then
      return false, nil
   else
      return true, res.SERIAL
   end
end

local function get_OUI()
   local res, err = mbus.get({  OUI = 'ENV._OUI.Value'}, 'KEYPATH')
   if err then
      return false, nil
   else
      return true, res.OUI
   end
end

-- [ Function to determine the user's name and password ] ----------------------
--------------------------------------------------------------------------------
-- returns TI Internet username
-- current scenario defines same ppp user pass for all three scenarios ADSL, VDSL, ETH
-- ATTENTION!! ToBeDefined how to retrieve the sync rate for the realm for the PPP
function get_user_mgnt_ppp(intf)
   --local ok, serial = get_serial(), oui = get_OUI()
   local ok = nil
   if ok then
-- enable the following line for TI
--      return serial..'-'..'oui'..'@'..'<SYNC>'..'alicenewborn.mgmt'

--remove this line for TI
    return 'bench50@juniper'
   end

--remove this line for TI
   return 'bench50@juniper' 
end

function sensing_changed(argv)
	local mode, msg = nil, 'NONE' 
	local res, err = nil, nil
	local rtdf = "0"
    --print('argv is ' .. argv)
    res, err = mbus.get(
		{ cur_mode='WANSensing.CurrentMode', req_mode='WANSensing.RequestedMode', dsl_type='DSL.ModulationType_Value', ge_status='ETH.Phys.ethif5.Status', wan_phy_up = 'TI_STORE.WANLowerLayerUp', dsl_status='DSL.Status_Value', }, 'KEYPATH')

    if err then
        print("Failed to get mbus values")
        --mode = 'NONE'
        return argv, msg
    end
    --print('res.dsl_type is ' .. res.dsl_type)
    --print('res.cur_mode is ' .. res.cur_mode)
    --print('res.req_mode is ' .. res.req_mode)
    --print('res.ge_status is ' .. res.ge_status)
    --print('res.dsl_status is ' .. res.dsl_status)
    --print('res.wan_phy_up is ' .. res.wan_phy_up)

	if res.dsl_type ~= 'VDSL' and res.dsl_status == 'Up' then
		mode = 'ADSL'
        --print("setting mode to ADSL")
    elseif res.dsl_type=='VDSL' and res.dsl_status=='Up' then
		mode = 'VDSL'
        --print("setting mode to VDSL")
    elseif res.ge_status=='Connected' and res.dsl_status~='Up' then
		mode = 'ETH'
        --print("setting mode to ETH")
	else
        --print("returning argv only, i guess this where it will stop")
        --mode = 'NONE'
		--return mode, msg
		return argv, msg
    end

	if res.cur_mode=='ADSL' or res.cur_mode=="VDSL" or res.cur_mode=="ETH" then
		if mode~=res.cur_mode then 
			rtdf = "1"
		end
	end
	if res.req_mode=='ADSL' or res.req_mode=="VDSL" or res.req_mode=="ETH" then
		if mode~=res.req_mode then 
			rtdf = "1"
		end
	end
	if rtdf == "1" then
		mbus.modify(
		function()
            --Workaroud: Disable upnp before system reset to factory default to avoid dead lock
			mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="system config upnp disabled"}}
			mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="system reset factory yes proceed yes"}}
		end)
                print("WANSENSING keep state and factory reset")
		return argv, msg
	end
    
    if mode ~= 'NONE' then
        if res.ge_status=='Connected' or res.dsl_status == 'Up' then
            --if res.wan_phy_up=='0' or res.wan_phy_up== 'Uninitailized' then 
            if res.wan_phy_up=='0' or res.wan_phy_up== 'Uninitailized' then 
                --print("mode = ADSL will set WANLowerLayerUp=1")
		        mbus.modify(
    		function()
                  mbus.setParameters{path = "TI_STORE", param = {WANLowerLayerUp = "1",}}
                  mbus.setParameters{path = "TI_STORE.TiUserIntf", param = {tclCmd="env set var %ws_mode value " .. mode}}
    		    end)
            else
                --print(" In else res.wan_phy_up==0 or res.wan_phy_up==Unitialized")
            end
        else
            --printf("In else res.ge_status==Connected or res.dsl_status == Up");
        end
    else
        --print(" In else mode ~= NONE")
    end

	return mode, msg
end


-- returns TI Internet password
-- ToBeDefined if auto-sensing scenario changes but currently password is default alicenewag for out of the box CPE




local wsd = require("wsd")
dofile("TI-creds.lua")

-- [ Mode entry configuration ] ------------------------------------------------

local entry_cfg = {
--  { path = 'DeviceConfig',
--   set = { deviceconfig = {FactoryDefaults='1'} } },
      
}

-- [ Mode exit configuration ] -------------------------------------------------

local exit_cfg = {
}

-- [ Main code ] ---------------------------------------------------------------

local argv = argv
--Enable logging by removing comments on next line
wsd.log()
return wsd.entry_exit(argv, entry_cfg, exit_cfg)
local wsd = require("wsd")
dofile("TI-creds.lua")
-- [ Main code ] ---------------------------------------------------------------

local argv = 'NONE'
--Enable logging by removing comments on next line
wsd.log()
return argv




local wsd = require("wsd")
dofile("TI-creds.lua")

-- [ Mode entry configuration ] ------------------------------------------------

local entry_cfg = {

}

-- [ Mode exit configuration ] -------------------------------------------------

local exit_cfg = {
              
}

-- [ Main code ] ---------------------------------------------------------------

local argv = argv
--Enable logging by removing comments on next line
wsd.log()
return wsd.entry_exit(argv, entry_cfg, exit_cfg)



local wsd = require("wsd")
dofile("TI-creds.lua")
-- [ Main code ] ---------------------------------------------------------------

local argv = 'ETH'
--Enable logging by removing comments on next line
wsd.log()
return sensing_changed(argv)




local wsd = require("wsd")
dofile("TI-creds.lua")

-- [ Mode entry configuration ] ------------------------------------------------

local entry_cfg = {

}

-- [ Mode exit configuration ] -------------------------------------------------

local exit_cfg = {
    
}

-- [ Main code ] ---------------------------------------------------------------

local argv = argv
--Enable logging by removing comments on next line
wsd.log()
return wsd.entry_exit(argv, entry_cfg, exit_cfg)
local wsd = require("wsd")
dofile("TI-creds.lua")
-- [ Main code ] ---------------------------------------------------------------

local argv = 'VDSL'
--Enable logging by removing comments on next line
wsd.log()
return sensing_changed(argv)




--------------------------------------------------------------------------------
-- Default values
--------------------------------------------------------------------------------
cgilua.addscripthandler ("lua", cgilua.doscript)
cgilua.addscripthandler ("lp",  cgilua.handlelp)
cgilua.addscripthandler ("llp", cgilua.handlellp)
--Add the handler to support accessing url without suffix for xml dumping of TI_WLS.
cgilua.addscripthandler ("requestdata", cgilua.handlelp)
cgilua.addscripthandler ("sipgwconfig", cgilua.handlelp)
cgilua.addscripthandler ("sipgwcalllog", cgilua.handlelp)
--Add the error rediret page to handle the session expire.
cgilua.seterrorpage("loginMask.lp", function() return {url = cgilua.script_file} end)
--------------------------------------------------------------------------------
-- Dynamic caching strategy
-- Set the dynamic stategy used for caching lua pages/scripts
-- Possibilities:
-- false -> normal
--   - Caches the compiled page/script in a table using the filename/path
--     as the key. This is sufficient if the webui is not updated while
--     the webserver is running. (Default)
-- true -> modification
--   - Same as above but with each request the file modification time is
--     checked to see if the file has been updated. Use this if the webui can
--     be updated on the fly.
--------------------------------------------------------------------------------
cgilua.lp.setdynamiccachingstrategy(false)

cgilua.lp.setcachesize(40)
local xmlStr = "<ROOT>"
local xmlFile = ""

--Change the number of rssi to signal level
local function rssiToLevel(rssi)
    local result = 0
    if rssi>=0 then
        result = 0
    elseif rssi>=-55 then
        result = 5
    elseif rssi>=-65 then
        result = 4
    elseif rssi>=-75 then
        result = 3
    elseif rssi>=-80 then
        result = 2
    elseif rssi>=-85 then
        result = 1
    end

    return result+1
end

local function writeSurveyToXmlFile()
  local reply, error =  mbus.getParameters{ path = "ENV", param = "Value", filter = "(== Name _PROD_SERIAL_NBR)" }
  local sn = reply["ENV"][1].param["Value"]
  reply, error =  mbus.getParameters{ path = "Time", param = "DateTime" }
  local datetime = reply["Time"][1].param["DateTime"]
  datetime = string.gsub(datetime, ":", "")

  xmlFile = tostring(sn .. "_wifisurvey_" .. datetime .. ".xml")
  local fh = io.open ("/tmp/" .. xmlFile, "w")
  if fh~=nil then
    local xmlStart="\<?xml version=\"1.0\" encoding=\"UTF-8\"?\>"
    fh:write(xmlStart .. tostring(xmlStr))
    fh:close()
  end

  reply, error = mbus.getParameters{path = "ENV", param = "Value", filter = "(== Name %Vendor_Log_File_2)"}
  mbus.modify(
    function()
      if reply["ENV"][1]~=nil and reply["ENV"][1].param~=nil and reply["ENV"][1].param["Value"]~=nil then
        mbus.setParameters{path = "ENV", param = {Value = xmlFile}, filter = "(== Name %Vendor_Log_File_2)" }
      else
        mbus.addObjects{path = "ENV", param = {Name = "%Vendor_Log_File_2", Value = xmlFile} }
      end
    end)
end

ret, error = mbus.getParameters{ path = "WLAN.Intf", param= "Status" }
if ret["WLAN.Intf"][1].param["Status"]~="enabled" and ret["WLAN.Intf"][2].param["Status"]~="enabled" then
  return "NOK"
end

local scanList = {}
local strfind = string.find
local WIntfPath
for n=1, 3, 2 do
  if ret["WLAN.Intf"][n].param["Status"] == "enabled" then
    if n==1 then
        WIntfPath ="WLAN.Intf.wlif1"
    elseif n==2 then
        WIntfPath="WLAN.Intf.wl_ssid1_local0"
    elseif n==3 then
        WIntfPath="WLAN.Intf.wle_radio1_ssid0"
    elseif n==4 then
        WIntfPath="WLAN.Intf.wle_radio1_ssid1"
    end

    local acs_path = WIntfPath .. ".ACS"
    mbus.modify(
      function()
        mbus.setParameters{ path = acs_path, param= {Rescan="1"} }
      end)
    
    local wlan_acs_data, error = mbus.getParameters{ path = acs_path, param= "BssList" ,flags="KEYPATH"}
    local apList_T = wlan_acs_data[acs_path][1].param["BssList"]
    local freqVal = "2.4GHz"
    local networkVal = table.concat({"b", "g", "n"}, ",")

    -- Fix for TESSA 496 Scan Wi-Fi from ACS is not showing 5 Ghz networks
    -- 5 GHz networks and missed information network type are added to the xml file 

    if n==3 then 
	freqVal = "5GHz" 
	networkVal = table.concat({"a", "n"}, ",")
    end
 
 if apList_T ~= nil then
    for apList in string.gmatch(apList_T, "([^;]+)") do
     if apList ~= nil then
      for bssidVal,ssidVal,channelVal,rssiVal, secmode, unknown in string.gmatch(apList, "([^:]*):([^:]*):([^:]*):([^:]*):([^:]*):([^:]*)") do
        local privacyVal = "False"
        local authVal = "Open"
        local s, e = strfind(secmode, "WEP")
        if s ~= nil then
          privacyVal = "True"
        else
          s, e = strfind(secmode, "WPA")
          if s ~= nil then
            privacyVal = "True"
            authVal = "WPA/WPA2"
          end
        end
        table.insert(scanList, {ssid=ssidVal, channel=channelVal, bssid=bssidVal, rssi=rssiVal, frequency=freqVal, privacy=privacyVal, auth=authVal, network=networkVal})
      end
     end
    end
   end 
  end
end

xmlStr = xmlStr .. "<NearWLANNumberofentries>" .. #scanList .. "</NearWLANNumberofentries>"

if #scanList > 0 then
  for i,v in pairs(scanList) do
    local level = rssiToLevel(tonumber(v["rssi"]))
    xmlStr = xmlStr .. "<NearWLAN id=\"" .. i .. "\">"
    xmlStr = xmlStr .. "<SSID>" .. v["ssid"] .. "</SSID>"
    xmlStr = xmlStr .. "<PrivacyEnabled>" .. v["privacy"] .. "</PrivacyEnabled>"
    xmlStr = xmlStr .. "<Authentication>" .. v["auth"] .. "</Authentication>"
    xmlStr = xmlStr .. "<BSSID>" .. v["bssid"] .. "</BSSID>"
    xmlStr = xmlStr .. "<Channel>" .. v["channel"] .. "</Channel>"
    xmlStr = xmlStr .. "<Frequency>" .. v["frequency"] .. "</Frequency>"
    xmlStr = xmlStr .. "<PowerLevel>" .. level .. "</PowerLevel>"

    -- Adding the Network Type information to the WiFi Survey xml file

    xmlStr = xmlStr .. "<NetworkType>" .. v["network"] .. "</NetworkType>"
    xmlStr = xmlStr .. "</NearWLAN>"
  end
end

xmlStr = xmlStr .. "</ROOT>"
writeSurveyToXmlFile()

return "OK"
-- This script is base on /vobs/fsn/archive/board/dant-v/active/WWW/include/lp/xml.lp
-- to meet TI's requirement for downloading X TELECOMITALIA Configuration File


--Set the session variable for xml file
local xmlStr=""
local fxoNumber = ""
--The param of the node name for single object query(the default value is Device).
local configurationData="Device"

--Make a workaround for host ipv4/ipv6 
local hostStack={}

--Set the value of session variable "configurationData"
local function setConfigurationData(value)
	if value ~= nil then
		configurationData = value
	end
end

--Get the value of session variable "configurationData"
local function getConfigurationData()
	return configurationData 
end

--Judge whether the table is null
function table_is_empty(t)
        return _G.next( t ) == nil
end

--Generate the tag start
--like <name> 
--or <name id="num">
function generateTagStart(name, num)
	local tagName=string.gsub(name, " ", "")
	local tagStart="\<" .. tagName .. "\>"
	if num ~= nil then
		tagStart="\<" .. tagName .." id=\""..num.."\"\>"	
	end
	return tagStart
end

--Generate the tag end
--like </name> 
function generateTagEnd(name)
	local tagName=string.gsub(name, " ", "")
	local tagEnd="\</" .. tagName .. "\>"
	return tagEnd
end

--To create the tag for params by path
--like <path><param>value</param></path> 
--or <path id="1"><param>value</param></path>
function getTag(tagName, paramVal, num)
	local tagStart=generateTagStart(tagName, num)
	local tagEnd=generateTagEnd(tagName)
	local tagVal = "\<" .. tagName .."/\>"
	if paramVal~="" and paramVal~=nil then
		tagVal = tagStart .. paramVal .. tagEnd
	end
	return tagVal
end

--To get the mutil instance path by mbus
function getMutilPath_T(pathStr)
	local stack = {}
	local data, error = mbus.getParameters{path=pathStr, datamodel="second"}
	for i,v in pairs(data[pathStr]) do
		table.insert(stack, v.path)
	end
	return stack
end

--To intergrate the groups of the path and params
function setMutilObjects_T(path_T, param_T)
	local set = {}
	while #path_T>0 do
		local pathTop = table.remove(path_T)
		table.insert(set, {path=pathTop, param=param_T})
	end
	
	return set
end

--get all the multi instance groups 
function getMutilObjects_T(set)
	local path = set["path"]
	local param = set["param"]
	local pathStack={}	
	local pathStr=""
	for s in string.gmatch(path, "[^.]+") do
		if s~="{i}" then
			if #pathStack>0 then
				for i,v in pairs(pathStack) do
					pathStack[i] = pathStack[i] ..".".. s					
				end
			else	
				table.insert(pathStack, s)
			end
		else
			local multiStack={}
			local tmpStack={}
			while #pathStack>0 do
				local pathTop = table.remove(pathStack)
				multiStack = getMutilPath_T(pathTop) 				
				for i,v in pairs(multiStack) do
					table.insert(tmpStack, v)
				end
			end
			pathStack = tmpStack
		end
	end
--[[
	--If it's the host object, it should reset the show path since the real path may be different with show path on xml.
	if path=="Device.Hosts.Host.{i}.IPv4Address" or path=="Device.Hosts.Host.{i}.IPv6Address" then
		setHostPathShow(pathStack)
	end
]]
	local objects_T = setMutilObjects_T(pathStack, param)
	return objects_T
end

--Make a mapping of path show for host ipv4/ipv6
function setHostPathShow(pathStack)
	for i,v in pairs(pathStack) do
		local hostPathShowStr = string.gsub(v, "%.%d%.", "."..tostring(i)..".")
		table.insert(hostStack, {v, hostPathShowStr})
	end
end

--Change the real host path to show host path with sequence index.
function getHostPathShow(pathStr)
	for i,v in pairs(hostStack) do
		if v[1]==pathStr then
			return v[2]
		end
	end
end

--get param tag by the data of mbus
function getParamsTagByData(path, params_T, data_T, lastIndex)
	local g, f, pathObjName = string.find(path, "%.([^.]+)$")
	local paramArray = {}	
	for i,elem_T in pairs(data_T[path]) do
		local flag = true
		if lastIndex~=nil then
			if path.."."..tostring(lastIndex) ~= elem_T["path"] then
				flag = false
			end
		end
		if flag == true and table_is_empty(elem_T["param"])==false then
			local paramStr = "" 
			for j,paramName in pairs(params_T) do
				if elem_T.param[paramName] ~= nil then
					local paramVal = elem_T.param[paramName]
                    --add special sign such as "& < >" solution
                    paramVal = string.gsub(paramVal, "&", "&amp;")
                    paramVal = string.gsub(paramVal, "<", "&lt;")
                    paramVal = string.gsub(paramVal, ">", "&gt;")
                    paramVal = string.gsub(paramVal, "\"", "&quot;")
					if pathObjName == paramName then
						paramName = paramName .. "_ReplaceWord"
					end
					local paramTmp = getTag(paramName, tostring(paramVal))		
					paramStr = paramStr .. paramTmp
				end
			end
			table.insert(paramArray, paramStr)
		end		
	end	
	return paramArray
end

--Get the path start position of the xml, from left to right like aaa.bbb.1
--Find the start position like <path> or <path id="num">
--then find another start position like <pathChild> or <pathChild id="num">
function getPathPositionStart(pathStack)
	local pathPosition=1
	local index = 1
	local resultIdx=index
	while index <= #pathStack do
		local path = pathStack[index]		
		local tagStart = generateTagStart(path)
		
		--if it is multi object, the next child node is number
		if pathStack[index+1]~=nil and tonumber(pathStack[index+1])~=nil then
			index = index + 1 
			local nodeNum = pathStack[index]
			tagStart = generateTagStart(path, nodeNum)
		end
		resultIdx = index 
	
		local posStart = string.find(xmlStr, tagStart, pathPosition)
		if posStart==nil or posStart<pathPosition then
			resultIdx = resultIdx - 1
			if tonumber(pathStack[index])~=nil then
				resultIdx = resultIdx - 1
			end
			break 
		end
		pathPosition = posStart
		index = index + 1 
	end
	if pathPosition==1 then		
		pathPosition=nil	
	end
	return resultIdx, pathPosition
end

--Get the path end position of the xml
--To find the pattern like "</path>" after the start position 
function getPathPositionEnd(path, pathStartPos)
	local pathTagEnd = generateTagEnd(path)
	local pathPosition = string.find(xmlStr,pathTagEnd,pathStartPos)		
	return pathPosition
end

--To find whether the path exist in the xml file 
--If unexist, return nil
function findPath(pathTagStart, pathStartPos)	

	local result = string.find(xmlStr,pathTagStart,pathStartPos)

	return result
end

--Generate the xml 
function generateXml(pathStack, pathStr)
	local index, pathStartPos = getPathPositionStart(pathStack)
	local total = #pathStack
	while total>=index do
		if xmlStr~="" and total==index  then
			break
		end
		local parentPath = table.remove(pathStack)
		if parentPath==nil then
			break
		end
		total = total -1
		local nodeNum	
		if tonumber(parentPath)~=nil then
			nodeNum = parentPath
			parentPath = table.remove(pathStack)
			total = total -1
		end
		local nextTagStart = generateTagStart(parentPath, nodeNum)		
		local nextTagEnd = generateTagEnd(parentPath)
		pathStr = nextTagStart .. pathStr .. nextTagEnd
	end
	if xmlStr=="" then
		xmlStr = pathStr
		return
	end
	local path = table.remove(pathStack)
    --TI needs ManageableDevice even it is empty.
    if path==nil then
        path = "Device"
    end
	if tonumber(path)~=nil then		
		path = table.remove(pathStack)	
	end
	local pathEndPos = getPathPositionEnd(path, pathStartPos)
	if path == "Device" and pathStack[2]~="UPnP" then		
		local pathEndPosNext = pathEndPos + 1
		while pathEndPosNext ~= nil do
			pathEndPosNext = getPathPositionEnd(path, pathEndPosNext)
			if pathEndPosNext ~= nil then
				pathEndPos = pathEndPosNext
				pathEndPosNext = pathEndPosNext + 1
			end		
		end
	end
	xmlStr = string.sub(xmlStr, 1, pathEndPos-1) .. pathStr .. string.sub(xmlStr, pathEndPos, string.len(xmlStr))	
end

--Filter the object by the special path from url param.
function filterConfigurationData(pathStr)
	local result = false
	local lastIndex 
	local configurationDataStr = getConfigurationData()
	local isChildObj = string.find(pathStr, tostring(configurationDataStr))
	
	if isChildObj ~= nil then
		result = true
	else
		local i, f, ext = string.find(configurationDataStr, "%.([^.]+)$")
		if type(tonumber(ext)) == "number" then		
			if pathStr.."."..ext == configurationDataStr then
				lastIndex = ext
			end	
		end
	end
	return result, lastIndex
end

--Get data by the mbus of the object to generate the xml file
--The obj_T includes path and params as obj_T = {path=***,params={"***"...}}
function getXmlByData(obj_T)
	local paramArray = {}
	local pathStack={}
	local pathDetail = obj_T["path"]
	local params_T = obj_T["param"]
	local isSingleObjQuery, lastIndex = filterConfigurationData(pathDetail) 
	if isSingleObjQuery==false and lastIndex==nil then	
		return
	end

	local data, error = mbus.getParameters{path=pathDetail, datamodel="second"}
    --TI needs ManageableDevice even it is empty.
    if string.match(tostring(pathDetail), "ManageableDevice")~=nil and data[pathDetail][1]==nil then
        table.insert(pathStack, "ManagementServer")
        local pathStr = ""
        generateXml(pathStack, pathStr)
    end
	if data[pathDetail][1]~=nil then
		--process params as <param>val</param>
		paramArray = getParamsTagByData(pathDetail, params_T, data, lastIndex)
		if table_is_empty(paramArray)==false then
			--process path		
			for pathElem in string.gmatch(pathDetail, "[^.]+") do
				table.insert(pathStack, pathElem)
			end		
			local pathElement = table.remove(pathStack)
			local pathStr = ""
			for i,paramStr in pairs(paramArray) do
				local paramTag = getTag(pathElement, paramStr)
				if data[pathDetail][1].path~=pathDetail then --multi instance
					if lastIndex==nil then
						paramTag = getTag(pathElement, paramStr, i)
					else
						paramTag = getTag(pathElement, paramStr, lastIndex)
					end
				end
				pathStr = pathStr .. paramTag
			end	
			generateXml(pathStack, pathStr)
		end
	end	
end

--Iterator Multi instance
function iteratorMultiObj(multiObj_T)	
	for i,obj_T in pairs(multiObj_T) do
		getXmlByData(obj_T)
	end	
end

--Iterator every object, including multi instance and single instance.
function iteratorObjects(obj_T)
	local path = obj_T["path"]
	local isMultiObj = string.find(path, "{i}")
	if isMultiObj ~= nil then
		local multiObj_T = getMutilObjects_T(obj_T)
		table.sort(multiObj_T, function(x, y) return string.lower(x["path"]) < string.lower(y["path"]) end)
		iteratorMultiObj(multiObj_T)
	else
		getXmlByData(obj_T)
	end
end

--Create the xml for the object groups
function createXmlByObjects(objs)
  	for i,obj_T in pairs(objs) do
		iteratorObjects(obj_T)
	end	
end

local function parseargs(s)
	local arg = {}
	string.gsub(s, "(%w+)=([\"'])(.-)%2", function (w, _, a)
		arg[w]=a
	end)
	if arg["id"]~=nil then
		return arg["name"]..".{"..arg["id"].."}"
	end
	return arg["name"]
end
		
local function collect(s)
	
	local ni,c,label,xarg, empty
	local i, j = 1, 1
	local type=""
	local stack={}
	local top = {}
	local param={}
	local path={}
	
	while true do
		ni,j,c,label,xarg, empty = string.find(s, "<(%/?)([%w:]+)(.-)(%/?)>", i)
		if not ni then break end
	 
		if label == "xs:element" then

			if empty == "/" then	-- empty element tag

				local arg=parseargs(xarg)					
				table.insert(param,arg)

			elseif c == "" then	 -- start tag
				local arg=parseargs(xarg)	
				table.insert(top,arg)

				local lastPath=""
				if #path>0 then
					lastPath=path[#path].."."
				end
				table.insert(path,lastPath..arg)

			else	-- end tag		

				if type=="param" then
					
					local toclose = table.remove(top)					
					table.insert(param, toclose)		
					type=""
				else
					if #param>0 then
						local pathInfo = path[#path]
						local lastMutilIdx = string.find(pathInfo,".{i}",string.len(pathInfo)-4)
						if lastMutilIdx~=nil then
							pathInfo = string.sub(pathInfo,1,string.len(pathInfo)-4)
						end
												
						table.insert(stack,{path=pathInfo,param=param})
						param={}
					end
				end
				table.remove(path)
			end
 		elseif label == "xs:simpleType" then
			type="param"	
		elseif label == "xs:complexType" then
			if #param>0 and c~="/" then
				local pathInfo = path[#path-1]
				local lastMutilIdx = string.find(pathInfo,".{i}",string.len(pathInfo)-4)
				if lastMutilIdx~=nil then
					pathInfo = string.sub(pathInfo,1,string.len(pathInfo)-4)
				end
				table.insert(stack,{path=pathInfo,param=param})
				param={}
			end
		end
		i = j+1
	end
	--table.sort(stack, function(x, y) return string.lower(x["path"]) < string.lower(y["path"]) end)
	return stack
end

--Read the template of xml
function readXmlTemplate(type)
	local open=io.open
	local src
	--local schemaPath=cgilua.servervariable"SERVER_ROOT".."include/lp/TIWLS_schema.xml"
	--if type=="widget" then
	--	schemaPath=cgilua.servervariable"SERVER_ROOT".."include/lp/TIWLS_widget_schema.xml"
	--end
	--if type=="Backup" then
	--	schemaPath=cgilua.servervariable"SERVER_ROOT".."include/lp/TIWLS_backup_schema.xml"
	--end

        local schemaPath="/tmp/TIWLS_schema.xml"
        if type=="widget" then
                schemaPath="/tmp/TIWLS_widget_schema.xml"
        end
    
	-- read the whole contents of the xml file
	local fh = open (schemaPath)
	if fh~=nil then
		src = fh:read("*a")		
		--cgilua.print(src)
		--cgilua.print("<br>xml file is read<br>")
	end
	fh:close()	
	return src
end

--To get the device log from the file of "/var/localsyslog"
function getDeviceLog()
	local confUrl = getConfigurationData()
	if confUrl=="Device" or confUrl=="Device.DeviceInfo" then
		
		local reply, error = mbus.modify(
		function()
                	local reply1, error1 = mbus.setParameters{ path = "TI_STORE.TiUserIntf", param = { SaveDeviceLog="1"}}
		end)		
		local open=io.open
		local filePath = "/var/localsyslog"
		local deviceLog = ""
		local fh = open (filePath)
		if fh~=nil then
			deviceLog = fh:read("*a")		
		end
		fh:close()
		deviceLog = "<DeviceLog>" .. deviceLog .. "</DeviceLog>"
		local pathEndPos = getPathPositionEnd("DeviceInfo")
		xmlStr = string.sub(xmlStr, 1, pathEndPos-1) .. deviceLog .. string.sub(xmlStr, pathEndPos, string.len(xmlStr))
	end
end

--To get the wan type as "Phibra", "ADSL", "VDSL"
function getWanType()
	local wanType = "ADSL"
	local wanTypePath = "Device.UserInterface.X_TELECOMITALIA_IT_WebPage"

	local data, error = mbus.getParameters{path=wanTypePath, param="Profile", datamodel="second"}
	if data[wanTypePath][1]~=nil then
		if data[wanTypePath][1].param["Profile"]~="" and data[wanTypePath][1].param["Profile"]~=nil then
			wanType = data[wanTypePath][1].param["Profile"]
		end
	end
	return wanType
end

--Write xml to /tmp/AGconfig.xml.
function writeToXmlFile(type)
	--If it doesn't exist in the datamodel of IGD, it should be reported error as invalid output.
	if xmlStr=="" then
		httperror(510, "Invalid output")		
	end
	local open=io.open
	local xmlPath="/tmp/AGConfig.xml"
	if type=="widget" then
		xmlPath="/tmp/Widget.xml"
	end
	local fh = open (xmlPath, "w")
	if fh~=nil then
		--getDeviceLog()		
		local xmlStart="\<?xml version=\"1.0\" encoding=\"UTF-8\"?\>"	
		xmlStr = string.gsub(xmlStr, "_ReplaceWord", "")
		local wanType = getWanType()
		local rootTagWithWanType="<Device xmlns=\"http://www.telecomitalia.it/agconfig_agplus-m5\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.telecomitalia.it/agconfig_agplus-m5\" elementFormDefault=\"qualified\" id=\"NewDataSet\">"
		xmlStr = rootTagWithWanType .. string.sub(xmlStr, 9, string.len(xmlStr))
		fh:write(xmlStart .. tostring(xmlStr))
	end
	fh:close()	
end

--get the atomic web type.
function getAtomWebType()
    local webTypePath = "WLAN.Intf.wl_ssid1_local0.Security"
    local reply, error = mbus.getParameters{ path = webTypePath, param = {"Mode"},flags="KEYPATH"}
    local webType = reply[webTypePath][1].param["Mode"]
    if webType=="WEP" then
        return true
    end
    return false
end

--Get the atomic webkey.
function getAtomWebkey()
    local webkeyPath = "WLAN.Intf.wl_ssid1_local0.Security.WEP"
    local reply, error = mbus.getParameters{ path = webkeyPath, param = {"WEPKey"},flags="KEYPATH"}
    local webkey = reply[webkeyPath][1].param["WEPKey"]
    return webkey
end

--Get FXO number from ENV.
function getFXONumber()
    local fxoNumber = ""
    local reply, error = mbus.getParameters{ path = "ENV", param = { "Name", "Value" }, filter = "(== Name ".. "IsFXONum" ..")" }
    if reply["ENV"]~=nil and reply["ENV"][1]~=nil then
        fxoNumber = reply["ENV"][1].param["Value"]
    end
    return fxoNumber
end

--Write xml to /tmp/AGconfig.xml for backup and restore.
function writeToXmlFileForBR(type)
    --If it doesn't exist in the datamodel of IGD, it should be reported error as invalid output.
    if xmlStr=="" then
        httperror(510, "Invalid output")    
    end 
    --If the wepkey is WEP, get the atomic path of WLAN.Intf.2.Security.WEPKey and backup it.
    local isWebType = getAtomWebType()
    if isWebType==true then
        local webKey = getAtomWebkey()
        local xmlStrWithWebkey = string.sub(xmlStr, 1, -10)
        local webkeyTag = "<WEPKeyInAtomic>" .. tostring(webKey) .. "</WEPKeyInAtomic>"
        xmlStr = xmlStrWithWebkey .. webkeyTag .. "</Device>"
    end

    --Get the ENV of FXO Number value.
    local fxoNumber = getFXONumber()
    
    local xmlStrWithENV = string.sub(xmlStr, 1, -10)
    local ENVTag = "<FXONumber>" .. tostring(fxoNumber) .. "</FXONumber>"
    xmlStr = xmlStrWithENV .. ENVTag .. "</Device>"

    local open=io.open
    local xmlPath="/tmp/AGConfig.xml"
    if type=="widget" then
        xmlPath="/tmp/Widget.xml"
    end 
    local fh = open (xmlPath, "w")

    if fh~=nil then
        --getDeviceLog()        
        local xmlStart="\<?xml version=\"1.0\" encoding=\"UTF-8\"?\>"   
        xmlStr = string.gsub(xmlStr, "_ReplaceWord", "") 
        local wanType = getWanType()
        local rootTagWithWanType="<Device xmlns=\"http://www.telecomitalia.it/agconfig_agplus-m5\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.telecomitalia.it/agconfig_agplus-m5\" elementFormDefault=\"qualified\" id=\"NewDataSet\">"
        xmlStr = rootTagWithWanType .. string.sub(xmlStr, 9, string.len(xmlStr))
        fh:write(xmlStart .. tostring(xmlStr))
    end 
    fh:close()  
end

--Start to create xml .
function xmlCreate(objNode) 
	local xmlObjNode = objNode
	local type = nil
	if objNode == "WidgetAssurance" then
		xmlObjNode = "Device"
		type = "widget"
	end
	local src = readXmlTemplate(type)
	local objs = collect(src)
	setConfigurationData(xmlObjNode)
	createXmlByObjects(objs)
	writeToXmlFile(type)	
end

--Start to create xml for Backup and Restored.
function xmlCreateBR(objNode) 
    local xmlObjNode = "Device"
    local type = "Backup"
    local src = readXmlTemplate(type)
    local objs = collect(src)
    setConfigurationData(xmlObjNode)
    createXmlByObjects(objs)
    writeToXmlFileForBR(type)
end

--Fix For CQ CPE_P00120870 Starts
--Encrypt the xml file to kry file
--mode:0 DECRYPT, 1 -- ENCRYPT
function xmlEncryptAndDecrypt(mode)
    local inputFile="/tmp/AGConfig.xml"
    local outputFile = "/tmp/AGConfig.kry"
    if mode == 0 then
        inputFile="/tmp/AGConfig.kry"
        outputFile="/tmp/AGConfig.xml"
    end
    local key = "a0dd1da4242d32424fdffaa0ed0e0f12"
    local iv  = "00000000000000000000000000000000"
    local error = xml_encryption(inputFile, outputFile, key, iv, mode)
    return error
end
--Fix For CQ CPE_P00120870 Ends

--Encrypt the xml file to kry file 
--mode:0 DECRYPT, 1 -- ENCRYPT
function widgetXmlEncryptAndDecrypt(mode)
    local inputFile="/tmp/Widget.xml" 
    local outputFile="/tmp/Widget.kry"
    if mode == 0 then
        inputFile="/tmp/Widget.kry"
        outputFile="/tmp/Widget.xml"
    end 
    local key = "a0dd1da4242d32424fdffaa0ed0e0f12"
    local iv  = "00000000000000000000000000000000"
    local error = xml_encryption(inputFile, outputFile, key, iv, mode)
    return error
end

xmlCreate("Device")
local fxoTeleNumber = ""
local wepGuestKey = ""

local tprint=require("tableprint")
function sleep(n)  
  while n  > 0 do  
    n = n - 1
    end
end

--Set the state of the ETH phy and WLAN Phy
function setPhyState(state)
        local modify={}
        table.insert(modify, {path="WLAN", param={Enable=state}})

        if state == "0" then
                state = "disabled"
        else
                state = "enabled"
        end

        for i=1, 4 do
                table.insert(modify, {path="TI_STORE.TiUserIntf", param={tclCmd="eth device ifconfig intf ethif" .. tostring(i) .. " state " .. state}})
        end
        local res =  setMBUS(modify)
		--tprint("@@@setPhyState result is");
		--tprint(res);
end

--Execute this action after ip changing.
function phyChangeSetting()
	--tprint("@@@ phyChangeSetting start...")
        --disable ETH phy and WLAN Phy
        setPhyState("0")
        sleep(10)

        local reply, error = mbus.modify(
                                function()
                                        local reply1, error1 = mbus.deleteObjects{path="IP.ARP"}
                                end)

      	local reply, error = mbus.modify(
                                function()
                                        local reply1, error1 = mbus.deleteObjects{path="Hosts.Host"}
                                end)

        sleep(3)

        -- if IP is modified, it may be the case the DHCP server disabled but IP changed to another subnetwork.
        -- in IP plugin, linux.ip will be created in this case, so dhcpcd need to restart
        -- if DHCP server is checked, it will be better.
        -- force Linux to update its IP address, force Smaba update its server ip
        local modify={}
        table.insert(modify, {path="TI_STORE.TiUserIntf", param={linuxCmd="/etc/init.d/udhcpcd stop &"}})
        setMBUS(modify)
        sleep(2)
        modify={}
        table.insert(modify, {path="TI_STORE.TiUserIntf", param={linuxCmd="/etc/init.d/udhcpcd start &"}})
        setMBUS(modify)
        modify={}
        table.insert(modify, {path="ContentSharing.CIFS", param={ServerComment="Gateway"}})
        setMBUS(modify)
        modify={}
        table.insert(modify, {path="ContentSharing.CIFS", param={ServerComment="TI Gateway"}})
        setMBUS(modify)

        -- enable ETH phy and WLAN phy
        -- wait dhcpcd finish the restart
        sleep(10)
        setPhyState("1")
        sleep(10)
	
	--tprint("@@@ phyChangeSetting end...")
end

-- name:           setMBUS
-- description:    set parameter to MBUS 
-- parameter:      set:  a table for set info 
-- return value    null  

function setMBUS(set)
  --tprint("@@@ setMBUS start ...")
  --tprint(set)
  local result=0
  if #set>0 then
      local reply, error = mbus.modify(
        function()
          local reply, error = mbus.setParameters(set)
          if error~=nil then result=1 end
        end)
  end
  --tprint("@@@ setMBUS result")
  --tprint(result)
  --tprint("@@@ setMBUS end ...")
  return result
end

-- name:           setMBUS_IGD
-- description:    set parameter to MBUS IGD datamodel
-- parameter:      set:  a table for set info 
-- return value    null  

function setMBUS_IGD(set)
  --tprint("@@@ setMBUS_IGD start....")
  --tprint(set)
  local result=0
  set["datamodel"]="second"
  if #set>0 then
      local reply1, error1 = mbus.modify(
        function()
          local reply, error = mbus.setParameters(set)
          if error~=nil then 
	          result=1 
          end
        end,
		{datamodel="second"}
      )
	if error1 ~=nil then 
	   result=1 
	end	  
  end
  --tprint("@@@ setMBUS_IGD result")
  --tprint(result)
  --tprint("@@@ setMBUS_IGD end....")
  return result
end

local stack={}

--Set the dhcp pool state as the session variable, 0 means false which as a default value.
local dhcpServerState = "0"
--This session variable judges whether the ip, netmask, dhcp ranged was changed.
local isLanConfigChanged = "false"
local natIpInitDefault, natIpFinalDefault

--Path list which should be checked to other vendors in which its path without sequence number.
local pathList_T = {{"InternetGatewayDevice.WANDevice.WANConnectionDevice.WANPPPConnection", 0}, {"InternetGatewayDevice.WANDevice.WANConnectionDevice.WANIPConnection", 0}, {"InternetGatewayDevice.WANDevice.WANConnectionDevice", 0}}
--Define the exception of the parameters for factory default in the table like "{path, {param1,param2,...}}"
local factoryException_T = {
{"InternetGatewayDevice.WANDevice.1.WANConnectionDevice.1.WANPPPConnection.1", {}},
{"InternetGatewayDevice.DeviceInfo", {"ProvisioningCode"}},
{"InternetGatewayDevice.ManagementServer", {"X_TELECOMITALIA_IT_ServiceRealm"}},
{"InternetGatewayDevice.Layer3Forwarding", {}},
{"InternetGatewayDevice.Layer3Forwarding.Forwarding.{i}", {}},
{"InternetGatewayDevice.USBHosts.Host.{i}", {}},
{"InternetGatewayDevice.LANDevice.1.Hosts", {}},
--{"InternetGatewayDevice.LANDevice.1.LANHostConfigManagement.DHCPStaticAddress.{i}", {}},
{"InternetGatewayDevice.LANDevice.1.Hosts.Host.{i}", {}},
{"InternetGatewayDevice.WANDevice.1.WANConnectionDevice.1.WANPPPConnection.{i}", {"Name", "ConnectionStatus", "Uptime", "LastConnectionError", "ExternalIPAddress", "CurrentMRUSize", "X_TELECOMITALIA_IT_CurrentDNSServer", "X_TELECOMITALIA_IT_WINS", "PortMappingNumberOfEntries"}},
{"InternetGatewayDevice.WANDevice.1.WANConnectionDevice.1.WANPPPConnection.3.PortMapping.{i}", {"X_TELECOMITALIA_IT_HostMACAddress"}},
{"InternetGatewayDevice.WANDevice.1.WANConnectionDevice.1.WANPPPConnection.3.Stats", {}}
}

--Define the list of parameters to be restored in the table like "{path, {param1,param2,...}}"
local restoredParams_T = {
{"Device.UserInterface", {"PasswordRequired", "X_TELECOMITALIA_IT_LedLowConsumptionEnable"}},
{"Device.USB.USBHosts", {"X_TELECOMITALIA_IT_USBService"}},
{"Device.WiFi.Radio.{i}", {"Enable", "OperatingStandards", "Channel", "AutoChannelEnable", "AutoChannelRefreshPeriod", "X_TELECOMITALIA_IT_ChannelRefresh", "OperatingChannelBandwidth"}},
{"Device.WiFi.SSID.{i}", {"Enable", "SSID", "X_TELECOMITALIA_IT_MACAddressControlEnabled", "X_TELECOMITALIA_IT_AllowedMACAddresses"}},
{"Device.WiFi.AccessPoint.{i}", {"Enable", "SSIDAdvertisementEnabled", "WMMEnable", "X_TELECOMITALIA_IT_DisconnectTime"}},
{"Device.WiFi.AccessPoint.{i}.Security", {"ModeEnabled", "WEPKey", "KeyPassphrase"}},
{"Device.IP.Interface.3.IPv4Address.1", {"IPAddress", "SubnetMask"}},
{"Device.LANConfigSecurity", {"ConfigPassword"}},
{"Device.NAT", {"PortMappingNumberOfEntries", "X_TELECOMITALIA_IT_DynamicDNSNumberOfEntries", "X_TELECOMITALIA_IT_URLFilteringNumberOfEntries"}},
{"Device.NAT.InterfaceSetting.2", {"Enable", "X_TELECOMITALIA_IT_NATStartIPAddress", "X_TELECOMITALIA_IT_NATEndIPAddress", "X_TELECOMITALIA_IT_NATExcludedInternalIPAddresses"}},
{"Device.NAT.PortMapping.{i}", {"Enable", "Interface", "AllInterfaces", "LeaseDuration", "RemoteHost", "ExternalPort", "InternalPort", "Protocol", "InternalClient", "Description", "X_000E50_GUIDisabled", "X_000E50_InterfaceDisabled"}},
{"Device.NAT.X_TELECOMITALIA_IT_DynamicDNS.{i}", {"Enable", "Status", "Interface", "Domain", "Provider", "Username", "Password"}},
{"Device.NAT.X_TELECOMITALIA_IT_URLFiltering.{i}", {"Enable", "Interface", "FilteredURLs", "FilteredURLsExclude"}},
{"Device.DHCPv4.Server", {"Enable"}},
{"Device.DHCPv4.Server.Pool.1", {"Enable", "Interface", "MinAddress", "MaxAddress", "ReservedAddresses", "SubnetMask", "IPRouters", "StaticAddressNumberOfEntries"}},
{"Device.DHCPv4.Server.Pool.1.StaticAddress.{i}", {"Enable", "Chaddr", "Yiaddr"}},
{"Device.Users.User.1", {"Enable", "RemoteAccessCapable", "Username", "Password"}},
{"Device.UPnP.Device", {"Enable", "UPnPMediaServer"}},
{"Device.Firewall", {"Config"}},
{"Device.Services.VoiceService.{i}.VoiceProfile.{i}", {"PSTNFailOver"}},
{"Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap.{i}", {"FromUA", "ToVoicePort", "Preassigned"}},
{"Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap.{i}", {"ToUA", "FromVoicePort", "Priority"}},
{"Device.Services.VoiceService.{i}.PhyInterface.{i}", {"X_TELECOMITALIA_IT_SwitchToPSTNIn", "X_TELECOMITALIA_IT_SwitchToPSTNOut", "X_TELECOMITALIA_IT_POSConfig"}}
}

--Define the restore wait infomation which is display in restore modem configuration.
local restoreWait_T = {
{"Device.DeviceInfo", "ModelName", "apparatus"},
{"Device.UserInterface.X_TELECOMITALIA_IT_WebPage", "Profile", "serviceProfile"},
{"Device.UserInterface", "PasswordRequired", "passwordSetting"},
{"Device.UserInterface", "X_TELECOMITALIA_IT_LedLowConsumptionEnable", "LedLowConsumptionEnable"},
{"Device.IP.Interface.3.IPv4Address.1", "IPAddress", "gatewayIpAddress"},
{"Device.IP.Interface.3.IPv4Address.1", "SubnetMask", "subnetMask"},
{"Device.DHCPv4.Server", "Enable", "dhcpEnable"},
{"Device.DHCPv4.Server.Pool.1", "Enable", "dhcpService"},
{"Device.DHCPv4.Server.Pool.1", "Interface", "dhcpInterface"},
{"Device.DHCPv4.Server.Pool.1", "MinAddress", "dhcpIpInit"},
{"Device.DHCPv4.Server.Pool.1", "MaxAddress", "dhcpIpFinal"},
{"Device.DHCPv4.Server.Pool.1", "ReservedAddresses", "allowedMacAddresses"},
{"Device.DHCPv4.Server.Pool.1", "SubnetMask", "dhcpSubnetMask"},
{"Device.DHCPv4.Server.Pool.1", "IPRouters", "dhcpIPRouters"},
{"Device.DHCPv4.Server.Pool.1", "StaticAddressNumberOfEntries", "dhcpStaticAddressNumberOfEntries"},
{"Device.NAT.", "PortMappingNumberOfEntries", "natPortMappingNumberOfEntries"},
{"Device.NAT.", "X_TELECOMITALIA_IT_DynamicDNSNumberOfEntries", "natDynamicDNSNumberOfEntries"},
{"Device.NAT.", "X_TELECOMITALIA_IT_URLFilteringNumberOfEntries", "natURLFilteringNumberOfEntries"},
{"Device.NAT.InterfaceSetting.2", "Enable", "natService"},
{"Device.NAT.InterfaceSetting.2", "X_TELECOMITALIA_IT_NATStartIPAddress", "natIpInit"},
{"Device.NAT.InterfaceSetting.2", "X_TELECOMITALIA_IT_NATEndIPAddress", "natIpFinal"},
{"Device.NAT.InterfaceSetting.2", "X_TELECOMITALIA_IT_NATExcludedInternalIPAddresses", "NATExcludedInternalIPAddresses"},
{"Device.NAT.PortMapping.{i}", "InternalClient","hostAddress"},
{"Device.NAT.PortMapping.{i}", "InternalPort","internalPort"},
{"Device.NAT.PortMapping.{i}", "ExternalPort","externalPort"},
{"Device.NAT.PortMapping.{i}", "Protocol","portMappingProtocol"},
{"Device.NAT.PortMapping.{i}", "Enable", "portMappingEnabled"},
{"Device.NAT.PortMapping.{i}", "Description", "portMappingDescription"},
{"Device.NAT.PortMapping.{i}", "Interface", "portMappingInterface"},
{"Device.NAT.PortMapping.{i}", "AllInterfaces", "portMappingAllInterfaces"},
{"Device.NAT.PortMapping.{i}", "LeaseDuration", "portMappingLeaseDuration"},
{"Device.NAT.PortMapping.{i}", "RemoteHost", "portRemoteHost"},
{"Device.PPP.Interface.1", "Name", "pppUser1Name"},
{"Device.PPP.Interface.2", "Name", "pppUser2Name"},
{"Device.Users.User.1", "Enable", "UserEnable"},
{"Device.Users.User.1", "RemoteAccessCapable", "RemoteAccessCapable"},
{"Device.Users.User.1", "Username", "Username"},
{"Device.Users.User.1", "Password", "Password"},
{"Device.LANConfigSecurity", "ConfigPassword", "passwordValue"},
{"Device.Firewall", "Config", "firewallSetting"},
{"Device.DHCPv4.Server.Pool.1.StaticAddress.{i}", "Enable", "preEnable"},
{"Device.DHCPv4.Server.Pool.1.StaticAddress.{i}", "Yiaddr", "preAllocatedIp"},
{"Device.DHCPv4.Server.Pool.1.StaticAddress.{i}", "Chaddr", "preAllocatedMacAddress"},
{"Device.WiFi.Radio.1", "Enable", "wifiRadioEnable"},
{"Device.WiFi.Radio.1", "AutoChannelEnable", "wifiAutoChannel"},
{"Device.WiFi.Radio.1", "Channel", "wifiChannel"},
{"Device.WiFi.Radio.1", "OperatingStandards", "wifiRadio1OperatingStandards"},
{"Device.WiFi.Radio.1", "AutoChannelRefreshPeriod", "wifiRadio1AutoChannelRefreshPeriod"},
{"Device.WiFi.Radio.1", "X_TELECOMITALIA_IT_ChannelRefresh", "wifiRadio1ChannelRefresh"},
{"Device.WiFi.Radio.1", "OperatingChannelBandwidth", "wifiRadio1OperatingChannelBandwidth"},
{"Device.WiFi.SSID.1", "SSID", "wifiSsid"},
{"Device.WiFi.SSID.1", "Enable", "wifiSsidEnable"},
{"Device.WiFi.SSID.1", "X_TELECOMITALIA_IT_MACAddressControlEnabled", "wifiAccessControl"},
{"Device.WiFi.SSID.1", "X_TELECOMITALIA_IT_AllowedMACAddresses", "wifiAllowMac"},
{"Device.WiFi.AccessPoint.1", "Enable", "wifiAccEnable"},
{"Device.WiFi.AccessPoint.1", "SSIDAdvertisementEnabled", "wifiAdvEnable"},
{"Device.WiFi.AccessPoint.1", "WMMEnable", "wifiWMMEnable"},
{"Device.WiFi.AccessPoint.1", "X_TELECOMITALIA_IT_DisconnectTime", "wifiDisTime"},
{"Device.WiFi.AccessPoint.1.Security", "ModeEnabled", "wifiBeaconType"},
{"Device.WiFi.AccessPoint.1.Security", "KeyPassphrase", "wifiKeyPassphrase"},
{"Device.WiFi.AccessPoint.1.Security", "WEPKey", "wifiWEPKey"},
{"Device.WiFi.Radio.2", "Enable", "wifi5RadioEnable"},
{"Device.WiFi.Radio.2", "AutoChannelEnable", "wifi5AutoChannel"},
{"Device.WiFi.Radio.2", "Channel", "wifi5Channel"},
{"Device.WiFi.Radio.2", "OperatingStandards", "wifiRadio2OperatingStandards"},
{"Device.WiFi.Radio.2", "AutoChannelRefreshPeriod", "wifiRadio2AutoChannelRefreshPeriod"},
{"Device.WiFi.Radio.2", "X_TELECOMITALIA_IT_ChannelRefresh", "wifiRadio2ChannelRefresh"},
{"Device.WiFi.Radio.2", "OperatingChannelBandwidth", "wifiRadio2OperatingChannelBandwidth"},
{"Device.WiFi.SSID.2", "SSID", "wifi5Ssid"},
{"Device.WiFi.SSID.2", "Enable", "wifiSsid5Enable"},
{"Device.WiFi.SSID.2", "X_TELECOMITALIA_IT_MACAddressControlEnabled", "wifi5AccessControl"},
{"Device.WiFi.SSID.2", "X_TELECOMITALIA_IT_AllowedMACAddresses", "wifi5AllowMac"},
{"Device.WiFi.AccessPoint.2", "Enable", "wifi5AccEnable"},
{"Device.WiFi.AccessPoint.2", "SSIDAdvertisementEnabled", "wifi5AdvEnable"},
{"Device.WiFi.AccessPoint.2", "WMMEnable", "wifi5WMMEnable"},
{"Device.WiFi.AccessPoint.2", "X_TELECOMITALIA_IT_DisconnectTime", "wifi5DisTime"},
{"Device.WiFi.AccessPoint.2.Security", "ModeEnabled", "wifi5BeaconType"},
{"Device.WiFi.AccessPoint.2.Security", "KeyPassphrase", "wifi5KeyPassphrase"},
{"Device.WiFi.AccessPoint.2.Security", "WEPKey", "wifi5WEPKey"},
{"Device.WiFi.SSID.3", "Enable", "wifiGuestEnable"},
{"Device.WiFi.SSID.3", "SSID", "wifiGuestSsid"},
{"Device.WiFi.SSID.3", "X_TELECOMITALIA_IT_MACAddressControlEnabled", "wifiGuestAccessControl"},
{"Device.WiFi.SSID.3", "X_TELECOMITALIA_IT_AllowedMACAddresses", "wifiGuestAllowMac"},
{"Device.WiFi.AccessPoint.3", "Enable", "wifiGuestAccEnable"},
{"Device.WiFi.AccessPoint.3", "SSIDAdvertisementEnabled", "wifiGuestAdvEnable"},
{"Device.WiFi.AccessPoint.3", "WMMEnable", "wifiGuestWMMEnable"},
{"Device.WiFi.AccessPoint.3", "X_TELECOMITALIA_IT_DisconnectTime", "wifiGuestDisTime"},
{"Device.WiFi.AccessPoint.3.Security", "ModeEnabled", "wifiGuestBeaconType"},
{"Device.WiFi.AccessPoint.3.Security", "KeyPassphrase", "wifiGuestKeyPassphrase"},
{"Device.WiFi.AccessPoint.3.Security", "WEPKey", "wifiGuestWEPKey"},
{"Device.WiFi.SSID.4", "Enable", "wifiGuest5Enable"},
{"Device.WiFi.SSID.4", "SSID", "wifiGuest5Ssid"},
{"Device.WiFi.SSID.4", "X_TELECOMITALIA_IT_MACAddressControlEnabled", "wifiGuest5AccessControl"},
{"Device.WiFi.SSID.4", "X_TELECOMITALIA_IT_AllowedMACAddresses", "wifiGuest5AllowMac"},
{"Device.WiFi.AccessPoint.4", "Enable", "wifiGuest5AccEnable"},
{"Device.WiFi.AccessPoint.4", "SSIDAdvertisementEnabled", "wifiGuest5AdvEnable"},
{"Device.WiFi.AccessPoint.4", "WMMEnable", "wifiGuest5WMMEnable"},
{"Device.WiFi.AccessPoint.4", "X_TELECOMITALIA_IT_DisconnectTime", "wifiGuest5DisTime"},
{"Device.WiFi.AccessPoint.4.Security", "ModeEnabled", "wifiGuest5BeaconType"},
{"Device.WiFi.AccessPoint.4.Security", "KeyPassphrase", "wifiGuest5KeyPassphrase"},
{"Device.WiFi.AccessPoint.4.Security", "WEPKey", "wifiGuest5WEPKey"},
{"Device.Hosts.Host.{i}", "HostName", "hostName"},
{"Device.Hosts.Host.{i}", "IPAddress", "wifiIp"},
{"Device.Hosts.Host.{i}", "PhysAddress", "wifiMacAddress"},
{"Device.USB.USBHosts", "X_TELECOMITALIA_IT_USBService", "usbService"},
{"Device.NAT.X_TELECOMITALIA_IT_URLFiltering.1", "Enable", "urlEnable"},
{"Device.NAT.X_TELECOMITALIA_IT_URLFiltering.1", "FilteredURLs", "urlFilterUrls"},
{"Device.NAT.X_TELECOMITALIA_IT_URLFiltering.1", "FilteredURLsExclude", "urlexcludeEnable"},
{"Device.NAT.X_TELECOMITALIA_IT_URLFiltering.1", "Interface", "urlFilteringInterface"},
{"Device.NAT.X_TELECOMITALIA_IT_DynamicDNS.{i}", "Provider", "dynProvider"},
{"Device.NAT.X_TELECOMITALIA_IT_DynamicDNS.{i}", "Domain", "dynDomain"},
{"Device.NAT.X_TELECOMITALIA_IT_DynamicDNS.{i}", "Username", "dynUsername"},
{"Device.NAT.X_TELECOMITALIA_IT_DynamicDNS.{i}", "Password", "dynPassword"},
{"Device.NAT.X_TELECOMITALIA_IT_DynamicDNS.{i}", "Enable", "dynEnable"},
{"Device.NAT.X_TELECOMITALIA_IT_DynamicDNS.{i}", "Status", "dynStatus"},
{"Device.NAT.X_TELECOMITALIA_IT_DynamicDNS.{i}", "Interface", "dynInterface"},
{"Device.UPnP.Device", "UPnPMediaServer", "upnpMedia"},
{"Device.UPnP.Device", "Enable", "upnpEnable"},
{"Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap.{i}", "FromUA", "fromUA"},
{"Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap.{i}", "ToVoicePort", "toVP"},
{"Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_UAMap.{i}", "Preassigned", "UAMAPPreassigned"},
{"Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap.{i}", "ToUA", "toUA"},
{"Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap.{i}", "FromVoicePort", "fromVP"},
{"Device.Services.VoiceService.1.VoiceProfile.1.X_TELECOMITALIA_IT_VoicePortMap.{i}", "Priority", "portmapPriority"},
{"Device.Services.VoiceService.1.PhyInterface.1", "X_TELECOMITALIA_IT_SwitchToPSTNIn", "pstnin1"},
{"Device.Services.VoiceService.1.PhyInterface.1", "X_TELECOMITALIA_IT_SwitchToPSTNOut", "pstnout1"},
{"Device.Services.VoiceService.1.PhyInterface.1", "X_TELECOMITALIA_IT_POSConfig", "pos1"},
{"Device.Services.VoiceService.1.PhyInterface.2", "X_TELECOMITALIA_IT_SwitchToPSTNIn", "pstnin2"},
{"Device.Services.VoiceService.1.PhyInterface.2", "X_TELECOMITALIA_IT_SwitchToPSTNOut", "pstnout2"},
{"Device.Services.VoiceService.1.PhyInterface.2", "X_TELECOMITALIA_IT_POSConfig", "pos2"},
{"Device.Services.VoiceService.1.PhyInterface.3", "X_TELECOMITALIA_IT_SwitchToPSTNIn", "pstnin3"},
{"Device.Services.VoiceService.1.PhyInterface.3", "X_TELECOMITALIA_IT_SwitchToPSTNOut", "pstnout3"},
{"Device.Services.VoiceService.1.PhyInterface.3", "X_TELECOMITALIA_IT_POSConfig", "pos3"},
{"Device.Services.VoiceService.1.PhyInterface.4", "X_TELECOMITALIA_IT_SwitchToPSTNIn", "pstnin4"},
{"Device.Services.VoiceService.1.PhyInterface.4", "X_TELECOMITALIA_IT_SwitchToPSTNOut", "pstnout4"},
{"Device.Services.VoiceService.1.PhyInterface.4", "X_TELECOMITALIA_IT_POSConfig", "pos4"},
--Not define the below path as multi path, just single every parameter.
{"Device.Services.VoiceService.1.VoiceProfile.1", "PSTNFailOver", "pstnfail1"},
{"Device.Services.VoiceService.2.VoiceProfile.1", "PSTNFailOver", "pstnfail2"},
{"Device.Services.VoiceService.2.VoiceProfile.2", "PSTNFailOver", "pstnfail3"},
{"Device.Services.VoiceService.2.VoiceProfile.3", "PSTNFailOver", "pstnfail4"},
{"Device.Services.VoiceService.2.VoiceProfile.4", "PSTNFailOver", "pstnfail5"},
{"Device.Services.VoiceService.3.VoiceProfile.1", "PSTNFailOver", "pstnfail6"},
{"Device.Services.VoiceService.3.VoiceProfile.2", "PSTNFailOver", "pstnfail7"},
{"Device.Services.VoiceService.3.VoiceProfile.3", "PSTNFailOver", "pstnfail8"},
{"Device.Services.VoiceService.3.VoiceProfile.4", "PSTNFailOver", "pstnfail9"},
{"Device.Services.VoiceService.3.VoiceProfile.5", "PSTNFailOver", "pstnfail10"},
{"Device.Services.VoiceService.3.VoiceProfile.6", "PSTNFailOver", "pstnfail11"},
{"Device.Services.VoiceService.3.VoiceProfile.7", "PSTNFailOver", "pstnfail12"},
{"Device.Services.VoiceService.3.VoiceProfile.8", "PSTNFailOver", "pstnfail13"},
{"Device.Services.VoiceService.3.VoiceProfile.9", "PSTNFailOver", "pstnfail14"},
{"Device.Services.VoiceService.3.VoiceProfile.10", "PSTNFailOver", "pstnfail15"},
{"Device", "WEPKeyInAtomic", "wepkey"},
{"Device", "FXONumber", "fxonumber"}
}

--Judge whether the table is null
function table_is_empty(t)

        return _G.next( t ) == nil

end

--Get the username from ppp management.
function getUsernameFromPPPManagement()
    local username
    local pathStr = "Device.PPP.Interface.1"
    local data, error = mbus.getParameters{path=pathStr, param="Username", datamodel="second"}
    if data[pathStr][1] ~= nil then
        username = data[pathStr][1].param["Username"]
        local position = string.find(username, "@")
        if position ~= nil then
            username = string.sub(username, 1, position-1)
        end

	--tprint("@@@getUsernameFromPPPManagement end")
        return username
    end
end

--Get the username which was made up with management ppp and data ppp.
function getUsernameWithPPP(usernameParam)
	--tprint("@@@getUsernameWithPPP start")
	local username = getUsernameFromPPPManagement()
	if username~=nil then
		local realnamePos = string.find(usernameParam, "@")
		if realnamePos ~= nil then
			username = username .. tostring(string.sub(usernameParam, realnamePos))
		end
        end
	--tprint("@@@getUsernameWithPPP end")
	return username
end

--Get the path of data ppp
function getPathWithDataPPP()
	local pathStr = "Device.PPP.Interface"
	local data, error = mbus.getParameters{path=pathStr, param="Name", filter="(== Name 'User session')", datamodel="second"}
	if data[pathStr][1] ~= nil then
		return data[pathStr][1].path	
	end
	return pathStr..".3"
end

--Get the extend name and start position from the path of IGD, which is the string after the last point.
--Like "InternetGatewayDevice.WANDevice.1.WANConnectionDevice.1.WANPPPConnection.3", it should be "3" to the extend name.
--Like "InternetGatewayDevice.WANDevice.1.WANConnectionDevice.1.WANPPPConnection.3.PortMapping", it should be "PortMapping" to the extend name.
function getExtendName(pathStr)
	local startIndex, endIndex, extendName = string.find(pathStr, "%.([^.]+)$")
	return extendName, startIndex
end

--Start to update the data from AGconfig.xml to Device
function execRestore()
	--tprint("@@@ execRestore start")
	local isNatRangeDefault=false
	local usernameParam 
	local factoryFlag = isAgInFactory()
	local pathDataPPP = getPathWithDataPPP()

	local dhcpServer_T = {}
	local channelAuto_T = {}
	for i,obj_T in pairs(stack) do
		local modify = {}
		local params_T = {}
		local pathStr = obj_T[1]
		local paramName = obj_T[2][1]
		local paramValue = obj_T[2][2]

        --Deal with the "&" in KeyPassphrase of wifi part.
        if (pathStr=="Device.WiFi.AccessPoint.1.Security" or pathStr=="Device.WiFi.AccessPoint.2.Security") and paramName=="KeyPassphrase" then
            if string.find(paramValue, "&amp;")~=nil then
                paramValue = string.gsub(paramValue, "&amp;", "&")
            end
            if string.find(paramValue, "&lt;")~=nil then
                paramValue = string.gsub(paramValue, "&lt;", "<")
            end
            if string.find(paramValue, "&gt;")~=nil then
                paramValue = string.gsub(paramValue, "&gt;", ">")
            end
            if string.find(paramValue, "&quot;")~=nil then
                paramValue = string.gsub(paramValue, "&quot;", "\"")
            end
        end
        --deal with the urlFilter add object.
        if paramName=="FilteredURLs" then
            paramName = "AddURL"
        end

        if paramName=="AddURL" then
            --local paramClearUrl_T["ClearURL"] = "1"
            table.insert(modify, {path=pathStr, param={ClearURL="1"}, datamodel="second"})
            setMBUS_IGD(modify)

            params_T[paramName] = paramValue
            table.insert(modify, {path=pathStr, param=params_T, datamodel="second"})
            setMBUS_IGD(modify)
        else
            params_T[paramName] = paramValue
            table.insert(modify, {path=pathStr, param=params_T, datamodel="second"})
            setMBUS_IGD(modify)
        end
	end

    --Restore the wepkey to atomic for ascii code displayed in the screen.
    local modify = {}
    local wepkeyForGuset = wepGuestKey
    if wepkeyForGuset~="" then
        local wepkeyPath = "WLAN.Intf.2.Security.WEP"
        table.insert(modify, {path = wepkeyPath, param = {WEPKey=wepkeyForGuset}})
        setMBUS(modify)
    end

    --Deal with the ENV value of FXO number.
    local modify = {}
    local fixedFXONum = fxoTeleNumber
    if fixedFXONum~="" then
        local IsFXONumExist = getFXONum()
        if IsFXONumExist=="" then
            local reply, error = mbus.modify(
            function()
                local reply, error = mbus.addObjects{path = "ENV", param = {Value = fixedFXONum, Name = "IsFXONum"}}
            end)
        else
            local replyFXOPath, errorFXOPath = mbus.getParameters{ path = "ENV", param = { "Name", "Value" }, filter = "(== Name ".. "IsFXONum" ..")" }
            local FXOPath = replyFXOPath["ENV"][1].path
            table.insert(modify, {path = FXOPath, param = {Value = fixedFXONum}})
            setMBUS(modify)
        end
    end

    --Deal with the ENV value of currentTime for wifi guest disconnect time.
    local currentTime = os.time()
    local reply,error = mbus.getParameters{path ="ENV",param = "Value",filter = "(== Name ".."Wlan_Time"..")"}
    mbus.modify(    
        function()
            if reply["ENV"][1] ~= nil and reply["ENV"][1].param ~= nil and reply["ENV"][1].param["Value"] ~= "" then 
                mbus.setParameters{path = "ENV.Wlan_Time" , param = {Value = tostring(currentTime)},flags = "KEYPATH"}
            else
                mbus.addObjects{ path = "ENV",param = {Name = "Wlan_Time",Value = tostring(currentTime)},flags = "KEYPATH"}
            end
        end)

	--update ip, or netmask or dhcp range 
	if isLanConfigChanged=="true" then
		setMBUS_IGD(dhcpServer_T)
		sleep(10)
	end
	--tprint("@@@ execRestore end")
end


--Add the object to the Device
function addObject(set)
	local pathDetail
	local pathStr = set["path"]	
	local param_T = set["param"]
    if string.match(pathStr, "PortMapping")~=nil then
        pathStr = "Device.NAT.PortMapping"
        local name = param_T["Description"]
        local interCli = param_T["InternalClient"]
        local protocol = param_T["Protocol"]
        local internalPort = param_T["InternalPort"]
        local externalPort = param_T["ExternalPort"]
        local status = param_T["Enable"]
        local interface = param_T["Interface"]
        local manualDisabled = "0"
        local intfDisabled = "0"
	local result = 0
        local reply, error = mbus.modify(
        function()
            local reply1, error1 = mbus.addObjects{ path = pathStr, param = { Description = name, 
                                                                              InternalClient = interCli, 
                                                                              InternalPort = internalPort, 
                                                                              ExternalPort = externalPort, 
                                                                              Protocol = protocol, 
                                                                              Enable = status, 
                                                                              Interface = interface, 
                                                                              X_000E50_GUIDisabled = manualDisabled, 
                                                                              X_000E50_InterfaceDisabled = intfDisabled}, datamodel="second"}
        end, {datamodel="second"})
    elseif string.match(pathStr, "X_TELECOMITALIA_IT_DynamicDNS")~=nil then
        pathStr = "DynDNS.Client"
        local username = param_T["Username"]
        local password = param_T["Password"]
        local dynEnable = param_T["Enable"]
        local serviceProvider = param_T["Provider"]
        local domainName = get_domain_name_from_url(param_T["Domain"])
        local servicePath, dynDnsClientPath
        local info = getPPP("PPP.Intf.2")
        local interface = info.ipintf
        if serviceProvider=="dyndns.it" then
            servicePath = "DynDNS.Service.1"
        elseif serviceProvider=="dyndns.org" then
            servicePath = "DynDNS.Service.2"
        elseif serviceProvider=="no-ip.com" then
            servicePath = "DynDNS.Service.3"
        elseif serviceProvider=="dtdns.com" then
            servicePath = "DynDNS.Service.4"
        end

        local reply, error = mbus.modify(
            function()
                local reply1, error1 = mbus.addObjects{path=pathStr, param={UserName=username, Password=password, Service=servicePath, Interface=interface}}
                if error1 ~= nil then
                    cgilua.redirect("resultKO.lp")
                    return
                end

                dynDnsClientPath=reply1[pathStr][1].path
                local reply2, error2 = mbus.addObjects{path = dynDnsClientPath..".Host", param = {Name=domainName}}
                if error2 ~= nil then
                    cgilua.redirect("resultKO.lp")
                    return
                end 
            end)
        if info.ppp_status ~= "Connected" then
            local modify = {}
            table.insert(modify, {path="PPP.Intf.2", param= {TI_Enable="true"}})
            setMBUS(modify)
        end
        if dynDnsClientPath ~= nil then
            modify = {}
            table.insert(modify, {path=dynDnsClientPath, param= {Enable=dynEnable}})
            setMBUS(modify)
        end
    elseif string.match(pathStr, "StaticAddress")~=nil then
        local dhcpStaticAddrEnable = param_T["Enable"]
	local yiaddr = param_T["Yiaddr"]
	local chaddr = param_T["Chaddr"]
	local result = 0
        if dhcpStaticAddrEnable=="true" then
            local reply, error = mbus.modify(
            function()
                local reply1, error1 = mbus.addObjects{ path = pathStr, param = { Enable=dhcpStaticAddrEnable,
										  Yiaddr=yiaddr,
                                                                                  Chaddr=chaddr}, datamodel="second"}
            end, {datamodel="second"})
        end
    else
        local reply, error = mbus.modify(
        function()
            local reply1, error1 = mbus.addObjects{path = pathStr, param = param_T, datamodel="second"}
                pathDetail=reply1[pathStr][1].path
                if error1~=nil then
                    result=1
                end
        end, {datamodel="second"})	
        return pathDetail
    end
end

--Update the object to the Device2
function updateObject(set)
	local pathStr = set["path"]	
	local param_T = set["param"]
	local modify = {}
	
	table.insert(modify, {path=pathStr, param=param_T, datamodel="second"})
	
	setMBUS_IGD(modify)
end

--Create the object in Device
function objectCreate(set)

	--tprint("@@@###objectCreate start.....")	
	--tprint(set)	
	local result=0
	local pathStr = set["path"]	
	local param_T = set["param"]	
	
	local extendName, startPosition = getExtendName(pathStr)
	if type(tonumber(extendName)) == "number" then
		pathStr = string.sub(pathStr, 1, startPosition-1)
		extendName,startPosition  = getExtendName(pathStr)
		set["path"]=pathStr		
	end	
	
	local pathDetail = addObject(set)

	if extendName=="Interface" then --PPP.Interface
		local modify = {}	
		local username = getUsernameWithPPP(param_T["Username"])
		table.insert(modify, {path=pathDetail, param={Username=username}, datamodel="second"})
		table.insert(modify, {path=pathDetail, param={Name="User session"}, datamodel="second"})	
		table.insert(modify, {path=pathDetail, param={DNSServers=param_T["DNSServers"]}, datamodel="second"})	
		table.insert(modify, {path=pathDetail, param={ConnectionTrigger=param_T["ConnectionTrigger"]}, datamodel="second"})
		table.insert(modify, {path=pathDetail, param={Enable=param_T["Enable"]}, datamodel="second"})

		--If the nat ip range is 0.0.0.0, it would be reset to it default value.
                if param_T["X_TELECOMITALIA_IT_NATStartIPAddress"] == "0.0.0.0" or param_T["X_TELECOMITALIA_IT_NATEndIPAddress"] == "0.0.0.0" then
			table.insert(modify, {path=pathDetail, param={X_TELECOMITALIA_IT_NATStartIPAddress=natIpInitDefault, X_TELECOMITALIA_IT_NATEndIPAddress=natIpFinalDefault}, datamodel="second"})
                end

		setMBUS_IGD(modify)
	end
	--tprint("@@@###objectCreate end.....")	
end


--Delete the object in Device
function deleteObject(pathStr)
	local reply, error = mbus.modify(
	function()
		local reply1, error1 = mbus.deleteObjects{ path = pathStr, datamodel="second"}
	end, {datamodel="second"})
end

--Delete the PortMapping and DHCPStaticAddress by the path
function deleteObjectByPath()
	local pathObj_T = {{path="Device.DHCPv4.Server.Pool.1.StaticAddress"}, {path="Device.NAT.PortMapping"}, {path="Device.NAT.X_TELECOMITALIA_IT_DynamicDNS"}}

	for i,set in pairs(pathObj_T) do
		deleteObject(set["path"])
	end	
end

--Query from Device to check whether it is existed.
function isExistedInAg(set)
	local flag = false
	local pathStr = set[1]
	local paramStr = set[2][1]

	local data, error = mbus.getParameters{path=pathStr, param=paramStr, datamodel="second"}
	if table_is_empty(data[pathStr][1].param) == false then
		flag = true
	end

	return flag
end

--Compare with params between stack and exception tables.
function compareParams(paramStack_T, paramFilter_T)
	local paramElement = paramStack_T[1]	
													
	for t,paramFilter in pairs(paramFilter_T) do	
		if paramElement == paramFilter then
			return true
		end
	end								
	return false
end

--Get the table of param like param={paramName1=paramValue1,paramName2=paramValue2,...}
function getParamByPath(instance)
	local pathStr = instance[1]
	local param_T = {}
	for j,obj_T in pairs(stack) do
		if pathStr==obj_T[1] and obj_T[2][1]~="X_TELECOMITALIA_IT_HostMACAddress" then
			param_T[obj_T[2][1]]=obj_T[2][2]
		end
	end
	return param_T
end

--Assemble the object in factory default like "{path=pathName, param={paramName1=paramValue1,paramName2=paramValue2,...}"
function assembleObjInFactory(path_T)
	local list = {}	
	for i,pathElem in pairs(path_T) do
		if isExistedInAg(pathElem)==false then			
			local param_T = getParamByPath(pathElem)			
			
			if table_is_empty(param_T)==false then
				table.insert(list, {path=pathElem[1], param=param_T})
			end
		end
	end
	return list
end

--Assemble the object in Configured like "{path=pathName, param={paramName1=paramValue1,paramName2=paramValue2,...}"
function assembleObjConfigured(path_T)
	local list = {}	
	for i,pathElem in pairs(path_T) do
		local param_T = getParamByPath(pathElem)			
			
		if table_is_empty(param_T)==false then
			table.insert(list, {path=pathElem[1], param=param_T})
		end
	end
	return list
end

--Check whether the path is existed in the path stack
function isExistedInPathStack(path_T, obj_T)
	local pathStr = obj_T[1]
	
	for j,pathElem in pairs(path_T) do		
		if pathStr==pathElem[1] then
			return true
		end
	end
	
	return false
end

--Check the multi exception for path
function pathFormatInFactory(pathStr)
	local result = pathStr
	local startIndex, endIndex, extendName = string.find(pathStr, "%.([^.]+)$")
	if type(tonumber(extendName)) == "number" then
		result = string.sub(pathStr, 1, startIndex) .. "{i}"		
	end
	return result
end

--Remove the factory exception data from stack
function removeExceptionData(stackFiltered)
	table.sort(stackFiltered, function(x, y) return x > y end)
	for i,obj_T in pairs(stackFiltered) do		
		local removeStack_T = table.remove(stack, obj_T)
	end
end

--Handle the factory exception list
function isInExceptionList(set)
	local pathStr = set[1]
	local params_T = set[2]

	for j,objElem in pairs(factoryException_T) do
		local isMultiException = string.find(objElem[1], "{i}")
		if isMultiException ~= nil then
			pathStr = pathFormatInFactory(pathStr)
		end
 		
		if pathStr == objElem[1] then
			local paramStr = objElem[2][1]
			if paramStr == nil then
				return true
			end
			if compareParams(params_T, objElem[2]) then	
				return true
			end				 
		end
	end
	return false
end

--Handle the restore list
function isInRestoreList(set)
	local pathStr = set[1]
	local params_T = set[2]

	for i, elem_T in pairs(restoredParams_T) do
        local pathIdxToPatten = string.gsub(elem_T[1], "%.{i}", "%%.(%%d+)")
        local isPathMatch,_,idx = string.find(pathStr, pathIdxToPatten.."$")
		if nil ~= isPathMatch then
			if compareParams(params_T, elem_T[2]) then
				return true
			end
		end
	end
	return false
end

--Filter the data for factory default, which should not change the ppp session name and should assemble the object which didn't exist in the Device.
function filterDataInFactory()
	local path_T = {}
	local stackFiltered = {}

	for i,obj_T in pairs(stack) do
		--Record the factory exception element.
		if isInExceptionList(obj_T) then
			table.insert(stackFiltered, i)
		end

		--Get all the path together
		if isExistedInPathStack(path_T, obj_T) == false then		
			table.insert(path_T, obj_T)
		end
	end	
	
	--Remove the element from the stack which is in factory exception
	removeExceptionData(stackFiltered)

	--Get the list after assembling the object.
	return assembleObjInFactory(path_T)
end

--Filter the data for configured data, which could not be changed if it not in the restore list.
function filterDataConfigured()
	local restoreList = {}
	local path_T = {}
	local portMappingPath = "Device.NAT.PortMapping.{i}"
	local dhcpPath = "Device.DHCPv4.Server.Pool.{i}.StaticAddress.{i}"
	local dynDnsPath = "Device.NAT.X_TELECOMITALIA_IT_DynamicDNS.{i}"
    
	for i,obj_T in ipairs(stack) do
		local pathStr = string.gsub(obj_T[1], "%.%d+", "%.{i}")
		local params_T = obj_T[2]

		--To check whether it is port mapping, if yes then add its path to the pathStack.
		if (pathStr == portMappingPath or pathStr == dhcpPath or pathStr == dynDnsPath) and isExistedInPathStack(path_T, obj_T) == false then
			table.insert(path_T, obj_T)
		else	
			--If it is in the list of restore, it should be add to the stack of filter
			if isInRestoreList(obj_T) then			
				table.insert(restoreList, obj_T)
			end
		end	
	end

	--Get the list after assembling the object of port mapping and dhcp static address.
	local portMappingAndDhcpAndDynDNSList = assembleObjConfigured(path_T)

	--Get the restore list which should be updated
	stack = {}
	stack = restoreList 

	return portMappingAndDhcpAndDynDNSList 
end

--As readonly params can't be modified in mbus, it's only to filter the PPP session.
function restoreAgInFactory()
	--Delete the DHCPStaticAddress if it existed in the Device.
	deleteObjectByPath()

	local list = filterDataInFactory()
	execRestore()

	if list ~= nil then		
		table.sort(list, function(x, y) return string.lower(x["path"]) < string.lower(y["path"]) end)
		for i,set in pairs(list) do 
			objectCreate(set)
		end
	end

end

--It should be filtered before restore the already configured data.
function restoreAgConfiged()

	local pathObj = "Device.NAT.PortMapping"
	deleteObject(pathObj)	
	
	local list = filterDataConfigured()
	execRestore()
	return list
end

function restoreAgConfigedFilteredData(list)
	--If it is port mapping and dhcp static address, it should be deleted first, and then add the new object.
	if list~=nil then 
		--Delete the StaticAddress and PortMapping if it existed in the Device.


		for i,set in pairs(list) do
		        local pathStr = set["path"]
		        local param_T = set["param"]
			objectCreate(set)
		end
	end	
end

--Query from Device to check whether it is AG in factory or already configured
function isAgInFactory()
	local flag = true
	local pathStr = "Device.ManagementServer"
	local data, error = mbus.getParameters{path=pathStr, param="X_TELECOMITALIA_IT_ServiceRealm", datamodel="second"}
	if data[pathStr] ~= nil then
		if data[pathStr][1].param["X_TELECOMITALIA_IT_ServiceRealm"] ~= "alicenewborn.mgmt" then
			flag = false
		end
	end

	return flag
end

--update the data of the AGconfig.xml to Device
function updateParams()	
	--disable the dhcp pool before updating
	setDHCPServer("0")

	--set the operation flag of ip changing before updating.
	ipChangeSet("1")

	local list
	local factoryFlag = isAgInFactory()
	if factoryFlag then
		list = restoreAgInFactory()
	else
		list = restoreAgConfiged()
	end
	sleep(5)
	
	--set the operation flag of ip changing after updating.
        ipChangeSet("0")		

	--update the state of dhcp pool after updating.
	--setDHCPServerState(dhcpServerState)
	setDHCPServer("1")

	restoreAgConfigedFilteredData(list)	

        --update the state of media server after updating.
        setMediaServerState()

        --update the wifi and wifi guest allowed mac.
        setWifiAllowMac()

	--Add the dhcp lease for linux service such as 192.168.1.254
	if isLanConfigChanged == "true" then
		addDhcpLease()
	end
end

--Add the dhcp lease for Linux service.
function addDhcpLease()
	local dhcpPoolPath = "DHCP.Server.Pool.1"
	local dhcpLeasePath= "DHCP.Server.Lease"
	local LMAC, gateWayIp, dhcpIpEnd

	local reply1, error1 = mbus.getParameters{ path = "ENV", param = "Value", filter = "(== Name _LMACADDR)" }
	if (reply1["ENV"][1]~=nil) and (reply1["ENV"][1].param~=nil) then
		LMAC=reply1["ENV"][1].param["Value"]
		-- env format is 02-90-D0-4E-F7-81, must change to 02:90:d0:4e:f7:81
		LMAC=tostring(LMAC)
		LMAC=string.gsub(LMAC,"-",":")
		LMAC=string.lower(LMAC)
	end

	local reply2, error2 = mbus.getParameters{ path = dhcpLeasePath, param = "MACAddress", filter = "(== MACAddress " .. LMAC .. ")" }
        if reply2[dhcpLeasePath][1]~=nil then
		local leasePathStr = reply2[dhcpLeasePath][1].path
		local reply, error = mbus.modify(
                                function()
                                        local reply1, error1 = mbus.deleteObjects{path=leasePathStr}
                                end)	
        end

	local reply3, error3 = mbus.getParameters{ path = dhcpPoolPath, param = {"Gateway", "MaxAddress"} }
	if (reply3[dhcpPoolPath][1]~=nil) and (reply3[dhcpPoolPath][1].param~=nil) then
		gateWayIp = reply3[dhcpPoolPath][1].param["Gateway"]
		dhcpIpEnd = reply3[dhcpPoolPath][1].param["MaxAddress"] 
	end

	local reply, error = mbus.modify(
	function()
		if (LMAC~=nil) then
			local reply2, error2 = mbus.addObjects{ path = dhcpLeasePath,
								param = { ClientID = LMAC,
									IPAddress = dhcpIpEnd,
									MACAddress = LMAC,
									DHCPServerPool = dhcpPoolPath ,
									LeaseTime = "0",
									ExpirationTime = "0",
									Gateway = gateWayIp,
									Allocation = "manual" } }
		end
	end)		

end

--Get the detail path from the path stack.like "InternetGatewayDevice.LANDevice.1.LANEthernetInterfaceConfig.1.Stats"
local function getPathFromTop(pathStack)
	local pathStr = ""
	for i,v in pairs(pathStack) do
		pathStr = pathStr .. "." .. v
	end
	return string.sub(pathStr, 2, string.len(pathStr))
end

--Insert each of the param to the table like : "{path, {paramName, ParamValue}}"
local function setEachParamToObjStack(pathStr, paramName, paramValue)

	local paramStack={}
	table.insert(paramStack, paramName)
	table.insert(paramStack, paramValue)
	table.insert(stack,{pathStr, paramStack})
	
end

--Parse the xargs "id=n", and return the multiobj's index
local function parseArgs(s)
	local arg = {}
	string.gsub(s, "(%w+)=([\"'])(.-)%2", function (w, _, a)
		arg[w] = a
	end)
  	return arg["id"]
end

--Match the partent path to the pathStr
local function matchParentPath(pathStr, pathParentStr)

	if pathParentStr==nil then
		return false
	end
	
	local search = string.find(pathStr, tostring(pathParentStr))
	if search~=nil then	
		return true
	end

	return false
end

--Get the path sequence if it is existed in the pathList_T
local function getPathSequenceNum(pathStr, oldPathStr)
	local pathSequenceNum
	local pathStrWithoutNum = string.gsub(pathStr, ".%d+", "")
	for i, pathElem in pairs(pathList_T) do			
			
		if pathStrWithoutNum == pathElem[1] then				
			local ext, pos = getExtendName(pathStr)
			if type(tonumber(ext)) == "number" and tonumber(ext)>3 then					
				if pathStr~=oldPathStr then							
					pathElem[2] = pathElem[2] + 1
				end
				pathSequenceNum = pathElem[2]
				return pathSequenceNum					
			end				
		end				
	end
	return false
end

--Check whether it is wan device.
local function isWanConnectionDevice(pathStrWithoutNum)
	local pos = string.find(pathStrWithoutNum, "InternetGatewayDevice.WANDevice.WANConnectionDevice")
	if pos ~= nil then
		return true
	end
	return false
end

--Restruct the stack in order to deal with other vendors xml.
local function restructStack()
	local oldPathStr
	local newPathStr
	local oldPathParentStr
	local newPathParentStr
	local lastOldPathParentStr
	local lastNewPathParentStr

	for i, obj_T in pairs(stack) do
		local pathStr = obj_T[1]
		local pathStrWithoutNum = string.gsub(pathStr, ".%d+", "")
			
		if isWanConnectionDevice(pathStrWithoutNum) then
			local pathSequenceNum = getPathSequenceNum(pathStr, oldPathStr)
			if pathSequenceNum ~= false then
				oldPathStr = pathStr
				local ext, pos = getExtendName(pathStr)			
				newPathStr = string.sub(pathStr, 1, pos) .. tostring(pathSequenceNum)
				obj_T[1] = newPathStr			
			
				if pathStrWithoutNum == pathList_T[3][1] then
					lastOldPathParentStr = oldPathStr
					lastNewPathParentStr = newPathStr
				end

				if pathStrWithoutNum == pathList_T[1][1] or pathStrWithoutNum == pathList_T[2][1] then					
					oldPathParentStr = oldPathStr
					newPathParentStr = newPathStr
				end
			end
	
			if matchParentPath(pathStr, oldPathParentStr) then
				obj_T[1] = string.gsub(pathStr, oldPathParentStr, newPathParentStr)
			end
	
			if matchParentPath(pathStr, lastOldPathParentStr) then
				pathStr = obj_T[1]
				obj_T[1] = string.gsub(pathStr, lastOldPathParentStr, lastNewPathParentStr)
			end
		end
	end
	
end

function isOtherVendor(pathStr)
	local pathStrWithoutNum = string.gsub(pathStr, ".%d+", "")
					
	if pathStrWithoutNum == pathList_T[3][1] then
		local ext, pos = getExtendName(pathStr)
		if tonumber(ext)>3 then
			return true
		end
	end
	return false
end

--Parse the AGconfig.xml to table as the type : "{path, {paramName, ParamValue}}"		
local function parseXml(s)

    local srcfile = string.sub(s, 271)
    s = "<Device>" .. srcfile
	local ni,c,label,xarg, empty
	local i, j = 1, 1		
	local top = {}
	--local otherVendorFlag = false

	while true do

		ni,j,c,label,xarg, empty = string.find(s, "<(%/?)([%w_:]+)(.-)(%/?)>", i)
		
		if not ni then break end	
		
		if empty == "/" then	-- empty element tag
			local pathStr = getPathFromTop(top)
            if label~="FXONumber" and label~="WEPKeyInAtomic" then
			    setEachParamToObjStack(pathStr, label, "")
            end
		elseif c == "" then	 -- start tag
						
			local pathStart = label
			if xarg ~= "" and label~="FXONumber" and label~="WEPKeyInAtomic" and (parseArgs(xarg)) ~= nil then
				pathStart = pathStart .. "." .. parseArgs(xarg)
			end
			table.insert(top,pathStart)
		else	-- end tag	
									
			local toclose = table.remove(top)
			local text = string.sub(s, i, ni-1)
			text=string.gsub(text, "^%s*", "")

			if text ~= "" then	
				local pathStr = getPathFromTop(top)
                if label=="FXONumber" then
                    fxoTeleNumber = text
                end
                if label=="WEPKeyInAtomic" then
                    wepGuestKey = text
                end
				if pathStr ~= "" and label~="FXONumber" and label~="WEPKeyInAtomic" then
                    if label=="KeyPassphrase" then
                        --add special sign such as "& < >" solution
                        text = string.gsub(text, "&amp;", "&")
                        text = string.gsub(text, "&lt;", "<")
                        text = string.gsub(text, "&gt;", ">")
                        text = string.gsub(text, "&quot;", "\"")
                    end
					setEachParamToObjStack(pathStr, label, text)
				end
			end
					
		end
		i = j+1
	end
	
	--Sort for the stack, if the sequence index is less then 10 it would add "0" to compare with the num which more than 10.
	table.sort(stack, function(x, y) 
		local xx = string.gsub(x[1], "%d+", function(num) if tonumber(num)<10 then num = "0"..num end return num end)
		local yy = string.gsub(y[1], "%d+", function(num) if tonumber(num)<10 then num = "0"..num end return num end)
		return string.lower(xx) < string.lower(yy) end)
end

-- read the whole contents of the xml file from "/tmp/AGConfig.xml"
function readXml()
	local open=io.open
	local src

	local xmlPath="/dl/AGConfig_TI.xml"

	local fh = open (xmlPath)
	if fh~=nil then
		src = fh:read("*a")
		fh:close()
	end
	return src
end

--Set the dhcp pool disable at the begin of updating and enable the dhcp pool after updating.
function setDHCPServer(state)
    local poolPath = "Device.DHCPv4.Server.Pool.1"
    local natPath = "Device.NAT.InterfaceSetting.2"
    local ipAddrPath = "Device.IP.Interface.3.IPv4Address.1"
    local waitInfoStack = getRestoreWaitStack()
    local IPAddrRes = waitInfoStack["gatewayIpAddress"]
    local subMaskRes = waitInfoStack["subnetMask"]

    local modify = {}
    table.insert(modify, {path=ipAddrPath, param={IPAddress=IPAddrRes, SubnetMask=subMaskRes}, datamodel="second"})
    setMBUS_IGD(modify)

    local dhcpMinAddress = waitInfoStack["dhcpIpInit"]
    local dhcpMaxAddress = waitInfoStack["dhcpIpFinal"]
    local natMinAddress = waitInfoStack["natIpInit"]
    local natMaxAddress = waitInfoStack["natIpFinal"]

    local modify = {}
    table.insert(modify, {path=poolPath, param= {Enable=state, MinAddress=dhcpMinAddress, MaxAddress=dhcpMaxAddress}, datamodel="second"})
    setMBUS_IGD(modify)

    local modify = {}
    table.insert(modify, {
                  path=natPath,
                  param={X_TELECOMITALIA_IT_NATStartIPAddress=natMinAddress,
                         X_TELECOMITALIA_IT_NATEndIPAddress=natMaxAddress},
                  datamodel="second"})
    setMBUS_IGD(modify)
end

--Set the dhcp pool disable at the begin of updating and enable the dhcp pool after updating.
function setDHCPServerState(state)
    local poolPath = "Device.DHCPv4.Server.Pool.1"
    local modify = {}
    table.insert(modify, {path=poolPath, param= {Enable=state}, datamodel="second"})
    setMBUS_IGD(modify)
end

--Set the media server state.
function setMediaServerState()
    local waitInfoStack = getRestoreWaitStack()
    local mediaState = waitInfoStack["upnpMedia"]
    local modify = {}
    table.insert(modify, {path="ContentSharing.UPnPAV", param={Enable=mediaState}})
    table.insert(modify, {path="UPnP", param={Enable=mediaState}})
    if mediaState == "true" then
        table.insert(modify, {path="System", param={UPnP="true"}})
    end
    setMBUS(modify)
end

--Set the param of wifiAllowMac.
function setWifiAllowMac()
    local mac2Path = "Device.WiFi.SSID.1"
    local mac5Path = "Device.WiFi.SSID.2"
    local macGuest2Path = "Device.WiFi.SSID.3"
    local macGuest5Path = "Device.WiFi.SSID.4"
    local waitInfoStack = getRestoreWaitStack()
    local allow2Mac = waitInfoStack["wifiAllowMac"]
    local allow5Mac = waitInfoStack["wifi5AllowMac"]
    local allowGuest2Mac = waitInfoStack["wifiGuestAllowMac"]
    local allowGuest5Mac = waitInfoStack["wifiGuest5AllowMac"]

    --insert each mac address for restored.
    local modify = {}
    if allow2Mac~=nil then
        table.insert(modify, {path=mac2Path, param={X_TELECOMITALIA_IT_AllowedMACAddresses=allow2Mac}, datamodel="second"})
    end
    setMBUS_IGD(modify)

    modify = {}
    if allow5Mac~=nil then
        table.insert(modify, {path=mac5Path, param={X_TELECOMITALIA_IT_AllowedMACAddresses=allow5Mac}, datamodel="second"})
    end
    setMBUS_IGD(modify)

    modify = {}
    if allowGuest2Mac~=nil then
        table.insert(modify, {path=macGuest2Path, param={X_TELECOMITALIA_IT_AllowedMACAddresses=allowGuest2Mac}, datamodel="second"})
    end
    setMBUS_IGD(modify)

    modify = {}
    if allowGuest5Mac~=nil then
        table.insert(modify, {path=macGuest5Path, param={X_TELECOMITALIA_IT_AllowedMACAddresses=allowGuest5Mac}, datamodel="second"})
    end
    setMBUS_IGD(modify)
end

--Set the operation flag of ip changing.
function ipChangeSet(state)
    local path = "TI_STORE.TiUserIntf"
    local modify = {}
    table.insert(modify, {path=path, param= {GUI_SetIP=state}})
    setMBUS(modify)
end

--restore xml 
function restoreXml(isLanChanged, natIpInit, natIpFinal)
	isLanConfigChanged = isLanChanged
	natIpInitDefault = natIpInit
	natIpFinalDefault = natIpFinal
	local xmlContent = readXml()
	local clearXmlBuff = string.gsub(xmlContent, "[\n\t]", "")
	parseXml(clearXmlBuff)
	updateParams()
end

--To check whether it is multi object, if yes then return the name.
function getMultiObjName(path)
	local pathDetail = string.gsub(path, "%.%d+", "")	
	local i, f, objName = string.find (pathDetail, "%.([^.]+)$")
	return objName
end

--Filter the data which couldn't be changed.
function getRestoreWaitStack()
	local restoreWaitStack = {}
	--multi instance 
	restoreWaitStack["PortMapping"] = {}
	restoreWaitStack["StaticAddress"] = {}
	restoreWaitStack["Host"] = {}
	restoreWaitStack["X_TELECOMITALIA_IT_DynamicDNS"] = {}
	restoreWaitStack["X_TELECOMITALIA_IT_UAMap"] = {}
	restoreWaitStack["X_TELECOMITALIA_IT_VoicePortMap"] = {}
    
    for i,obj_T in pairs(stack) do
        local pathStr = obj_T[1]
        local params_T = obj_T[2]

        for j=1,#restoreWait_T do
          local pathIdxToPatten = string.gsub(restoreWait_T[j][1], "%.{i}", "%%.(%%d+)")

          if pathIdxToPatten ~= tostring(restoreWait_T[j][1]) then
            --handle to multi object                
            local findRes,_,idx = string.find(pathStr, pathIdxToPatten.."$")
            local paramNameFromStack = params_T[1]
            local paramNameFromRestore = restoreWait_T[j][2]
            if nil ~= findRes and paramNameFromStack == paramNameFromRestore then
              local key = restoreWait_T[j][3]
              local multiObjName = getMultiObjName(pathStr)

              if table.maxn(restoreWaitStack[multiObjName]) < tonumber(idx) then
                local temp_T = {}
                temp_T[key] = params_T[2]
                table.insert(restoreWaitStack[multiObjName], temp_T)
              else
                restoreWaitStack[multiObjName][tonumber(idx)][key] = params_T[2]
              end
              break
            end
          else --handle to single object
            local path = restoreWait_T[j][1]
            local param = restoreWait_T[j][2]
            local key = restoreWait_T[j][3]
            if pathStr == path and params_T[1] == param then
                restoreWaitStack[key] = params_T[2]
                break
            end
          end  --if multi end
          restoreWaitStack["wepkey"] = wepGuestKey
          restoreWaitStack["fxonumber"] = fxoTeleNumber
        end
    end
	return restoreWaitStack	
end

--Get the restore wait infomation
function getWaitInfo()
	
	local xmlContent = readXml()
	parseXml(xmlContent)
	local waitInfoStack = getRestoreWaitStack()
	return waitInfoStack
end	


function getIPInfo()
	local result={}
	local dhcp, error = mbus.getParameters{path="DHCP.Server", param = {"Enable"}}
	result.dhcpState = dhcp["DHCP.Server"][1].param["Enable"]

	local dhcp, error = mbus.getParameters{path="DHCP.Server.Pool", param = {"MinAddress","MaxAddress","LeaseTime","State"}, filter="(== Name LocalNetwork_default)"}
	if dhcp["DHCP.Server.Pool"][1]~=nil then
		result.enable=dhcp["DHCP.Server.Pool"][1].param["State"]
		result.poolpath=dhcp["DHCP.Server.Pool"][1].path
		result.beginip=dhcp["DHCP.Server.Pool"][1].param["MinAddress"]
		result.endip=dhcp["DHCP.Server.Pool"][1].param["MaxAddress"]
		result.leasetime=dhcp["DHCP.Server.Pool"][1].param["LeaseTime"]
		if result.leasetime=="-1" then
			result.days=0
			result.hours=0
		else
			result.days=result.leasetime/(60*60*24)
			result.hours=result.leasetime/(60*60)-result.days*24
		end
	end

	local hub, error = mbus.getParameters{ path="IP.Intf",param = "Name", filter="(== Name LocalNetwork)" }
	local ipintf=hub["IP.Intf"][1].path
	local hub, error = mbus.getParameters{path=ipintf..".Addr",param ={"IPAddress","SubnetMask"}, filter="(== Preferred 1)"}
	result.ippath=hub[ipintf..".Addr"][1].path
	result.ipaddress=hub[ipintf..".Addr"][1].param["IPAddress"]
	result.ipmask=hub[ipintf..".Addr"][1].param["SubnetMask"]

	--Get the public ip and submask
	local pubIpIntf, error = mbus.getParameters{path=ipintf..".Addr",param ={"IPAddress","SubnetMask"}, filter="(== Primary 0)"}
	if pubIpIntf[ipintf..".Addr"][1]~=nil then
		result.pubIp = pubIpIntf[ipintf..".Addr"][1].param["IPAddress"]
		result.pubSubmask = pubIpIntf[ipintf..".Addr"][1].param["SubnetMask"]
	end

	local reply, error = mbus.getParameters{ path = ipintf..".Stats", param = {"RxBCPackets", "RxUCPackets", "RxMCPackets", "TxBCPackets", "TxUCPackets", "TxMCPackets"} }	
	result.ethPacketsReceived = reply[ipintf..".Stats"][1].param["RxBCPackets"] + reply[ipintf..".Stats"][1].param["RxUCPackets"] + reply[ipintf..".Stats"][1].param["RxMCPackets"]
	result.ethPacketsSent = reply[ipintf..".Stats"][1].param["TxBCPackets"] + reply[ipintf..".Stats"][1].param["TxUCPackets"] + reply[ipintf..".Stats"][1].param["TxMCPackets"]
	return result
end

bit={data32={}}

for i=1,32 do
    bit.data32[i]=2^(32-i)
end

function    bit:b2d(arg)

    local   nr=0

    for i=1,32 do

        if arg[i] ==1 then

        nr=nr+2^(32-i)

        end

    end

    return  nr

end   --bit:b2d


function bit:d2b(arg)

    local   tr={}

    for i=1,32 do

        if arg >= self.data32[i] then

        tr[i]=1

        arg=arg-self.data32[i]

        else

        tr[i]=0

        end

    end

    return   tr

end   --bit:d2b


function    bit:_and(a,b)

    local   op1=self:d2b(a)

    local   op2=self:d2b(b)

    local   r={}

    

    for i=1,32 do

        if op1[i]==1 and op2[i]==1  then

            r[i]=1

        else

            r[i]=0

        end

    end

    return  self:b2d(r)

    

end --bit:_and

function    bit:_or(a,b)

    local   op1=self:d2b(a)

    local   op2=self:d2b(b)

    local   r={}

    

    for i=1,32 do

        if  op1[i]==1 or   op2[i]==1   then

            r[i]=1

        else

            r[i]=0

        end

    end

    return  self:b2d(r)

end --bit:_or

function    bit:_not(a)

    local   op1=self:d2b(a)

    local   r={}

    for i=1,32 do

        if  op1[i]==1   then

            r[i]=0

        else

            r[i]=1

        end

    end

    return  self:b2d(r)

end --bit:_not



-- convert ip address to binary number
function ip2long(ip)
    local _,_,a,b,c,d =string.find(tostring(ip),"(%d+).(%d+).(%d+).(%d+)")
    return tonumber(a)*16777216+tonumber(b)*65536+tonumber(c)*256+tonumber(d)
end

-- convert binary number of ip address to xxx.xxx.xxx.xxx fromat
function long2ip(ipnumber)
    local temp1, temp2, seg1, seg2, seg3, seg4
    temp1= ipnumber%(256*256*256)
    seg1= (ipnumber-temp1)/(256*256*256)
    temp2= temp1%(256*256)
    seg2=(temp1-temp2)/(256*256)
    temp1= temp2%256
    seg3= (temp2-temp1)/256
    seg4= temp1
    return seg1.."."..seg2.."."..seg3.."."..seg4
end

-- return true when ip is in start and end
function inRange(ip, start, endip)
   if ip2long(ip)>=ip2long(start) and ip2long(ip)<=ip2long(endip) then
      return true 
   else
      return false
   end
end

--return the nat range from the ip and net mask
function natRange(ip, netmask)
	
	local ipLong=ip2long(ip)
	local maskLong=ip2long(netmask)

	local startip= bit:_and(ipLong,maskLong) + 1
	local endip = bit:_or(ipLong , bit:_not(maskLong)) - 1
	if ipLong == startip then startip=startip+1 end
	if ipLong == endip then endip=endip-1 end

	local beginip=long2ip(startip)
	local lastip=long2ip(endip)

	return beginip, lastip
end






-----------------------------------------
--test code for setMbus and setMbus_IGD--
-----------------------------------------
--local modify={}
--table.insert(modify, {path="PPP.Intf.1", param={NATExcludedInternalIPAddress="192.168.100.58"}})
--setMBUS(modify)

--local modify2={}
--table.insert(modify2, {path="InternetGatewayDevice.ManagementServer", param={ManageableDeviceNotificationLimit="22"}})
--setMBUS_IGD(modify2)


-----------------------------------------
--main part------------------------------
-----------------------------------------
--tprint("@@@script: start to load kry fiel by LUA script");

local waitInfo_T = getWaitInfo()
function isIpChanged()
	local ipInfo = getIPInfo()
	local ipAddr = ipInfo.ipaddress
	local ipMask = ipInfo.ipmask
	local dhcpIpBegin = ipInfo.beginip
	local dhcpIpEnd = ipInfo.endip
	if ipAddr ~= tostring(waitInfo_T["gatewayIpAddress"]) or ipMask ~= tostring(waitInfo_T["subnetMask"]) or dhcpIpBegin ~= tostring(waitInfo_T["dhcpIpInit"]) or dhcpIpEnd ~= tostring(waitInfo_T["dhcpIpFinal"]) then
		return true
	end
	return false
end

isLanConfigChanged = isIpChanged() 
--tprint("@@@ isLanCongigChanged value is :")
--tprint(isLanConfigChanged)

local natIpInitDefault, natIpFinalDefault = natRange(waitInfo_T["gatewayIpAddress"], waitInfo_T["subnetMask"])
--tprint("@@@ natIpInitDefault value is :")
--tprint(natIpInitDefault)
--tprint("@@@ natIpFinalDefault  value is :")
--tprint(natIpFinalDefault)

local xmlContent = readXml()
parseXml(xmlContent)
updateParams()
--phyChangeSetting()

-----------------------------------------
--test code for setMbus and setMbus_IGD--
-----------------------------------------
--local modify={}
--table.insert(modify, {path="PPP.Intf", param={Enable="false"}})
--setMBUS(modify)
--sleep(100000) 
--modify={}
--table.insert(modify, {path="PPP.Intf", param={Enable="true"}})
--setMBUS(modify)

--tprint("@@@script: End of  load kry fiel by LUA script");

function  DoM4toM4IMSUpgrade_common()
   print("Do the M4 common part ");
   local replys, errors
   local reply, err
   local pcall_rep, pcall_err

      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice.NumberTranslation", param={Globalnumbpostprocess="0"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice", param={CountryCode="0", DelayedDisconnect= "0",DelayedDisconnectTimer="0"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice.Fax", param={VBDcodec="G711A",Transport="t38"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice.SIP", param={Privacy="ignore",PRACK="when_supported",}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice.Services.Service.bargein",param={Provisioned="0"},flags = "KEYPATH"}end)end)


      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.addObjects{path="Voice.numbtranslAC", param={level="1",areacode="+39", action= "hideareacode",delete="0",executeprefdel="insideareacode"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.addObjects{path="Voice.numbtranslAC", param={level="2",areacode="+", action="showareacode",prefix="00",delete="1", executeprefdel="insideareacode"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.deleteObjects{path="Voice.SIP.Responsemap.181",flags = "KEYPATH"}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.deleteObjects{path="Voice.SIP.Responsemap.488",flags = "KEYPATH"}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.addObjects{path="Voice.SIP.Responsemap", param={Responsecode="600",Tone="busy",Textmessage=""},flags = "KEYPATH"}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.addObjects{path="Voice.SIP.Responsemap", param={Responsecode="603",Tone="busy",Textmessage=""},flags = "KEYPATH"}end)end)


      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="DeviceConfig", param={UpgradeStsFileName="active/common.sts", UpgradeStsLoad="1"}}end)end)

   -- CPE_P00115550: set AdminPassword to Admin when not present
   reply, err =  mbus.getParameters{ path = "TI_STORE.TiUserIntf", param = "AdminPassword" }
   if not err then
      local AdminPassword = reply["TI_STORE.TiUserIntf"][1].param["AdminPassword"]
      if tostring(AdminPassword) == "" then
         replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="TI_STORE.TiUserIntf", param={AdminPassword="Admin"}}end)end)
      end
   end

   reply,err = mbus.getParameters{path ="ENV",param = "Value",filter = "(== Name ".. "IsFXONum" ..")" }
   replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(
       function()
          if reply["ENV"][1] == nil or reply["ENV"][1].param == nil then
               mbus.addObjects{ path = "ENV",param = {Name = "IsFXONum",Value = "Linea Fissa"},flags = "KEYPATH"}
          end
       end)end)
end
function  DoM4toM4IMSUpgrade_SIP_GW()
   print("Do the M4 SIP_GW part ");
   local replys, errors
   local reply, err
   local pcall_rep, pcall_err

      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice.CAC", param={MaxPortsPerProfile="all"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice.SIP", param={TelURI="0", PhoneContext= "+39"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer", param={MaxMapsPerExtua="all",StickyOutbProxy="1"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice.Services.SOC.map", param={SOC="ignore"},filter="(== function Establish3Party)"}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundRegistrar.1", param={RegPort="5060"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundRegistrar.2", param={RegPort="5060"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundRegistrar.3", param={RegPort="5060"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundRegistrar.4", param={RegPort="5060"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundProxy.1", param={ProxyPort="0"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundProxy.2", param={ProxyPort="0"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundProxy.3", param={ProxyPort="0"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundProxy.4", param={ProxyPort="0"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer", param={ExtraReregistrations ="1"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundRegistrar.1", param={RegServer="telecomitalia.it"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundRegistrar.2", param={RegServer="telecomitalia.it"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundRegistrar.3", param={RegServer="telecomitalia.it"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="SIPServer.OutboundRegistrar.4", param={RegServer="telecomitalia.it"}}end)end)
end
function  DoM4toM4IMSUpgrade_Virtual_PBX()
   print("Do the M4 Virtual_PBX part ");
   local replys, errors
   local reply, err
   local pcall_rep, pcall_err

      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice.SIP", param={TelURI="0", PhoneContext= "+39"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Voice.Services.Service.transfer", param={Status="1"},flags = "KEYPATH"}end)end)
end



function  DoM4IMStoM5Upgrade_common()
   print("Do the M5 common part ");
   local replys, errors
   local reply, err
   local pcall_rep, pcall_err

      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="DeviceConfig", param={UpgradeStsFileName="active/M5common.sts", UpgradeStsLoad="1"}}end)end)
      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="PPP.Intf.2", param={Enable="1"}}end)end)

   -- Fix for not able to login to GUI after upgrade from M4 to M5
   -- Solution is to update mlpuser parameters using the configured password value
   reply, err =  mbus.getParameters{ path = "TI_STORE.TiUserIntf", param = "AdminPassword" }
   if not err then
      local AdminPassword = reply["TI_STORE.TiUserIntf"][1].param["AdminPassword"]
      if tostring(AdminPassword) == "" then
         print ("admin password check")
      else
         replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="Users.User.admin", param={Password=AdminPassword},flags = "KEYPATH"}end)end)  
      end
   end

end


function MakeIntuaMappingBidrectional()
	
	-- Intua to Extua mapping
	local replyMaps, err =  mbus.getParameters{ path = "SIPServer.InternalUAMap", param = {"InternalUA","ExternalUA"}}
	if (replyMaps["SIPServer.InternalUAMap"][1]) == nil then
		print("MakeIntuaMappingBidrectional no InternalUAMap found");
	else
		local replys, errors = mbus.modify(
		function()
			for j,k in pairs(replyMaps["SIPServer.InternalUAMap"]) do
				local ValInternalUA  = k.param["InternalUA"]
				local ValExternalUA  = k.param["ExternalUA"]
				
				local reply1, err1 =  mbus.getParameters{ path = "SIPServer.ExternalUAMap", param = {"InternalUA","ExternalUA"},  filter = "(and(== InternalUA "..tostring(ValInternalUA)..")  (== ExternalUA "..tostring(ValExternalUA).."))" }
				
				if (reply1["SIPServer.ExternalUAMap"][1]) == nil then

					local reply, error = mbus.addObjects{ path="SIPServer.ExternalUAMap", param = {InternalUA = ValInternalUA,ExternalUA=ValExternalUA} }					
				end	
			end 
		end)
	end
	
	--Extua to Intua mapping
	local replyMapsExtua,errormap =  mbus.getParameters{ path = "SIPServer.ExternalUAMap", param = {"InternalUA","ExternalUA"}}
	if (replyMapsExtua["SIPServer.ExternalUAMap"][1]) == nil then
		print("MakeIntuaMappingBidirectional no ExternalUAMap found");
	else
		local replys, errors = mbus.modify(function()
			for l,m in pairs(replyMapsExtua["SIPServer.ExternalUAMap"]) do
				local ValInternalUA  = m.param["InternalUA"]
				local ValExternalUA  = m.param["ExternalUA"]

				local reply1, err1 =  mbus.getParameters{ path = "SIPServer.InternalUAMap", param = {"InternalUA","ExternalUA"},  filter = "(and(== InternalUA "..tostring(ValInternalUA)..")  (== ExternalUA "..tostring(ValExternalUA).."))" }

				if (reply1["SIPServer.InternalUAMap"][1]) == nil then

					local reply, error = mbus.addObjects{ path="SIPServer.InternalUAMap", param = {InternalUA = ValInternalUA,ExternalUA=ValExternalUA} }
				end	
			end 
		end)
	end
end

function WriteVoiceUamapToIntuas()
   print("WriteVoiceUamapToIntuas");

end

function DoM4IMStoM5Upgrade_SIP_GW()
   print("M5 SIP_GW part ");
   local replys, errors
   local reply, err
   local pcall_rep, pcall_err

      replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="DeviceConfig", param={UpgradeStsFileName="active/M5SIPGW.sts", UpgradeStsLoad="1"}}end)end)

   -- increase directory number intua 2 to 10 and make bidirectional
   MakeIntuaMappingBidrectional()
   -- write the voice uamap to the sipserver intua (will write intua 1 and 12 to 17)
   WriteVoiceUamapToIntuas()
end

function DoM4IMStoM5Upgrade_Virtual_PBX()
   print("Do The M5 Virtual_PBX part");
   local replys, errors
   local reply, err
   local pcall_rep, pcall_err

 replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(function()reply, err = mbus.setParameters{path="DeviceConfig", param={UpgradeStsFileName="active/M5VPBX.sts", UpgradeStsLoad="1"}}end)end)

end

function DoUpgrade(argv)
   local pcall_rep, pcall_err

 -- 1) GET SOME PARAMETERS to determine which upgrade
 --    get them all now before changing anything

   -- 1.1) Determine IMS upgrade or not
   local ExtraReregistrations
   local reply, err =  mbus.getParameters{ path = "SIPServer", param = "ExtraReregistrations" }
   if err then
      ExtraReregistrations = "Not obtained so M4 IMS to D5"
   else
      ExtraReregistrations = reply["SIPServer"][1].param["ExtraReregistrations"]
   end
   print("DoUpgrade ExtraReregistrations: "..tostring(ExtraReregistrations))

   -- 1.2) Determine D2 upgrade or not
   local voiceServiceType
   reply, err =  mbus.getParameters{ path = "SIPServer", param = "VoIPServiceType" }
   if err then
      voiceServiceType = "Not obtained so D2 to D4"
   else
      voiceServiceType = reply["SIPServer"][1].param["VoIPServiceType"]
   end
   print("DoUpgrade voiceServiceType: "..tostring(voiceServiceType))

 -- 2) DO THE NECCESSARY UPGRADES
   -- 2.1) Do from D2 to M4 upgrade when neccessary
   if voiceServiceType ~= "SIP_GW" and voiceServiceType ~= "Virtual_PBX" then
       print("voiceServiceType unassigned so we need D2 to M4 upgrade")
      -- Do day2.sts
      local replys, errors = mbus.modify(function()pcall_rep, pcall_err = pcall(
        function()
           reply, err = mbus.setParameters{path="DeviceConfig", param={UpgradeStsFileName="active/Day2_upgrade.sts", UpgradeStsLoad="1"}}
         end)end)
      if err or errors then
        print("D2 to M4 upgrade failed")
      else
        print("D2 to M4 upgrade done")
      end
   end

   -- 2.2) Do D4 IMS upgrade when neccessary
   if ExtraReregistrations ~= "true" then
       print("ExtraReregistrations not on so we need the M4toM4IMS ")
       -- Do common, SIP_GW and Virtual_PBX part ...
       DoM4toM4IMSUpgrade_common()

       if voiceServiceType ~= "Virtual_PBX" then
          DoM4toM4IMSUpgrade_SIP_GW()
       end
       if voiceServiceType == "Virtual_PBX" then
          DoM4toM4IMSUpgrade_Virtual_PBX()
       end
       print("ExtraReregistrations not on M4toM4IMS done")
   end

   -- 2.3) Do D5 upgrade when neccessary

	print("Do M5 upgrade always")
   -- Do common, SIP_GW and Virtual_PBX part ...
   DoM4IMStoM5Upgrade_common()

   if voiceServiceType ~= "Virtual_PBX" then
       DoM4IMStoM5Upgrade_SIP_GW()
   end
   if voiceServiceType == "Virtual_PBX" then
       DoM4IMStoM5Upgrade_Virtual_PBX()
   end

   -- Delete the unwanted dect traces 
    os.remove("/rw/dl/Gf_UiTrace.log");
    os.remove("/rw/dl/Gf_Trace.log");

   print("upgrade.lua ENDED fine!")
end


local argv = argv
-- Main code
return DoUpgrade(argv)
local ipairs, loadstring, mbus = ipairs, loadstring, mbus
local pairs, pcall, print, string, type = pairs, pcall, print, string, type

local dbgtrc = 1

module('wsd')

--------------------------------------------------------------------------------

function printtype(prefix, t, k)
   local p = prefix
   if k then
      p = p..k..' = '
   end
   if type(t) == 'number' or type(t) == 'string' then
      print(p..t)
   elseif type(t) == 'table' then
      print(p..'{')
      for k,v in pairs(t) do
         printtype(prefix..'  ', v, k)
      end
      print(prefix..'}')
   elseif type(t) == 'nil' then
      print(prefix..'nil')
   else
      print(prefix..'euh?')
   end
end

--------------------------------------------------------------------------------

local function loc_invoke(cmd, type, path, allok) 
   local ok, res, err = false, nil, nil
   local msg = nil

   -- tracing
   if dbgtrc then
      print('*** '..type..'('..path..')')
   end
   -- execute MBus client command
   ok, res, err = pcall(mbus.invoke, cmd)
   -- handle results and errors
   if not ok or err then
      allok = false
      if not ok then
         msg = res
         res = nil
      else 
         msg = 'can not '..type..'('..path..')'
      end
      if dbgtrc then
         print('E - '..msg)
         if res then printtype('    ', res, 'res') end
         if err then printtype('    ', err, 'err') end
      end
   end
   return allok, msg
end

--------------------------------------------------------------------------------

local function loc_process_cfg_cmd(cmdtype, cmdpath, key, name, params) 
   local allok, msg = true, nil
   local fltr, flgs = nil, nil

   -- delete command has no parameters (array instead of hashtable)
   if cmdtype == 'del' then
      name,params = params,nil
   end
   -- process key parameter
   if key then
      if cmdtype == 'add' then
         params[key] = name
      else
         fltr = '(== '..key..' '..name..')'
      end
   end
   -- process dynamic parameter values
   if type(params) == 'table' then
      for k,v in pairs(params) do
         if type(v) == 'function' then
            allok, params[k] = pcall(v, name)
            if not allok then
               return nil, 'could not get value for: '..k
            end
         end
      end
   end
   -- execute MBus client command
   local ccmd = {
      cmd = cmdtype, path = cmdpath, param = params, filter = fltr,
      flags = 'KEYPATH'
   }
   allok, msg = loc_invoke(ccmd, cmdtype, cmdpath..'.'..name, allok)
   return allok, msg
end

--------------------------------------------------------------------------------

local function loc_process_cfg_block(cfg, exit_on_error) 
   local allok, msg = true, nil
   local res, err = nil, nil

   for _,cmdtype in ipairs{'sync','add','del','set'} do
      if cfg[cmdtype] then
         if cmdtype == 'sync' then
            -- if syncing perform a synchronized get for objects
            local ccmd = {
               cmd = 'get', path = cfg.path, flags = { 'KEYPATH', 'SYNC' },
               gettype = 'object'
            }
            allok, msg = loc_invoke(ccmd, cmdtype, cfg.path, allok)
            if not allok and exit_on_error then
               return nil, msg
            end
         else
            for name,params in pairs(cfg[cmdtype]) do
               allok, msg = loc_process_cfg_cmd(cmdtype, cfg.path, cfg.key,
                                                name, params)
               -- try error recovery
               if not allok then
                  if cmdtype == 'add' then
                     -- 1. failed add, try delete and add again
                     loc_process_cfg_cmd('del', cfg.path, cfg.key, nil, name)
                     allok, msg = loc_process_cfg_cmd(cmdtype, cfg.path,
                                                      cfg.key, name, params)
                  end
               end
               -- handle error
               if not allok and exit_on_error then
                  return nil, msg
               end
            end
         end
      end
   end
   if allok then
      return 'All ok'
   else
      return nil, 'an error occurred'
   end
end

--------------------------------------------------------------------------------

local function loc_process_cfg(cfg, exit_on_error)
   local allok = true
   local pok, ok, msg = true, true, ''

   for _,block in ipairs(cfg) do
      pok, ok, msg = pcall(mbus.modify,
                           function ()
                              return loc_process_cfg_block(block, exit_on_error)
                           end)
      if not pok or not ok then
         allok = false
         if not pok then
            msg = ok
         end
         if dbgtrc and msg then
            print('E - '..msg)
         end
         if exit_on_error then
            return nil, msg
         end
      end
   end
   if allok then
         return 'All ok'
   else
      return nil, 'an error occurred'
   end
end

--------------------------------------------------------------------------------

function entry_exit(argv, entry_cfg, exit_cfg)
   local cfg, exit_on_error = nil, false

   if argv[1] == 'Entry' then
      cfg, exit_on_error  = entry_cfg, true
   elseif argv[1] == 'Exit' then
      cfg, exit_on_error = exit_cfg, false
   else
      return 'No action specified'
   end
   if cfg then
      return loc_process_cfg(cfg, exit_on_error)
   end
   return 'All Ok'              -- no error
end
config autoload=enabled
debug traceconfig level=0
debug commconfig pong-to=1500
.snd     R&     @   wuz{ttvxuryytv{ywzywz{{~zz}}{wv||}|w|~{x~}y|~x|z{|~~|zuv{}~{zzz|~}z|~~}|||{yzzzz{|~}~~~~~~~~~~~~~~~~}}~~~~~}~~|}}}}~}}~}}}}}~}}~~~~~~~~~~~~~~~~~~~~}}}}}||}}|~}~~~}~}~}}~~~~~~~}}~}~~~~~~~~~~~~~~}~~}~~~}~~~~~~}{{~}}z}~}}~}{~}}~~~}~|}~|~|z|~|~~~}|{~zy||z}~|zz}}}~{}~}z}xz}}~}~}xux|zsw~~yrs{|xz~vw~urz}|~vv}~{v{{wxwtu~|~~~~{rruwvmlvytzyrormx}z}vkwzrmysw}zy~wxppuxylzw{ldj}egmtwhopjts~rpyy~m~t}wged^e|hgjdlt~rnkt}x}g]gd^mik{wgll^lzu~k|zrtmgmpgp{woo}cgymplx|gdyjdho~sopz}{ryrqwhh{u^_yoivyxy{|}plkpzvzlpsnmdvnqrjqp[\lm^ac_pw_`}e^]g{yyn`cn{{zwyzsma\[]nuc\Z`zgVMGB@BEECCIQaPLU\J9/-,,3@/:U]B<FJ3*&$-4(/XV][C2(  9N%$;DWffwfZE:- )$*;;I@T^A6-"%"%50B9H[:0++*.3=6JM4-$(;)LJ57~:,%G.CJ*;[65[<,$I,I@*ES:;s^8- /,O69rP/&-;0c*8>6H~6("r',1A5@{8)%,0F2:8%#A*+5O03R:"5l?+SB.8k,!/3y1-H;@?/e;)2b&!(BF0LH*,l*26J4LL,*N,+
C@6eE)(X('	:;>&*L u
9O1"/4
'	7??%&tH)C;U' ;'5
o=),/	=)'0		B((.

L&'-	
yq ,'
&'-$58ND@OVP1"]:]D\+'1Y:Z+*~2HH>B<)K=#&(_.!%EO* H2<9!1S^<(!@,3,CC?;-&G*zB3?8?T7),N+;LN5/Nd1 8,MBI*9&7)\(,o=@W17(>i*$'/(]N-3*.4+*7h.82&>c*>S06/U={0_W6FR/=F(E@&>j];=8"@9"$NLF=("6*docX9,%3:"$Sl>2+#U."*YGkD:.'"[G*%?OBcH;.*(R.)8d=KTC30-#Jf.08@:vdI9;3'%G^:88C;^ScH>4++) <MCDC<9JJL5.3-!.LSF`<8MJfK887,(!V=F@>wpWvUL@;5.,&4?hxCAZm^MsTF920+  O9]BKnXXuKU}G<92,' -AeOVVSKYRsgKC:2-(!,j?[^]XMDjVcmr\N@92-&#<S:irSCGgeg[}TA<5,'&4I=SGH{of\olME<1,(&7E<XHLg\}zPI>2,)%5C:]LJql^laRB6/,%+D7KTJWu\~hioN?6.+%+A6JXMXiWxdmn}\D:2-('7;8yUU`VoirwkQB:/-('8:9]X^TnusnVH=0-+&.<6Xu]_ZWonNC7/.))4::rdXbpPF:20-*-:;Fd[{lNC931.,/8<Ic^nwsePE<740/.4>?\jdnirxWK@:740017?FgtejkpbRJ?;94442:BDnsjldncXJ><:5553:BE_uvjyu]PF?<:7878>EJooldUNE?>;:;;<@FO`_XPGC@=<=<>BEO[mvd^VMJIDCDACHHMWZjnd_XSOMLLJLMNSWZaim}rlf^][XYXW[[\_`bigfjkgkljmqpwwnmgfhgfiiinmmxyt|}vvvolnljmmmqtv{{|wwuommkjmjkvt~zpqnmonqy~{xtrqqtzwqnlkkjlnns{~yy~y|}}}yxzuuvty|}{wtonnmnqtx}~zwrponoquxz~|zzxxyxxyz{|~~}|{zz{{{}~~~~~}}|{{}~~~~}~~~~~|zyyxwwxyz{~~~||{{||}~~~}}}|}~}~~}~~}~~~}}}~|{||}}}~}}~~~~~}}}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~}~~~~}}}}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~}}~~~~~}}}}}~~}~}}}|}~~|}}{zz{||}|{{|{{}~~~|}||~{{}~~~~~{|}{{}}|}||}}{z{||}~~~}}||z}~||||}|}~||~~~}|}}~|}|}}}~~}}|}|~~~}~~}}}}}}~~~~~~~}}~~~~}}{{|}|}~}||~}{}~~~yt{{ttvxuryytv{ywzywz{{~zz}}{wv||}|w|~{x~}y|~x|z{|~~|zuv{}~{z{z|~|z|}~}{zzzxyyxxyz|}}~~~}~~}}{{~~|{xxvtuttsppqpqttvyzz{}~~~~~~}~~~~~~~~}|||~}~}}~~~~}~~~~}|}|}~~~~||~~~}{|}}~}~~|}~}|}~}~~}}}}~}}~~~~}~~~~~}}}~~}}~~||~}|}}||||||}~}|||{|~|{}|~|}~~~}}}}~}~~~~~~}}~}}}|{zyyxwxwwwwwwwvstvwtrtuusrrrqprvx|}|xtrnnnlnprv|xqligedccdfhikmoswy{|}}{yxvtvwvx{|}|{|||~|{{xvvuuvwxz|~~~~~~~}~}||}{yyyxvwyxxwvvwxwwvuuttttrttrrrrtuuxywxzz}~~}}~}zwuronmkifdb`^]\[ZYYYYZ[]^_^^]\\[[[ZZ]iqd]X^jtsWOngNPZXv{~t[[VNSWOQ\]ZXgORJ>GNGR_Vb\Xe_c~fcmklyoouh^g^dvh`bTYTMSRX]Q`cfXY^|PUhuvLO`oUOV__WYym]^eTjUNWs^vhawhf]Vkc^\dRcei`^bf`RbVOU\n~ZbpeZWm_]]`[|^Sknpgtvfmtumhku]^]jgjb_\XZgz[UZ[YemnYTpYNdeVr\bx{ecge^j]`~lzph~yrd`gmnnsmv}`ZYZSW[U[k90;9,)/932Eu~=/*"+?D:/$%5LnHB4((-n^RD30/(-)<=8/(!!$+>5-'"$#NK7-'"%6OE.'&!(dN4(&  =d?-(#*VS3*%;P?.('<[U4)6?4(0?3)0@3%0G[0%!2WH* )88(-IN+(64%".j;',g5%
	+1

-)			$2O#
			)G5		
.p)&:? 		..
 ;E&'U5 
	.-		5-

12!+\G+ %4F/( (1CD9,# "+3?VD6,(&"  #&*.:Y_B7.+(&&''),07>[R>83/.../049<F]bQF?=;<;<?@HJNZ^|[_\PKOPKNVWT^s_lot]ZspT_fcXcxqrlrmhlyotrz~~mmkyzyksxqs|~||}rqsiekyndkovlj|y}{{uszvjl~^nt`mWVoXsci|wvpxigfdhjgfjry~zzxzxgmiZ`ulhpqmd{_i~pmmzc}_ihlsexzmnj`xZolko}}rvomslw_yfpvnck{paUViY]h\dukoimkcek|l{`fygstkxjidlvoh|p\vdfxln{cnvs}lnqvuonikfglkqvpwlnmedh}{yn`^mgvafsj|zzx}mg~o_lf\a_Z`^XjynvUXWIHJA?A?@HKN]fL?91,*'$&&'+.6G`LD=:97631../..//4<@QylrtaYMA;2--*''&(,.7G[KJGBB=:70-.+)*(*..7JmZMHGDEE?=9200,+*'*-.8G^_NHFBB?:94./.**(',,/=KrWLFEDC@=:501.++((,+/=H]MFDA@=961./,+,*+02<NewYWM=74,$#% ')-I[`RC6*#'&6K;2($'(RJ3,$$ 2c:-(")MSK6+#4G^[@0*#;<T<1)#95K81)'-/X:1,-*[m>3.!*)Fb?3- ()SN:2($%0g?5,  %*TpD7-!$)Nl@6+"#.\W<1&"&?rvC8+!!"#0[I9."!"#-TJ:."!##-ZI;."###/\E:,"#%$6ofB7)"#%&@mX?3'#"#%*VK=.%$%%/gwH;,$$&&9[B6)## &(GS?4'#""'*OT@4(#"!')KWB5)""''@gD9,""&&4T<3' !((FdG8," $&-[@3*'&3dA4+''1xD4- #)+b93)*(1U72'*+1;3/ 0)[hd86- 3,LjB50(!':.aeG:4,#!"97EZXhjL=8/'!!!%-C>{ccj^fP>:0)""# ' .KGhfg\vpRG>1,##& )#-JW[]`vmWI92*"'$$))5Mf_YckhdI>5*#'%$)+7Jzm_T\q{QC8,$'& $(,6Ajoe]b}jK=0('(#$')0;Nqmh^`kWA5+'(%#%'-6Ag_^^_hgJ:.('&#%'*0:Qyca]Y[iR>3*'(&%')-6Ca]YTQVl`G9.))(%&(+1;Oi\YRPU\m{N>4,))(')*.7CmcZRKECEJOR[wjgrnn~^WMD=<<===@FLVe]G?=:6579:;>HQZgyWNIA>=;;:=ABBK_nhWLC@B>===?CGIQltohqSILHGHDDHJJLZjc\RPOOJGKNNOV[eryk`]ROOLKKMPOR\ek{v]UUOJKNMLPWW\mv`YSMJHGIIHNTUaeUNIGB>?BAAENU\cXK?<<75875;BDM{^B=;3//.-//4;=L`G=73.+,-+.48=M\OH;30.,,-./5<H][H?5.*(%"$()-:Lp?5.%,25O=3&",,JG9,(/6N7,&L^JHWo5+""&QV@6/9a0% 8@NU52>NIfD2+& *LpI53E=-('$ 1}R=9LjC/(&&$.OFQMDMmH<2,)&#,oH<FSXjL=5/,)&#A97BoO9.+++&-O8=A/+*'8j|YE.)&"*N;F[e^6*#(Tj;8^WF_p?/& $>p;5JBHL9-%-iA4:RCQY@4*""6c=9SNI]mI;.&*GSF]ORjM</&);j~]XmjcweM</&!(1;>GbuT?2( "$()*1A^H:/&"*9p[MC;3+$!&/Gz\K?6,# &0K[H=3*!!'4XcJ>6-%#-CSA90(!*<pL=5-&"-GlI;4-%%2TV@7.(",FU?5.'#.JT>4-&%1UT;-& $,3//EoB=EQW:0,%,[Ds]?;Ii=*$-IPD9FORiA-& -:.=?,& .3.Ks6)$bK,6];,%PQ-:{Mp:,$?/M^Y<.&>xF/OgC8*CKm6/O=1$WoHb_/2f:0+![K@h4?F.+')C9DD14+)$825g9@>--*!)3@UCh6++'%,8ecA/-)#$,9[A81,%!)/=TbV>0,' ):?I[I7*&" *+'-7BPM9//0/13569::DS[imL@<;=??;7:98>Tu^eelLGLMOILQGDJQT[judNMHEGEMQLNST`nrlrjPRPNTNUicchmrsx}v\syalr|]ck\a]dQjmRg`KMxhl|zz||`VlgZ{yldm}fr{pz|mh|emoiz}zpjfzxyglokftslwtgrcwn{nmuohpvhowqroylwkknnnhl|npsjq~i}tnthgngnui`~hznxyktp~vyt||~{wu~qunpq}eytogrxizo{ypprsnzow}sx}~}j}vq~kn~v}}~mwrrxrwsusnj~nmn}ph~gjtoyuhpdkt|wkkx^h}eq|qzdby^dwda|smnbmkltkfzpg}omo}x{vhnuyoxrslny{u{mklcyrjyzv{~sghscsjimknoda[zxpqnw|xjl~jygyjl{s|ja}xww|{|vufnps~o{smkq{xjfnjmjp~njoym|zjbinfgmkfbp}prz{sknu_lpvv^^~rrlp~j`\ihuhnubej^{xltvsk~mnio|sjfkypknmzsnmqegyjmjzglslt{uwumsvfnth{yp~n{vj_pq^aphgglyp|}maabXX^]][Ziiduuc[]XTXRNNOOPNQVXbymgXJB=9531/../16=MvpE<5,)% %.8Y^PI@:3,& !$,9NdLHKLQq\\YG:.'!"(1=P|I>;>CLaF2& &,.:NuJGDCL~R8,%%$.KYi<2*!'+1{ILE>F_A8-&".-<UMR@<MmG=3*&$ .16oNXD<D\YrT?2,*%!!&44V\QH>;BNO}E90,)%$! /65\ZI<;HIInI<4/+'%!$/.7P>>E>AbUA<6.,*'#'0.5_TLRDAR\\TB=<610/,+161;ILW}dQIC>;865433469<AKY}s\OHA<:74210136;@K\uYKB=951/../15:@K_wYKA<840/...049>IZ[LB<840/...049>IY~[LC=951/...038=GV\NE>:630/../16;ALb`QH@<8520///148=EQmcSJC=:753101247;@JYw^RJD?<976544568;?GO`eYOJE@><:9999:;=?DJQ__`WMOGCC@?>?@?ACFJLU\er]iYPRMKJHHFGGHKILONWY]iixkzZ[`RVXOPVOUQRWVXR^YW^XiZ\{ad{{mik_a\__VYjVVf\_XOQ[WKZ^Mo_[f|ih[W]Z[bY\`^XWXZu\m[tqn|qxjgq{loukmeojdipai~pl[Yed^|dy]YcbkZ\lfmjVzPg^Ziqgr`fnWVr|Vb\ZW_]]}X\taxime`i^su]W]q^Ri^qg~dc\~R\dfjbnklX^]b_klPOGRSoQYVn_QLM}xZ_TPohhY^o]u]l^l`QNZefJKecfyg]]c]qsi\`ls~gf{~phosTz[dVSOegptg]{WzVjjja\ik_xd\gp_]i[y_j\Vwudfxlvk`[`S^k^WagO|\QlRk}lilaNR^wNSwzcieg`d]_o~rriqmxzfd_s\]\zsgffgWcq|_]sVZ]m_hjmgkhybum}{~t]c`dsrszwxyzaci_|tjcU{^zot\iVk^\rlvp~n|mp~scnt`ojy}lmdnn|sl_mlnrxrqogwmpqv}~npi{~z{leq|t}~gmjm__ie~mvm]]smmj|vvqvynccihdx|zpmxinjz{olmpuq|megsbtpornnl}myxo|yt~sv|~||~{zt{}urvzy||}|vu{qooljnqqt{{{{u|~vpnpsu{|||yxspqpptwz||~||}}|}~~~}|yyzz}~{|~}}{yy{|yxwuuuvwuvxwvvxz{{|}}~~~~~|{}~~|{}~~~~~~}{{zy{|{y{{yywxzyxwvxyzyz{z{|||}~~~~||}|}}~~~~~}}~~}~}||}~~|}~~~~~~~~~~~~~~~~~}}~~}~~~~}~}|}~~|}}{zz{||}|{{|{{}~~~|}||~{{}~~~~~{|}{{}}|}||}}{z{||}~~~}}||z}~||||}|}~||~~~}|}}~|}|}}}~~}}|}|~~~}~~}}}}}}~~~~~~~}}~~~~}}{{|}|}~}||~}{}~~}}}}}add name=admin password="" role=PowerUser
add name=off_user password="" role=PowerUser defuser=enabled
add name=Rescue password=ewqfobptdsatvorsfdacsfglkersd role=Upgrade
add name=Install password="" role=Install

[OperatorList]
20404;Vodafone
20408;KPN Mobile
20412;NL Telfort
20416;T-Mobile NL
20420;Orange
20601;Proximus
20610;Mobistar
20620;Base
20810;SFR
20820;Bouyges Telecom
24201;Telenor
26201;T-Mobile
26202;Vodafone
26203;E-plus
26207;O2
23400;Virgin
23410;O2
23415;Vodaphone
23420;3
23430;T-Mobile / Virgin
23433;Orange
23450;Jersey Telecom
23455;Guernsey Telecom
23458;Manx Telecom Pronto
26001;Polkomtel PLUS GSM
26002;ERA GSM
26003;PTK Centertel
53001;Vodaphone
53003;Telecom NZ
53004;Telstra
ifconfig intf=Telecom_Italia translation=enabled
ifconfig intf=ppp_0 translation=disabled
mapadd intf=LocalNetwork type=napt inside_addr=192.168.1.254 protocol=tcp outside_port=139 outside_addr=192.168.1.1 inside_port=139
tmpladd intf=Telecom_Italia type=nat outside_addr=0.0.0.1 inside_addr=127.0.0.1 protocol=icmp outside_port=8 inside_port=8
tmpladd intf=IPTV type=nat inside_addr=192.168.1.2-192.168.1.254 outside_addr=0.0.0.1 
ifconfig intf IPTV translation disabled


tiservmng config ServiceRealm="alicenewborn.mgmt" ManagementConnection="InternetGatewayDevice.WANDevice.DSL.WANConnectionDevice.atm_8_35.WANPPPConnection.Telecom_Italia"
tiusrintf config Profile="" LANOption=res-br ConnectionMode="Bridged" PublicPrimaryDNS="" PublicSecondaryDNS=""  ExtensionsName="BaseEthDECT,Rip_Wi-Fi" Static=off USBPowerCtrl=enabled AdminPassword="admin"
tiwancondev addpppcon Name=Telecom_Italia IdleMngDisconnectTime=0 ReconnectTime=0 NATService=1 NATStartIPAddress=192.168.1.2 NATEndIPAddress=192.168.1.254 NATPersistanceTime=5400 DNSOverrideAllowed=enabled IGDName="Telecom Italia" Conditional=disabled TI_DialOnDemand=disabled TI_Restart=enabled TI_Enable=enabled
tiwancondev addpppcon Name=ppp_0 NATPersistanceTime=300 Conditional enabled
tiwancondev adddslcfg Name=atm_8_35 LANIfMappingEnable=0
tiwancondev adddslcfg Name=atm_8_36 LANIfMappingEnable=1
tivoice config enable=Disabled AlgSIPEnable=false CodecPriority=enabled name="FXS DECT UA" ClearLog=disabled IntfEnable=15
tiipqos config QueuePrecedence1=100 QueuePrecedence2=40 QueuePrecedence3=20
tidhcp config DHCPServerConfigurable=enabled
tilandev addhostmng_ipintf Address=192.168.1.1 Enable=enabled
ticlassification config Name=routing_labels#1 EthernetPriorityCheck=-1 EthernetPriorityExclude=disabled EthernetPriorityMark=-1
ticlassification config Name=routing_labels#2 EthernetPriorityCheck=-1 EthernetPriorityExclude=disabled EthernetPriorityMark=-1
ticlassification config Name=qos_labels#3 EthernetPriorityCheck=-1 EthernetPriorityExclude=disabled EthernetPriorityMark=-1
ticlassification config Name=qos_labels#4 EthernetPriorityCheck=-1 EthernetPriorityExclude=disabled EthernetPriorityMark=-1
ticlassification config Name=rt_default_labels#16 EthernetPriorityCheck=-1 EthernetPriorityExclude=disabled EthernetPriorityMark=-1
ticlassification config Name=rt_default_labels#17 EthernetPriorityCheck=-1 EthernetPriorityExclude=disabled EthernetPriorityMark=-1
ticlassification config Name=qos_default_labels#18 EthernetPriorityCheck=-1 EthernetPriorityExclude=disabled EthernetPriorityMark=-1
ticlassification config Name=qos_default_labels#19 EthernetPriorityCheck=-1 EthernetPriorityExclude=disabled EthernetPriorityMark=-1
ticlassification config Name=qos_default_labels#20 EthernetPriorityCheck=-1 EthernetPriorityExclude=disabled EthernetPriorityMark=-1
tiwlancfg config Name=wlif1 TI_ChannelRefresh=disabled TI_MaximumRetries=0 TI_AutoChannelSelectEnable=enabled TI_AutoChannelRefreshPeriod=86400
tibridgingcfg brconfig bridge=default state=enabled
tibridgingcfg brconfig bridge=video state=enabled
tibridgingcfg brconfig bridge=data state=enabled
tibridgingcfg vlanconfig bridge=default state=enabled name="Default VLAN 1"
tibridgingcfg vlanconfig bridge=video state=enabled name="IPTV VLAN 836"
tibridgingcfg vlanconfig bridge=data state=enabled name="PPPoE VLAN 835"
tibridgingcfg portconfig bridge=default port=ethport1 state=enabled lowerlayers="Device.Ethernet.Interface.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=ethport2 state=enabled lowerlayers="Device.Ethernet.Interface.2" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=ethport3 state=enabled lowerlayers="Device.Ethernet.Interface.3" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=ethport4 state=enabled lowerlayers="Device.Ethernet.Interface.4" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=WLAN state=enabled lowerlayers="Device.WiFi.SSID.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=WLAN2 state=enabled lowerlayers="Device.WiFi.SSID.2" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=ADSL state=enabled lowerlayers="Device.ATM.Link.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=br_video state=enabled lowerlayers="Device.ATM.Link.2" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=vdsl2 state=enabled lowerlayers="Device.PTM.Link.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=bri_ge state=enabled lowerlayers="Device.Ethernet.Interface.5" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=OBC state=enabled lowerlayers="Device.Bridging.Bridge.1.Port.1,Device.Bridging.Bridge.1.Port.2,Device.Bridging.Bridge.1.Port.3,Device.Bridging.Bridge.1.Port.4,Device.Bridging.Bridge.1.Port.5, Device.Bridging.Bridge.1.Port.6,Device.Bridging.Bridge.1.Port.8,Device.Bridging.Bridge.1.Port.9" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=WLAN3 state=enabled lowerlayers="Device.WiFi.SSID.3" frametypes=AdmitAll
tibridgingcfg portconfig bridge=default port=WLAN4 state=enabled lowerlayers="Device.WiFi.SSID.4" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=ethport1 state=enabled lowerlayers="Device.Ethernet.Interface.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=ethport2 state=enabled lowerlayers="Device.Ethernet.Interface.2" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=ethport3 state=enabled lowerlayers="Device.Ethernet.Interface.3" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=ethport4 state=enabled lowerlayers="Device.Ethernet.Interface.4" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=WLAN state=enabled lowerlayers="Device.WiFi.SSID.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=WLAN2 state=enabled lowerlayers="Device.WiFi.SSID.2" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=ADSL state=enabled lowerlayers="Device.ATM.Link.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=br_video state=enabled lowerlayers="Device.ATM.Link.2" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=vdsl2 state=enabled lowerlayers="Device.PTM.Link.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=bri_ge state=enabled lowerlayers="Device.Ethernet.Interface.5" frametypes=AdmitAll
tibridgingcfg portconfig bridge=video port=OBC state=enabled lowerlayers="Device.Bridging.Bridge.2.Port.1,Device.Bridging.Bridge.2.Port.2,Device.Bridging.Bridge.2.Port.3,Device.Bridging.Bridge.2.Port.4,Device.Bridging.Bridge.2.Port.5, Device.Bridging.Bridge.2.Port.6,Device.Bridging.Bridge.2.Port.7" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=ethport1 state=enabled lowerlayers="Device.Ethernet.Interface.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=ethport2 state=enabled lowerlayers="Device.Ethernet.Interface.2" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=ethport3 state=enabled lowerlayers="Device.Ethernet.Interface.3" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=ethport4 state=enabled lowerlayers="Device.Ethernet.Interface.4" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=WLAN state=enabled lowerlayers="Device.WiFi.SSID.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=WLAN2 state=enabled lowerlayers="Device.WiFi.SSID.2" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=ADSL state=enabled lowerlayers="Device.ATM.Link.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=br_video state=enabled lowerlayers="Device.ATM.Link.2" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=vdsl2 state=enabled lowerlayers="Device.PTM.Link.1" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=bri_ge state=enabled lowerlayers="Device.Ethernet.Interface.5" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=OBC state=enabled lowerlayers="Device.Bridging.Bridge.3.Port.1,Device.Bridging.Bridge.3.Port.2,Device.Bridging.Bridge.3.Port.3,Device.Bridging.Bridge.3.Port.4,Device.Bridging.Bridge.3.Port.5,Device.Bridging.Bridge.3.Port.6,Device.Bridging.Bridge.3.Port.7,Device.Bridging.Bridge.3.Port.8,Device.Bridging.Bridge.3.Port.9,Device.Bridging.Bridge.3.Port.11,Device.Bridging.Bridge.3.Port.12" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=WLAN3 state=enabled lowerlayers="Device.WiFi.SSID.3" frametypes=AdmitAll
tibridgingcfg portconfig bridge=data port=WLAN4 state=enabled lowerlayers="Device.WiFi.SSID.4" frametypes=AdmitAll  
tibridgingcfg vlanportconfig bridge=default port=ethport1 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=default port=ethport2 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=default port=ethport3 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=default port=ethport4 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=default port=WLAN state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=default port=WLAN2 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=default port=ADSL state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=default port=br_video state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=default port=vdsl2 state=enabled untagged=disabled
tibridgingcfg vlanportconfig bridge=default port=bri_ge state=enabled untagged=disabled
tibridgingcfg vlanportconfig bridge=default port=OBC state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=video port=ethport1 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=video port=ethport2 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=video port=ethport3 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=video port=ethport4 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=video port=WLAN state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=video port=WLAN2 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=video port=ADSL state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=video port=br_video state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=video port=vdsl2 state=enabled untagged=disabled
tibridgingcfg vlanportconfig bridge=video port=bri_ge state=enabled untagged=disabled
tibridgingcfg vlanportconfig bridge=video port=OBC state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=ethport1 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=ethport2 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=ethport3 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=ethport4 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=WLAN state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=WLAN2 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=ADSL state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=br_video state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=vdsl2 state=enabled untagged=disabled
tibridgingcfg vlanportconfig bridge=data port=bri_ge state=enabled untagged=disabled
tibridgingcfg vlanportconfig bridge=data port=OBC state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=WLAN3 state=enabled untagged=enabled
tibridgingcfg vlanportconfig bridge=data port=WLAN4 state=enabled untagged=enabled
tiqosclassification config DefaultEthernetPriorityMark 0
tiqosclassification ruleconfig Index 1 Order 1 Enable true Alias VLAN837 EthernetPriorityMark 5 VLANIDCheck 837
tiqosclassification ruleconfig Index 2 Order 2 Enable true Alias VLAN836 EthernetPriorityMark 3 VLANIDCheck 836
tiqosclassification ruleconfig Index 3 Order 3 Enable true Alias VLAN835 EthernetPriorityMark 0 VLANIDCheck 835
tisipext_fxo add UserAgentDomain telecomitalia.it UserAgentPort 5060 OutboundProxy "" OutboundProxyPort 0 RegisterExpires 3600

-----BEGIN CERTIFICATE-----
MIID0jCCArqgAwIBAgIBATANBgkqhkiG9w0BAQUFADBmMQswCQYDVQQGEwJJVDEV
MBMGA1UEChMMSS5ULiBUZWxlY29tMSIwIAYDVQQLExlTZXJ2aXppIGRpIGNlcnRp
ZmljYXppb25lMRwwGgYDVQQDExNJLlQuIFRlbGVjb20gVExDIENBMB4XDTA1MDEw
NTE0MzE0NFoXDTE1MDEwNTE0MzAwNVowZjELMAkGA1UEBhMCSVQxFTATBgNVBAoT
DEkuVC4gVGVsZWNvbTEiMCAGA1UECxMZU2Vydml6aSBkaSBjZXJ0aWZpY2F6aW9u
ZTEcMBoGA1UEAxMTSS5ULiBUZWxlY29tIFRMQyBDQTCCASIwDQYJKoZIhvcNAQEB
BQADggEPADCCAQoCggEBALPPuWsvuHMConKJ7o7+1QPYIEEoCYAT+JC2XEgj1lpu
d2k3ePmgD4goJdT50w8TuXVMs09KvUpsLhQ8Ww+kxJaK2XJh0+tUggs0SWRlrTZ1
O3yA4JDlEkf3tu10lrGkDulIhPGPZjKBI641+34oFOifRYJ968tEl6LwTkAWtZbu
9N2Yw34mbMZ7L8JUP3a8bXHNm1v+5isIW3+5sca62M7eyYyYHIrIoi4s7x6WzHMg
kCOLePiol+FckazAsZAxKCac18TxYZvUxYjS7ZUMg1NunbHY/CPAFYzrX3OM6XgM
FR3VnLw0DQsDXMstnkOnZW//IV2yaR3lyyKxlE8p1GECAwEAAaOBijCBhzASBgNV
HRMBAf8ECDAGAQH/AgEAMEIGA1UdIAQ7MDkwNwYGK0wMAQEHMC0wKwYIKwYBBQUH
AgEWH2h0dHBzOi8vd3d3LnRpcGtpLmNvbS9UTENDQS9DUFMwDgYDVR0PAQH/BAQD
AgEGMB0GA1UdDgQWBBQbG9P/eC596drzqK4eEAXG58hp6jANBgkqhkiG9w0BAQUF
AAOCAQEAE43h6JnOi2Ya5jPklkOlfGY8yp20l8deD1sMAFPFnECg/8/PyNzcG7pM
8QIlG20DZcXQt8AQiObUhYNLJKoKIgE9HZ3sUihU9ZqwQ+O+cIlIo23sHVLHqsy8
Rbeh0R9HI2zmzWz58jK7wiZWlPBuCJ49ox+GTTYve3IyHRWL8EIGtQ8UJeFync4W
AUZjpIp72TMtj2QZnfb86W+oB+hZc+JktWVniS4HAJCrE7AH5VTufR+1sFzHSG7w
+NkoBEEI27s9IBuWpebt3MqLzXyYPIxGyf3F6yNTs04F5QXFPTE6UX3m1KbM/XgA
MFzsRMiXW6mf8OvK9pe9LLYWAtH69w==
-----END CERTIFICATE-----
<?xml version="1.0"?>
<defaults xmlns="http://thomson.net/mbus/defaults/">
<tree typename="atomic_root">
<object typename="KDB">
<object typename="system">
<object typename="config">
<object typename="familycom">
<objects typename="handset">
<object key="1">
<value typename="profile">1</value>
</object>
<object key="2">
<value typename="profile">1</value>
</object>
<object key="3">
<value typename="profile">1</value>
</object>
<object key="4">
<value typename="profile">1</value>
</object>
<object key="5">
<value typename="profile">1</value>
</object>
</objects>
</object>
<object typename="wml">
<object typename="debug">
<value typename="manager_debug">n</value>
<value typename="service_debug">n</value>
<value typename="buffer_debug">n</value>
</object>
<object typename="voice">
<objects typename="profile">
<object key="1">
<value typename="line">1</value>
<value typename="nickname">Profile1</value>
</object>
<object key="2">
<value typename="line">1</value>
<value typename="nickname">Profile2</value>
</object>
<object key="3">
<value typename="line">1</value>
<value typename="nickname">Profile3</value>
</object>
<object key="4">
<value typename="line">1</value>
<value typename="nickname">Profile4</value>
</object>
<object key="5">
<value typename="line">1</value>
<value typename="nickname">Profile5</value>
</object>
<object key="6">
<value typename="line">1</value>
<value typename="nickname">Profile6</value>
</object>
<object key="7">
<value typename="line">1</value>
<value typename="nickname">Profile7</value>
</object>
</objects>
<objects typename="line">
<object key="1">
<value typename="color">1</value>
<value typename="name">1</value>
<value typename="number">1</value>
<value typename="ringtone">5</value>
</object>
<object key="2">
<value typename="color">2</value>
<value typename="name">2</value>
<value typename="number">2</value>
<value typename="ringtone">4</value>
</object>
<object key="3">
<value typename="color">3</value>
<value typename="name">3</value>
<value typename="number">3</value>
<value typename="ringtone">3</value>
</object>
<object key="4">
<value typename="color">4</value>
<value typename="name">4</value>
<value typename="number">4</value>
<value typename="ringtone">2</value>
</object>
<object key="5">
<value typename="color">5</value>
<value typename="name">5</value>
<value typename="number">5</value>
<value typename="ringtone">1</value>
</object>
<object key="6">
<value typename="color">3</value>
<value typename="name">6</value>
<value typename="number">6</value>
<value typename="ringtone">4</value>
</object>
<object key="7">
<value typename="color">1</value>
<value typename="name">7</value>
<value typename="number">7</value>
<value typename="ringtone">5</value>
</object>
</objects>
<object typename="voicemail">
<value typename="proxy_name">smpp-vip.anypath.com</value>
<objects typename="line">
<object key="1">
<value typename="vm_pass">3327</value>
<value typename="vm_user">3175873327</value>
</object>
<object key="2">
<value typename="vm_pass">3327</value>
<value typename="vm_user">3175873327</value>
</object>
<object key="3">
<value typename="vm_pass">3327</value>
<value typename="vm_user">3175873327</value>
</object>
<object key="4">
<value typename="vm_pass">3327</value>
<value typename="vm_user">3175873327</value>
</object>
<object key="5">
<value typename="vm_pass">3327</value>
<value typename="vm_user">3175873327</value>
</object>
<object key="6">
<value typename="vm_pass">3327</value>
<value typename="vm_user">3175873327</value>
</object>
<object key="7">
<value typename="vm_pass">3327</value>
<value typename="vm_user">3175873327</value>
</object>
</objects>
</object>
</object>
</object>
</object>
</object>
</object>
</tree>
</defaults>
add name=atm_pvc_8_35 addr=8*35
add name=atm_pvc_8_36 addr=8*36
-----BEGIN CERTIFICATE-----
MIIDYjCCAkoCAQAwDQYJKoZIhvcNAQEEBQAwdzELMAkGA1UEBhMCRlIxFDASBgNV
BAoTC1RlY2huaWNvbG9yMRowGAYDVQQLExFDb25uZWN0ZWQgRGV2aWNlczE2MDQG
A1UEAxQtKioqRFVNTVkqKiogUG9ydGFsIFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9y
aXR5MB4XDTEwMDYyMTA4MTEzM1oXDTMwMDYxNjA4MTEzM1owdzELMAkGA1UEBhMC
RlIxFDASBgNVBAoTC1RlY2huaWNvbG9yMRowGAYDVQQLExFDb25uZWN0ZWQgRGV2
aWNlczE2MDQGA1UEAxQtKioqRFVNTVkqKiogUG9ydGFsIFJvb3QgQ2VydGlmaWNh
dGUgQXV0aG9yaXR5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA41q/
LEAjaldUe6vzjkIv6feCZJ5Qx2z1HGGOJYBvLINzq+FomWcKIR0NxEzlwV1dLrB0
W6b/xN+boDKizOKRRTt9mrrhDqhEk0KiuZD2aNMbTRAyA7DKslXHX7EJ7y918Yc2
TtOQ8g8rBt07YmfJBRZeJv8BUUgbY3Lj927Q3z6ASGyHs0N9bTYhSqQw7bQsd4AK
IFuLd8dvavjfhfQ9KPoz/ttbDCz5MDgFiHmnq62uTfpJUBzpHrnMaSR4d9A+GkDN
alIdoP6/07IKIchywG939rcoJjZA9ETDPjwXqykhHlYHh/HMs5PJ3e2EtbJ1G1QB
ToCFaGtzEa5S+jcgLQIDAQABMA0GCSqGSIb3DQEBBAUAA4IBAQAzf8mew4tSGrhh
GbTLX7TA0aB3aje5al/XJKGfkxKLUlB1Jqy9hUysvRt/H+N8aR5kFXPfInvEzzsS
lC2W53Vpn2+YThFz5M9N68M1qmboKdJX5GBg3MZnv/hkgR+rWTvxonnAZizKFCv4
yshMUmia50F7YSpWH1ImTXnFW0xGE7LrCw+2GwTJwRQwnJJ8yrsnnfAY6WxQQphv
JZ9g++DUb/C759yb1TD8QxWGO8DVB7c1vunFF7jrj5vFzQRNJbaN3olX2e/FGW5w
0t9t+pK7LgJf5SB3Xw4dkUwh6viFnhrkCZiSgKtjgOC94Dm17GPMYOVwRo1Mo61S
uhSKr0lz
-----END CERTIFICATE-----
ifadd intf=Telecom_Italia
ifconfig intf=Telecom_Italia dest=RELAY accomp=enabled format=none dnsmetric=10 idletime=0 restart=enabled echotolerance=4 echo=30 gracefulrestart enabled
ifconfig intf=Telecom_Italia echotolerancetime=150 laddr=0.0.0.0 
rtadd intf Telecom_Italia label modemToACS dst 0.0.0.0/0
ifconfig intf=Telecom_Italia gracefulrestart enabled
ifadd intf=ppp_0
ifconfig intf=ppp_0 dest=RELAY accomp=enabled format=none dnsmetric=10 idletime=0 restart=enabled echotolerance=4 echo=30 gracefulrestart enabled
ifconfig intf=ppp_0 echotolerancetime=150 laddr=0.0.0.0 
ifconfig intf=ppp_0 gracefulrestart enabled 
ifconfig intf Telecom_Italia ipv6 disabled
rtadd intf ppp_0 src 0.0.0.0/0 dst 0.0.0.0/0
[ env.ini ]
set var=CONF_REGION value="tr(0,World)"
set var=CONF_PROVIDER value="tr(1,Basic)"
set var=CONF_DESCRIPTION value="tr(2,Routed Connection.)"
set var=CONF_SERVICE value="tr(3,Routed PPP)"
set var=CONF_DATE value=""
set var=CONF_DATETIME value=0000-00-00T00:00:00
set var=CONF_TPVERSION value="2.0.0"
set var=HOST_SETUP value="auto"
set var=HOST_LANGUAGE value="en"
set var=ATM_addr value="8.35"
set var=ATM_upl value="pppoe"
set var=ST_SYS_USERNAME value="Administrator"
set var=%ST_SYS_PASSWORD value=""
set var=CWMPUSER value=${_OUI}-${_PROD_SERIAL_NBR}
set var=WL0_SSID_PREFIX_CUSTOM value=$_WL0_SSID_PREFIX
set var=WL1_SSID_PREFIX_CUSTOM value=${_WL0_SSID_PREFIX}Com
set var=WL2_SSID_PREFIX_CUSTOM value=${_WL0_SSID_PREFIX}Mob
set var=WL3_SSID_PREFIX_CUSTOM value=${_WL0_SSID_PREFIX}Gst
set var=WL0_SSID value=${WL0_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL1_SSID value=${WL1_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL2_SSID value=${WL2_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL3_SSID value=${WL3_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}

[ wizard.ini ]
' ATM PVC
'--------
def var=ATM type=grp desc="tr(4,Specify the details of the Internet connection. All information should be provided by your ISP.)" alias="tr(5,Routed Internet Connection)"
def var=ATM_addr type=combo grp=ATM alias="VPI/VCI" data="0.32,0.33,0.34,0.35,0.36,0.37,0.38,0.100,1.32,1.33,1.100,8.32,8.35,8.36,8.37,8.48,8.81" desc="tr(6,Choose a VPI/VCI from the list)"
def var=ATM_upl type=radioset grp=ATM req=yes alias="tr(7,Connection Type)" data="pppoa,pppoe" dalias="tr(8,'PPP over ATM (PPPoA)','PPP over Ethernet (PPPoE)')" default="pppoe"
def var=ENABLE_IPV6 type=bool grp=ATM alias="tr(25,IPv6)" data="disabled,enabled" desc="tr(26,Enable IPv6 on this interface)" default=enabled

' PPP Settings
'-------------
def var=PPP type=grp desc="tr(9,Specify the details of your Internet Account. All information should be provided by your ISP.)" alias="tr(10,Internet Account Settings)"
def var=ST_PPP_USER type=string grp=PPP alias="tr(11,User Name)" req=yes desc="tr(12,Enter your Internet connection user name.)"
def var=%ST_PPP_PASSWORD type=passw grp=PPP alias="tr(13,Password)" req=yes desc="tr(14,Enter your Internet connection password.)" max=32
def var=dummy1 type=passwcheck grp=PPP alias="tr(15,Confirm Password)" desc="tr(16,Re-enter your password.)" linkvar=%ST_PPP_PASSWORD max=32
'ST Security
'-----------
def var=ST type=grp desc="tr(17,Specify user name and password to prevent unwanted access to the Technicolor Gateway management interface.)" alias="tr(18,Access Control)"
def var=ST_SYS_USERNAME type=string grp=ST alias="tr(19,User Name)" req=yes desc="tr(20,Enter a user name.)"
def var=%ST_SYS_PASSWORD type=passw grp=ST alias="tr(21,Password)" desc="tr(22,Enter a password.)" max=32
def var=dummy2 type=passwcheck grp=ST alias="tr(23,Confirm Password)" desc="tr(24,Re-enter the password.)" linkvar=%ST_SYS_PASSWORD max=32

[ phone.ini ]
add name=usb_port addr=usb.0.35 logging=disabled
add name=pvc_Internet addr=$ATM_addr

[ ipqos.ini ]
config dest=pvc_Internet state=enabled maxbytes=128

queue config dest=pvc_Internet queue=0 maxbytes=64 hold=2000
queue config dest=pvc_Internet queue=1 ackfiltering=enabled maxpackets=40 maxbytes=100 hold=2000
queue config dest=pvc_Internet queue=2 hold=2000
queue config dest=pvc_Internet queue=3 hold=2000
queue config dest=pvc_Internet queue=4 hold=2000
queue config dest=pvc_Internet queue=5 maxpackets=30 maxbytes=12 hold=2000

[ atm.ini ]
ifadd intf=usbif1 dest=usb_port logging=disabled
ifconfig intf=usbif1 ulp=mac retry=0 logging=disabled
ifattach intf=usbif1 logging=disabled
ifadd intf=atm_Internet
ifconfig intf=atm_Internet dest=pvc_Internet
#if ATM_upl=pppoe
ifconfig intf=atm_Internet ulp=mac encaps=llc
#else
ifconfig intf=atm_Internet ulp=ppp encaps=vcmux
#endif
ifattach intf=atm_Internet

[ eth.ini ]
#if ATM_upl=pppoe
ifadd intf=ethoa_Internet
ifconfig intf=ethoa_Internet dest=atm_Internet
ifattach intf=ethoa_Internet
#endif

[ ppprelay.ini ]
#if ATM_upl=pppoe
ifadd intf=bridge
ifadd intf=ethoa_Internet
#endif

[ ppp.ini ]
ifadd intf=Internet
rtadd intf=Internet dst=0.0.0.0/0 src=0.0.0.0/0 metric=10
#if ATM_upl=pppoe
ifconfig intf=Internet dest=RELAY
#else
ifconfig intf=Internet dest=atm_Internet
#endif
ifconfig intf=Internet user=$ST_PPP_USER password=$%ST_PPP_PASSWORD
ifconfig intf=Internet accomp=enabled format=none dnsmetric=10 idletime=0 restart=enabled
ifconfig intf=Internet ipv4=enabled ipv6=$ENABLE_IPV6 
ifattach intf=Internet

[ ip.ini ]
config forwarding=enabled redirects=enabled netbroadcasts=disabled ttl=64 fraglimit=64 defragmode=enabled addrcheck=dynamic mssclamping=enabled acceleration=enabled
config checkoptions=enabled natloopback=enabled
ifadd intf=LocalNetwork dest=bridge
ifconfig intf=loop symmetric=enabled
ifconfig intf=LocalNetwork mtu=1500 group=lan linksensing=disabled primary=enabled
ifattach intf=LocalNetwork
ipadd intf=LocalNetwork addr=10.0.0.138/24
ipadd intf=LocalNetwork addr=192.168.1.254/24
ipconfig addr=192.168.1.254 preferred=enabled primary=enabled
rtadd dst=255.255.255.255/32 gateway=127.0.0.1
ifconfig intf=Internet mtu=1500 linksensing=enabled group=wan acceptredir=disabled rpfilter=disabled curhoplimit=64 dadtransmits=1 retranstimer=1000 acceptra=enabled autoconf=enabled

[ mlpuser.ini ]
#if $%ST_SYS_PASSWORD=""
add name=$ST_SYS_USERNAME password="" role=Administrator defuser=enabled
#else
add name=$ST_SYS_USERNAME password=$%ST_SYS_PASSWORD role=Administrator defuser=enabled
#endif
add name=tech password=$_PROD_SERIAL_NBR role=TechnicalSupport defremadmin=enabled
config name=tech password=$__SEC_MODEM_ACCESS_CODE

[ language.ini ]
langdef lang=nl
t r="0, Wereld"
t r="1, Basis"
t r="2, Routed-verbinding."
t r="3, Router"
t r="4, Geef de details van de Internetverbinding. Alle informatie wordt door uw Internet-provider verstrekt."
t r="5, Routed-Internetverbinding"
t r="6, Kies een VPI/VCI uit de lijst"
t r="7, Routed-Internetverbinding"
t r="8, 'PPP via ATM (PPPoA)','PPP via Ethernet (PPPoE)'"
t r="9, Geef de details van uw Internetaccount. Alle informatie wordt door uw Internet-provider verstrekt."
t r="10, Instellingen Internetaccount"
t r="11, Gebruikersnaam"
t r="12, Voer de gebruikersnaam van uw Internetverbinding in."
t r="13, Wachtwoord"
t r="14, Voer het wachtwoord van uw Internetverbinding in."
t r="15, Bevestig wachtwoord"
t r="16, Voer uw wachtwoord opnieuw in."
t r="17, Geef gebruikersnaam en wachtwoord om ongewenste toegang tot de beheersinterface van de Technicolor Gateway te voorkomen."
t r="18, Toegangscontrole"
t r="19, Gebruikersnaam"
t r="20, Voer een gebruikersnaam in."
t r="21, Wachtwoord"
t r="22, Voer een wachtwoord in."
t r="23, Bevestig wachtwoord"
t r="24, Voer het wachtwoord opnieuw in."
t r="25, IPv6"
t r="26, Schakel IPv6 op deze interface"
langdef lang=de
t r="0, Welt"
t r="1, Standard"
t r="2, Verbindung ber Router"
t r="3, Router"
t r="4, Geben Sie Informationen zu der Internetverbindung an. Sie erhalten alle ntigen Informationen bei Ihrem Internetdienstanbieter."
t r="5, Internetverbindung ber Router"
t r="6, Whlen Sie einen VPI/VCI aus der Liste aus"
t r="7, Internetverbindung ber Router"
t r="8, 'PPP over ATM (PPPoA)','PPP over Ethernet (PPPoE)'"
t r="9, Geben Sie Informationen zu Ihrem Internetzugangskonto an. Sie erhalten alle ntigen Informationen bei Ihrem Internetdienstanbieter."
t r="10, Einstellungen fr das Internetzugangskonto"
t r="11, Benutzername"
t r="12, Geben Sie den Benutzernamen fr die Internetverbindung ein."
t r="13, Kennwort"
t r="14, Geben Sie das Kennwort fr die Internetverbindung ein."
t r="15, Kennwort besttigen"
t r="16, Geben Sie das Kennwort erneut ein."
t r="17, Geben Sie einen Benutzernamen und ein Kennwort ein, um unerwnschten Zugriff auf die Technicolor Gateway-Verwaltungsschnittstelle zu vermeiden."
t r="18, Zugangskontrolle"
t r="19, Benutzername"
t r="20, Geben Sie einen Benutzernamen ein."
t r="21, Kennwort"
t r="22, Geben Sie ein Kennwort ein."
t r="23, Kennwort besttigen"
t r="24, Geben Sie das Kennwort erneut ein."
t r="25, IPv6"
t r="26, Aktivieren von IPv6 auf dieser Schnittstelle"
langdef lang=pt
t r="0, Mundial"
t r="1, Bsico"
t r="2, Conexo roteada."
t r="3, Roteador"
t r="4, Especifique os detalhes da conexo com a Internet. Todas as informaes devem ser obtidas com o provedor."
t r="5, Conexo com a Internet roteada"
t r="6, Escolha uma VPI/VCI na lista"
t r="7, Conexo com a Internet roteada"
t r="8, 'PPP via ATM (PPPoA)','PPP via Ethernet (PPPoE)'"
t r="9, Especifique os detalhes da sua Conta na Internet. Todas as informaes devem ser obtidas com o provedor."
t r="10, Configuraes da conta na Internet"
t r="11, Nome de usurio"
t r="12, Digite o nome de usurio para conexo com a Internet"
t r="13, Senha"
t r="14, Digite a senha para conexo com a Internet."
t r="15, Confirmar senha"
t r="16, Digite a senha novamente."
t r="17, Especifique o nome de usurio e a senha para impedir o acesso no desejado  interface de gerenciamento do Technicolor Gateway."
t r="18, Controle de acesso"
t r="19, Nome de usurio"
t r="20, Digite um nome de usurio."
t r="21, Senha"
t r="22, Digite uma senha."
t r="23, Confirmar senha"
t r="24, Digite novamente a senha."
t r="25, IPv6"
t r="26, Ativar o IPv6 nesta interface"
langdef lang=es
t r="0, Mundo"
t r="1, Bsico"
t r="2, Conexin enrutada."
t r="3, Enrutador"
t r="4, Especifique los detalles de la conexin a Internet. Toda la informacin debe proporcionarla su proveedor de servicios de Internet."
t r="5, Conexin enrutada a Internet"
t r="6, Elegir un VPI/VCI de la lista"
t r="7, Conexin enrutada a Internet"
t r="8, 'PPP a travs de ATM (PPPoA)','PPP a travs de Ethernet (PPPoE)'"
t r="9, Especifique los detalles de su cuenta de Internet. Toda la informacin debe proporcionarla su proveedor de servicios de Internet."
t r="10, Configuracin de la cuenta de Internet"
t r="11, Nombre de usuario"
t r="12, Escriba su nombre de usuario para la conexin a Internet."
t r="13, Contrasea"
t r="14, Escriba su contrasea de conexin a Internet."
t r="15, Confirmar contrasea"
t r="16, Vuelva a escribir su contrasea."
t r="17, Especifique el nombre de usuario y la contrasea para impedir el acceso no autorizado a la interfaz de administracin de Technicolor Gateway."
t r="18, Control de acceso"
t r="19, Nombre de usuario"
t r="20, Escriba un nombre de usuario."
t r="21, Contrasea"
t r="22, Escriba una contrasea."
t r="23, Confirmar contrasea"
t r="24, Vuelva a escribir la contrasea."
t r="25, IPv6"
t r="26, Habilitar el IPv6 en esta interfaz"
langdef lang=it
t r="0, Mondiale"
t r="1, Modello base"
t r="2, Connessione Routed."
t r="3, Router"
t r="4, Specificare i dettagli della connessione Internet. Tutte le informazioni devono essere fornite dal proprio ISP."
t r="5, Connessione Internet routed"
t r="6, Scegliere un VPI/VCI dall'elenco"
t r="7, Connessione Internet routed"
t r="8, 'PPP over ATM (PPPoA)','PPP over Ethernet (PPPoE)'"
t r="9, Specificare i dettagli dell'account Internet. Tutte le informazioni devono essere fornite dal proprio ISP."
t r="10, Impostazioni account Internet"
t r="11, Nome utente"
t r="12, Immettere il nome utente della connessione Internet."
t r="13, Password"
t r="14, Immettere la password della connessione Internet."
t r="15, Conferma password"
t r="16, Reimmettere la password."
t r="17, Specificare nome utente e password per impedire accessi non autorizzati all'interfaccia di gestione dello Technicolor Gateway."
t r="18, Controllo di accesso"
t r="19, Nome utente"
t r="20, Immettere un nome utente"
t r="21, Password"
t r="22, Immettere una password."
t r="23, Conferma password"
t r="24, Reimmettere la password."
t r="25, IPv6"
t r="26, Abilitare IPv6 su questa interfaccia"
langdef lang=fr
t r="0, Monde"
t r="1, Basic"
t r="2, Connexion route."
t r="3, Routeur"
t r="4, Spcifiez les dtails de la connexion Internet. Toutes les informations doivent tre fournies par votre fournisseur de services Internet."
t r="5, Connexion Internet route"
t r="6, Choisissez un VPI/VCI dans la liste"
t r="7, Connexion Internet route"
t r="8, 'PPP sur ATM (PPPoA)','PPP sur Ethernet (PPPoE)'"
t r="9, Spcifiez les dtails de votre compte Internet. Toutes les informations doivent tre fournies par votre fournisseur de services Internet."
t r="10, Paramtres du compte Internet"
t r="11, Nom d'utilisateur"
t r="12, Entrez le nom d'utilisateur employ pour votre connexion  Internet."
t r="13, Mot de passe"
t r="14, Entrez le mot de passe employ pour votre connexion  Internet."
t r="15, Confirmer le mot de passe"
t r="16, Entrez  nouveau le mot de passe."
t r="17, Spcifiez un nom d'utilisateur et un mot de passe pour empcher les accs non voulus  l'interface de gestion du Technicolor Gateway."
t r="18, Contrle d'accs"
t r="19, Nom d'utilisateur"
t r="20, Entrez un nom d'utilisateur."
t r="21, Mot de passe"
t r="22, Entrez un mot de passe."
t r="23, Confirmer le mot de passe"
t r="24, Entrez  nouveau le mot de passe."
t r="25, IPv6"
t r="26, Activer IPv6 sur cette interface"
langdef lang=sv
t r="0, Vrlden"
t r="1, Grunder"
t r="2, Routed anslutning."
t r="3, Router"
t r="4, Ange information om Internet-anslutningen. Du fr all information som behvs av Internet-leverantren."
t r="5, Routed Internet-anslutning"
t r="6, Vlj en VPI/VCI i listan"
t r="7, Routed Internet-anslutning"
t r="8, 'PPP ver ATM (PPPoA)','PPP ver Ethernet (PPPoE)'"
t r="9, Ange information om Internet-kontot. Du fr all information som behvs av Internet-leverantren."
t r="10, Instllningar fr Internet-konto"
t r="11, Anvndarnamn"
t r="12, Ange anvndarnamnet fr Internet-anslutningen."
t r="13, Lsenord"
t r="14, Ange lsenordet fr Internet-anslutningen."
t r="15, Bekrfta lsenordet"
t r="16, Ange lsenordet igen."
t r="17, Ange anvndarnamn och lsenord fr att frhindra onskad tkomst till hanteringsgrnssnittet fr Technicolor Gateway."
t r="18, tkomstkontroll"
t r="19, Anvndarnamn"
t r="20, Ange ett anvndarnamn."
t r="21, Lsenord"
t r="22, Ange ett lsenord."
t r="23, Bekrfta lsenordet"
t r="24, Ange lsenordet igen."
t r="25, IPv6"
t r="26, Aktivera IPv6 p detta grnssnitt"

[ endofarch ]
ifadd intf=bridge
ifadd intf=ethoa_8_35
ifadd intf=user_835
[ env.ini ]
set var=CONF_REGION value="tr(1,World)"
set var=CONF_PROVIDER value="tr(2,Basic)"
set var=CONF_DESCRIPTION value="tr(3,Routed/Voice Connection.)"
set var=CONF_SERVICE value="tr(4,Voice Router)"
set var=CONF_DATE value=""
set var=CONF_DATETIME value=0000-00-00T00:00:00
set var=CONF_TPVERSION value="2.0.0"
set var=HOST_SETUP value="auto"
set var=HOST_LANGUAGE value="en"
set var=ATM_addr value="8.35"
set var=ATM_upl value="pppoe"
set var=ST_SYS_USERNAME value="Administrator"
set var=%ST_SYS_PASSWORD value=""
set var=URI_PORT value="COMMON"
set var=WL0_SSID_PREFIX_CUSTOM value=$_WL0_SSID_PREFIX
set var=WL1_SSID_PREFIX_CUSTOM value=${_WL0_SSID_PREFIX}Com
set var=WL2_SSID_PREFIX_CUSTOM value=${_WL0_SSID_PREFIX}Mob
set var=WL3_SSID_PREFIX_CUSTOM value=${_WL0_SSID_PREFIX}Gst
set var=WL0_SSID value=${WL0_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL1_SSID value=${WL1_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL2_SSID value=${WL2_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}
set var=WL3_SSID value=${WL3_SSID_PREFIX_CUSTOM}${_SSID_POSTFIX_LEGACY_OR_MAC}

[ wizard.ini ]
' ATM PVC
'--------
def var=ATM type=grp desc="tr(5,Specify the details of the Internet connection. All information should be provided by your ISP.)" alias="tr(6,Routed Internet Connection)"
def var=ATM_addr type=combo grp=ATM alias="VPI/VCI" data="0.32,0.33,0.34,0.35,0.36,0.37,0.38,0.100,1.32,1.33,1.100,8.32,8.35,8.36,8.37,8.48,8.81" desc="tr(7,Choose a VPI/VCI from the list)"
def var=ATM_upl type=radioset grp=ATM req=yes alias="Connection Type" data="pppoa,pppoe" dalias="tr(8,'PPP over ATM (PPPoA)','PPP over Ethernet (PPPoE)')" default="pppoe"
def var=ENABLE_IPV6 type=bool grp=ATM alias="tr(46,IPv6)" data="disabled,enabled" desc="tr(47,Enable IPv6 on this interface)" default=enabled
' PPP Settings
'-------------
def var=PPP type=grp desc="tr(9,Specify the details of your Internet Account. All information should be provided by your ISP.)" alias="tr(10,Internet Account Settings)"
def var=ST_PPP_USER type=string grp=PPP alias="tr(11,User Name)" req=yes desc="tr(12,Enter your Internet connection user name.)"
def var=%ST_PPP_PASSWORD type=passw grp=PPP alias="tr(13,Password)" req=yes desc="tr(14,Enter your Internet connection password.)" max=32
def var=dummy1 type=passwcheck grp=PPP alias="tr(15,Confirm Password)" desc="tr(16,Re-enter your password.)" linkvar=%ST_PPP_PASSWORD max=32
' VOIP Settings
'-------------
def var=VOIP type=grp desc="tr(17,Specify the details of your Voice over Internet Connection. All information should be provided by your provider.)" alias="tr(18,Voice Connection Settings)"
def var=VOIP_PROXY type=string grp=VOIP alias="tr(19,Proxy Address)" req=yes desc="tr(20,Enter proxy address or name (e.g. proxy.myisp.com))"
def var=VOIP_PROXYPORT type=string grp=VOIP alias="tr(21,Proxy Port)" req=yes desc="tr(22,Enter proxy UDP port.)" default=5060
def var=VOIP_REG type=string grp=VOIP alias="tr(23,Registrar Address)" req=yes desc="tr(24,Enter registrar address or name (e.g. registrar.myisp.com))"
def var=VOIP_REGPORT type=string grp=VOIP alias="tr(25,Registrar Port)" req=yes desc="tr(26,Enter registrar UDP port.)" default=5060
' VOIP Account Settings
'-------------
def var=URI type=grp desc="tr(27,Specify the details of your Voice over Internet Account. All information should be provided by your provider.)" alias="tr(28,Voice Account Settings)"
def var=URI_URI type=string grp=URI alias="tr(29,Telephone number (URI))" req=yes desc="tr(30,Enter a telephone number.)"
def var=URI_USERNAME type=string grp=URI alias="tr(31,User Name)" req=yes desc="tr(32,Enter a user name.)"
def var=URI_PASSWORD type=passw grp=URI alias="tr(33,Password)" desc="tr(34,Enter a password.)" max=32
'ST Security
'-----------
def var=ST type=grp desc="tr(38,Specify user name and password to prevent unwanted access to the Technicolor Gateway management interface.)" alias="tr(39,Access Control)"
def var=ST_SYS_USERNAME type=string grp=ST alias="tr(40,User Name)" req=yes desc="tr(41,Enter a user name.)"
def var=%ST_SYS_PASSWORD type=passw grp=ST alias="tr(42,Password)" desc="tr(43,Enter a password.)" max=32
def var=dummy2 type=passwcheck grp=ST alias="tr(44,Confirm Password)" desc="tr(45,Re-enter the password.)" linkvar=%ST_SYS_PASSWORD max=32

[ servmgr.ini ]
ifadd name=AppWeb group=lan
ifadd name=AppWebS group=lan
ifadd name=HTTP group=lan
ifadd name=HTTPs group=lan
ifadd name=FTP group=lan
ifadd name=TELNET group=lan
ifadd name=DNS-S group=lan
ifadd name=SNMP_AGENT group=lan
ifadd name=PING_RESPONDER group=lan
ifadd name=PPTP group=lan
ifadd name=SSDP group=lan
ifadd name=MDAP group=lan
modify name=AppWeb state=enabled
modify name=AppWebS state=enabled
modify name=DNS-C state=enabled
modify name=DHCP-S state=enabled
modify name=SNTP state=disabled
modify name=HTTP state=enabled
modify name=HTTPs state=enabled
modify name=HTTPI state=enabled
modify name=FTP state=enabled
modify name=TELNET state=enabled
modify name=RIP state=disabled
modify name=IGMP-Proxy state=enabled
modify name=DNS-S state=enabled
modify name=SNMP_AGENT state=disabled
modify name=IP_COMMANDS state=enabled
modify name=PING_RESPONDER state=enabled
modify name=MDAP state=enabled
modify name=CWMP-C state=disabled qoslabel=Management
modify name=SIP_SERVER_SIG qoslabel=SIPS_SIG
modify name=SIP_SERVER_RTP qoslabel=SIPS_RTP
modify name=SSDP state=enabled
modify name=PPTP state=enabled
modify name=VOIP_SIP state=enabled


[ phone.ini ]
add name=usb_port addr=usb.0.35 logging=disabled
add name=pvc_Internet addr=$ATM_addr

[ ipqos.ini ]
config dest=pvc_Internet state=enabled maxbytes=128

queue config dest=pvc_Internet queue=0 maxbytes=64 hold=2000
queue config dest=pvc_Internet queue=1 ackfiltering=enabled maxpackets=40 maxbytes=100 hold=2000
queue config dest=pvc_Internet queue=2 hold=2000
queue config dest=pvc_Internet queue=3 hold=2000
queue config dest=pvc_Internet queue=4 hold=2000
queue config dest=pvc_Internet queue=5 maxpackets=30 maxbytes=12 hold=2000


[ atm.ini ]
ifadd intf=usbif1 dest=usb_port logging=disabled
ifconfig intf=usbif1 ulp=mac retry=0 logging=disabled
ifattach intf=usbif1 logging=disabled
ifadd intf=atm_Internet
ifconfig intf=atm_Internet dest=pvc_Internet
#if ATM_upl=pppoe
ifconfig intf=atm_Internet ulp=mac encaps=llc
#else
ifconfig intf=atm_Internet ulp=ppp encaps=vcmux
#endif
ifattach intf=atm_Internet

[ eth.ini ]
#if ATM_upl=pppoe
ifadd intf=ethoa_Internet
ifconfig intf=ethoa_Internet dest=atm_Internet
ifattach intf=ethoa_Internet
#endif

[ ppprelay.ini ]
#if ATM_upl=pppoe
ifadd intf=bridge
ifadd intf=ethoa_Internet
#endif

[ ppp.ini ]
ifadd intf=Internet
rtadd intf=Internet dst=0.0.0.0/0 src=0.0.0.0/0 metric=10
#if ATM_upl=pppoe
ifconfig intf=Internet dest=RELAY
#else
ifconfig intf=Internet dest=atm_Internet
#endif
ifconfig intf=Internet user=$ST_PPP_USER password=$%ST_PPP_PASSWORD
ifconfig intf=Internet accomp=enabled format=none dnsmetric=10 idletime=0 restart=enabled
ifconfig intf=Internet ipv4=enabled ipv6=$ENABLE_IPV6
ifattach intf=Internet

[ mlpuser.ini ]
#if $%ST_SYS_PASSWORD=""
add name=$ST_SYS_USERNAME password="" role=Administrator defuser=enabled
#else
add name=$ST_SYS_USERNAME password=$%ST_SYS_PASSWORD role=Administrator defuser=enabled
#endif
add name=tech password=$_PROD_SERIAL_NBR role=TechnicalSupport defremadmin=enabled
config name=tech password=$__SEC_MODEM_ACCESS_CODE

[ voice.ini ]
tone patterntable add id=1 tone=on freq1=425 power1=-19 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=500 nextentry=2 maxloops=0 nextentryafterloops=0
tone patterntable add id=2 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=500 nextentry=1 maxloops=0 nextentryafterloops=0
tone patterntable add id=11 tone=on freq1=425 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=12 maxloops=0 nextentryafterloops=0
tone patterntable add id=12 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=13 maxloops=0 nextentryafterloops=0
tone patterntable add id=13 tone=on freq1=425 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=0 maxloops=0 nextentryafterloops=0
tone patterntable add id=21 tone=on freq1=765 power1=-21 freq2=850 power2=-21 freq3=0 power3=0 freq4=0 power4=0 duration=1000 nextentry=22 maxloops=0 nextentryafterloops=0
tone patterntable add id=22 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=5000 nextentry=21 maxloops=0 nextentryafterloops=0
tone patterntable add id=31 tone=on freq1=1400 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=400 nextentry=32 maxloops=0 nextentryafterloops=0
tone patterntable add id=32 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=15000 nextentry=31 maxloops=0 nextentryafterloops=0
tone patterntable add id=41 tone=on freq1=425 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=250 nextentry=42 maxloops=0 nextentryafterloops=0
tone patterntable add id=42 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=250 nextentry=41 maxloops=0 nextentryafterloops=0
tone patterntable add id=51 tone=on freq1=425 power1=-19 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=0 nextentry=0 maxloops=0 nextentryafterloops=0
tone patterntable add id=61 tone=on freq1=425 power1=-19 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=1200 nextentry=62 maxloops=0 nextentryafterloops=0
tone patterntable add id=62 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=40 nextentry=63 maxloops=0 nextentryafterloops=0
tone patterntable add id=63 tone=on freq1=425 power1=-19 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=40 nextentry=62 maxloops=4 nextentryafterloops=51
tone patterntable add id=71 tone=on freq1=765 power1=-20 freq2=850 power2=-20 freq3=0 power3=0 freq4=0 power4=0 duration=400 nextentry=72 maxloops=0 nextentryafterloops=0
tone patterntable add id=72 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=400 nextentry=71 maxloops=0 nextentryafterloops=0
tone patterntable add id=81 tone=on freq1=1400 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=500 nextentry=82 maxloops=0 nextentryafterloops=0
tone patterntable add id=82 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=5000 nextentry=83 maxloops=0 nextentryafterloops=0
tone patterntable add id=83 tone=on freq1=1400 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=500 nextentry=84 maxloops=0 nextentryafterloops=0
tone patterntable add id=84 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=5000 nextentry=81 maxloops=0 nextentryafterloops=0
tone patterntable add id=91 tone=on freq1=1400 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=400 nextentry=92 maxloops=0 nextentryafterloops=0
tone patterntable add id=92 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=15000 nextentry=91 maxloops=0 nextentryafterloops=0
tone patterntable add id=101 tone=on freq1=425 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=102 maxloops=0 nextentryafterloops=0
tone patterntable add id=102 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=103 maxloops=0 nextentryafterloops=0
tone patterntable add id=103 tone=on freq1=425 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=104 maxloops=0 nextentryafterloops=0
tone patterntable add id=104 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=9000 nextentry=101 maxloops=0 nextentryafterloops=0
tone patterntable add id=111 tone=on freq1=425 power1=-19 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=1000 nextentry=112 maxloops=0 nextentryafterloops=0
tone patterntable add id=112 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=4000 nextentry=111 maxloops=0 nextentryafterloops=0
tone patterntable add id=121 tone=on freq1=425 power1=-19 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=0 nextentry=0 maxloops=0 nextentryafterloops=0
tone patterntable add id=131 tone=on freq1=425 power1=-19 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=500 nextentry=132 maxloops=0 nextentryafterloops=0
tone patterntable add id=132 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=50 nextentry=131 maxloops=0 nextentryafterloops=0
tone patterntable add id=141 tone=on freq1=1400 power1=-20 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=500 nextentry=142 maxloops=0 nextentryafterloops=0
tone patterntable add id=142 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=5000 nextentry=141 maxloops=0 nextentryafterloops=0
tone patterntable add id=151 tone=on freq1=2130 power1=-16 freq2=2750 power2=-16 freq3=0 power3=0 freq4=0 power4=0 duration=100 nextentry=0 maxloops=0 nextentryafterloops=0
tone descrtable add tone=dial status=enabled delay=0 patternentryid=51 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=none status=enabled delay=0 patternentryid=0 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=remotecallhold status=disabled delay=0 patternentryid=91 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=callhold status=enabled delay=0 patternentryid=31 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=remotecallwaiting status=disabled delay=0 patternentryid=101 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=callwaiting status=enabled delay=2500 patternentryid=11 file="" text="" maxduration=0 nexttone="" repeatafter=9600
tone descrtable add tone=rejection status=enabled delay=0 patternentryid=71 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=confirmation status=enabled delay=0 patternentryid=21 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=release status=enabled delay=0 patternentryid=81 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=warning status=enabled delay=0 patternentryid=141 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=congestion status=enabled delay=0 patternentryid=41 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=busy status=enabled delay=0 patternentryid=1 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=ringback status=enabled delay=0 patternentryid=111 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=mwi status=enabled delay=0 patternentryid=61 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=specialdial status=enabled delay=0 patternentryid=121 file="" text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=stutterdial status=enabled delay=0 patternentryid=131 file="" text="" maxduration=0 nexttone="" repeatafter=0

config digitrelay=auto

services provision type=transfer
services provision type=hold
services provision type=waiting
services provision type=clip
services provision type=3pty

services activate type=transfer
services activate type=hold
services activate type=waiting
services activate type=clip
services activate type=3pty

services assign type=transfer servicecode=96
services assign type=hold servicecode=94
services assign type=waiting servicecode=43
services assign type=clip servicecode=30
services assign type=clir servicecode=31
services assign type=3pty servicecode=95
services assign type=forcedFXO servicecode=01

codec config type=g711u ptime=20 vad=disabled priority=2 status=enabled
codec config type=g711a ptime=20 vad=disabled priority=2 status=enabled
codec config type=g726_40 ptime=20 vad=disabled priority=4 status=disabled 
codec config type=g726_32 ptime=20 vad=disabled priority=5 status=disabled 
codec config type=g726_24 ptime=20 vad=disabled priority=6 status=disabled
codec config type=g726_16 ptime=20 vad=disabled priority=7 status=disabled
codec config type=g723_1 ptime_g723=30 vad=disabled priority=7 status=enabled
codec config type=g729 ptime=20 vad=disabled priority=3 status=enabled
codec config type=g722 ptime=30 vad=disabled priority=1 status=enabled

sip config sdp_ptime=20 symmetriccodec=enabled SIPURI_port=enabled rport=disabled session-expires=0 min-se=0
sip config primproxyaddr=$VOIP_PROXY proxyport=$VOIP_PROXYPORT primregaddr=$VOIP_REG regport=$VOIP_REGPORT
profile add SIP_URI=$URI_URI username=$URI_USERNAME password=$URI_PASSWORD voiceport=$URI_PORT

dect handsetupgrade config initialcheck enabled state enabled periodiccheckperiod 334 upgradeatchangedurl enabled
dect handsetupgrade url add hardwarevendor=THOMSON url=inventel:inventel@handset-ips.inventel.com/inventel/dect_handset/sales_generic/release/

fxsport config interdigit=5000
fxoport config fxodisconnect=1000

qos config type=Signaling qosfield=DSCP dscp=af42
qos config type=Realtime qosfield=DSCP dscp=ef

fax config transport=inband_reneg


[ language.ini ]
langdef lang=nl
t r="1, Wereld"
t r="2, Basis"
t r="3, Routed-/spraakverbinding."
t r="4, Spraakrouter"
t r="5, Geef de details van de Internetverbinding. Alle informatie wordt door uw Internet-provider verstrekt."
t r="6, Routed-Internetverbinding"
t r="7, Kies een VPI/VCI uit de lijst"
t r="8, 'PPP via ATM (PPPoA)','PPP via Ethernet (PPPoE)'"
t r="9, Geef de details van uw Internetaccount. Alle informatie wordt door uw Internet-provider verstrekt."
t r="10, Instellingen Internetaccount"
t r="11, Gebruikersnaam"
t r="12, Voer de gebruikersnaam van uw Internetverbinding in."
t r="13, Wachtwoord"
t r="14, Voer het wachtwoord van uw Internetverbinding in."
t r="15, Bevestig wachtwoord"
t r="16, Voer uw wachtwoord opnieuw in."
t r="17, Geef de details van uw Spraak via Internet verbinding. Alle informatie wordt door uw provider verstrekt."
t r="18, Instellingen spraakverbinding"
t r="19, Proxyadres"
t r="20, Voer proxy-adres of naam in (bv. proxy.myisp.com)"
t r="21, Proxy-poort"
t r="22, Voer proxy-UDP-poort in."
t r="23, Adres registrator"
t r="24, Voer adres of naam registrator in (bv. registrar.myisp.com)"
t r="25, Poort registrator"
t r="26, Voer UDP-poort registrator in."
t r="27, Geef de details van uw Spraak via Internet verbinding. Alle informatie wordt door uw provider verstrekt."
t r="28, Instellingen spraakaccount"
t r="29, Telefoonnummer (URI)"
t r="30, Voer een telefoonnummer in."
t r="31, Gebruikersnaam"
t r="32, Voer een gebruikersnaam in."
t r="33, Wachtwoord"
t r="34, Voer een wachtwoord in."
t r="35, Toewijzen aan"
t r="36, Selecteer een doelpoort voor het opgegeven telefoonnummer."
t r="37, 'Alle poorten','Poort 1','Poort 2'"
t r="38, Geef gebruikersnaam en wachtwoord om ongewenste toegang tot de beheersinterface van de Technicolor Gateway te voorkomen."
t r="39, Toegangscontrole"
t r="40, Gebruikersnaam"
t r="41, Voer een gebruikersnaam in."
t r="42, Wachtwoord"
t r="43, Voer een wachtwoord in."
t r="44, Bevestig wachtwoord"
t r="45, Voer het wachtwoord opnieuw in."
t r="46, IPv6"
t r="47, Schakel IPv6 op deze interface"
langdef lang=de
t r="1, Welt"
t r="2, Standard"
t r="3, Router-/Sprachverbindung"
t r="4, Voice-Router"
t r="5, Geben Sie Informationen zu der Internetverbindung an. Sie erhalten alle ntigen Informationen bei Ihrem Internetdienstanbieter."
t r="6, Internetverbindung ber Router"
t r="7, Whlen Sie einen VPI/VCI aus der Liste aus"
t r="8, 'PPP over ATM (PPPoA)','PPP over Ethernet (PPPoE)'"
t r="9, Geben Sie Informationen zu Ihrem Internetzugangskonto an. Sie erhalten alle ntigen Informationen bei Ihrem Internetdienstanbieter."
t r="10, Einstellungen fr das Internetzugangskonto"
t r="11, Benutzername"
t r="12, Geben Sie den Benutzernamen fr die Internetverbindung ein."
t r="13, Kennwort"
t r="14, Geben Sie das Kennwort fr die Internetverbindung ein."
t r="15, Kennwort besttigen"
t r="16, Geben Sie das Kennwort erneut ein."
t r="17, Geben Sie Informationen zu Ihrer Voice over Internet-Verbindung an. Sie erhalten alle ntigen Informationen bei Ihrem Anbieter."
t r="18, Einstellungen fr die Sprachverbindung"
t r="19, Proxyadresse"
t r="20, Geben Sie eine Proxyadresse oder einen Namen ein (z. B. proxy.meinisp.de)."
t r="21, Proxyanschluss"
t r="22, Geben Sie den UDP-Proxyanschluss an."
t r="23, Registeradresse"
t r="24, Geben Sie eine Registeradresse oder einen Namen ein (z. B. register.meinisp.de)."
t r="25, Registeranschluss"
t r="26, Geben Sie den UDP-Registeranschluss an."
t r="27, Geben Sie Informationen zu Ihrem Voice over Internet-Konto an. Sie erhalten alle ntigen Informationen bei Ihrem Anbieter."
t r="28, Einstellungen fr das Sprachkonto"
t r="29, Telefonnummer (URI)"
t r="30, Geben Sie eine Telefonnummer ein."
t r="31, Benutzername"
t r="32, Geben Sie einen Benutzernamen ein."
t r="33, Kennwort"
t r="34, Geben Sie ein Kennwort ein."
t r="35, Zuweisen"
t r="36, Whlen Sie einen Zielanschluss fr die bereitgestellte Telefonnummer aus."
t r="37, 'Alle Anschlsse','Anschluss 1','Anschluss 2'"
t r="38, Geben Sie einen Benutzernamen und ein Kennwort ein, um unerwnschten Zugriff auf die Technicolor Gateway-Verwaltungsschnittstelle zu vermeiden."
t r="39, Zugangskontrolle"
t r="40, Benutzername"
t r="41, Geben Sie einen Benutzernamen ein."
t r="42, Kennwort"
t r="43, Geben Sie ein Kennwort ein."
t r="44, Kennwort besttigen"
t r="45, Geben Sie das Kennwort erneut ein."
t r="46, IPv6"
t r="47, Aktivieren von IPv6 auf dieser Schnittstelle"
langdef lang=pt
t r="1, Mundial"
t r="2, Bsico"
t r="3, Conexo de voz/roteada."
t r="4, Roteador de voz"
t r="5, Especifique os detalhes da conexo com a Internet. Todas as informaes devem ser obtidas com o provedor."
t r="6, Conexo com a Internet roteada"
t r="7, Escolha uma VPI/VCI na lista"
t r="8, 'PPP via ATM (PPPoA)','PPP via Ethernet (PPPoE)'"
t r="9, Especifique os detalhes da sua Conta na Internet. Todas as informaes devem ser obtidas com o provedor."
t r="10, Configuraes da conta na Internet"
t r="11, Nome de usurio"
t r="12, Digite o nome de usurio para conexo com a Internet"
t r="13, Senha"
t r="14, Digite a senha para conexo com a Internet."
t r="15, Confirmar senha"
t r="16, Digite a senha novamente."
t r="17, Especifique os detalhes da sua Conexo de voz via Internet. Todas as informaes devem ser obtidas com o provedor."
t r="18, Configuraes da conexo de voz"
t r="19, Endereo proxy"
t r="20, Digite o endereo ou o nome proxy (por exemplo, proxy.myisp.com)"
t r="21, Porta proxy"
t r="22, Digite a porta proxy UDP."
t r="23, Endereo registrar"
t r="24, Digite o endereo ou o nome registrar (por exemplo, registrar.myisp.com)"
t r="25, Porta registrar"
t r="26, Digite a porta registrar UDP"
t r="27, Especifique os detalhes da sua Conta de voz via Internet. Todas as informaes devem ser obtidas com o provedor."
t r="28, Configuraes da conta de voz"
t r="29, Nmero de telefone (URI)"
t r="30, Digite um nmero de telefone."
t r="31, Nome de usurio"
t r="32, Digite um nome de usurio."
t r="33, Senha"
t r="34, Digite uma senha."
t r="35, Atribuir a"
t r="36, Selecione uma porta de destino para o nmero de telefone fornecido."
t r="37, 'Todas as portas','Porta 1','Porta 2'"
t r="38, Especifique o nome de usurio e a senha para impedir o acesso no desejado  interface de gerenciamento do Technicolor Gateway."
t r="39, Controle de acesso"
t r="40, Nome de usurio"
t r="41, Digite um nome de usurio."
t r="42, Senha"
t r="43, Digite uma senha."
t r="44, Confirmar senha"
t r="45, Digite novamente a senha."
t r="46, IPv6"
t r="47, Ativar o IPv6 nesta interface"
langdef lang=es
t r="1, Mundo"
t r="2, Bsico"
t r="3, Conexin enrutada/voz."
t r="4, Enrutador de voz"
t r="5, Especifique los detalles de la conexin a Internet. Toda la informacin debe proporcionarla su proveedor de servicios de Internet."
t r="6, Conexin enrutada a Internet"
t r="7, Elegir un VPI/VCI de la lista"
t r="8, 'PPP a travs de ATM (PPPoA)','PPP a travs de Ethernet (PPPoE)'"
t r="9, Especifique los detalles de su cuenta de Internet. Toda la informacin debe proporcionarla su proveedor de servicios de Internet."
t r="10, Configuracin de la cuenta de Internet"
t r="11, Nombre de usuario"
t r="12, Escriba su nombre de usuario para la conexin a Internet."
t r="13, Contrasea"
t r="14, Escriba su contrasea de conexin a Internet."
t r="15, Confirmar contrasea"
t r="16, Vuelva a escribir su contrasea."
t r="17, Especifique los detalles de la conexin Voz a travs de Internet. Toda la informacin la debe proporcionar su proveedor."
t r="18, Configuracin de la conexin de voz"
t r="19, Direccin proxy"
t r="20, Escriba la direccin o el nombre proxy (por ejemplo, proxy.myisp.com)"
t r="21, Puerto proxy"
t r="22, Escriba el puerto UDP de proxy."
t r="23, Direccin del registrador"
t r="24, Escriba la direccin o el nombre del registrador (por ejemplo, registrador.myisp.com)"
t r="25, Puerto del registrador"
t r="26, Escriba el puerto UDP del registrador."
t r="27, Especifique los detalles de su cuenta Voz a travs de Internet. Toda la informacin la debe proporcionar su proveedor."
t r="28, Configuracin de la cuenta de voz"
t r="29, Nmero de telfono (URI)"
t r="30, Escriba un nmero de telfono."
t r="31, Nombre de usuario"
t r="32, Escriba un nombre de usuario."
t r="33, Contrasea"
t r="34, Escriba una contrasea."
t r="35, Asignar a"
t r="36, Seleccione un puerto de destino para el nmero de telfono proporcionado."
t r="37, 'Todos los puertos','Puerto 1','Puerto 2'"
t r="38, Especifique el nombre de usuario y la contrasea para impedir el acceso no autorizado a la interfaz de administracin de Technicolor Gateway."
t r="39, Control de acceso"
t r="40, Nombre de usuario"
t r="41, Escriba un nombre de usuario."
t r="42, Contrasea"
t r="43, Escriba una contrasea."
t r="44, Confirmar contrasea"
t r="45, Vuelva a escribir la contrasea."
t r="46, IPv6"
t r="47, Habilitar el IPv6 en esta interfaz"
langdef lang=it
t r="1, Mondiale"
t r="2, Modello base"
t r="3, Connessione routed/vocale."
t r="4, Router vocale"
t r="5, Specificare i dettagli della connessione Internet. Tutte le informazioni devono essere fornite dal proprio ISP."
t r="6, Connessione Internet routed"
t r="7, Scegliere un VPI/VCI dall'elenco"
t r="8, 'PPP over ATM (PPPoA)','PPP over Ethernet (PPPoE)'"
t r="9, Specificare i dettagli dell'account Internet. Tutte le informazioni devono essere fornite dal proprio ISP."
t r="10, Impostazioni account Internet"
t r="11, Nome utente"
t r="12, Immettere il nome utente della connessione Internet."
t r="13, Password"
t r="14, Immettere la password della connessione Internet."
t r="15, Conferma password"
t r="16, Reimmettere la password."
t r="17, Specificare i dettagli della connessione Voice over Internet. Tutte le informazioni devono essere fornite dal proprio provider."
t r="18, Impostazioni connessione vocale"
t r="19, Indirizzo proxy"
t r="20, Immettere indirizzo o nome proxy (es. proxy.myisp.com)"
t r="21, Porta proxy"
t r="22, Immettere porta UPD del proxy."
t r="23, Indirizzo registro"
t r="24, Immettere indirizzo o nome registro (es registrar.myisp.com)"
t r="25, Porta registro"
t r="26, Immettere una porta registro UPD."
t r="27, Specificare i dettagli del proprio account Voice over Internet. Tutte le informazioni devono essere fornite dal proprio provider."
t r="28, Impostazioni account vocale"
t r="29, Numero di telefono (URI)"
t r="30, Immettere un numero di telefono."
t r="31, Nome utente"
t r="32, Immettere un nome utente"
t r="33, Password"
t r="34, Immettere una password."
t r="35, Assegna a"
t r="36, Selezionare una porta destinazione per il numero di telefono fornito."
t r="37, 'Tutte le porte','Porta 1','Porta 2'"
t r="38, Specificare nome utente e password per impedire accessi non autorizzati all'interfaccia di gestione dello Technicolor Gateway."
t r="39, Controllo di accesso"
t r="40, Nome utente"
t r="41, Immettere un nome utente"
t r="42, Password"
t r="43, Immettere una password."
t r="44, Conferma password"
t r="45, Reimmettere la password."
t r="46, IPv6"
t r="47, Abilitare IPv6 su questa interfaccia"
langdef lang=fr
t r="1, Monde"
t r="2, Basic"
t r="3, Connexion route/vocale."
t r="4, Routeur vocal"
t r="5, Spcifiez les dtails de la connexion Internet. Toutes les informations doivent tre fournies par votre fournisseur de services Internet."
t r="6, Connexion Internet route"
t r="7, Choisissez un VPI/VCI dans la liste"
t r="8, 'PPP sur ATM (PPPoA)','PPP sur Ethernet (PPPoE)'"
t r="9, Spcifiez les dtails de votre compte Internet. Toutes les informations doivent tre fournies par votre fournisseur de services Internet."
t r="10, Paramtres du compte Internet"
t r="11, Nom d'utilisateur"
t r="12, Entrez le nom d'utilisateur employ pour votre connexion  Internet."
t r="13, Mot de passe"
t r="14, Entrez le mot de passe employ pour votre connexion  Internet."
t r="15, Confirmer le mot de passe"
t r="16, Entrez  nouveau le mot de passe."
t r="17, Spcifiez les dtails de votre connexion Voix sur IP. Toutes les informations doivent tre fournies par votre fournisseur de services Internet."
t r="18, Paramtres de la connexion vocale"
t r="19, Adresse proxy"
t r="20, Entrez l'adresse ou le nom du proxy (par exemple, proxy.monisp.com)"
t r="21, Port du proxy"
t r="22, Entrez le port UDP du proxy."
t r="23, Adresse registraire"
t r="24, Entrez l'adresse ou le nom registraire (par exemple, registraire.monisp.com)"
t r="25, Port registraire"
t r="26, Entrez le port UDP registraire."
t r="27, Spcifiez les dtails de votre compte Voix sur IP. Toutes les informations doivent tre fournies par votre fournisseur de services Internet."
t r="28, Paramtres du compte vocal"
t r="29, Numro de tlphone (URI)"
t r="30, Entrez un numro de tlphone."
t r="31, Nom d'utilisateur"
t r="32, Entrez un nom d'utilisateur."
t r="33, Mot de passe"
t r="34, Entrez un mot de passe."
t r="35, Affecter "
t r="36, Slectionnez un port cible pour le numro de tlphone fourni :"
t r="37, 'Tous les ports','Port 1','Port 2'"
t r="38, Spcifiez un nom d'utilisateur et un mot de passe pour empcher les accs non voulus  l'interface de gestion du Technicolor Gateway."
t r="39, Contrle d'accs"
t r="40, Nom d'utilisateur"
t r="41, Entrez un nom d'utilisateur."
t r="42, Mot de passe"
t r="43, Entrez un mot de passe."
t r="44, Confirmer le mot de passe"
t r="45, Entrez  nouveau le mot de passe."
t r="46, IPv6"
t r="47, Activer IPv6 sur cette interface"
langdef lang=sv
t r="1, Vrlden"
t r="2, Grunder"
t r="3, Routed/rstanslutning."
t r="4, Rstrouter"
t r="5, Ange information om Internet-anslutningen. Du fr all information som behvs av Internet-leverantren."
t r="6, Routed Internet-anslutning"
t r="7, Vlj en VPI/VCI i listan"
t r="8, 'PPP ver ATM (PPPoA)','PPP ver Ethernet (PPPoE)'"
t r="9, Ange information om Internet-kontot. Du fr all information som behvs av Internet-leverantren."
t r="10, Instllningar fr Internet-konto"
t r="11, Anvndarnamn"
t r="12, Ange anvndarnamnet fr Internet-anslutningen."
t r="13, Lsenord"
t r="14, Ange lsenordet fr Internet-anslutningen."
t r="15, Bekrfta lsenordet"
t r="16, Ange lsenordet igen."
t r="17, Ange information om din anslutning fr rst ver Internet. Du fr all information som behvs av Internet-leverantren."
t r="18, Instllningar fr rstanslutning"
t r="19, Proxyadress"
t r="20, Ange proxyadressen eller proxynamnet (t.ex. proxy.minisp.com)"
t r="21, Proxyport"
t r="22, Ange proxyns UDP-port"
t r="23, Registeradress"
t r="24, Ange registeradressen eller registernamnet (t.ex. register.minisp.com)"
t r="25, Registerport"
t r="26, Ange registrets UDP-port."
t r="27, Ange information om ditt konto fr rst ver Internet. Du fr all information som behvs av Internet-leverantren."
t r="28, Instllningar fr rstkonto"
t r="29, Telefonnummer (URI)"
t r="30, Ange ett telefonnummer."
t r="31, Anvndarnamn"
t r="32, Ange ett anvndarnamn."
t r="33, Lsenord"
t r="34, Ange ett lsenord."
t r="35, Tilldela till"
t r="36, Vlj en mlport fr det angivna telefonnumret."
t r="37, 'Alla portar','Port 1','Port 2'"
t r="38, Ange anvndarnamn och lsenord fr att frhindra onskad tkomst till hanteringsgrnssnittet fr Technicolor Gateway."
t r="39, tkomstkontroll"
t r="40, Anvndarnamn"
t r="41, Ange ett anvndarnamn."
t r="42, Lsenord"
t r="43, Ange ett lsenord."
t r="44, Bekrfta lsenordet"
t r="45, Ange lsenordet igen."
t r="46, IPv6"
t r="47, Aktivera IPv6 p detta grnssnitt"

[ endofarch ]
LPD queue add name=q1 type=Raw default=yes
LPD config state=enabled
wlan-pwr-options single-rxchain=enabled
config eco-manager=enabled cpu-microsleep=disabled cpu-lowspeed=disabled usb-controller=enabled wlan-pwrcontrol=enabled
debug traceconfig state=disabled
config format=bytes
ctdadd name=default conformance=UBR
add name=default txctd=default rxctd=default
add name default conformance UBR
config DefaultQueue 1 DefaultLabel Classification.Label.default Rule=Classification.Chain.qos_default_labels.Rule.20
add_queue Enable=enabled Interface=WAN Precedence=100 Queue=1
add_queue Enable=enabled Interface=WAN Precedence=40  Queue=2
add_queue Enable=enabled Interface=WAN Precedence=20  Queue=3
add_classification Index=2 ClassQueue=2 Label=Classification.Label.qos_label_1 Rule=Classification.Chain.qos_default_labels.Rule.19
add_classification Index=1 ClassQueue=3 Label=Classification.Label.qos_label_0 Rule=Classification.Chain.qos_default_labels.Rule.18
-----BEGIN CERTIFICATE-----
MIID4TCCAsmgAwIBAgIBATANBgkqhkiG9w0BAQUFADBsMQswCQYDVQQGEwJJVDEV
MBMGA1UECgwMSS5ULiBUZWxlY29tMSIwIAYDVQQLDBlTZXJ2aXppIGRpIGNlcnRp
ZmljYXppb25lMSIwIAYDVQQDDBlJLlQuIFRlbGVjb20gUHJpdmF0ZSBDQSAxMB4X
DTExMDIwMTE1MTcwN1oXDTQxMDEzMDE1MTcwN1owbDELMAkGA1UEBhMCSVQxFTAT
BgNVBAoMDEkuVC4gVGVsZWNvbTEiMCAGA1UECwwZU2Vydml6aSBkaSBjZXJ0aWZp
Y2F6aW9uZTEiMCAGA1UEAwwZSS5ULiBUZWxlY29tIFByaXZhdGUgQ0EgMTCCASIw
DQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKqvexWZ3AuyiJfbzZAhylC7cjQq
NHdF4j1m/yz4s/3Ki+f1lxi+hyzfsGBAk95eebZMfq0tURJ9YlKmdbsWaBdDWolw
rPNSXn4+kCBzkBXSlcNA4xcOKtJyqUMewiiCql2GhSN5UywtMTfQfUjJyVhJS1oF
n2tzNcbiTBWXzHvoWHWuqQU6Mr10//nRa0elu/8W02cIXNPxlzfj5WcGfEtUBMLl
fPpAuPu7iIxLBN2F82ympe2bjavuXLkjRDZ5msDMgjYm8rXd8+DntLoSG7vPJOOH
zN/2SfC1NARILXBYpN/ibhnoNgyd/acrMXBhSk+In73ri/5LeTco0B1iok0CAwEA
AaOBjTCBijAPBgNVHRMBAf8EBTADAQH/MEgGA1UdIARBMD8wPQYGK0whAQEEMDMw
MQYIKwYBBQUHAgEWJWh0dHA6Ly9jYS5pdHRlbGVjb20uaXQvUHJpdmF0ZUNBMS9D
UFMwDgYDVR0PAQH/BAQDAgEGMB0GA1UdDgQWBBQkv3N8Scr3X4S4HhFFAEBn3l5z
KzANBgkqhkiG9w0BAQUFAAOCAQEAQH2DH/NdgX4vaJOQfdiFfDmUjybhtHHAwhTR
ZbHuTrh2V6Jjm4pOv9ZP2AhafYDoONkN/xbTFHlrsVbCoApw6ZTicihZqdGFbpGx
hGjpD6iD+fXrjw3jAPSvuCuNMpzY69wYsYQq0att13EBPrB1WaRdwtPKQuoXLIEF
FbXrx1ojpGfTXC8jSPo4vhwNYCVJzCowcuM/pNuuobQpP/R5Ien0eiR0FFSRde5F
bV2h95fyNpYq6HLDEaA71S6wef7v8RDD5j2Byhm6r2MRUhJ2jeJLI+YH5oxPjTn/
PskdjZQzaJNjilpU8hG1bsimEY4IM41gDW4sI15Mdcj3/Hr63g==
-----END CERTIFICATE-----
ifadd intf=LocalNetwork
ifconfig intf=LocalNetwork maxinterval=600 mininterval=200 mflag=no oflag=yes reachabletime=0 curhoplimit=64 deflifetime=1800 
pdadd intf=LocalNetwork subnet-id=::/64 interface-id=slaac
ifattach intf=LocalNetwork
add name="autopvc_add_qos" command="atm qosbook ctdadd name _auto_$1_$2_tx conformance $3 peakrate $4 sustrate $5 maxburst $6 minrate $7 maxframe $8 celldelay $9 realtime $10 dynamic enabled"
add name="autopvc_add_qos" command="atm qosbook ctdadd name _auto_$1_$2_rx conformance $11 peakrate $12 sustrate $13 maxburst $14 minrate $15 maxframe $16 celldelay $17 realtime $18 dynamic enabled"
add name="autopvc_add_qos" command="atm qosbook add name _auto_$1_$2 txctd _auto_$1_$2_tx rxctd _auto_$1_$2_rx dynamic enabled"
add name="autopvc_delete_qos" command="atm qosbook delete name _auto_$1_$2"
add name="autopvc_delete_qos" command="atm qosbook ctddelete name _auto_$1_$2_tx"
add name="autopvc_delete_qos" command="atm qosbook ctddelete name _auto_$1_$2_rx"
add name="autopvc_add_bridge" command="atm qosbook ctdadd name _auto_$1_$2_tx conformance $3 peakrate $4 sustrate $5 maxburst $6 minrate $7 maxframe $8 celldelay $9 realtime $10 dynamic enabled"
add name="autopvc_add_bridge" command="atm qosbook ctdadd name _auto_$1_$2_rx conformance $11 peakrate $12 sustrate $13 maxburst $14 minrate $15 maxframe $16 celldelay $17 realtime $18 dynamic enabled"
add name="autopvc_add_bridge" command="atm qosbook add name _auto_$1_$2 txctd _auto_$1_$2_tx rxctd _auto_$1_$2_rx dynamic enabled"
add name="autopvc_add_bridge" command="atm phonebook add name _auto_$1_$2 addr $1.$2 dynamic enabled maxFwdCPCS_PDU $21 maxBwdCPCS_PDU $22"
add name="autopvc_add_bridge" command="atm ifadd intf _auto_$1_$2_atm dest _auto_$1_$2 dynamic enabled"
add name="autopvc_add_bridge" command="atm ifconfig intf _auto_$1_$2_atm qos _auto_$1_$2 encaps $19 fcs $20 ulp mac"
add name="autopvc_add_bridge" command="atm ifattach intf _auto_$1_$2_atm"
add name="autopvc_add_bridge" command="eth bridge ifadd intf _auto_$1_$2_eth dest _auto_$1_$2_atm dynamic enabled"
add name="autopvc_add_bridge" command="eth bridge ifconfig intf _auto_$1_$2_eth"
add name="autopvc_add_bridge" command="eth bridge ifattach intf _auto_$1_$2_eth"
add name="autopvc_delete_bridge" command="eth bridge ifdetach intf _auto_$1_$2_eth"
add name="autopvc_delete_bridge" command="eth bridge ifdelete intf _auto_$1_$2_eth"
add name="autopvc_delete_bridge" command="atm ifdetach intf _auto_$1_$2_atm"
add name="autopvc_delete_bridge" command="atm ifdelete intf _auto_$1_$2_atm"
add name="autopvc_delete_bridge" command="atm phonebook delete name _auto_$1_$2"
add name="autopvc_delete_bridge" command="atm qosbook delete name _auto_$1_$2"
add name="autopvc_delete_bridge" command="atm qosbook ctddelete name _auto_$1_$2_tx"
add name="autopvc_delete_bridge" command="atm qosbook ctddelete name _auto_$1_$2_rx"
add name="autopvc_add_pppoerelay" command="atm qosbook ctdadd name _auto_$1_$2_tx conformance $3 peakrate $4 sustrate $5 maxburst $6 minrate $7 maxframe $8 celldelay $9 realtime $10 dynamic enabled"
add name="autopvc_add_pppoerelay" command="atm qosbook ctdadd name _auto_$1_$2_rx conformance $11 peakrate $12 sustrate $13 maxburst $14 minrate $15 maxframe $16 celldelay $17 realtime $18 dynamic enabled"
add name="autopvc_add_pppoerelay" command="atm qosbook add name _auto_$1_$2 txctd _auto_$1_$2_tx rxctd _auto_$1_$2_rx dynamic enabled"
add name="autopvc_add_pppoerelay" command="atm phonebook add name _auto_$1_$2 addr $1.$2 dynamic enabled maxFwdCPCS_PDU $21 maxBwdCPCS_PDU $22"
add name="autopvc_add_pppoerelay" command="atm ifadd intf _auto_$1_$2_atm dest _auto_$1_$2 dynamic enabled"
add name="autopvc_add_pppoerelay" command="atm ifconfig intf _auto_$1_$2_atm qos _auto_$1_$2 ulp mac"
add name="autopvc_add_pppoerelay" command="atm ifattach intf _auto_$1_$2_atm"
add name="autopvc_add_pppoerelay" command="eth ifadd intf _auto_$1_$2_eth dest _auto_$1_$2_atm dynamic enabled"
add name="autopvc_add_pppoerelay" command="eth ifattach intf _auto_$1_$2_eth"
add name="autopvc_add_pppoerelay" command="ppp relay ifadd intf _auto_$1_$2_eth"
add name="autopvc_delete_pppoerelay" command="ppp relay ifdelete intf _auto_$1_$2_eth"
add name="autopvc_delete_pppoerelay" command="eth ifdetach intf _auto_$1_$2_eth"
add name="autopvc_delete_pppoerelay" command="eth ifdelete intf _auto_$1_$2_eth"
add name="autopvc_delete_pppoerelay" command="atm ifdetach intf _auto_$1_$2_atm"
add name="autopvc_delete_pppoerelay" command="atm ifdelete intf _auto_$1_$2_atm"
add name="autopvc_delete_pppoerelay" command="atm phonebook delete name _auto_$1_$2"
add name="autopvc_delete_pppoerelay" command="atm qosbook delete name _auto_$1_$2"
add name="autopvc_delete_pppoerelay" command="atm qosbook ctddelete name _auto_$1_$2_tx"
add name="autopvc_delete_pppoerelay" command="atm qosbook ctddelete name _auto_$1_$2_rx"
add name="autopvc_add_ipoa" command="atm qosbook ctdadd name _auto_$1_$2_tx conformance $3 peakrate $4 sustrate $5 maxburst $6 minrate $7 maxframe $8 celldelay $9 realtime $10 dynamic enabled"
add name="autopvc_add_ipoa" command="atm qosbook ctdadd name _auto_$1_$2_rx conformance $11 peakrate $12 sustrate $13 maxburst $14 minrate $15 maxframe $16 celldelay $17 realtime $18 dynamic enabled"
add name="autopvc_add_ipoa" command="atm qosbook add name _auto_$1_$2 txctd _auto_$1_$2_tx rxctd _auto_$1_$2_rx dynamic enabled"
add name="autopvc_add_ipoa" command="atm phonebook add name _auto_$1_$2 addr $1.$2 dynamic enabled maxFwdCPCS_PDU $21 maxBwdCPCS_PDU $22"
add name="autopvc_add_ipoa" command="atm ifadd intf _auto_$1_$2_atm dest _auto_$1_$2 dynamic enabled"
add name="autopvc_add_ipoa" command="atm ifconfig intf _auto_$1_$2_atm qos _auto_$1_$2 encaps $19 fcs $20 ulp ip"
add name="autopvc_add_ipoa" command="atm ifattach intf _auto_$1_$2_atm"
add name="autopvc_add_ipoa" command="ip ifadd intf _auto_$1_$2 dest _auto_$1_$2_atm dynamic enabled"
add name="autopvc_add_ipoa" command="ip ifattach intf _auto_$1_$2"
add name="autopvc_delete_ipoa" command="ip ifdetach intf _auto_$1_$2"
add name="autopvc_delete_ipoa" command="ip ifdelete intf _auto_$1_$2"
add name="autopvc_delete_ipoa" command="atm ifdetach intf _auto_$1_$2_atm"
add name="autopvc_delete_ipoa" command="atm ifdelete intf _auto_$1_$2_atm"
add name="autopvc_delete_ipoa" command="atm phonebook delete name _auto_$1_$2"
add name="autopvc_delete_ipoa" command="atm qosbook delete name _auto_$1_$2"
add name="autopvc_delete_ipoa" command="atm qosbook ctddelete name _auto_$1_$2_tx"
add name="autopvc_delete_ipoa" command="atm qosbook ctddelete name _auto_$1_$2_rx"
add name="autopvc_add_ethoa" command="atm qosbook ctdadd name _auto_$1_$2_tx conformance $3 peakrate $4 sustrate $5 maxburst $6 minrate $7 maxframe $8 celldelay $9 realtime $10 dynamic enabled"
add name="autopvc_add_ethoa" command="atm qosbook ctdadd name _auto_$1_$2_rx conformance $11 peakrate $12 sustrate $13 maxburst $14 minrate $15 maxframe $16 celldelay $17 realtime $18 dynamic enabled"
add name="autopvc_add_ethoa" command="atm qosbook add name _auto_$1_$2 txctd _auto_$1_$2_tx rxctd _auto_$1_$2_rx dynamic enabled"
add name="autopvc_add_ethoa" command="atm phonebook add name _auto_$1_$2 addr $1.$2 dynamic enabled maxFwdCPCS_PDU $21 maxBwdCPCS_PDU $22"
add name="autopvc_add_ethoa" command="atm ifadd intf _auto_$1_$2_atm dest _auto_$1_$2 dynamic enabled"
add name="autopvc_add_ethoa" command="atm ifconfig intf _auto_$1_$2_atm qos _auto_$1_$2 encaps $19 fcs $20 ulp mac"
add name="autopvc_add_ethoa" command="atm ifattach intf _auto_$1_$2_atm"
add name="autopvc_add_ethoa" command="eth ifadd intf _auto_$1_$2_eth dest _auto_$1_$2_atm dynamic enabled"
add name="autopvc_add_ethoa" command="eth ifattach intf _auto_$1_$2_eth"
add name="autopvc_add_ethoa" command="ip ifadd intf _auto_$1_$2 dest _auto_$1_$2_eth dynamic enabled"
add name="autopvc_add_ethoa" command="ip ifattach intf _auto_$1_$2"
add name="autopvc_delete_ethoa" command="ip ifdetach intf _auto_$1_$2"
add name="autopvc_delete_ethoa" command="ip ifdelete intf _auto_$1_$2"
add name="autopvc_delete_ethoa" command="eth ifdetach intf _auto_$1_$2_eth"
add name="autopvc_delete_ethoa" command="eth ifdelete intf _auto_$1_$2_eth"
add name="autopvc_delete_ethoa" command="atm ifdetach intf _auto_$1_$2_atm"
add name="autopvc_delete_ethoa" command="atm ifdelete intf _auto_$1_$2_atm"
add name="autopvc_delete_ethoa" command="atm phonebook delete name _auto_$1_$2"
add name="autopvc_delete_ethoa" command="atm qosbook delete name _auto_$1_$2"
add name="autopvc_delete_ethoa" command="atm qosbook ctddelete name _auto_$1_$2_tx"
add name="autopvc_delete_ethoa" command="atm qosbook ctddelete name _auto_$1_$2_rx"
add name="autopvc_add_pppoa" command="atm qosbook ctdadd name _auto_$1_$2_tx conformance $3 peakrate $4 sustrate $5 maxburst $6 minrate $7 maxframe $8 celldelay $9 realtime $10 dynamic enabled"
add name="autopvc_add_pppoa" command="atm qosbook ctdadd name _auto_$1_$2_rx conformance $11 peakrate $12 sustrate $13 maxburst $14 minrate $15 maxframe $16 celldelay $17 realtime $18 dynamic enabled"
add name="autopvc_add_pppoa" command="atm qosbook add name _auto_$1_$2 txctd _auto_$1_$2_tx rxctd _auto_$1_$2_rx dynamic enabled"
add name="autopvc_add_pppoa" command="atm phonebook add name _auto_$1_$2 addr $1.$2 dynamic enabled maxFwdCPCS_PDU $21 maxBwdCPCS_PDU $22"
add name="autopvc_add_pppoa" command="atm ifadd intf _auto_$1_$2_atm dest _auto_$1_$2 dynamic enabled"
add name="autopvc_add_pppoa" command="atm ifconfig intf _auto_$1_$2_atm qos _auto_$1_$2 encaps $19 fcs $20 ulp ppp"
add name="autopvc_add_pppoa" command="atm ifattach intf _auto_$1_$2_atm"
add name="autopvc_add_pppoa" command="ppp ifadd intf _auto_$1_$2 dest _auto_$1_$2_atm dynamic enabled"
add name="autopvc_add_pppoa" command="ppp ifattach intf _auto_$1_$2"
add name="autopvc_add_pppoa" command="nat ifconfig intf _auto_$1_$2 translation enabled"
add name="autopvc_delete_pppoa" command="ppp ifdetach intf _auto_$1_$2"
add name="autopvc_delete_pppoa" command="ppp ifdelete intf _auto_$1_$2"
add name="autopvc_delete_pppoa" command="atm ifdetach intf _auto_$1_$2_atm"
add name="autopvc_delete_pppoa" command="atm ifdelete intf _auto_$1_$2_atm"
add name="autopvc_delete_pppoa" command="atm phonebook delete name _auto_$1_$2"
add name="autopvc_delete_pppoa" command="atm qosbook delete name _auto_$1_$2"
add name="autopvc_delete_pppoa" command="atm qosbook ctddelete name _auto_$1_$2_tx"
add name="autopvc_delete_pppoa" command="atm qosbook ctddelete name _auto_$1_$2_rx"
add name="autopvc_add_pppoe" command="atm qosbook ctdadd name _auto_$1_$2_tx conformance $3 peakrate $4 sustrate $5 maxburst $6 minrate $7 maxframe $8 celldelay $9 realtime $10 dynamic enabled"
add name="autopvc_add_pppoe" command="atm qosbook ctdadd name _auto_$1_$2_rx conformance $11 peakrate $12 sustrate $13 maxburst $14 minrate $15 maxframe $16 celldelay $17 realtime $18 dynamic enabled"
add name="autopvc_add_pppoe" command="atm qosbook add name _auto_$1_$2 txctd _auto_$1_$2_tx rxctd _auto_$1_$2_rx dynamic enabled"
add name="autopvc_add_pppoe" command="atm phonebook add name _auto_$1_$2 addr $1.$2 dynamic enabled maxFwdCPCS_PDU $21 maxBwdCPCS_PDU $22"
add name="autopvc_add_pppoe" command="atm ifadd intf _auto_$1_$2_atm dest _auto_$1_$2 dynamic enabled"
add name="autopvc_add_pppoe" command="atm ifconfig intf _auto_$1_$2_atm qos _auto_$1_$2 encaps $19 fcs $20 ulp mac"
add name="autopvc_add_pppoe" command="atm ifattach intf _auto_$1_$2_atm"
add name="autopvc_add_pppoe" command="eth ifadd intf _auto_$1_$2_eth dest _auto_$1_$2_atm dynamic enabled"
add name="autopvc_add_pppoe" command="eth ifattach intf _auto_$1_$2_eth"
add name="autopvc_add_pppoe" command="ppp ifadd intf _auto_$1_$2 dest _auto_$1_$2_eth dynamic enabled"
add name="autopvc_add_pppoe" command="ppp ifattach intf _auto_$1_$2"
add name="autopvc_add_pppoe" command="nat ifconfig intf _auto_$1_$2 translation enabled"
add name="autopvc_delete_pppoe" command="ppp ifdetach intf _auto_$1_$2"
add name="autopvc_delete_pppoe" command="ppp ifdelete intf _auto_$1_$2"
add name="autopvc_delete_pppoe" command="eth ifdetach intf _auto_$1_$2_eth"
add name="autopvc_delete_pppoe" command="eth ifdelete intf _auto_$1_$2_eth"
add name="autopvc_delete_pppoe" command="atm ifdetach intf _auto_$1_$2_atm"
add name="autopvc_delete_pppoe" command="atm ifdelete intf _auto_$1_$2_atm"
add name="autopvc_delete_pppoe" command="atm phonebook delete name _auto_$1_$2"
add name="autopvc_delete_pppoe" command="atm qosbook delete name _auto_$1_$2"
add name="autopvc_delete_pppoe" command="atm qosbook ctddelete name _auto_$1_$2_tx"
add name="autopvc_delete_pppoe" command="atm qosbook ctddelete name _auto_$1_$2_rx"
add name="autopvc_change_qos" command="atm ifconfig intf $1 qos $2"
add name="wlbrintfadd" command="eth bridge ifadd intf WL_$1_$2 dynamic enabled"
add name="wlbrintfadd" command="eth bridge ifconfig intf WL_$1_$2 dest wl_ssid$1_$2"
add name="wlbrintfadd" command="eth bridge ifattach intf WL_$1_$2"
add name="wlbrintfdel" command="eth bridge ifdetach intf WL_$1_$2"
add name="wlbrintfdel" command="eth bridge ifdelete intf WL_$1_$2"
add name="eth_bridge_filter" command="eth bridge filter ifdel brname=bridge name=br_filter intf=ethport1"
add name="eth_bridge_filter" command="eth bridge filter ifdel brname=bridge name=br_filter intf=ethport2"
add name="eth_bridge_filter" command="eth bridge filter ifdel brname=bridge name=br_filter intf=ethport3"
add name="eth_bridge_filter" command="eth bridge filter ifdel brname=bridge name=br_filter intf=ethport4"
add name="eth_bridge_filter" command="eth bridge filter ifadd brname=bridge name=br_filter intf=ethport1"
add name="eth_bridge_filter" command="eth bridge filter ifadd brname=bridge name=br_filter intf=ethport2"
add name="eth_bridge_filter" command="eth bridge filter ifadd brname=bridge name=br_filter intf=ethport3"
add name="eth_bridge_filter" command="eth bridge filter ifadd brname=bridge name=br_filter intf=ethport4"
add name="eth_bridge_filter" command="eth bridge filter ifdel brname=bridge name=PPP_LAN_BLOCK intf=OBC"
add name="eth_bridge_filter" command="eth bridge filter ifadd brname=bridge name=PPP_LAN_BLOCK intf=OBC"
add name="eth_bridge_filter" command="eth bridge filter forwarding brname=bridge name=PPP_LAN_BLOCK mode=ToFwdIntfsOnly"
add name="eth_bridge_filter" command="eth bridge filter fwdintfdel intf=vdsl2 brname=bridge name=PPP_LAN_BLOCK"
add name="eth_bridge_filter" command="eth bridge filter fwdintfdel intf=bri_ge brname=bridge name=PPP_LAN_BLOCK"
add name="eth_bridge_filter" command="eth bridge filter fwdintfadd intf=vdsl2 brname=bridge name=PPP_LAN_BLOCK"
add name="eth_bridge_filter" command="eth bridge filter fwdintfadd intf=bri_ge brname=bridge name=PPP_LAN_BLOCK"
add name="dhcr_video"  command="eth bridge dynvlan add hwaddr $1 vlan video prio $2 mode both dynamic enabled"
add name="IPTV_Dyn_add" command="dhcp relay ruleadd name=LocalNetwork_to_127.0.0.1 rulename=noIPTV"
add name="IPTV_Dyn_add" command="dhcp relay add name=dhcp_to_iptv"
add name="IPTV_Dyn_add" command="dhcp relay modify name dhcp_to_iptv addr 10.0.0.1 intf LocalNetwork script video"
add name="IPTV_Dyn_add" command="dhcp relay ruleadd name=dhcp_to_iptv rulename=IPTV"
add name="IPTV_Dyn_add" command="eth bridge ifconfig intf=ethport1 dynvlan=enabled"
add name="IPTV_Dyn_add" command="eth bridge ifconfig intf=ethport2 dynvlan=enabled"
add name="IPTV_Dyn_add" command="eth bridge ifconfig intf=ethport3 dynvlan=enabled"
add name="IPTV_Dyn_add" command="eth bridge ifconfig intf=ethport4 dynvlan=enabled"
add name="IPTV_Dyn_add" command="eth bridge vlan ifadd intf br_video name video untagged enabled"
add name="IPTV_Dyn_add" command="eth bridge vlan ifdelete intf br_video name default"
add name="IPTV_Dyn_del" command="dhcp relay ruledelete name=LocalNetwork_to_127.0.0.1 rulename=noIPTV"
add name="IPTV_Dyn_del" command="dhcp relay delete name=dhcp_to_iptv"
add name="IPTV_Dyn_del" command="eth bridge ifconfig intf=ethport1 dynvlan=disabled"
add name="IPTV_Dyn_del" command="eth bridge ifconfig intf=ethport2 dynvlan=disabled"
add name="IPTV_Dyn_del" command="eth bridge ifconfig intf=ethport3 dynvlan=disabled"
add name="IPTV_Dyn_del" command="eth bridge ifconfig intf=ethport4 dynvlan=disabled"
add name="IPTV_Dyn_del" command="eth bridge dynvlan flush"
add name="dhcr_staticvideo" command="eth filter operand add operand=checksa"
add name="dhcr_staticvideo" command="eth filter operand config operand checksa type Match operator Equal protocollevel EthernetFrame length 6 mask ffffffffffff value $1 offset 6"
add name="dhcr_staticvideo" command="eth filter template ruledel filter=staticiptv ruleid=0"
add name="dhcr_staticvideo" command="eth filter template ruleadd filter=staticiptv operand=checksa"
add name="dhcr_staticvideo" command="eth bridge filter attach brname=bridge name=staticiptv"
add name="IPTV_Static_add" command="eth bridge vlan ifadd name=video intf=$1"
add name="IPTV_Static_add" command="dhcp rule add name=iptvport type=port port=$1"
add name="IPTV_Static_add" command="dhcp rule add name=noiptvport type=port port=!$1"
add name="IPTV_Static_add" command="dhcp relay ruleadd name=LocalNetwork_to_127.0.0.1 rulename=noIPTV"
add name="IPTV_Static_add" command="dhcp relay ruleadd name=LocalNetwork_to_127.0.0.1 key=or rulename=noiptvport"
add name="IPTV_Static_add" command="dhcp relay add name=dhcp_to_iptv"
add name="IPTV_Static_add" command="dhcp relay modify name dhcp_to_iptv addr 10.0.0.1 intf LocalNetwork script staticvideo"
add name="IPTV_Static_add" command="dhcp relay ruleadd name=dhcp_to_iptv rulename=IPTV"
add name="IPTV_Static_add" command="dhcp relay ruleadd name=dhcp_to_iptv key=and rulename=iptvport"
add name="IPTV_Static_add" command="eth filter template add filter=staticiptv location=Ingress"
add name="IPTV_Static_add" command="eth filter template setvid filter=staticiptv state=enabled vid=836"
add name="IPTV_Static_add" command="eth bridge filter add brname=bridge name=staticiptv filter=staticiptv"
add name="IPTV_Static_add" command="eth bridge filter ifadd brname=bridge name=staticiptv intf=$1"
add name="IPTV_Static_add" command="eth bridge vlan ifadd intf br_video name video untagged enabled"
add name="IPTV_Static_add" command="eth bridge vlan ifdelete intf br_video name default"
add name="IPTV_Static_del" command="eth bridge filter delete brname=bridge name=staticiptv"
add name="IPTV_Static_del" command="eth filter template delete filter=staticiptv"
add name="IPTV_Static_del" command="eth filter operand delete operand=checksa"
add name="IPTV_Static_del" command="eth bridge vlan ifdelete name=video intf=$1"
add name="IPTV_Static_del" command="dhcp relay delete name=dhcp_to_iptv"
add name="IPTV_Static_del" command="dhcp relay ruledelete name=LocalNetwork_to_127.0.0.1 rulename=noIPTV"
add name="IPTV_Static_del" command="dhcp relay ruledelete name=LocalNetwork_to_127.0.0.1 rulename=noiptvport"
add name="IPTV_Static_del" command="dhcp rule delete name noiptvport"
add name="IPTV_Static_del" command="dhcp rule delete name iptvport"
add name="remove_dynvideo" command="eth bridge dynvlan delete hwaddr $1"
add name="remove_staticvideo" command="eth bridge filter detach brname=bridge name=staticiptv"
add name="remove_staticvideo" command="eth filter template ruledel filter=staticiptv ruleid=0"
add name="remove_staticvideo" command="eth filter operand delete operand=checksa"


@_PROD_NUMBER;
@_TPVERSION;2.0.0
@_BUILD;8.8.W.I
@_BOARD_NAME;VDNT-S
zRead/LAN/WAN/Local;0;read/LAN/WAN/Local attached to a Hardcoded concept
zWrite/LAN/WAN/Local;1;Write/LAN/WAN/Local attched to a Hardcoded concept
zr_lan;2;read lan configurations
zr_wan;3;read wan configurations
zr_fs_view;4;listing the filesystem files
zr_fs_retrieve;5;reads the file system files
zr_rtg;6;reading the routing configurations
zr_fwdg;7;reading the forwarding configurations
zr_nat;8;reading the nat configurations
zr_frwl;9;reading firewall configurations
zr_ipsec_norm;10;reading the normal ipsec configurations
zr_ipsec_adv;11;reading advance ipsec configuration e.g display keys
zr_certificates;12;reading certificates configurations
zr_remote_mgnt;13;reading remote manegement e,g http/port/show
zr_local;14;reading the local configurations
zr_qos;15;reading qos configurations
zw_lan;16;write lan configurations
zw_wan;17;write wan configurations
zw_fs_passive;18;writing to the passive directory in the filesystem
zw_rtg;19;writing the routing configurations
zw_fwdg;20;wrting the forwarding configurations
zw_nat;21;writing the nat configurations
zw_frwl_norm;22;writing the normal firewall configurations
zw_frwl_adv;23;writing the advanced firewall configurations
zw_frwl_ss;24;writing the advance source and sink firewall rules
zw_ipsec;25;writng the ipsec configurations
zw_certificates;26;wrting the certificates configrations as pki/import
zw_remote_mgnt;27;writing the remote management channels configurations
zw_local;28;writing the local configurations
zw_qos;29;writing the qos configurations
zSND_lan;30;simple network debugging the lan
zSND_wan;31;simple network debugging the wan
zSND_local;32;simple network debugging the local
zAND_lan;33;advance network debugging the lan
zAND_wan;34;advance network debugging the wan
zAND_frwl;35;advance network debugging the firewall
zAND_local;36;advance network debugging the local
zUser_Admin;37;default roles and privileges configurations
zMLP_Admin;38;customised roles and privileges configurations
zsecure_ipsec_term;39;secure ipsec termination
zsecure_BR;40;secure backup and restore configurations
zCLI;41;CLI allowed
zCGI;42;CGI allowed
zFTP;43;FTP allowed
zMDAP;44;MDAP allowed
zsecure_reset;45;secure reset to defaults
zGUI_advanced;46;GUI_advanced
zMDAP1;47;MDAP on LAN allowed
zmbus;48;Allow mbus configurations
zWebsev;49;Webservice allowed
zMDAP2;52;MDAP minimal
zunsecure_connection;64;unsecurec connection access
zSensitve_file;65;sensitive file access
zchannel_ftp;66;channel ftp access
zchannel_telnet;67;channel telnet access
zchannel_http;68;channel http access
zchannel_mdap;69;channel mdap access
zchannel_serial;70;channel serial access
zorigin_lan;80;origin lan access
zorigin_wan;81;origin wan access
zorigin_local;82;origin local access
ztrace;93;trace commands configurations
yr;0;2;3;14
yw;1;16;17;28
u;66;67;68;69;70
v;80;81;82
w;64
x;65
t;93
pAP1;20000:0:0;LAN_Local_all
pAP10;2005c:0:0;LAN only with MDAP
pAP2;20001:0:0;LAN_Local with all secured channels
pAP3;5006d:0:0;WAN from a secure HTTP
pAP4;60008:0:0;LAN from all channels except telnet
pAP5;60009:0:0;LAN from all secured channels except telnet
pAP6;10:0:0;All origins_noHTTP
pAP7;11:0:0;All origins_from all secured channels no http
pAP8;50008:0:0;WAN from all channels except telnet
pAP9;6006c:0:0;LAN from a HTTP/HTTPS
qSP1;4004;Limited_Read
qSP10;1:c0000000;Simple_network_debugging
qSP11;1e:0;Advance_Network_debugging
qSP12;20:0;User_admin
qSP13;40:0;MLP_Admin
qSP14;100:0;Backup & Restore
qSP15;200:0;CLI mngt Interface only
qSP16;400:0;CGI mngt Interface only
qSP17;800:0;FTP mngt Interface only
qSP18;2000:0;reset to factory defaults
qSP19;4000:0;advance cgi
qSP20;8000:0;MDAP from LAN
qSP21;20000:0;Webservice
qSP22;1000:0;MDAP upgrade
qSP23;2:0:0;sensitive file access
qSP24;40000;passive FS writing
qSP25;20000000:0:0;trace commands configurations
qSP26;100000:0;MDAP minimal
qSP30;10000000:0;upgrade privilege
qSP2;c7fc;detailed_Read
qSP3;10000;Write_to_LAN
qSP4;780000;Write_FWD_RT_normal_FW_cfgs
qSP5;6c01c00;cooperative_cfgs
qSP6;8002000;Remote Configurations
qSP7;1000000;Advanced sink & source FW
qSP8;283a81c8;Write_to_U_Connection
qSP9;10004000;Write_to_Local
rSuperUser;root;Any service and any access from LAN/WAN/LOCAL except telnet
sAP4;anyservice
sAP8;anyservice
rTechnicalSupport;SuperUser;Any service and any channels from WAN except telnet
sAP8;anyservice
rUpgrade;root;MDAP Upgrade from LAN origin
sAP10;SP22
sAP10;SP26
rInstall;root;MDAP only check from LAN origin
sAP10;SP26
rPowerUser;Upgrade;HTTP access
sAP9;anyservice
gcontentsharing;0
gcontentsharing cifs;0
cconfig;200:0
ostate;200:0
oworkgroup;200:0
oname;200:0
ocomment;200:0
clist;200:0
gcontentsharing ftp;200:0
cconfig;200:0
ostate;200:0
clist;200:0
gcontentsharing upnp;200:0
cconfig;200:0
ostate;200:0
ofriendlyname;200:0
clist;200:0
gcontentsharing upnp radiostation;200:0
cconfig;200:0
ostate;200:0
clist;200:0
gcontentsharing upnp radiostation station;200:0
cadd;200:0
cdelete;200:0
clist;200:0
gcontentsharing upnpav;200:0
cconfig;200:0
ostate;200:0
ofriendlyname;200:0
clist;200:0
gcontentsharing upnpav radiostation;200:0
cconfig;200:0
ostate;200:0
clist;200:0
gcontentsharing upnpav radiostation station;200:0
cadd;200:0
cdelete;200:0
clist;200:0
gfirewall;200:0
cconfig;200:800000
ostate;200:800000
okeep;200:800000
otcpchecks;200:800000
oudpchecks;200:800000
oicmpchecks;200:800000
ologdefault;200:800000
ologthreshold;200:800000
otcpwindow;200:800000
otest;200:800000
cclear;200:800000
clist;200:200
oformat;200:200
gfirewall chain;200:800200
cadd;200:800000
opolicy;200:800000
cdelete;200:800000
cmodify;200:800000
opolicy;200:800000
clist;200:200
oformat;200:200
cflush;200:1000000
gfirewall debug;200:0
ctraceconfig;200:0
otcpchecks;200:0
oudpchecks;200:0
oicmpchecks;200:0
osink;200:0
oforward;200:0
osource;200:0
cstats;200:0
cclear;200:0
gfirewall level;200:200
cadd;200:200
oindex;200:200
oreadonly;200:200
oudptrackmode;200:200
oservice;200:200
oproxy;200:200
otext;200:200
opolicy;0
cdelete;200:800200
cmodify;200:800200
oindex;200:800200
oreadonly;200:800200
oudptrackmode;200:800200
oservice;200:800200
oproxy;200:800200
otext;200:800200
opolicy;0
clist;200:200
oformat;200:200
cset;200:800200
oname;200:800200
cflush;200:800200
gfirewall rule;200:200
cadd;200:800000
oindex;200:800000
onewindex;200:800000
oname;200:800000
oclink;200:800000
osrcintf;200:800000
osrcip;200:800000
odstintf;200:800000
odstip;200:800000
oserv;200:800000
osrcmac;200:800000
olength;200:800000
olog;200:800000
ostate;200:800000
oconnstate;200:800000
cdelete;200:1000000
cmodify;200:1000000
oindex;200:1000000
onewindex;200:1000000
oname;200:1000000
oclink;200:1000000
osrcintf;200:1000000
osrcip;200:1000000
odstintf;200:1000000
odstip;200:1000000
oserv;200:1000000
osrcmac;200:1000000
olength;200:1000000
olog;200:1000000
ostate;200:1000000
oaction;200:1000000
oconnstate;200:1000000
clist;200:200
ochain;200:200
oformat;200:200
cflush;200:800000
ochain;200:800000
gfirewall rule debug;210:0
ctraceconfig;210:0
ostate;210:0
cstats;210:0
ochain;210:0
oindex;210:0
cclear;210:0
ochain;210:0
oindex;210:0
gled;200:4000
cconfig;200:4000
ostatustimeout;200:10004000
gprintersharing;200:0
gprintersharing LPD;200:0
cconfig;200:0
ostate;200:0
clist;200:0
gprintersharing LPD queue;200:0
cadd;200:0
otype;200:0
odefault;200:0
cdelete;200:0
clist;200:0
gprintersharing RAW;200:0
cconfig;200:0
ostate;200:0
oport;200:0
clist;200:0
gpwr;0
cwlanpowercontrol;0
ostate;0
oton;0
otoff;0
otext;0
cr4kwait;0
ostate;0
cGatewayOperationalState;0
cusbhost;0
ostate;0
ccpuspeed;0
ostate;0
gservice;200:4
gservice host;200:10004
clist;200:4
oname;200:4
cadd;200:10000
omode;200:10000
ocategory;200:10000
cdelete;200:10000
cassign;200:10000
ohost;200:10000
olog;200:10000
cdisable;200:10000
oname;200:10000
cstats;200:4
cconfig;200:0
otrace;200:10000
ctriggerlist;200:4
cflush;200:10000
gservice host category;200:10000
cadd;200:10000
cdelete;200:10000
crename;200:10000
clist;200:4
gservice host rule;200:10000
cadd;200:10000
oprotocol;200:10000
obaseport;200:10000
otriggerport;200:10000
otriggerprotocol;200:10000
omode;200:10000
cdelete;200:10000
oprotocol;200:10000
obaseport;200:10000
otriggerport;200:10000
otriggerprotocol;200:10000
omode;200:10000
gservice system;200:2000c
clist;200:4000
oname;200:4000
oexpand;200:4000
odynamics;200:4000
omembers;200:4000
cmodify;200:20000
ostate;200:20000
oport;200:10000000
odynportrange;200:30000
oqoslabel;200:30000
oroutelabel;200:30000
osrcintf;200:30000
olog;200:20000
oforward;200:20000
onatpmweight;200:30000
cmapadd;200:20000
cmapdelete;200:20000
cifadd;200:20000
ogroup;200:20000
ointf;200:20000
cifdelete;200:20000
ogroup;200:20000
ointf;200:20000
cipadd;200:20000
cipdelete;200:20000
gservice system debug;201:0
cstats;201:0
gautopvc;200:8
cconfig;200:8
omode;200:20000
otype;200:20000
ooverwrite;200:20000
opeakrate;200:20000
clist;200:8
otable;200:8
gconnection;0
cconfig;0
oconfigchangemode;0
oprobes;0
oudptrackmode;0
osafepredicts;0
ctimerconfig;0
otimer;0
ovalue;0
ctimerclear;0
otimer;0
cinfo;0
clist;0
oid;0
onr;0
ohistory;0
ostring;0
obeginstring;0
oproto;0
oip;0
oport;0
ointf;0
oroutelabel;0
oqoslabel;0
oapplication;0
oreserved;0
oaccelerated;0
oprioritized;0
cdescribe;0
oid;0
crefresh;0
cclear;0
cclean;0
olevel;0
cstats;0
creserve;0
oflow;0
oamount;0
crelease;0
oflow;0
capplist;0
cappconfig;0
otrace;0
otimeout;0
ochildqos;0
ofloating;0
oproxy;0
otracelevel;0
oSIP_ALG;0
osnooping;0
otranslate-predict;0
oRTP_predict_for_term_SIP_ALG;0
cappinfo;0
cbindlist;0
cbind;0
oport;0
cunbind;0
oport;0
cflush;0
cdebug;0
otrace;0
gconnection bindblacklist;0
cadd;0
oproto;0
oport;0
cdelete;0
oproto;0
oport;0
clist;0
gconnection flow;0
cadd;0
oname;0
cdelete;0
oflow;0
cqoslabeladd;0
oflow;0
oqoslabel;0
cqoslabeldel;0
oflow;0
oqoslabel;0
clist;0
cflush;0
gcwmp;200:10100000
cconfig;200:10100000
ostate;200:10100000
omode;200:10100000
operiodicInform;200:10100000
operiodicInfInt;200:10100000
operiodicInfTime;200:10100000
osessionTimeout;200:10100000
onoIpTimeout;200:10100000
omaxEnvelopes;200:10100000
oconnectionRequest;200:10100000
oconnectionReqPath;200:10100000
oconnectionReqUserName;200:10100000
oconnectionReqPsswd;200:10100000
oconnectionReqAuth;200:10100000
oqos-class;200:10100000
obootdelayrange;200:10100000
oupgradedelay;200:10100000
odelaytimeoutaction;200:10100000
oam1Termination;200:10100000
opersistentSubscription;200:10100000
oconnectionReqThrotNumber;200:10100000
oconnectionReqThrotTime;200:10100000
oshowPasswords;200:10100000
ourlSource;200:10100000
cruntimevar;200:10100000
ccmd;200:10100000
gcwmp debug;210:0
ctraceconfig;210:0
olevel;210:0
gcwmp notification;200:10100000
crule;200:10100000
onotification;200:10100000
oname;200:10100000
okeystring;200:10100000
cnotifiedparameter;200:10100000
oname;200:10100000
gcwmp server;200:0
cconfig;200:10000
ourl;200:10000
ousername;200:10000
opassword;200:10000
gdhcp;200:0
gdhcp client;200:0
cifadd;200:10000
cifattach;200:10000
cifconfig;200:10000
oclientid;200:10000
ohostname;200:10000
ovendor;200:10000
ouserid;200:10000
oaddr;200:10000
oleasetime;200:10000
odomain;200:10000
odns;200:10000
ostatrt;200:10000
ogateway;200:10000
olabel;200:10000
ometric;200:10000
odnsmetric;200:10000
obroadcast;200:10000
oserverroute;200:10000
ofollowlabel;200:10000
cifdelete;200:10000
cifdetach;200:10000
ciflist;200:4
ointf;200:4
oexpand;200:4
cifrenew;200:10000
cflush;200:10000
gdhcp client debug;200:10000
ctraceconfig;204:40000000
ostate;0
cstats;204:40000000
cclear;200:10000
gdhcp client rqoptions;200:0
cadd;200:10000
oindex;200:10000
cdelete;200:10000
clist;200:4
ointf;200:4
coptionlist;200:4
gdhcp client txoptions;200:0
cadd;200:10000
oenterprise;200:10000
osuboption;200:10000
oindex;200:10000
cdelete;200:10000
oenterprise;200:10000
osuboption;0
clist;200:4
ointf;200:4
oexpand;200:4
coptionlist;200:4
gdhcp relay;200:10004
cifconfig;0
orelay;0
omaxhops;0
oremoteid;0
otrusted;0
ciflist;0
ointf;0
cadd;200:10000
cdelete;200:10000
cmodify;200:10000
oaddr;200:10000
ointf;200:10000
ogiaddr;200:10000
oscript;200:10000
clist;200:4
oname;200:4
cruleadd;200:10000
okey;200:10000
cruledelete;200:10000
cconfig;200:10000
oagentinfo;0
oagentmismatch;0
cflush;200:10000
gdhcp relay debug;200:10000
ctraceconfig;204:40000000
ostate;0
cstats;204:40000000
gdhcp rule;200:10000
cadd;200:10000
oenterprise;200:10000
osuboption;200:10000
ovalue;200:10000
omatch;200:10000
okey;200:10000
cdelete;200:10000
clist;200:4
cflush;200:10000
gdhcp rule debug;200:10000
ctraceconfig;204:40000000
ostate;200:10000
gdhcp server;200:4
cconfig;200:4
ostate;200:10000
cpolicy;200:10000
overifyfirst;200:10000
otrustclient;200:10000
ortbehaviour;200:10000
oackinform;200:10000
cflush;200:10000
gdhcp server debug;200:10000
ctraceconfig;204:40000000
ostate;0
cstats;200:4
cclear;200:10000
gdhcp server lease;200:10004
cadd;200:10000
oaddr;200:10000
ooffset;200:10000
olifetime;200:10000
oleasetime;200:10000
oexpirytime;200:10000
ogateway;200:10000
omacaddr;200:10000
oallocation;200:10000
cdelete;200:10000
oclientid;200:10000
oindex;200:10000
oexpand;200:10000
cflush;200:10000
opool;200:10000
clist;200:4
oclientid;200:4
oindex;200:4
oexpand;200:4
gdhcp server option;200:4
ctmpladd;200:10000
odynamic;200:10000
otype;200:10000
ctmpldelete;200:10000
ctmpllist;200:4
cinstadd;200:10000
opolicy;200:10000
odynamic;200:10000
omaxuse;200:10000
oenterprise;200:10000
osuboption;200:10000
cinstdelete;200:10000
oenterprise;200:10000
osuboption;200:10000
cinstlist;200:4
oname;200:4
cruleadd;200:10000
okey;200:10000
cruledelete;200:10000
cflush;200:10000
gdhcp server pool;200:10004
cadd;200:10000
oindex;200:10000
cconfig;200:10000
ostate;0
oallocation;200:10000
ointf;0
oindex;200:10000
opoolstart;200:10000
opoolend;200:10000
onetmask;200:10000
ogateway;200:10000
oserver;200:10000
oprimdns;200:10000
osecdns;200:10000
odnsmetric;200:10000
oprimwins;200:10000
osecwins;200:10000
oleasetime;200:10000
orenewtime;200:10000
orebindtime;200:10000
olockouttime;200:10000
ounnumbered;200:10000
olocalgw;200:10000
olocaldns;200:10000
cdelete;200:10000
crtadd;200:0
odstmsk;200:0
ogateway;200:0
crtdelete;200:0
odstmsk;200:0
ogateway;200:0
coptadd;200:0
coptdelete;200:0
cruleadd;200:0
okey;200:0
cruledelete;200:0
cflush;200:0
clist;200:4
oname;200:4
gdhcp spoofing;200:4
cconfig;200:10000
ostate;200:10000
cadd;200:10000
cdelete;200:10000
cattach;0
cdetach;0
clist;200:4
oname;200:4
coption-add;200:10000
coption-delete;200:10000
cflush;200:10000
gdhcp spoofing debug;200:4
ctraceconfig;204:10000
ostate;204:10000
gdns;200:10000000
gdns client;200:10000000
cdnsadd;200:10100000
oport;200:10100000
cdnsdelete;200:10100000
cdnslist;200:10100000
cconfig;200:10100000
otimeout;200:10100000
oretry;200:10100000
ostate;200:10100000
osearch;200:10100000
olist;200:10100000
otrace;200:10100000
cnslookup;200:10100000
cflush;200:10100000
gdns server;200:10100000
cconfig;200:4000
odomain;200:4000
otimeout;200:4000
osuppress;200:4000
ostate;200:4000
otrace;200:4000
osyslog;200:4000
oWANDownSpoofing;200:4000
oWDSpoofedIP;200:4000
cflush;200:10000000
gdns server debug;200:4080
cstats;200:4000
cclear;200:10000000
gdns server debug spoof;200:10000000
cclear;200:10000000
clist;200:10000000
cgetflags;200:10000000
cgetaddress;200:10000000
cupdate;200:10000000
gdns server host;200:10000000
cadd;200:10100000
oaddr;200:10100000
ottl;200:10100000
cdelete;212:4080
cflush;212:4000
clist;212:10000080
gdns server route;200:10000000
cadd;201:4000
osrc;201:4000
osrcmask;201:4000
odomain;201:4000
ometric;201:4000
olabel;201:4000
ointf;201:4000
cdelete;200:10000000
odomain;200:10000000
ointf;200:10000000
cflush;200:10100000
clist;200:10000080
gdsd;200:10100000
cconfig;200:10100000
ostate;200:10100000
gdsd debug;200:10100000
cconfig;200:10100000
oturbomode;200:10100000
cstats;200:10100000
oname;200:10100000
oclear;200:10100000
crecycling;200:10100000
ostate;200:10100000
ointerval;200:10100000
ohttpidle;200:10100000
ootheridle;200:10100000
cproxy;200:10100000
ostate;200:10100000
odest;200:10100000
oport;200:10100000
gdsd debug connection;200:10100000
clist;200:10100000
oexpand;200:10100000
gdsd intercept;200:10100000
cconfig;200:10100000
oWDSpoofedIP;200:10100000
oservertimeout;200:10100000
oconnecterrorurl;200:10100000
ocategoryerrorurl;200:10100000
omonitorintercepturl;200:10100000
ounauthorizedrequrl;200:10100000
oimageredirect;200:10100000
oimageredirecturl;200:10100000
oalwaysuseip;200:10100000
gdsd syslog;200:10100000
cconfig;200:10100000
osyslog;200:10100000
clist;200:10100000
gdsd urlfilter;200:10100000
cconfig;200:10000080
ostate;200:10000080
oblockproxy;200:10000080
oblockipaddress;200:10000080
oblockobscuredip;200:10000080
odefaultaction;200:10000080
gdsd urlfilter rule;200:10100000
cadd;200:10100000
cdelete;200:10100000
ourl;200:10100000
cmodify;200:10100000
onewurl;200:10100000
clist;200:10000080
cflush;200:10100000
gdsd webfilter;200:10100000
cconfig;200:10000080
ostate;200:10000080
oserverunreachable;200:10000080
ouncategorized;200:100000080
olicense;200:10000080
oticket;200:10000080
osessionkey;200:10000080
clist;200:10100000
gdsd webfilter cache;200:10100000
cstats;200:10100000
oexpand;200:10100000
cflush;200:10100000
gdsd webfilter professional;200:10100000
cconfig;200:10100000
olistversion;200:10100000
ovalidcatmask;200:10100000
gdsd webfilter professional category;200:10100000
ccreate;200:10100000
cadd;200:10100000
cremove;200:10100000
cdelete;200:10100000
clist;200:10100000
otype;200:10100000
cflush;200:10100000
gdsd webfilter professional level;200:10100000
cset;200:10100000
cadd;200:10100000
otext;200:10100000
ootherurls;200:10100000
cmodify;200:10100000
otext;200:10100000
ootherurls;200:10100000
cdelete;200:10100000
otext;200:10100000
ootherurls;200:10100000
clist;200:10100000
cflush;200:10100000
gdsd webfilter professional rule;200:10100000
cmodify;200:10100000
oid;200:10100000
clist;200:10100000
olevel;200:10100000
cclear;200:10100000
gdsd webfilter server;200:10100000
cconfig;200:10100000
olistversion;200:10100000
oretries;200:10100000
oservertimeout;200:10100000
otimeoutmultiplier;200:10100000
orenewfrequency;200:10100000
ouseproxy;200:10100000
oproxyserver;200:10100000
oproxyport;200:10100000
cadd;200:10100000
oindex;200:10100000
cmodify;200:10100000
cdelete;200:10100000
clist;200:10100000
cflush;200:10100000
gdsd webfilter standard;200:10100000
cconfig;200:10100000
ostdmax;200:10100000
ovalidcatmask;200:10100000
gdsd webfilter standard category;200:10100000
ccreate;200:10100000
cadd;200:10100000
cremove;200:10100000
cdelete;200:10100000
clist;200:10100000
otype;200:10100000
cflush;200:10100000
gdsd webfilter standard level;200:10100000
cset;200:10100000
cadd;200:10100000
otext;200:10100000
ootherurls;200:10100000
cmodify;200:10100000
otext;200:10100000
ootherurls;200:10100000
cdelete;200:10100000
otext;200:10100000
ootherurls;200:10100000
clist;200:10100000
cflush;200:10100000
gdsd webfilter standard rule;200:10100000
cmodify;200:10100000
oid;200:10100000
clist;200:10100000
olevel;200:10100000
cclear;200:10100000
gdyndns;200:10100000
cadd;200:10100000
cmodify;200:10100000
ointf;200:10100000
ouser;200:10100000
opassword;200:10100000
ogroup;200:10100000
omx;200:10100000
obackmx;200:10100000
owildcard;200:10100000
ooffline;200:10100000
oservice;200:10100000
ostatus;200:10100000
otrace;200:10100000
cdelete;200:10100000
cflush;200:10100000
clist;200:4080
gdyndns host;200:10100000
cadd;200:10100000
cdelete;200:10100000
cflush;200:10100000
clist;200:4080
gdyndns service;200:10100000
cmodify;200:10100000
oserver;200:10100000
oport;200:10100000
orequest;200:10100000
oupdateinterval;200:10100000
oretryinterval;200:10100000
omax_retry;200:10100000
clist;200:4080
geth;200:10004
cifadd;200:10000
cifdelete;200:10000
cifattach;200:10000
cifdetach;200:10000
cifconfig;200:10000
odest;200:10000
oretry;200:10000
owan;200:10000
opriotag;200:10000
omtu;200:10000
ovlan;200:10000
ogroup;200:10000
ciflist;200:4
ointf;200:4
cflush;200:10000
geth bridge;200:8
cconfig;200:8
obrname;200:20000
oage;200:20000
omtu;200:20000
ofilter;200:20000
ovlan;200:20000
oprecedencemap;200:20000
cippriomap;200:20000
obrname;200:20000
cippriomapreset;200:20000
obrname;200:20000
clist;200:4
obrname;200:20000
cadd;200:10000
cdelete;200:10000
cselect;200:8
cifadd;200:20000
obrname;200:20000
cifdelete;200:20000
obrname;200:20000
cifattach;200:20000
obrname;200:20000
cifdetach;200:20000
obrname;200:20000
cifconfig;200:20000
obrname;200:20000
odest;200:20000
oportstate;200:20000
oretry;200:20000
opriotag;200:20000
ovlan;200:20000
oprioconfig;200:20000
oipprec;200:20000
opriority;200:20000
oregenprio;200:20000
oingressfiltering;200:20000
oacceptvlanonly;200:20000
omcastfilter;200:20000
odynvlan;200:20000
odyngroup;200:20000
owan;200:20000
oigmpsnooping;200:20000
opriotransparent;200:20000
obpdufiltering;200:20000
oxtratagging;200:20000
cifflush;200:20000
obrname;200:20000
ciflist;200:8
obrname;200:8
ointf;0
cmacadd;200:20000
obrname;200:20000
ovlan;200:20000
cmaclist;200:8
obrname;200:20000
cmacdelete;200:20000
obrname;200:20000
ovlan;200:20000
cclear;200:20000
obrname;200:20000
cflush;200:10000
obrname;200:20000
geth bridge dyngroup;200:0
cadd;200:10000
oid;200:10000
orgroup;200:10000
odynamic;200:10000
cconfig;200:10000
otimeout;200:10000
geth bridge dynvlan;200:0
cadd;200:10000
oid;200:10000
oremvlan;200:10000
oprio;200:10000
omode;200:10000
odynamic;200:10000
cdelete;200:10000
clist;200:0
cflush;200:10000
cconfig;200:10000
otimeout;200:10000
cactlist;200:10000
geth bridge group;200:0
cadd;200:10000
obrname;200:10000
oname;200:10000
cmove;200:10000
obrname;200:10000
geth bridge igmpsnooping;200:8
cconfig;200:8
obrname;200:20000
ostate;200:20000
ofloodrp;200:20000
ofloodmcast;200:20000
clist;200:8
obrname;200:8
cifconfig;200:8
obrname;200:20000
oportmode;200:20000
ofastleave;200:20000
oexptrack;200:20000
omrdp;200:20000
orgmp;200:20000
ciflist;200:8
obrname;200:8
ointf;200:20000
cclear;200:8
obrname;200:8
ointf;200:20000
geth bridge rule;200:10000
cadd;200:10000
ovlan2;200:10000
oisi;200:10000
cdelete;200:10000
clist;200:0
cflush;200:10000
geth bridge unknownvlan;200:0
cifadd;200:10000
obrname;200:10000
ountagged;200:10000
cifdelete;200:10000
obrname;200:10000
cifconfig;200:10000
obrname;200:10000
ountagged;200:10000
ciflist;200:4
geth bridge vlan;200:8
cifadd;200:10008
ountagged;10008
cifdelete;200:10008
cifconfig;200:10008
ciflist;200:8
geth bridge xtratag;200:0
cadd;200:10000
obrname;200:10000
cdelete;200:10000
obrname;200:10000
cconfig;200:10000
obrname;200:10000
clist;200:4
cflush;200:10000
geth device;200:8
cifconfig;200:10000
ostate;200:10000
otype;200:10000
omtu;0
ostate;200:10000
cifrestart;200:10000
cifautoneg;200:10000
ospeed;200:10000
oduplex;200:10000
opause;200:10000
ciflist;200:8
geth dot1x;200:0
cflush;200:10000
geth dot1x creds;200:0
cadd;200:10000
oname;200:10000
otype;200:10000
ousername;200:10000
opassword;200:10000
cmodify;200:10000
oname;200:10000
otype;200:10000
ousername;200:10000
opassword;200:10000
clist;200:4
oname;200:10000
cdelete;200:10000
oname;200:10000
geth dot1x link;200:0
cadd;200:10000
ointf;200:10000
omaxpeers;200:10000
ounknowns;200:10000
cmodify;200:10000
ointf;200:10000
omaxpeers;200:10000
ounknowns;200:10000
clist;200:4
ointf;200:10000
cdelete;200:10000
ointf;200:10000
geth dot1x port;200:0
cadd;200:10000
oname;200:10000
ointf;200:10000
omode;200:10000
ocredentials;200:10000
pctrl;200:10000
mac;200:10000
cmodify;200:10000
oname;200:10000
ointf;200:10000
omode;200:10000
ocredentials;200:10000
pctrl;200:10000
mac;200:10000
clist;200:4
oname;200:4
cdelete;200:10000
oname;200:10000
geth filter;200:0
geth filter operand;200:0
cadd;200:10000
cconfig;200:10000
oframeclass;200:10000
oipprotocol;200:10000
opriority;200:10000
ovid;200:10000
cdelete;200:10000
creset;200:10000
clist;200:4
ooperand;200:4
oexpand;200:4
cvidadd;200:10000
cviddelete;200:10000
cframeclassadd;200:10000
cframeclassdelete;200:10000
cipprotoadd;200:10000
cipprotodelete;200:10000
cpriorityadd;200:10000
cprioritydelete;200:10000
cflush;200:10000
geth filter template;200:0
cadd;200:10000
olocation;200:10000
olevel;200:10000
otracing;200:10000
omark;200:10000
clist;200:10000
ofilter;200:10000
oexpand;200:10000
cdelete;200:10000
cconfig;200:10000
olocation;200:10000
olevel;200:10000
otracing;200:10000
omark;200:10000
csetvid;200:10000
ostate;200:10000
csetpriority;200:10000
ostate;200:10000
cruleadd;200:10000
onegate;200:10000
oorder;200:10000
ooperator;200:10000
crulemodify;200:10000
ooperand;200:10000
onegate;200:10000
oorder;200:10000
ooperator;200:10000
cruledel;200:10000
cflush;200:10000
geth bridge filter;200:0
cadd;200:10000
ofilter;200:10000
clist;200:4
oname;200:4
ofilter;200:4
oexpand;200:4
cdelete;200:10000
cconfig;200:10000
ofilter;200:10000
cattach;200:10000
cdetach;200:10000
cforwarding;200:10000
cifadd;200:10000
cifdel;200:10000
cfwdintfadd;200:10000
cfwdintfdel;200:10000
geth switch;200:0
cinfo;200:0
geth switch group;200:0
clist;200:0
cmove;200:10000
cdelete;200:10000
cflush;200:10000
geth switch mirror;200:0
ccapture;200:8
cingress;200:8
ostate;200:0
cegress;200:10000
ostate;200:0
geth switch qos;200:0
cconfig;200:10000
onbrOfQueues;200:10000
orealtime;200:10000
othreshold;200:10000
orxbackpressure;200:10000
otxbackpressure;200:10000
cweights;200:10000
cifconfig;200:10000
oflowcontrol;200:10000
clist;200:10000
geth switch shaper;200:0
cconfig;200:10000
ounicast;200:10000
omulticast;200:10000
obroadcast;200:10000
ocontrol;200:10000
ounknown;200:10000
odiscard;200:10000
onormalize;200:10000
oexclude_ipg;200:10000
cifconfig;200:10000
ostate;200:10000
ospeed;200:10000
oburstsize;200:10000
ciflist;200:10000
geth switch share;200:0
cadd;200:10000
cdelete;200:10000
clist;200:10000
geth switch storm;200:0
cifconfig;200:10000
ostate;200:10000
orate;200:10000
oburstsize;200:10000
obroadcast;200:10000
omulticast;200:10000
ounknown;200:10000
ciflist;200:10000
geth vlan;200:8
cadd;200:10008
oaddrule;200:10008
cdelete;200:10008
clist;200:8
cflush;200:10008
geth vlan priomap;200:10008
cconfig;200:10008
clist;200:10008
gadsl;200:20008
cinfo;200:8
oexpand;200:8
olevel;200:8
cconfig;200:8
oopermode;200:20000
oxdsltype;200:20000
ostatus;200:20000
omodemoption;200:20000
odetect-lop;200:20000
osyslog;200:20000
gadsl debug;204:20008
cbitloadinginfo;204:20008
cdeltconfig;204:20008
ostate;204:20008
cdeltinfo;204:20008
cmodemoptioninfo;204:20008
cmultimode;204:20008
oconfig;204:20008
ctraceconfig;204:20008
gadsl qual;204:20008
calb;204:20008
clov;204:20008
clcl;204:20008
cmib;204:20008
cqln;204:20008
gatm;200:80000000
cifadd;200:80000000
oqueues;200:80000000
opriority;200:80000000
cifdelete;200:80000000
cifattach;200:80000000
cifdetach;200:80000000
cifconfig;200:80000000
odest;200:80000000
oqos;200:80000000
oclp;200:80000000
oclpthresh;200:80000000
oencaps;200:80000000
ofcs;200:80000000
oulp;200:80000000
omtu;200:80000000
oretry;200:80000000
ciflist;200:80000000
ointf;200:80000000
cflush;200:80000000
gatm cac;200:80000000
cconfig;200:80000000
coverbooking;200:80000000
ort;200:80000000
onrt;200:80000000
clist;200:80000000
gatm debug;200:80000008
ctraceconfig;200:80000008
olen;200:80000008
ointf;200:80000008
ostate;200:80000008
cportstats;200:80000008
oclear;200:80000008
cvcstats;200:80000008
ovci;200:80000008
oclear;200:80000008
caal5stats;200:80000008
ovci;200:80000008
oclear;200:80000008
cgstats;200:80000008
oclear;200:80020008
ctraceconfig;200:80000008
olen;200:80000008
ointf;200:80000008
ostate;200:80000008
gatm oam;200:80000000
cping;200:80000000
ocount;200:80000000
ointerval;200:80000000
cconfig;204:80000008
oclp;204:80020000
oloopbackid;204:80020000
cmodify;200:20008
clist;204:8
gatm oam cc;200:8
cmodify;200:20000
ovci;200:20000
otransmit;200:20000
oreceive;200:20000
oauto;200:20000
ospan;200:20000
csend;204:20000
ovci;204:20000
ospan;204:20000
oaction;204:20000
odirection;204:20000
clist;200:8
gatm oam vclb;200:8
cadd;200:8
ovci;200:8
cdel;200:8
ovci;200:8
clist;200:8
gatm phonebook;204:10024008
cautolist;204:4008
clist;200:4008
cadd;200:10020000
cdelete;200:10020000
cflush;200:10020000
gatm qos;200:10020000
clist;200:10020000
ointf;200:10020000
gatm qos queue;200:10020000
cconfig;200:10020000
clist;200:10020000
ointf;200:10020000
gatm qosbook;200:1000c000
cconfig;200:c000
oformat;200:10000000
cctdlist;200:4000
cctdadd;200:30000000
opeakrate;200:30000000
osustrate;200:30000000
omaxburst;200:30000000
ominrate;200:30000000
omaxframe;200:30000000
ocelldelay;200:30000000
orealtime;200:30000000
oframediscard;200:30000000
cctddelete;200:30000000
oforce;200:30000000
clist;200:c000
cadd;200:30000000
otxctd;200:30000000
orxctd;200:30000000
cdelete;200:30000000
oforce;200:30000000
cflush;200:30000000
gar;220:0
gar group;220:0
gar group member;220:0
cadd;260:20
cdelete;260:20
clist;260:20
ogroupname;260:20
gconfig;10
csave;40000
cload;40000
oload_ip;40000
odefaults;40000
oflush;40000
opersistent;40000
oecho;40000
ofilename;40000
cdelete;40000
ofilename;40000
cflush;40000
oflush_ip;40000
clist;8000:0
otemplates;10
cdump;20
cfile;10
oencrypt;10
gdebug;200:8
cexec;200:8
cprompt;0
cshell;0
ctasks;0
cdmesg;200:8
gdiag;200:c
cconfig;200:c
opingtimeout;200:c
opingpacketsize;200:c
cifhide;200:c
ciflist;200:c
cifconfig;200:c
oping;200:c
oipaddress;200:c
cflush;200:c
genv;1000:0
cset;200:10000000
cdef;200:10000000
ogrp;200:10000000
odesc;200:10000000
ohelp;200:10000000
oalias;200:10000000
oreq;200:10000000
odefault;200:10000000
odata;200:10000000
odalias;200:10000000
omin;200:10000000
omax;200:10000000
ocalc;200:10000000
olinkvar;200:10000000
cget;200:4000
cunset;200:10000000
clist;1000:0
cflush;200:10000000
chash;200:10000000
gexpr;200:400c
cadd;200:10030000
otype;200:10030000
omask;200:10030000
ointf;200:10030000
ointfgroup;200:10030000
obridgeport;200:10030000
otos;200:10030000
oprecedence;200:10030000
odscp;200:10030000
oproto;200:10030000
osrcport;200:10030000
osrcportend;200:10030000
odstport;200:10030000
odstportend;200:10030000
oicmptype;200:10030000
oicmpcode;200:10030000
oicmpcodeend;200:10030000
oiplengthmax;200:10030000
cdelete;200:10030000
oindex;200:10030000
cmodify;200:10030000
otype;200:10030000
omask;200:10030000
ointf;200:10030000
ointfgroup;200:10030000
obridgeport;200:10030000
otos;200:10030000
oprecedence;200:10030000
odscp;200:10030000
oproto;200:10030000
osrcport;200:10030000
osrcportend;200:10030000
odstport;200:10030000
odstportend;200:10030000
oicmptype;200:10030000
oicmpcode;200:10030000
oicmpcodeend;200:10030000
oiplengthmax;200:10030000
clist;200:400c
oname;200:400c
otype;200:400c
oformat;200:400c
odynamic;200:400c
cflush;200:10030000
ggrp;200:8b004c
cifconfig;200:800000
crtlist;200:40
odst;200:40
odstmsk;200:40
cconfig;200:40
ocdistance;200:80000
okdistance;200:80000
ordistance;200:80000
otrace;200:80000
ciflist;200:c
ointf;200:c
crttadd;200:0
odstmsk;200:0
otdstmsk;200:0
crttdelete;200:0
odstmsk;200:0
otdstmsk;200:0
crttlist;200:c
cflush;200:80000
ggrp rip;200:b0040
cifconfig;200:80000
orip;200:80000
otxversion;200:80000
orxversion;200:80000
oauthmode;200:80000
oauthstr;200:80000
opassive;200:80000
osplithorizon;200:80000
cbnadd;200:b0000
onetmask;200:b0000
cbndelete;200:b0000
onetmask;200:b0000
cbnlist;200:40
cnbadd;200:b0000
cnbdelete;200:b0000
cnblist;200:b0000
crtfadd;200:0
onetmask;200:0
crtfdelete;200:0
onetmask;200:0
crtflist;200:40
cconfig;200:40
oversion;200:80000
odefmetric;200:80000
oupdatetime;200:80000
otimeouttime;200:80000
ogarbagetime;200:80000
oimpcrt;200:80000
oimpkrt;200:80000
oimpsrt;200:80000
oimpdefkrt;200:80000
oimpdefsrt;200:80000
oexprt;200:80000
oexpdefrt;200:80000
otxdefrt;200:80000
otrace;200:80000
cshow;200:40
cflush;200:b0000
ghostmgr;200:b0000
cclear;200:b0000
cflush;200:b0000
cconfig;200:b0000
ostate;200:b0000
oscantime;200:b0000
oautosave;200:b0000
otrace;200:b0000
cadd;200:b0000
oip_addr;200:b0000
oname;200:b0000
ohost_type;200:b0000
ohost_name;200:b0000
ouser_friendly_name;200:b0000
odns_name;200:b0000
otype;200:b0000
ointerface;200:b0000
oip_intf;200:b0000
oipintf;200:b0000
oethintf;200:b0000
ophysintf;200:b0000
ouser_set;200:b0000
cupdate;200:b0000
ohost_type;200:b0000
ohost_name;200:b0000
ouser_friendly_name;200:b0000
odns_name;200:b0000
otype;200:b0000
ointerface;200:b0000
oip_intf;200:b0000
ouser_set;200:b0000
cdelete;200:b0000
otype;200:b0000
oindex;200:b0000
clist;200:4c
oexpand;200:4c
gids;400200
cconfig;400200
ostate;400200
otrace;400200
cclear;400200
gids conntrack;400200
clist;200
osize;200
cstats;200
cclear;400200
gids parser;400200
clist;400200
oparser;400200
cmodify;400200
oparser;400200
gids pattern;400200
clist;200
osize;200
cstats;200
cclear;400200
gids signature;400200
clist;200
osignature;200
cmodify;400200
osignature;400200
gids threshold;400200
clist;200
cmodify;400200
owindow;400200
olimit;400200
oscaling;400200
cclear;400200
gigmp;400200
gigmp host;400200
cconfig;400200
orequirera;400200
cifconfig;400200
ciflist;400200
oexpand;400200
clist;200
ointf;200
oexpand;0
cflush;400200
gigmp host debug;0
cstats;200
cclear;400200
gigmp proxy;400200
cconfig;400200
ostate;400200
oqi;400200
oqri;400200
olmqi;400200
orv;400200
oadvinter;400200
oinitadvinter;400200
oinitadvcount;400200
orequirera;400200
olocalgroup;400200
cifconfig;400200
ostate;400200
oversion;400200
ofastleave;400200
oexptrack;400200
omrd;400200
ospoofing;400200
ciflist;400200
oexpand;400200
cgrouplist;400200
ointf;400200
oexpand;400200
cmbslist;400200
cflush;400200
gigmp proxy debug;400200
ctraceconfig;400200
ostate;400200
cstats;200
cclear;400200
ginterface;c
clist;c
oexpand;c
oreverse;c
gip;200:130000
cifadd;200:30000
cifdelete;200:30000
cifattach;200:330000
cifdetach;200:330000
cifconfig;200:330000
omtu;200:30003
ostatus;200:30003
ohwaddr;200:30003
oarpcachetimeout;200:30003
ogroup;200:30003
olinksensing;200:30003
oprimary;200:30003
omcastmode;200:0
omcastpromisc;200:0
osymmetric;200:0
oarpprobe;200:0
ciflist;200:0
oexpand;200:0
olegend;200:0
cifwait;200:130000
otimeout;200:130000
oadminstatus;200:130000
ooperstatus;200:130000
olinkstatus;200:130000
cipadd;200:330000
onetmask;200:330000
opointopoint;200:330000
oaddroute;200:330000
oaddhostroute;200:330000
otype;200:330000
cipdelete;200:130000
cipconfig;200:130000
opreferred;200:130000
oprimary;200:130000
ciplist;200:c
oexpand;200:c
crtadd;200:100000
odstmsk;200:100000
olabel;200:100000
ogateway;200:100000
ointf;200:100000
osrcintf;200:100000
ostatic;200:100000
ostatus;200:100000
ometric;200:100000
otype;200:100000
crtconfig;200:100000
odstmsk;200:100000
olabel;200:100000
ogateway;200:100000
ointf;200:100000
osrcintf;200:100000
ostatic;200:100000
ostatus;200:100000
ometric;200:100000
crtdelete;200:100000
odstmsk;200:100000
olabel;200:100000
ogateway;200:100000
ointf;200:100000
crtlist;200:80
oexpand;200:80
carpadd;200:10100000
ohwaddr;200:10100000
carpdelete;200:10100000
ohwaddr;200:10100000
carplist;200:408c
cconfig;200:42c0
oforwarding;200:10100000
oredirects;200:10000000
ocheckoptions;200:10000000
onetbroadcasts;200:10000000
orandomdatagramids;200:10000000
ottl;200:10000000
ofraglimit;200:10000000
odefragmode;200:10000000
oaddrcheck;200:10000000
omssclamping;200:10000000
onatloopback;200:10000000
oarpcachetimeout;200:10000000
oarpclass;200:10100000
obitrate-window(sec);200:10000000
oacceleration;200:10000000
cflush;200:10030000
gip auto;200:10014004
cifadd;200:10010000
oaddr;200:10010000
cifdelete;200:10010000
cifattach;200:10010000
cifdetach;200:10010000
cifconfig;200:10010000
oaddr;200:10010000
opoolstart;200:10010000
opoolend;200:10010000
onetmask;200:10010000
oclaim;200:10010000
odefence;200:10010000
oprobe;200:10010000
ointerval;200:10010000
ciflist;200:4004
ointf;200:4004
cflush;200:10010000
gip auto debug;200:c000000c
ctraceconfig;200:c000000c
otrace;200:c000000c
ostate;200:c000000c
gip debug;200:c000000c
cstats;200:c
ctraceconfig;216:0
oinput;216:0
oforward;216:0
ooutput;216:0
odrop;216:0
opath;216:0
omode;216:0
oarp;216:0
csendto;200:c0000000
ocount;200:c0000000
osize;200:c0000000
ointerval;200:c0000000
olisten;200:c0000000
odffield;200:c0000000
osrcaddr;200:c0000000
osrcport;200:c0000000
odstintf;200:c0000000
chttpprobe;210:c
oversion;0
otracelevel;0
gip mcast;200:10014004
crtadd;200:10010000
osrc;200:10010000
ottl;200:10010000
ottlincr;200:10010000
crtdelete;200:10010000
osrc;200:10010000
crtlist;200:400c
oexpand;200:400c
cflush;200:10010000
gipqos;20000000
cconfig;200:0
ostate;200:20000000
odiscard;200:20000000
opriority;200:20000000
orealtimerate;200:20000000
oburstsize;200:20000000
oqtyrealtimequeues;200:20000000
obackgroundqueue;200:20000000
oecnthreshold;200:20000000
oweight1;200:20000000
oweight2;200:20000000
oweight3;200:20000000
oweight4;200:20000000
oweight5;200:20000000
omaxpackets;200:20000000
omaxbytes;200:20000000
clist;200:8000
gipqos ef;200:8000
cconfig;200:20000000
odiscard;200:20000000
ostate;200:20000000
otimeout;200:20000000
omtu;200:20000000
clist;200:8000
cstats;200:8000
gipqos meter;200:0
cadd;200:20000000
cconfig;200:8000
olabel;200:20000000
ointf;200:20000000
odroprate;200:20000000
omarkrate;200:20000000
oburst;200:20000000
odropaction;200:20000000
omarkaction;200:20000000
otosmarking;200:20000000
otos;200:20000000
odscp;200:20000000
oprecedence;200:20000000
oclassification;200:20000000
oclass;200:20000000
cdelete;200:20000000
clist;200:8000
cstart;200:20000000
cstop;200:20000000
cflush;200:20000000
cstats;200:8000
cclear;200:20000000
gipqos queue;200:8000
cconfig;200:8000
odiscard;200:20000000
opropagate;200:20000000
oecnmarking;200:20000000
omaxrate;200:20000000
omaxburst;200:20000000
oackfiltering;200:20000000
omaxpackets;200:20000000
omaxbytes;200:20000000
orespackets;200:20000000
oresbytes;200:20000000
ohold;200:20000000
omarkprob;200:20000000
oloprio;200:20000000
ohiprio;200:20000000
clist;200:8000
odest;200:8000
cstats;200:8000
odest;200:8000
cclear;200:20000000
gkoa;200:ffffffff
ca;200:ffffffff
ol;200:ffffffff
gkoi;200:ffffffff
ca;200:ffffffff
ol;200:ffffffff
gkta;200:ffffffff
ca;200:ffffffff
ol;200:ffffffff
gkti;200:ffffffff
ca;200:ffffffff
ol;200:ffffffff
glabel;21f:d0884000
cadd;200:10000000
cmodify;206:10000000
oclassification;206:10000000
odefclass;206:10000000
oackclass;206:10000000
obidirectional;206:10000000
oinheritance;206:10000000
otosmarking;206:10000000
otos;206:10000000
odscp;206:10000000
oprecedence;206:10000000
otrace;206:10000000
cdelete;206:10000000
clist;200:4000
oname;200:4000
cflush;206:10000000
glabel chain;200:10004000
cadd;200:10000000
opolicy;200:10000000
cdelete;200:10000000
cmodify;200:10000000
opolicy;200:10000000
clist;200:4000
oformat;200:4000
cflush;200:10000000
glabel rule;201:d0884000
cadd;200:10880000
oindex;200:10880000
onewindex;200:10880000
oname;200:10880000
oclink;200:10880000
osrcintf;200:10880000
osrcip;200:10880000
odstintf;200:10880000
odstip;200:10880000
oserv;200:10880000
osrcmac;200:10880000
olength;200:10880000
olog;200:10880000
ostate;200:10880000
oconnstate;200:10880000
cdelete;200:10880000
cmodify;200:10880000
oindex;200:10880000
onewindex;200:10880000
oname;200:10880000
oclink;200:10880000
osrcintf;200:10880000
osrcip;200:10880000
odstintf;200:10880000
odstip;200:10880000
oserv;200:10880000
osrcmac;200:10880000
olength;200:10880000
olog;200:10880000
ostate;200:10880000
olabel;200:10880000
oconnstate;200:10880000
clist;200:4000
ochain;200:4000
oformat;200:4000
cflush;200:10880000
ochain;200:10880000
glabel rule debug;210:0
ctraceconfig;210:0
ostate;210:0
cstats;210:0
ochain;210:0
oindex;210:0
cclear;210:0
ochain;210:0
oindex;210:0
glanguage;1000:0
cconfig;200:10800000
olanguage;200:10800000
ocomplete;200:10800000
clist;1000:0
cdelete;200:10800000
ofile;200:10800000
oall;200:10800000
clangdef;200:10800000
ocharset;200:10800000
ct;200:10800000
cexclude;200:10800000
cflush;200:10800000
gmbus;10220:0
clistenums;10260:20
odmtree;10260:40000
oname;10260:40000
oexpand;10260:40000
clisttypes;10260:20
odmtree;10260:40000
opath;10260:40000
oexpand;10260:40000
clistobjects;10260:20
odmtree;10260:40000
opath;10260:40000
otype;10260:40000
ooutput;10260:40000
oshowflags;10260:40000
clistcontexts;10260:20
odmtree;10260:40000
oexpand;10260:40000
clistsubscriptions;10260:20
odmtree;10260:40000
cpluginevent;10260:20
oname;10260:40000
ovalue;10260:40000
oorivalue;10260:40000
oflags;10260:40000
cunregister;10260:20
csave;10260:40000
odmtree;10260:40000
ocaching;10260:40000
oforce;10260:40000
opath;10260:40000
cload;10260:40000
odmtree;10260:40000
cdelete;10260:40000
cexport;10260:40000
odmtree;10260:40000
oformat;10260:40000
cimport;10260:40000
cxmldump;10260:40000
oformat;10260:40000
gmbus client;10260:20
cregister;10260:40000
odmtree;10260:40000
otype;10260:40000
odlink;10260:40000
ombusd_addr;10260:40000
orefresolv;10260:40000
ostate_events;10260:40000
cunregister;10260:20
cconfig;10260:40000
owritelock;10260:40000
owlgetimeout;10260:40000
owlidletimeout;10260:40000
opath;10260:40000
otype;10260:40000
oid;10260:40000
cexec;10260:40000
oparam;10260:40000
ovalue;10260:40000
ogettype;10260:40000
odepth;10260:40000
oprocesscmd;10260:40000
oonerrorrollback;10260:40000
ousecallback;10260:40000
ofilter;10260:40000
opath;10260:40000
oflags;10260:40000
oaccesslist;10260:40000
oaction;10260:40000
omodifier;10260:40000
oreplytype;10260:40000
oattribute;10260:40000
otiming;10260:40000
ono_output;10260:40000
cauthenticate;10260:40000
ousername;10260:40000
opassword;10260:40000
oaddr;10260:40000
ctermsession;10260:40000
gmbus debug;10260:20
cstats;10260:40000
cclearstats;10260:40000
ctraceconfig;10260:40000
olevel;10260:40000
cloadobjects;10260:40000
odmtree;10260:40000
opath;10260:40000
otype;10260:40000
oflush;10260:40000
oeventing;10260:40000
onotifyplugin;10260:40000
cunloadobjects;10260:40000
odmtree;10260:40000
opath;10260:40000
otype;10260:40000
oflush;10260:40000
oeventing;10260:4
onotifyplugin;10260:40000
ccommconfig;10260:40000
opong-to;10260:40000
gmbus sqlite;10260:40000
cstats;10260:40000
cclear;10260:40000
cdump;10260:40000
odmtree;10260:40000
oorder;10260:40000
oexpand;10260:40000
cinfo;10260:40000
cexec;10260:40000
cpragma;10260:40000
ovalue;10260:40000
cexit;10260:40000
gmemm;200:0
cstats;200:4000
oname;200:40000
clistobjects;200:4000
oname;200:40000
otagged;200:40000
ohidedeldynstr;200:40000
gmemm debug;210:40000
cstats;210:40000
oname;200:40000
cclearstats;210:40000
ctraceconfig;210:40000
olevel;210:40000
ctag;210:40000
oname;210:40000
otag;210:40000
gmemm debug lock;210:40000
cstats;210:40000
ctraceconfig;210:40000
olevel;210:40000
oname;210:40000
oshowtid;210:40000
gmlp;220:0
cimport;260:20
oallow_dl;260:20
otrace;260:20
cflush;240:0
gmlp debug;270:0
cexport;250:40000
cstats;250:0
ctraceconfig;250:0
otrace;250:0
gmlp interaction;240:0
clist;240:0
otype;240:0
overbose;240:0
oname;240:0
cconfig;240:0
otype;240:0
oscore;240:0
oscore2;240:0
overbose;240:0
orecurse;240:0
caddzone;240:0
oscorenr;240:0
cremovezone;240:0
oscorenr;240:0
gmlp privilege;220:0
cadd;240:0
odescr;240:0
cdelete;240:0
caddzone;240:0
cremovezone;240:0
clist;260:0
oname;260:0
otype;260:0
overbose;260:0
cconfig;240:0
odescr;240:0
oscore;240:0
gmlp role;260:0
cadd;240:0
odescr;240:0
cdelete;240:0
caddpriv;260:0
cremovepriv;260:0
oservice;260:0
clist;260:0
oname;260:0
overbose;260:0
cconfig;260:0
oparent;260:0
odescr;260:0
gmlp zone;240:0
cadd;240:0
odescr;240:0
cdelete;240:0
clist;240:0
cconfig;240:0
oname;240:0
odescr;240:0
cconfigintfgroup;240:0
orw;240:0
otarget;240:0
olan;240:0
owan;240:0
olocal;240:0
cconfigchannels;240:0
oftp;240:0
otelnet;240:0
ohttp;240:0
omdap;240:0
oserial;240:0
cconfigorigin;240:0
olan;240:0
owan;240:0
olocal;240:0
cconfigsecconn;240:0
ozonenr;240:0
cconfigsecfile;240:0
ozonenr;240:0
cconfigtrace;240:0
ozonenr;240:0
gmobile;200:20008
cifadd;200:20000
cifdelete;200:20000
cifconfig;200:20000
opin;200:20000
opuk;200:20000
oapn;200:20000
omode;200:20000
ooperator;200:20000
otechnology;200:20000
oinitcommand;200:20000
ouser;200:20000
opassword;200:20000
cifattach;200:20000
cifdetach;200:20000
ciflist;200:8
ointf;200:8
csimcard;200:8
gmobile debug;204:20008
coperator;204:20008
olist;204:20008
cshowsq;204:20008
csendat;204:20008
ctraceconfig;204:20008
ostate;204:20008
gmobile device;200:20008
cadd;200:20000
ostoragevid;200:20000
ostoragepid;200:20000
omodeswitchparam;200:20000
oforceusb11;200:20000
cdelete;200:20000
clist;200:8
gnat;200:1020010c
cifconfig;200:10200000
ciflist;200:c
cmapadd;200:10204100
otype;200:10204100
ooutside_addr;200:10204100
oinside_addr;200:10204100
oaccess_list;200:10204100
oforeign_addr;200:10204100
oprotocol;200:10204100
ooutside_port;200:10204100
oinside_port;200:10204100
omode;200:10204100
oinbound;200:10204100
oweight;200:10204100
ostatus;200:10204100
cmapdelete;200:10200000
cmaplist;200:0
ointf;200:0
oexpand;200:0
osort_s;200:0
ctmpladd;200:10200000
ointf;200:10200000
ogroup;200:10200000
otimeout;200:10200000
otype;200:10200000
oinside_addr;200:10200000
oaccess_list;200:10200000
oforeign_addr;200:10200000
oprotocol;200:10200000
ooutside_port;200:10200000
oinside_port;200:10200000
omode;200:10200000
oinbound;200:10200000
oweight;200:10200000
ostatus;200:10200000
ctmpldelete;200:10200100
ctmpllist;200:100
oexpand;200:100
ctmplinst;200:10200000
cconfig;200:10200000
otrace;200:10200000
cflush;200:10200000
gppp;204:10314008
cifadd;200:10020000
cifdelete;200:10020000
cifattach;200:20000
cifscan;200:4008
otime;0
cifdetach;0
cifconfig;204:10220000
odest;204:10220000
oemptyauth;204:10220000
ouser;204:10220000
opassword;204:10220000
oacname;204:10220000
oservicename;204:10220000
oppp-max-payload;204:10220000
oclass;204:10220000
opool;204:10220000
opcomp;204:10220000
oaccomp;204:10220000
otrace;204:10220000
oconcentrator;204:10220000
oauth;204:10220000
orestart;204:10220000
oretryinterval;204:10220000
opassive;204:10220000
osilent;204:10220000
oechotolerance;204:10220000
oecho;204:10220000
oechotolerance;204:10220000
omru;204:10220000
oladdr;204:10220000
oraddr;204:10220000
onetmask;204:10220000
oformat;204:10220000
osubnetfirstip;204:10220000
osavepwd;204:10220000
odemanddial;204:10220000
ododdelay;204:10220000
oprimdns;204:10220000
osecdns;204:10220000
odnsmetric;204:10220000
oidletime;204:10220000
oidletrigger;204:10220000
ounnumbered;204:10220000
opoolstart;204:10220000
opoolend;204:10220000
ostatus;204:10220000
ciflist;200:4008
ointf;200:4008
crtadd;200:120000
odstmsk;200:120000
olabel;200:120000
osrc;200:120000
osrcmsk;200:120000
ometric;200:120000
crtdelete;200:120000
cflush;200:10120000
csimlock;200:c
olist;200:c
gppp relay;200:1001400c
cifadd;200:10010000
cifdelete;200:10010000
cifconfig;200:10010000
ciflist;200:4004
csesslist;200:400c
cflush;200:10000
gpptp;200:20020008
clist;200:8
cprofadd;200:20020000
oqos;200:20020000
oencaps;200:20020000
oac;200:20020000
cprofdelete;200:20020000
cproflist;200:8
cflush;200:20000
cifadd;200:20020000
orate;200:20020000
oencaps;200:20020000
oac;200:20020000
gra;8002000
cconfig;8002000
ostate;8002000
osecure;8002000
oport;8002000
otimeout;8002000
omode;8002000
oipintf;8002000
orandompassword;8002000
orandomport;8002000
ogroup;8002000
ouser;8002000
cstart;8002000
cstop;8002000
gptrace;21e:10004000
cadd;21e:10004000
cdelete;21e:10004000
cflush;21e:10004000
clist;21e:10004000
cmodify;21e:10004000
ostate;21e:10004000
gptrace action;21e:10004000
cadd;21e:10004000
cdelete;21e:10004000
clist;21e:10004000
cmodify;21e:10004000
gptrace debug;21e:10004000
ctraceconfig;21e:10004000
ostate;21e:10004000
gptrace filter;21e:10004000
cadd;21e:10004000
cdelete;21e:10004000
clist;21e:10004000
cmodify;21e:10004000
gscript;200:20000
cadd;200:20000
oindex;200:20000
cdelete;200:20000
oindex;200:20000
clist;200:8
oname;200:8
cflush;200:20000
crun;200:20000
ctrace;200:20000
gsnmp;206:4000
cconfig;206:10004000
osysContact;206:10004000
osysName;206:10004000
osysLocation;206:10004000
cifadd;206:10004000
cifdelete;206:10004000
cifattach;206:10004000
cifdetach;206:10004000
cifconfig;206:10004000
oindex;206:10004000
osecurityname;206:10004000
ocommunityname;206:10004000
ciflist;206:4000
ointf;206:4000
cget;206:10004000
oobjectid;206:10004000
cgetnext;206:10004000
oobjectid;206:10004000
cwalk;206:10004000
oobjectid;206:10004000
gsnmp community;206:10004000
cadd;206:10000000
oindex;206:10000000
cmodify;206:10000000
oindex;206:10000000
cdelete;206:10000000
clist;200:4000
gsntp;200:10004000
cadd;200:10000000
oaddr;200:10000000
oname;200:10000000
oversion;200:10000000
clist;200:4000
cdelete;200:10000000
oaddr;200:10000000
oname;200:10000000
cflush;200:10000000
cconfig;200:10000000
ostate;200:10000000
opoll;200:10000000
opollpresync;200:10000000
owanSubscribe;200:10000000
gsntp debug;0
ctraceconfig;0
ostate;0
gsoftware;1000:0
cversion;1000:0
cswitchover;200:4030
cupgrade;1000:0
cdownload;200:10040000
ousername;200:10040000
opassword;200:10040000
ofilesize;200:10040000
otargetfilename;200:10040000
gstatecheck;0
cconfig;0
ostatecheck;0
ointerval;0
otimeout;0
ogroupop;0
odmtree;0
cstatecheckadd;0
cstatecheckdelete;0
clist;0
cgroupadd;0
ostatecheck;0
ocheckop;0
cgroupdelete;0
ccheckadd;0
ostatecheck;0
oparamop;0
oconschecks;0
ccheckdelete;0
gsyslog;200:10000000
cconfig;200:10000000
oactivate;200:10000000
otimeout;200:10000000
oformat;200:10000000
cruleadd;200:10030000
cruledelete;200:10030000
cflush;200:10030000
clist;200:4000
cbootup;200:10030000
gsyslog msgbuf;216:10004000
cshow;216:4000
ofac;216:4000
osev;216:4000
ohist;216:4000
csend;200:10000000
ofac;200:10000000
osev;200:10000000
ohist;200:10000000
cflush;200:10000000
gsystem;1000:0
csettime;200:10000000
odate;200:10000000
otime;200:10000000
otimezone;200:10000000
odaylightsaving;200:10000000
ogeotimezone;200:10000000
ogeotimezonename;200:10000000
ogtzn;200:10000000
ortc;200:10000000
cdst;200:10000000
ostatus;200:10000000
omode;200:10000000
ostartdate;200:10000000
ostarttime;200:10000000
oenddate;200:10000000
oendtime;200:10000000
ostartweekday;200:10000000
ostarthour;200:10000000
ostartweek;200:10000000
ostartmonth;200:10000000
oendweekday;200:10000000
oendhour;200:10000000
oendweek;200:10000000
oendmonth;200:10000000
clocale;200:10000000
odec_symbol;200:10000000
ogroup_symbol;200:10000000
odate_separator;200:10000000
odate_format;200:10000000
otime_format;200:10000000
odatetime_format;200:10000000
oduration_format;200:10000000
creboot;1000:0
cflush;200:10000000
creset;1000:0
cconfig;200:4000
oupnp;200:10004000
otr64;200:10004000
otr64auth;200:10004000
owps;200:10004000
omdap;200:10004000
odrst;200:10004000
oled;200:10004000
oresetbutton;200:10004000
odigestauth;200:10004000
odualinterface;200:10004000
odefaultconnection;200:10004000
oautosave;200:10004000
oautosavedelay;200:10004000
oWANMode;200:10004000
oWANEthPort;200:10004000
ctimedreboot;200:4000
ostate;200:10004000
otime;200:10004000
odate;200:10004000
gsystem debug;210:4000
cstats;210:4000
oreset;210:4000
ccpu;210:4000
odelay;210:4000
oiterations;210:4000
otasks;210:4000
cmem;210:4000
oexpand;210:4000
cautosave;210:4000
otrace;210:4000
gsystem qual;200:4000
cled;200:10004000
ovalue;200:10004000
gsystem ra;200:10002000
clist;200:10002000
oname;200:10002000
cinstadd;200:10002000
cinstdelete;200:10002000
cconfig;200:10002000
ostate;200:10002000
osecure;200:10002000
oport;200:10002000
otimeout;200:10002000
omode;200:10002000
oipintf;200:10002000
orandompassword;200:10002000
orandomport;200:10002000
ogroup;200:10002000
ouser;200:10002000
otodschedule;200:10002000
osystemservice;200:10002000
cstart;200:10002000
cstop;200:10002000
gsystemlog;200:10000000
cshow;200:10000000
ofac;200:10000000
osev;200:10000000
ohist;200:10000000
csend;200:10000000
ofac;200:10000000
osev;200:10000000
ohist;200:10000000
cflush;200:10000000
gthreshold;200:10000000
cenable;0
oid;200:10000000
cdisable;200:10000000
oid;200:10000000
cconfig;200:10000000
oid;200:10000000
otype;200:10000000
ocount;200:10000000
operiod;200:10000000
ostate;200:10000000
creset;200:10000000
oid;200:10000000
cclear;200:10000000
oid;200:10000000
clist;200:10000000
cstats;200:10000000
gtls;200:40000
gtls acs-client;200:40000
cconfig;200:40000
ostate;200:40000
oauth-serv;200:40000
ovalid-date;200:40000
ovalid-domain;200:40000
gtls acs-client cert;200:40000
cadd;200:40000
cdelete;200:40000
clist;200:40000
oindex;200:40000
oexpand;200:40000
gtls https-server;200:40000
cconfig;200:40000
ostate;200:40000
oauth-client;200:40000
ovalid-date;200:40000
ovalid-domain;200:40000
gtls https-server cert;200:40000
cadd;200:40000
cdelete;200:40000
clist;200:40000
oindex;200:40000
oexpand;200:40000
gtls remote-upgraded;200:40000
cconfig;200:40000
ostate;200:40000
gtls remote-upgraded cert;200:40000
cadd;200:40000
cdelete;200:40000
clist;200:40000
oindex;200:40000
oexpand;200:40000
gtls self;200:40000
gtls self cert;200:40000
clist;200:40000
oindex;200:40000
oexpand;200:40000
gtod;200:10000000
cconfig;200:10000000
oacchain;200:10000000
ostate;200:10000000
clist;200:10000000
gtod action;200:10000000
cadd;200:10000000
oid;200:10000000
cdelete;200:10000000
csetvaladd;200:10000000
oid;200:10000000
oon;200:10000000
csetvaldelete;200:10000000
cparamadd;200:10000000
oid;200:10000000
oobject;200:10000000
oparam;200:10000000
ovalue;200:10000000
oon;200:10000000
cparamdelete;200:10000000
clist;200:10000000
gtod schedule;200:10000000
cadd;200:10000000
oid;200:10000000
cmodify;200:10000000
oexpiretime;200:10000000
onrofminutes;200:10000000
ocount;200:10000000
omode;200:10000000
oreference;200:10000000
oname;200:10000000
oaction;200:10000000
ostate;200:10000000
cstart;200:10000000
cdelete;200:10000000
cdayadd;200:10000000
oid;200:10000000
cdaydelete;200:10000000
ctimeadd;200:10000000
oid;200:10000000
oaction;200:10000000
ctimedelete;200:10000000
ctimeabsadd;200:10000000
orangeid;200:10000000
ostarttime;200:10000000
oendtime;200:10000000
ctimeabsdelete;200:10000000
clist;200:1000000
gtrigger;200:4000
clist;200:4000
oname;200:4000
gtrigger chain;200:0
cadd;200:10000000
opolicy;200:10000000
cdelete;200:4000
cmodify;200:10000000
opolicy;200:10000000
clist;200:4000
oformat;200:10000000
cflush;200:10000000
gtrigger rule;200:0
cadd;200:10000000
oindex;200:10000000
onewindex;200:10000000
oname;200:10000000
oclink;200:10000000
osrcintf;200:10000000
osrcip;200:10000000
odstintf;200:10000000
odstip;200:10000000
oserv;200:10000000
osrcmac;200:10000000
olength;200:10000000
olog;200:10000000
ostate;200:10000000
oconnstate;200:10000000
cdelete;200:10000000
cmodify;200:10000000
oindex;200:10000000
onewindex;200:10000000
oname;200:10000000
oclink;200:10000000
osrcintf;200:10000000
osrcip;200:10000000
odstintf;200:10000000
odstip;200:10000000
oserv;200:10000000
osrcmac;200:10000000
olength;200:10000000
olog;200:10000000
ostate;200:10000000
otrigger;200:10000000
oconnstate;200:10000000
clist;200:4000
ochain;200:4000
oformat;200:4000
cflush;200:10000000
ochain;200:10000000
gtrigger rule debug;210:0
ctraceconfig;210:10000000
ostate;210:10000000
cstats;210:10000000
ochain;210:10000000
oindex;210:10000000
cclear;210:10000000
ochain;210:10000000
oindex;210:10000000
gupgrade;200:0
cconfig;200:10000
ostate;200:10000
oprotocol;200:10000
cstart;200:10000
oserver;200:10000
ofilename;200:10000
gupgrade debug;200:10000
ctraceconfig;200:40000000
csesslist;200:40000000
gupgrade profile;200:0
cadd;200:10000
odestdir;200:10000
omaxsize(KBytes);200:10000
cmodify;200:10000
odestdir;200:10000
omaxsize(KBytes);200:10000
cdelete;200:10000
clist;200:4
gupnp;200:1023410c
cconfig;200:10020000
omaxage;200:10020000
owritemode;200:10200000
osafenat;200:10200000
opreferredaddresses;200:10000000
ohttpport;200:10200000
oupnpautosave;200:10200000
odslfautosave;200:10200000
oautosavedelay;200:10200000
oonlydefault;200:10200000
oenable_framework;200:10200000
oenable_IGD;200:10200000
oenable_DSLF;200:10200000
cflush;200:10230000
clist;201:400c
overbose;201:400c
clistmask;0
gupnp debug;200:40000000
ctraceconfig;200:40000004
olevel;200:40000000
cnonce;200:40000004
otype;200:40000004
guser;220:0
cadd;220:0
ohash2;220:0
ohash3;220:0
ocrypt;220:0
olm;220:0
ontlm;220:0
odescr;220:0
odefuser;220:0
odefremadmin;220:0
odeflocadmin;220:0
cdelete;220:0
clist;220:0
oname;220:0
ochannel;220:0
oorigin;220:0
osecure;220:0
cconfig;220:0
opassword;220:0
orole;220:0
odescr;220:0
odefuser;220:0
odefremadmin;220:0
odeflocadmin;220:0
cflush;260:0
crights;220:0
gwansensing;200:0
cconfig;200:0
ostate;200:0
oerrorinterval;200:0
oerrorscript;200:0
cflush;200:0
clist;200:0
crequestmode;200:0
gwansensing debug;220:0
ctraceconfig;220:0
ostate;220:0
gwansensing mode;200:0
clist;200:0
cadd;200:0
oredirectgui;200:0
cdelete;200:0
gwebserver;200:10000000
gwebserver ssl;200:10000000
gwebserver ssl commonname;200:10000000
cadd;200:10000000
cdelete;200:10000000
clist;200:10000000
gwireless;200:10004
cifconfig;200:10000
ostate;200:10000
ochannel;200:10000
ossid;200:10000
oany;200:10000
orts;200:10000
ointerop;200:10000
oprotection;200:10000
oprotmode;200:10000
oprottrigger;200:10000
oshortslot;200:10000
oframeburst;200:10000
olocale;200:10000
ocountry;200:10000
orateset;200:10000
odtim;200:10000
oflags;200:10000
osrl;200:10000
olrl;200:10000
oframeaggregation;200:10000
oradio_id;200:10000
cradio;200:10000
ostate;200:10000
ochannel;200:10000
orts;200:10000
ointerop;200:10000
oprotection;200:10000
oprotmode;200:10000
oprottrigger;200:10000
oshortslot;200:10000
oframeburst;200:10000
olocale;200:10000
ocountry;200:10000
orateset;200:10000
odtim;200:10000
oflags;200:10000
osrl;200:10000
olrl;200:10000
oframeaggregation;200:10000
ointerferencemode;200:10000
ointerferencechannel;200:10000
oradio_id;200:10000
cbcminfo;200:10000
creset;200:10000
cflush;200:10000
gwireless acs;200:10000
cconfig;200:10000
ostate;200:10000
oglitchthreshold;200:10000
occathreshold;200:10000
ochannelscantime;200:10000
ofailiteration;200:10000
omaxiteration;200:10000
olockoutperiod;200:10000
operiodicscantime;200:10000
oradio_id;200:10000
oscanmode;200:10000
oautoscanreport;200:10000
cscanhistory;200:10000
oradio_id;200:10000
gwireless acs debug;200:40000004
crescan;200:40000004
oradio_id;200:10000
cscan;200:40000004
oradio_id;200:10000
cscanreport;200:40000004
oradio_id;200:10000
ctriggerdump;200:40000004
oradio_id;200:10000
gwireless debug;200:40000004
chwdump;200:40000004
cbcminfo;200:40000004
cnconfig;200:40000004
oninit;200:40000004
omimo_bw_cap;200:40000004
onmode;200:40000004
onmode_protection;200:40000004
onmode_protection_override;200:40000004
onreqd;200:40000004
oamsdu;200:40000004
oampdu;200:40000004
oprotection_control;200:40000004
cdualband;200:40000004
cstats;200:40000004
cnasdump;200:40000004
cbtc;200:40000004
obtc;200:40000004
ctxpower;200:40000004
otxpwr;200:40000004
cmaxpower;200:40000004
cmcd;200:40000004
ostate;200:40000004
cwpainclude;200:40000004
gwireless eco;200:10000
cconfig;200:10000
ostate;200:10000
oton;200:10000
otoff;200:10000
otext;200:10000
oradio_id;200:10000
cdump;200:10000
oradio_id;200:10000
csuspend;200:10000
otime;200:10000
oradio_id;200:10000
cresume;200:10000
oradio_id;200:10000
ctraceconfig;200:10000
oradio_id;200:10000
cstats;200:10000
oradio_id;200:10000
gwireless macacl;200:10000
cconfig;200:4
ossid_id;200:10000
oradio_id;200:10000
ocontrol;200:10000
oregtime;200:10000
cregister;200:10000
ossid_id;200:10000
oradio_id;200:10000
cadd;200:10000
ossid_id;200:10000
oradio_id;200:10000
oname;200:10000
cmodify;200:10000
ossid_id;200:10000
oradio_id;200:10000
opermission;200:10000
oname;200:10000
cdelete;200:10000
ossid_id;200:10000
oradio_id;200:10000
clist;200:4
ossid_id;200:10000
oradio_id;200:10000
cflush;200:10000
ossid_id;200:10000
oradio_id;200:10000
gwireless mssid;200:10000
ciflist;200:10000
ossid_id;200:10000
oradio_id;200:10000
cifadd;200:10000
ossid;200:10000
ossid_id;200:10000
oradio_id;200:10000
cifdelete;200:10000
oradio_id;200:10000
cifconfig;200:10000
ossid;200:10000
oapisolation;200:10000
oany;200:10000
osecmode;200:10000
oWEPkey;200:10000
oWPAPSKkey;200:10000
oWPAPSKversion;200:10000
oradio_id;200:10000
oaddscript;200:10000
odelscript;200:10000
otrace;200:10000
oWPAradiuskey;200:10000
oWPArekeysec;200:10000
oWPAradiusip;200:10000
oWPAradiusport;200:10000
oWPAradiussto;200:10000
oWPAversion;200:10000
oradio_id;200:10000
cifattach;200:10000
oradio_id;200:10000
cifdetach;200:10000
oradio_id;200:10000
gwireless multiuni;200:4
cscanresults;200:4
orescan;200:4
cadd;200:1000
cdelete;200:1000
clist;200:4
cflush;200:1000
gwireless qos;200:10004
cconfig;200:10004
omode;200:100004
oackpolicy;200:10004
oapsd;0
oradio_id;200:10004
capacconfig;200:10004
oclass;200:10004
oacm;200:10004
oecwmax;200:10004
oecwmin;200:10004
ocwmax;200:10004
ocwmin;200:10004
oaifsn;200:10004
otxop;200:10004
oradio_id;200:10004
cstaacconfig;200:10004
oclass;200:10004
oacm;200:10004
oecwmax;200:10004
oecwmin;200:10004
ocwmax;200:10004
ocwmin;200:10004
oaifsn;200:10004
otxop;200:10004
oradio_id;200:10004
gwireless qual;200:4
cup;200:4
oradio_id;200:4
cdown;200:4
oradio_id;200:4
cout;200:4
oradio_id;200:4
crenewssid;200:4
oradio_id;200:4
ctxant;200:4
ovalue;200:4
oradio_id;200:4
cantdiv;200:4
ovalue;200:4
oradio_id;200:4
cfqacursy;200:4
oradio_id;200:4
gwireless secmode;200:4
cconfig;200:4
omode;200:10000
ossid;200:10000
cwep;200:4
oencryptionkey;200:10000
ocontrol;200:10000
oforce;200:10000
cwpa-psk;200:4
opresharedkey;200:10000
oencryption;200:10000
orekeysec;200:10000
ocontrol;200:10000
oforce;200:10000
oversion;200:10000
cwpa;200:10000
oradiuskey;200:10000
oencryption;200:10000
orekeysec;200:10000
oradiusip;200:10000
oradiusport;200:10000
oradiussto;200:10000
ocontrol;200:10000
oforce;200:10000
oversion;200:10000
gwireless stations;200:4
clist;200:4
ohwaddr;200:4
ossid_id;200:4
oradio_id;200:4
gwireless wds;200:4
cconfig;200:4
ostate;200:10000
oautoaccess;200:10000
cscanresults;200:4
orescan;200:10000
cadd;200:10000
oname;200:10000
cdelete;200:10000
clist;200:4
cflush;200:10000
gwireless wps;200:10000
cconfig;200:10000
ossid_id;200:10000
oradio_id;200:10000
ostate;200:10000
oapip;200:10000
oregip;200:10000
oradio_id;200:10000
cpin;200:10000
ossid_id;200:10000
oradio_id;200:10000
ovalue;200:10000
cap_pin;200:10000
ossid_id;200:10000
oradio_id;200:10000
ovalue;200:10000
cmode;200:10000
ossid_id;200:10000
ovalue;200:10000
oradio_id;200:10000
ostate;200:10000
cevent;200:10000
ossid_id;200:10000
oradio_id;200:10000
ostate;200:10000
ovalue;200:10000
cdump;200:10000
gwizard;200:10004000
cconfig;200:10004000
oallow_factory_tpl;200:10004000
otrace;200:10004000
oautopopup;200:10004000
oconfigtime;200:10004000
cdef;200:10000000
ogrp;200:10000000
odesc;200:10000000
ohelp;200:10000000
oalias;200:10000000
oreq;200:10000000
odefault;200:10000000
odata;200:10000000
odalias;200:10000000
omin;200:10000000
omax;200:10000000
ocalc;200:10000000
olinkvar;200:10000000
cflush;200:10000000
cview;200:4000
cload;200:10004000
oprofile;0
gxdsl;200:20008
cinfo;200:20008
oexpand;200:20008
og.997.1;200:20008
ocounter_period_filter;200:20008
ocounters_reset;200:20008
cconfig;200:20008
oadslmultimode;0
odetect-lop;200:20008
osyslog;200:20008
ostatus;200:20008
cmaxspeed;200:20008
otx;200:20008
orx;200:20008
cversion;200:20008
gxdsl debug;204:20008
cbitloadinginfo;204:20008
cdeltconfig;204:20008
ostate;204:20008
cdeltinfo;204:20008
cmodemoptioninfo;204:20008
cmultimode;204:20008
oconfig;204:20008
ctraceconfig;204:20008
gxdsl qual;200:20008
calb;200:20008
cbitloadinginfo;200:20008
clov;200:20008
osignal_type;200:20008
clcl;200:20008
cmib;200:20008
cqln;200:20008
caisf;200:20008
cfreeze-showtime;200:20008
ostate;200:20008
fHelp_Basic.htm;400:0
fHelp_Basic10.htm;400:0
fHelp_Basic11.htm;400:0
fHelp_Basic12.htm;400:0
fHelp_Basic13.htm;400:0
fHelp_Basic14.htm;400:0
fHelp_Basic15.htm;400:0
fHelp_Basic16.htm;400:0
fHelp_Basic17.htm;400:0
fHelp_Basic18.htm;400:0
fHelp_Basic19.htm;400:0
fHelp_Basic2.htm;400:0
fHelp_Basic20.htm;400:0
fHelp_Basic21.htm;400:0
fHelp_Basic22.htm;400:0
fHelp_Basic23.htm;400:0
fHelp_Basic24.htm;400:0
fHelp_Basic25.htm;400:0
fHelp_Basic26.htm;400:0
fHelp_Basic27.htm;400:0
fHelp_Basic28.htm;400:0
fHelp_Basic29.htm;400:0
fHelp_Basic3.htm;400:0
fHelp_Basic30.htm;400:0
fHelp_Basic31.htm;400:0
fHelp_Basic32.htm;400:0
fHelp_Basic33.htm;400:0
fHelp_Basic34.htm;400:0
fHelp_Basic35.htm;400:0
fHelp_Basic36.htm;400:0
fHelp_Basic37.htm;400:0
fHelp_Basic38.htm;400:0
fHelp_Basic39.htm;400:0
fHelp_Basic4.htm;400:0
fHelp_Basic40.htm;400:0
fHelp_Basic41.htm;400:0
fHelp_Basic42.htm;400:0
fHelp_Basic43.htm;400:0
fHelp_Basic44.htm;400:0
fHelp_Basic45.htm;400:0
fHelp_Basic46.htm;400:0
fHelp_Basic47.htm;400:0
fHelp_Basic48.htm;400:0
fHelp_Basic49.htm;400:0
fHelp_Basic5.htm;400:0
fHelp_Basic50.htm;400:0
fHelp_Basic51.htm;400:0
fHelp_Basic52.htm;400:0
fHelp_Basic53.htm;400:0
fHelp_Basic54.htm;400:0
fHelp_Basic55.htm;400:0
fHelp_Basic6.htm;400:0
fHelp_Basic7.htm;400:0
fHelp_Basic8.htm;400:0
fHelp_Basic9.htm;400:0
fHelp_Expert.htm;4400:0
fb_index.htm;400:0
fbottom_piece.htm;0
fbottom_redirect.htm;0
fcatservertimeout.htm;0
fcli.htm;7fff:fffffffc
fcliBegin.htm;0
fcliEnd.htm;0
fcliExit.htm;0
fcliFooter.htm;0
fcliHeader.htm;0
fcliMenu.htm;0
fcliOutAuto.htm;0
fcliOutRaw.htm;0
fcliWelcome.htm;0
fe_index.htm;4400:0
ferror.htm;0
fewizard.htm;400:400c
fewizarda.htm;0
ffooter.htm;0
fhelp.htm;0
findex.htm;0
fnavigation.htm;400:0
fnotfound.htm;400:0
fservererror.htm;0
fservertimeout.htm;0
fswkrestart.htm;0
fswover.htm;0
ftitle.htm;0
ftoc.htm;400:0
ftop_piece.htm;0
ftop_redirect.htm;0
funauthorized.htm;0
funconfigured.htm;0
hb/users/cfg/changepsswdpopup/;400:0;400:0
hb/users/cfg/usraccaddrem/;420:0;420:0
hb/dyndns/_multihost_/cfg/;400:10004000;400:10004000
h_NULL_wansensing_enabled;0;0
hb/users/cfg/changepsswd/;400:0;400:0
hb/games/_servconf_/cfg/;400:200100;400:200100
hb/users/cfg/usraccedit/;420:0;420:0
hb/users/cfg/defaultusr/;420:0;420:0
hb/games/_servconf_/ov/;400:100;400:100
h_NULL_wli_enabled.cgi;0;0
hb/dyndns/_multi_/cfg/;400:10004000;400:10004000
hincludeWFAWLANConfig;0;0
hb/ic/connect/success;0;0
hb/users/switchpopup/;400:0;400:0
hb/sfltr/content/cfg/;400:0;400:0
hb/dyndns/_multi_/ov/;400:4000;400:4000
hincludeDeviceConfig;0;0
hincludeLANConfigSec;0;0
hb/intfs/_intf_/cfg/;400:10004;400:10004
hb/intfs/_pool_/cfg/;400:14004;400:10014004
h_NULL_acllocked.cgi;0;0
hincludeWanServices;0;0
hb/events/security/;410:0;410:0
hb/intfs/_intf_/ov/;400:4004;400:4004
hb/ic/connect/check;0;0
hb/sfltr/_lvl_/cfg/;400:0;400:0
hincludeWanDevices;0;0
hincludeLanDevices;0;0
hincludeDeviceInfo;0;0
hb/is/_ethwan_/ov/;400:8;400:20008
hb/is/_ethwan_/dt/;4400:8;4400:8
hb/is/_bridge_/ov/;400:8;400:20008
hb/is/_bridge_/dt/;4400:8;4400:20008
h_NULL_oneconf.cgi;0;0
hewizard_popup.cgi;0;0
hb/backup/user.ini;500:0;500:0
hb/sfltr/_lvl_/ov/;400:4;400:10004
hewizard_popup.cgi;0;0
h_NULL_std_license;0;0
hisregistered.cgi;0;0
hiswansensing.cgi;0;0
hincludeL3Forward;0;0
hb/is/_pppoe_/ov/;400:8;400:20008
hb/is/_pppoe_/dt/;4400:8;4400:8
hb/is/_pppoa_/ov/;400:8;400:20008
hb/is/_pppoa_/dt/;4400:8;4400:8
hb/is/_pppom_/ov/;400:8;400:20008
hb/is/_pppom_/dt/;4400:8;4400:8
hb/is/_ethoa_/ov/;400:8;400:20008
hb/is/_ethoa_/dt/;0;4400:20008
hb/games/servdef/;400:100;400:100
hb/games/newserv/;400:200100;400:200100
hb/ic/LBButton.js;400:0;400:0
hb/users/usrpage/;400:0;400:0
hb/sfltr/license/;400:4000;400:10004000
hisdsldevice.cgi;0;0
hb/info/restart/;400:10000000;400:10000000
hb/events/flush/;410:10000000;410:10000000
hb/is/_ipoa_/ov/;400:8;400:20008
hb/is/_ipoa_/dt/;4400:8;4400:8
hb/_seclvl_/cfg/;400:400200;400:400200
hb/_fwrule_/cfg/;400:400200;400:1c00200
hb/csharing/cfg/;400:0;400:0
hb/csharing/fmt/;400:0;400:0
hb/publicip/cfg/;400:200104;400:200104
hb/_upnpdev_/ov/;400:8;400:20008
hb/users/switch/;400:0;400:0
hb/sfltr/newlvl/;400:10004;400:30004
hb/wli/register/;400:10004;400:10004
hb/_seclvl_/ov/;400:200;400:200
hb/csharing/ov/;400:0;400:0
hb/ic/redirect/;0;0
hb/ic/b_menu.js;0;0
hb/ic/e_menu.js;0;0
h_NULL_dsd_lite;0;0
hhasrights.cgi;0;0
hb/info/reset/;2400:0;2400:0
hb/secpol/cfg/;400:400200;400:400200
hb/mobile/adv/;4400:8;4400:20008
hb/ic/connect/;0;0
hb/ic/blocked/;0;0
hb/dyndns/cfg/;400:10004000;400:10004000
hlanguage.cgi;0;0
hb/secpol/ov/;400:200;400:200
hb/sfltr/cfg/;400:10004;400:30004
hb/ids/flush/;400:10004000;400:10004000
hb/games/cfg/;400:200000;400:200100
hb/_dev_/cfg/;400:10004;400:10004
hb/mobile/ov/;400:8;400:20008
hb/mobile/dt/;400:8;400:8
hb/ic/util.js;0;0
hb/users/cfg/;420:0;420:0
hb/_wli_/cfg/;400:10004;400:10004
hb/_wds_/cfg/;400:10004;400:10004
hb/dyndns/ov/;400:4000;400:4000
hcharset.cgi;0;0
hb/_newlvl_/;0;0
hb/sfltr/ov/;400:4;400:4
hb/games/ov/;400:100;400:100
hb/devs/cfg/;400:10004;400:10004
hb/_dev_/ov/;400:0;400:0
hb/users/ov/;400:0;400:0:0
hewizard.cgi;0;0
hb/_wli_/ov/;400:4;400:4
hb/_wli_/dt/;4400:4;4400:4
hb/_wds_/ov/;400:4;400:4
hb/wds/scan/;400:4;400:4
hincludeUDN;0;0
hb/cfg/cfg/;4400:10004000;4400:10004000
hb/connchk/;400:0;400:0
hb/toolbox/;400:4000;400:4000
hb/devs/ov/;400:4;400:4
hb/restore/;500:0;500:0
hb/cfg/ov/;400:0;400:0
hb/cfg/dt/;4400:4000;4400:4000
hb/events/;410:0;410:0
hb/dsl/ov/;400:8;400:8
hb/dsl/dt/;4400:8;4400:8
hb/ids/ov/;400:4000;400:4000
hwireless/;400:10004;400:10004
hwebroot/;0;0
hb/wan/ov;400:8;400:20008
hb/ws/ov/;400:8;400:20008
hb/intfs/;400:4;400:4
hb/bandr/;500:0;500:0
hb/info/;400:4;400:4
hb/ping/;401:40000008;401:40000008
hwizard/;400:10030000;400:10030000
hb/lan/;400:4;400:4
hb/ras/;400:2000;400:8000000
hb/ST/;400:4;400:4
hb/bb/;400:8;400:8
hb/is/;400:8;400:20008
hremote_admin.lp;400:2000;400:8000000
hbackup.lp;500:0;500:0
hrestart.lp;400:10000000;400:10000000
hreset.lp;2400:0;2400:0
hswitchuser.lp;400:0;400:0
hrestore.lp;500:0;500:0
hservices/xmlcom/xmlcom2.llp;ffffffff:ffffffff;20000:0
hdl/user.ini;500:0;500:0
hmusicbox_register.cgi;0;0
hconfig.wifi.html;0;0
minfo;100000:0
mexeccli;1000:0
mreadfile;1000:0
mwritefile;1000:0
klist;800:30
kread;800:10
kwrite;800:40030
kexec;800:40030

category add name=Virtual

add name "DNS ALG" mode server category=Virtual
rule add name "DNS ALG" protocol=udp portrange=53

add name="FTP" mode=server category=Virtual
rule add name="FTP" protocol=tcp portrange=21

add name="FTPS" mode=server category=Virtual
rule add name="FTPS" protocol=tcp portrange=21
rule add name="FTPS" protocol=tcp portrange=989
rule add name="FTPS" protocol=tcp portrange=990

add name "H.323 RAS" mode server category=Virtual
rule add name "H.323 RAS" protocol=udp portrange=1719

add name="HTTP" mode=server category=Virtual
rule add name="HTTP" protocol=tcp portrange=80

add name="HTTP Secondary" mode=server category=Virtual
rule add name="HTTP Secondary" protocol=tcp portrange=8080

add name="HTTPS" mode=server category=Virtual
rule add name="HTTPS" protocol=tcp portrange=443

add name="HTTPS Secondary" mode=server category=Virtual
rule add name="HTTPS Secondary" protocol=tcp portrange=8443

add name="IMAP" mode=server category=Virtual
rule add name="IMAP" protocol=tcp portrange=143

add name="IPSec" mode=server category=Virtual
rule add name="IPSec" protocol=udp portrange=500

add name "L2TP" mode server category=Virtual
rule add name "L2TP" protocol=udp portrange=1701

add name="NNTP" mode=server category=Virtual
rule add name="NNTP" protocol=tcp portrange=119

add name="POP3" mode=server category=Virtual
rule add name="POP3" protocol=tcp portrange=110

add name="PPTP" mode=server category=Virtual
rule add name="PPTP" protocol=tcp portrange=1723

add name="Remote Management" mode=server category=Virtual
rule add name="Remote Management" protocol=tcp portrange=7020

add name="Remote Management SSL" mode=server category=Virtual
rule add name="Remote Management SSL" protocol=tcp portrange=7021

add name="SMTP" mode=server category=Virtual
rule add name="SMTP" protocol=tcp portrange=25

add name="SNMP" mode=server category=Virtual
rule add name="SNMP" protocol=udp portrange=161

add name "SSH" mode server category=Virtual
rule add name "SSH" protocol=TCP portrange=22

add name="Telnet" mode=server category=Virtual
rule add name="Telnet" protocol=tcp portrange=23

add name="Telnet Secondary" mode=server category=Virtual
rule add name="Telnet Secondary" protocol=tcp portrange=8023

add name="Telnet SSL" mode=server category=Virtual
rule add name="Telnet SSL" protocol=tcp portrange=992

add name="Windows Remote Desktop" mode=server category=Virtual
rule add name="Windows Remote Desktop" protocol=tcp portrange=3389

add name="Wake-On-LAN" mode=server category=Virtual
rule add name="Wake-On-LAN" protocol=udp portrange=0
rule add name="Wake-On-LAN" protocol=udp portrange=7
rule add name="Wake-On-LAN" protocol=udp portrange=9

add name="AIM Talk" mode=client
rule add name="AIM Talk" protocol=tcp portrange=5190 triggerport=4099 triggerprotocol=tcp

add name="BearShare" mode=server
rule add name="BearShare" protocol=tcp portrange=6346

add name="BitTorrent" mode=client
rule add name="BitTorrent"  protocol=tcp portrange=6881-6889

add name="CarbonCopy32" mode=server
rule add name="CarbonCopy32" protocol=tcp portrange=1024-1680

add name="Checkpoint FW1 VPN" mode=server
rule add name="Checkpoint FW1 VPN" protocol=any portrange=2599

add name="Counter Strike" mode=server
rule add name="Counter Strike" protocol=udp portrange=1200
rule add name="Counter Strike" protocol=udp portrange=27000-27015
rule add name="Counter Strike" protocol=tcp portrange=27030-27039

add name="DirectX 7" mode=server
rule add name="DirectX 7" protocol=udp portrange=2302-2400
rule add name="DirectX 7" protocol=udp portrange=47624

add name="DirectX 8" mode=server
rule add name="DirectX 8" protocol=udp portrange=2302-2400
rule add name="DirectX 8" protocol=udp portrange=6073

add name="DirectX 9" mode=server
rule add name="DirectX 9" protocol=udp portrange=2302-2400
rule add name="DirectX 9" protocol=udp portrange=6073

add name="DirectX Games" mode=server
rule add name="DirectX Games" protocol=any portrange=47624-47625
rule add name="DirectX Games" protocol=any portrange=2300-2400
rule add name="DirectX Games" protocol=tcp portrange=28800-28912

add name="eDonkey" mode=server
rule add name="eDonkey" protocol=tcp portrange=4662
rule add name="eDonkey" protocol=udp portrange=5737

add name="eMule" mode=server
rule add name="eMule" protocol=tcp portrange=4662
rule add name="eMule" protocol=udp portrange=4672

add name="Gamespy Arcade" mode=server
rule add name="Gamespy Arcade" protocol=udp portrange=6500
rule add name="Gamespy Arcade" protocol=udp portrange=6700
rule add name="Gamespy Arcade" protocol=udp portrange=12300
rule add name="Gamespy Arcade" protocol=udp portrange=27900
rule add name="Gamespy Arcade" protocol=tcp portrange=28900
rule add name="Gamespy Arcade" protocol=udp portrange=23000-23009

add name="iMesh" mode=server
rule add name=iMesh protocol=tcp portrange=1214

add name="KaZaA" mode=server
rule add name=KaZaA protocol=tcp portrange=1214

add name="Mail Server (SMTP)" mode=server
rule add name="Mail Server (SMTP)" protocol=any portrange=25

add name="Microsoft Remote Desktop" mode=server
rule add name="Microsoft Remote Desktop" protocol=any portrange=3389

add name="MSN Game Zone" mode=server
rule add name="MSN Game Zone" protocol=any portrange=6667
rule add name="MSN Game Zone" protocol=any portrange=28800-29000

add name="MSN Game Zone (DX)" mode=server
rule add name="MSN Game Zone (DX)" protocol=any portrange=2300-2400
rule add name="MSN Game Zone (DX)" protocol=any portrange=47624

add name="MSN Messenger" mode=server
rule add name="MSN Messenger" protocol=tcp portrange=1863

add name="MyHome Bticino" mode=server
rule add name="MyHome Bticino" protocol=tcp portrange=443
rule add name="MyHome Bticino" protocol=tcp portrange=20000

add name="Neverwinter Nights" mode=server
rule add name="Neverwinter Nights" protocol=udp portrange=5120-5300
rule add name="Neverwinter Nights" protocol=udp portrange=6500
rule add name="Neverwinter Nights" protocol=udp portrange=6667
rule add name="Neverwinter Nights" protocol=udp portrange=27900
rule add name="Neverwinter Nights" protocol=udp portrange=28900

add name="NNTP Server" mode=server
rule add name="NNTP Server" protocol=any portrange=119

add name="Play-Station2" mode=server
rule add name="Play-Station2" protocol=tcp portrange=10070-10080
rule add name="Play-Station2" protocol=udp portrange=10070

add name="Secure Shell Server (SSH)" mode=server
rule add name="Secure Shell Server (SSH)" protocol=tcp portrange=22

add name="Steam Games" mode=server
rule add name="Steam Games" protocol=tcp portrange=27030-27039
rule add name="Steam Games" protocol=udp portrange=1200
rule add name="Steam Games" protocol=udp portrange=27000-27015

add name "Steam Client" mode server
rule add name "Steam Client" protocol tcp portrange 27020-27039
rule add name "Steam Client" protocol udp portrange 1200
rule add name "Steam Client" protocol udp portrange 27000-27015

add name "Steam Server" mode server
rule add name "Steam Server" protocol any portrange 27015
rule add name "Steam Server" protocol udp portrange 27020

add name="VNC" mode=server
rule add name="VNC" protocol=any portrange=5500
rule add name="VNC" protocol=any portrange=5800
rule add name="VNC" protocol=any portrange=5900

add name="Webcam (TrueTech)" mode=server
rule add name="Webcam (TrueTech)" protocol=tcp portrange=2047

add name="Webcam32" mode=server
rule add name="Webcam32" protocol=tcp portrange=81

add name "World of Warcraft" mode server
rule add name "World of Warcraft" protocol tcp portrange 3724

add name="XBoX" mode=server
rule add name="XBoX" protocol=udp portrange=88
rule add name="XBoX" protocol=any portrange=3074

add name="Xbox Live" mode=server
rule add name="Xbox Live" protocol=any portrange=88 mode=auto
rule add name="Xbox Live" protocol=any portrange=3074 mode=auto

add name="Xbox One Live" mode=server
rule add name="Xbox One Live" protocol=any portrange=88 mode=auto
rule add name="Xbox One Live" protocol=any portrange=3074 mode=auto
rule add name="Xbox One Live" protocol=any portrange=3544 mode=auto
rule add name="Xbox One Live" protocol=any portrange=4500 mode=auto

mapadd name=HTTPI intf=LocalNetwork port=www-http
mapadd name=HTTPI intf=LocalNetwork port=1080
mapadd name=HTTPI intf=LocalNetwork port=httpproxy
ifadd name=HTTP group=lan
ifadd name=HTTPs group=lan
ifadd name=HTTPs_2 group=lan
ifadd name=FTP group=lan
ifadd name=TELNET group=lan
ifadd name=DNS-S group=lan
ifadd name=SSDP group=lan
ifadd name=MDAP group=lan
modify name=SNTP state=enabled routelabel=modemToACS
modify name=SLA_ICMP_PING state=enabled
modify name=SLA_UDP_PING state=disabled
modify name=HTTP state=enabled
modify name=HTTPs state=enabled
modify name=HTTPs_2 state=enabled
modify name=FTP state=disabled
modify name=TELNET state=disabled
modify name=IGMP-Proxy state=enabled qoslabel=IPTV
modify name=DNS-S state=enabled
modify name=DNS-C state=enabled
modify name=DHCP-S state=enabled qoslabel=Management
modify name=SSDP state=enabled
modify name=MDAP state=disabled
modify name=CWMP-C state=enabled qoslabel=Management routelabel=modemToACS
modify name=CWMP-S state=enabled port=7170
modify name=IP_COMMANDS state=enabled
modify name=PING_RESPONDER state=enabled
modify name UPnP-HTTP state=disabled
:voice country config country=italy
modify name VOIP_SIP_SIG routelabel=none qoslabel VoIP
modify name VOIP_SIP_RTP routelabel=none qoslabel VoIP
modify name=VOIP_SIP port 5070
modify name VOIP_SIP state enabled
modify name SIP_SERVER_SIG routelabel None qoslabel VoIP 
modify name SIP_SERVER_RTP routelabel modemToACS qoslabel VoIP
modify name SIP_SERVER state enabled
ifadd name=PINGv6_RESP group=lan
modify name=PINGv6_RESP state=enabled
modify name=DHCPv6-S state=enabled qoslabel=Management
modify name=MLD-Proxy state=disabled qoslabel=Management
modify name=IP_REDIR state=disabled qoslabel=Management
modify name=IPv6_MANAGEMENT qoslabel=Management
modify name=SLA_ICMPv6_PING state=enabled

config areacode="" maxsessions=30 rtpportrange=16384-32767 urimatch=full voipservicetype=SIP_GW max#mapsperextua=all regevent=disabled  p-preferred-id=FirstPAU

realm flush
realm add id 1 realm modemtelecom.homenet.telecomitalia.it
realm add id 2 realm digest.telecomitalia.it

outbreg flush
outbreg add id=1 port=5060 address=telecomitalia.it
outbreg add id=2 port=5060 address=telecomitalia.it
outbreg add id=3 port=5060 address=telecomitalia.it
outbreg add id=4 port=5070 address=127.0.0.1
outbproxy flush
outbproxy add id=1 port=undefined address=""
outbproxy add id=2 port=undefined address=""
outbproxy add id=3 port=undefined address=""
outbproxy add id=4 port=5070 address=127.0.0.1
  
intua flush
intua add id=1  aor=**11@modemtelecom.homenet.telecomitalia.it username=**11 password=11 status=enabled Realm 1 linename="FXS 1" uaport=5065 PhyAssignment "Assigned"
intua add id=2  aor=**02@modemtelecom.homenet.telecomitalia.it username=**02 password=02 status=enabled Realm 1 linename="Telefono IP 2" uaport=5065
intua add id=3  aor=**03@modemtelecom.homenet.telecomitalia.it username=**03 password=03 status=enabled Realm 1 linename="Telefono IP 3" uaport=5065
intua add id=4  aor=**04@modemtelecom.homenet.telecomitalia.it username=**04 password=04 status=enabled Realm 1 linename="Telefono IP 4" uaport=5065
intua add id=5  aor=**05@modemtelecom.homenet.telecomitalia.it username=**05 password=05 status=enabled Realm 1 linename="Telefono IP 5" uaport=5065
intua add id=6  aor=**06@modemtelecom.homenet.telecomitalia.it username=**06 password=06 status=enabled Realm 1 linename="Telefono IP 6" uaport=5065
intua add id=7  aor=**07@modemtelecom.homenet.telecomitalia.it username=**07 password=07 status=enabled Realm 1 linename="Telefono IP 7" uaport=5065
intua add id=8  aor=**08@modemtelecom.homenet.telecomitalia.it username=**08 password=08 status=enabled Realm 1 linename="Telefono IP 8" uaport=5065
intua add id=9  aor=**09@modemtelecom.homenet.telecomitalia.it username=**09 password=09 status=enabled Realm 1 linename="Telefono IP 9" uaport=5065
intua add id=10 aor=**10@modemtelecom.homenet.telecomitalia.it username=**10 password=10 status=enabled Realm 1 linename="Telefono IP 10" uaport=5065
intua add id=11  aor=**01@modemtelecom.homenet.telecomitalia.it username=**01 password=01 status=enabled Realm 1 linename="Telefono IP 1" uaport=5065 PhyAssignment "Not Assigned"
intua add id=12  aor=**12@modemtelecom.homenet.telecomitalia.it username=**12 password=12 status=enabled Realm 1 linename="FXS 2" uaport=5065
intua add id=13  aor=**13@modemtelecom.homenet.telecomitalia.it username=**13 password=13 status=enabled Realm 1 linename="DECT 1" uaport=5065
intua add id=14  aor=**14@modemtelecom.homenet.telecomitalia.it username=**14 password=14 status=enabled Realm 1 linename="DECT 2" uaport=5065
intua add id=15  aor=**15@modemtelecom.homenet.telecomitalia.it username=**15 password=15 status=enabled Realm 1 linename="DECT 3" uaport=5065
intua add id=16  aor=**16@modemtelecom.homenet.telecomitalia.it username=**16 password=16 status=enabled Realm 1 linename="DECT 4" uaport=5065
intua add id=17  aor=**17@modemtelecom.homenet.telecomitalia.it username=**17 password=17 status=enabled Realm 1 linename="DECT 5" uaport=5065

extua flush
extua add id=1  intf=Telecom_Italia sipport=5060 outboundregistrar=1 outboundproxy=1 registerexpire=3600 status=disabled Realm 2
extua transparent id=1 type=clip
extua transparent id=1 type=clir
extua add id=2  intf=Telecom_Italia sipport=5060 outboundregistrar=2 outboundproxy=2 registerexpire=3600 status=disabled Realm 2
extua transparent id=2 type=clip
extua transparent id=2 type=clir
extua add id=3  intf=Telecom_Italia sipport=5060 outboundregistrar=3 outboundproxy=3 registerexpire=3600 status=disabled Realm 2
extua transparent id=3 type=clip
extua transparent id=3 type=clir
extua add id=4  intf=loop sipport=5090 outboundregistrar=4 outboundproxy=4 registerexpire=0 status=disabled forfxo=enabled Realm 2
extua transparent id=4 type=clip
extua transparent id=4 type=clir

registrar config mode=process registerexpire=3600
registrar bind flush 
registrar bind add intf LocalNetwork sipport 5065
registrar bind add intf loop sipport 5065

inboundauth intua config BYE=disabled 
inboundauth intua config INFO=disabled 
inboundauth intua config INVITE=enabled
inboundauth intua config NOTIFY=disabled
inboundauth intua config OPTIONS=disabled
inboundauth intua config PING=disabled
inboundauth intua config PRACK=disabled
inboundauth intua config REFER=disabled
inboundauth intua config REGISTER=enabled
inboundauth intua config SUBSCRIBE=disabled
inboundauth intua config UPDATE=disabled

inboundauth extua config BYE=disabled 
inboundauth extua config INFO=disabled 
inboundauth extua config INVITE=disabled
inboundauth extua config NOTIFY=disabled
inboundauth extua config OPTIONS=disabled
inboundauth extua config PING=disabled
inboundauth extua config PRACK=disabled
inboundauth extua config REFER=disabled
inboundauth extua config REGISTER=enabled
inboundauth extua config SUBSCRIBE=disabled
inboundauth extua config UPDATE=disabled


config extrareregistrations=enabled
config omit_displayname=yes


config areacode="" maxsessions=30 rtpportrange=16384-32767 urimatch=full voipservicetype=SIP_GW max#mapsperextua=all regevent=enabled  p-preferred-id=FirstPAU

realm flush
realm add id 1 realm modemtelecom.homenet.telecomitalia.it
realm add id 2 realm digest.telecomitalia.it

outbreg flush
outbreg add id=1 port=5060 address=telecomitalia.it
outbreg add id=2 port=5060 address=telecomitalia.it
outbreg add id=3 port=5060 address=telecomitalia.it
outbreg add id=4 port=5070 address=127.0.0.1
outbproxy flush
outbproxy add id=1 port=undefined address=""
outbproxy add id=2 port=undefined address=""
outbproxy add id=3 port=undefined address=""
outbproxy add id=4 port=5070 address=127.0.0.1
  
intua flush
intua modify id=1  aor=**11@modemtelecom.homenet.telecomitalia.it username=**11 password=11 status=enabled Realm 1 linename="FXS 1" uaport=5065
intua modify id=2  aor=**02@modemtelecom.homenet.telecomitalia.it username=**02 password=02 status=enabled Realm 1 linename="Telefono IP 2" uaport=5065
intua modify id=3  aor=**03@modemtelecom.homenet.telecomitalia.it username=**03 password=03 status=enabled Realm 1 linename="Telefono IP 3" uaport=5065
intua modify id=4  aor=**04@modemtelecom.homenet.telecomitalia.it username=**04 password=04 status=enabled Realm 1 linename="Telefono IP 4" uaport=5065
intua modify id=5  aor=**05@modemtelecom.homenet.telecomitalia.it username=**05 password=05 status=enabled Realm 1 linename="Telefono IP 5" uaport=5065
intua modify id=6  aor=**06@modemtelecom.homenet.telecomitalia.it username=**06 password=06 status=enabled Realm 1 linename="Telefono IP 6" uaport=5065
intua modify id=7  aor=**07@modemtelecom.homenet.telecomitalia.it username=**07 password=07 status=enabled Realm 1 linename="Telefono IP 7" uaport=5065
intua modify id=8  aor=**08@modemtelecom.homenet.telecomitalia.it username=**08 password=08 status=enabled Realm 1 linename="Telefono IP 8" uaport=5065
intua modify id=9  aor=**09@modemtelecom.homenet.telecomitalia.it username=**09 password=09 status=enabled Realm 1 linename="Telefono IP 9" uaport=5065
intua modify id=10 aor=**10@modemtelecom.homenet.telecomitalia.it username=**10 password=10 status=enabled Realm 1 linename="Telefono IP 10" uaport=5065
intua modify id=11  aor=**01@modemtelecom.homenet.telecomitalia.it username=**01 password=01 status=enabled Realm 1 linename="Telefono IP 1" uaport=5065
intua modify id=12  aor=**12@modemtelecom.homenet.telecomitalia.it username=**12 password=12 status=enabled Realm 1 linename="FXS 2" uaport=5065
intua modify id=13  aor=**13@modemtelecom.homenet.telecomitalia.it username=**13 password=13 status=enabled Realm 1 linename="DECT 1" uaport=5065
intua modify id=14  aor=**14@modemtelecom.homenet.telecomitalia.it username=**14 password=14 status=enabled Realm 1 linename="DECT 2" uaport=5065
intua modify id=15  aor=**15@modemtelecom.homenet.telecomitalia.it username=**15 password=15 status=enabled Realm 1 linename="DECT 3" uaport=5065
intua modify id=16  aor=**16@modemtelecom.homenet.telecomitalia.it username=**16 password=16 status=enabled Realm 1 linename="DECT 4" uaport=5065
intua modify id=17  aor=**17@modemtelecom.homenet.telecomitalia.it username=**17 password=17 status=enabled Realm 1 linename="DECT 5" uaport=5065

extua flush
extua add id=1  intf=Telecom_Italia sipport=5060 outboundregistrar=1 outboundproxy=1 registerexpire=3600 status=disabled Realm 2
extua transparent id=1 type=clip
extua transparent id=1 type=clir
extua add id=2  intf=Telecom_Italia sipport=5060 outboundregistrar=2 outboundproxy=2 registerexpire=3600 status=disabled Realm 2
extua transparent id=2 type=clip
extua transparent id=2 type=clir
extua add id=3  intf=Telecom_Italia sipport=5060 outboundregistrar=3 outboundproxy=3 registerexpire=3600 status=disabled Realm 2
extua transparent id=3 type=clip
extua transparent id=3 type=clir
extua add id=4  intf=loop sipport=5090 outboundregistrar=4 outboundproxy=4 registerexpire=0 status=disabled forfxo=enabled Realm 2
extua transparent id=4 type=clip
extua transparent id=4 type=clir

registrar config mode=process registerexpire=3600
registrar bind flush 
registrar bind add intf LocalNetwork sipport 5065
registrar bind add intf loop sipport 5065

inboundauth intua config BYE=disabled 
inboundauth intua config INFO=disabled 
inboundauth intua config INVITE=enabled
inboundauth intua config NOTIFY=disabled
inboundauth intua config OPTIONS=disabled
inboundauth intua config PING=disabled
inboundauth intua config PRACK=disabled
inboundauth intua config REFER=disabled
inboundauth intua config REGISTER=enabled
inboundauth intua config SUBSCRIBE=disabled
inboundauth intua config UPDATE=disabled

inboundauth extua config BYE=disabled 
inboundauth extua config INFO=disabled 
inboundauth extua config INVITE=disabled
inboundauth extua config NOTIFY=disabled
inboundauth extua config OPTIONS=disabled
inboundauth extua config PING=disabled
inboundauth extua config PRACK=disabled
inboundauth extua config REFER=disabled
inboundauth extua config REGISTER=enabled
inboundauth extua config SUBSCRIBE=disabled
inboundauth extua config UPDATE=disabled

config extrareregistrations=enabled
 
c;grp ifconfig
c;grp iflist
c;grp rttadd
c;grp rttdelete
c;grp rttlist
c;grp rip bnadd
c;grp rip bndelete
c;grp rip bnlist
c;grp rip nbadd
c;grp rip nbdelete
c;grp rip nblist
c;grp rip rtfadd
c;grp rip rtfdelete
c;grp rip rtflist
o;grp rip ifconfig passive
o;grp rip ifconfig txversion
o;grp rip config defmetric
o;grp rip config timeouttime
o;grp rip config garbagetime
o;grp rip config impcrt
o;grp rip config impkrt
o;grp rip config impsrt
o;grp rip config impdefkrt
o;grp rip config impdefsrt
o;grp rip config exprt
o;grp rip config expdefrt
o;grp rip config txdefrt
o;grp rip config trace
o;ip config loadbalancing
o;atm ifconfig mtu
o;ppp ifconfig ppp-max-payload
o;eth ifconfig mtu
o;eth bridge config mtu
g1;tftp
g1;sla
h2;b/_wds_/cfg/
h1;b/_wds_/cfg/
h2;b/_wds_/ov/
h1;b/_wds_/ov/
h2;b/wds/scan/
h1;b/wds/scan/
h2;b/webcams/
h1;b/webcams/
h2;b/voicem/ov/
h1;b/voicem/ov/
h2;b/voicem/cfg/
h1;b/voicem/cfg/
h2;b/sipserver/kcfg/
h1;b/sipserver/kcfg/
config sysContact="Service Provider" sysName=$_PROD_FRIENDLY_NAME sysLocation="Customer Premises"
community add index=ROCommunity securityname=ROCommunity communityname=public
add name=ntp-tr069-1.interbusiness.it version=3
add name=ntp-tr069-2.interbusiness.it version=3
config poll=720 pollpresync=5
config state=enabled
debug traceconfig state=disabled
config auth=password auth_timeout=3 auth_attempts=3 shell=enabled
statecheckadd name=upgrade
groupadd statecheck=upgrade name=DeferUpgrade checkop=or
checkadd statecheck=upgrade group=DeferUpgrade name=offhookState object=Voice.Ports paramname=Status paramtype=string paramop=or matchtype=equal match=Offhook conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate1 object=Voice.Profile paramname=CallState paramtype=string paramop=or matchtype=equal match=Calling conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate2 object=Voice.Profile paramname=CallState paramtype=string paramop=or matchtype=equal match=Ringing conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate3 object=Voice.Profile paramname=CallState paramtype=string paramop=or matchtype=equal match=Connecting conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate4 object=Voice.Profile paramname=CallState paramtype=string paramop=or matchtype=equal match=InCall conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate5 object=SIPServer.InternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=InCall conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate6 object=SIPServer.ExternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=InCall conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate7 object=SIPServer.InternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=Calling conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate8 object=SIPServer.ExternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=Calling conschecks=1 
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate9 object=SIPServer.InternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=Ringing conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate10 object=SIPServer.ExternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=Ringing conschecks=1 
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate11 object=SIPServer.InternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=Connecting conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate12 object=SIPServer.ExternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=Connecting conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate13 object=SIPServer.InternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=Hold conschecks=1
checkadd statecheck=upgrade group=DeferUpgrade name=VOIPcallstate14 object=SIPServer.ExternalUA paramname=CallState paramtype=string paramop=or matchtype=equal match=Hold conschecks=1
qos config state=enabled nbrOfQueues=4 rxbackpressure=disabled txbackpressure=disabled realtime=enabled nbrOfRealtime=3
qos ifconfig port=1 mode=acc_lan
qos ifconfig port=2 mode=acc_lan
qos ifconfig port=3 mode=acc_lan
qos ifconfig port=4 mode=acc_lan
qos ifconfig port=5 mode=acc_wan
settime timezone=+01:00 daylightsaving=enabled
config upnp=disabled mdap=disabled drst=disabled resetbutton=enabled
config digestauth=enabled
config autosave=disabled
config defaultconnection ppp_0
locale dec_symbol=, group_symbol=. date_separator=- date_format=ddmmyyyy time_format=iso datetime_format=date+time duration_format=dhmmss
settime date 01/05/2011 
dst mode Relative
config prio-level=9
:mbus debug loadobjects dmtree atomic path Users
instadd name=remoteaccess
config name=remoteaccess state=disabled secure=enabled port=0 timeout=20 mode=Permanent ipintf="" randompassword=disabled randomport=disabled group=Users.Group.TechnicalSupport user=Users.User.remoteadmin todschedule="" systemservice=GUI
AGVTF_5.3.2_003
https-server config state=enabled auth-client=disabled valid-date=disabled valid-domain=disabled
acs-client config state=enabled auth-serv=enabled valid-date=disabled valid-domain=disabled
acs-client cert add filename=oldRootTLC-CA.cer
acs-client cert add filename=rootTLC-CA.cer
remote-upgraded config state=enabled auth-serv=enabled
remote-upgraded cert add filename=rootTLC-CA.cer
dms-client config state enabled auth-serv disabled valid-date disabled valid-domain disabled
dms-client cert add filename=dms_cafile.pem
config acchain=forward_timeofday state=enabled
action add id 0
action setvaladd actionid=0
action paramadd actionid=0 setvalueid=0 id=0 object=WLAN param=Enable value=1 on=active
action paramadd actionid=0 setvalueid=0 id=1 object=WLAN param=Enable value=0 on=inactive
schedule add id=0 type=action
schedule modify scheduleid=0 name=WIFI_ON_OFF
schedule dayadd scheduleid=0 weekday=all id=0
schedule timeadd scheduleid=0 dayid=0 starthour=07 startminute=00 endhour=12 endminute=00 action=0
schedule timeadd scheduleid=0 dayid=0 starthour=12 startminute=00 endhour=22 endminute=00 action=0
profile add extension=sts destdir=dl maxsize(KBytes)=100 action=script_load
profile add extension=ini destdir=dl maxsize(KBytes)=100 action=config_load

# Moved to Day2_upgrade.sts to mark a clear split in the upgrade.sts workings
# This file is kept as it it is used to differ between a bli (not present) and an rbi (present)
<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>Reboot</name>
<argumentList>
</argumentList>
</action>
<action>
<name>FactoryReset</name>
<argumentList>
</argumentList>
</action>
<action>
<name>ConfigurationStarted</name>
<argumentList>
<argument>
<name>NewSessionID</name>
<direction>in</direction>
<relatedStateVariable>A_ARG_TYPE_UUID</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>ConfigurationFinished</name>
<argumentList>
<argument>
<name>NewStatus</name>
<direction>out</direction>
<relatedStateVariable>A_ARG_TYPE_Status</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>A_ARG_TYPE_UUID</name>
<dataType>uuid</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>A_ARG_TYPE_Status</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>RebootRequired</allowedValue>
<allowedValue>ChangesApplied</allowedValue>
</allowedValueList>
</stateVariable>
</serviceStateTable>
</scpd><?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>GetInfo</name>
<argumentList>
<argument>
<name>NewManufacturerName</name>
<direction>out</direction>
<relatedStateVariable>ManufacturerName</relatedStateVariable>
</argument>
<argument>
<name>NewManufacturerOUI</name>
<direction>out</direction>
<relatedStateVariable>ManufacturerOUI</relatedStateVariable>
</argument>
<argument>
<name>NewModelName</name>
<direction>out</direction>
<relatedStateVariable>ModelName</relatedStateVariable>
</argument>
<argument>
<name>NewDescription</name>
<direction>out</direction>
<relatedStateVariable>Description</relatedStateVariable>
</argument>
<argument>
<name>NewProductClass</name>
<direction>out</direction>
<relatedStateVariable>ProductClass</relatedStateVariable>
</argument>
<argument>
<name>NewSerialNumber</name>
<direction>out</direction>
<relatedStateVariable>SerialNumber</relatedStateVariable>
</argument>
<argument>
<name>NewHardwareVersion</name>
<direction>out</direction>
<relatedStateVariable>HardwareVersion</relatedStateVariable>
</argument>
<argument>
<name>NewSoftwareVersion</name>
<direction>out</direction>
<relatedStateVariable>SoftwareVersion</relatedStateVariable>
</argument>
<argument>
<name>NewModemFirmwareVersion</name>
<direction>out</direction>
<relatedStateVariable>ModemFirmwareVersion</relatedStateVariable>
</argument>
<argument>
<name>NewAdditionalHardwareVersions</name>
<direction>out</direction>
<relatedStateVariable>AdditionalHardwareVersions</relatedStateVariable>
</argument>
<argument>
<name>NewAdditionalSoftwareVersions</name>
<direction>out</direction>
<relatedStateVariable>AdditionalSoftwareVersions</relatedStateVariable>
</argument>
<argument>
<name>NewEnabledOptions</name>
<direction>out</direction>
<relatedStateVariable>EnabledOptions</relatedStateVariable>
</argument>
<argument>
<name>NewSpecVersion</name>
<direction>out</direction>
<relatedStateVariable>SpecVersion</relatedStateVariable>
</argument>
<argument>
<name>NewProvisioningCode</name>
<direction>out</direction>
<relatedStateVariable>ProvisioningCode</relatedStateVariable>
</argument>
<argument>
<name>NewUpTime</name>
<direction>out</direction>
<relatedStateVariable>UpTime</relatedStateVariable>
</argument>
<argument>
<name>NewFirstUseDate</name>
<direction>out</direction>
<relatedStateVariable>FirstUseDate</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetProvisioningCode</name>
<argumentList>
<argument>
<name>NewProvisioningCode</name>
<direction>in</direction>
<relatedStateVariable>ProvisioningCode</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>ManufacturerName</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ModelName</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>SerialNumber</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>HardwareVersion</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>SoftwareVersion</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ManufacturerOUI</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Description</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ProductClass</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>AdditionalSoftwareVersions</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ModemFirmwareVersion</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>EnabledOptions</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>AdditionalHardwareVersions</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>SpecVersion</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ProvisioningCode</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpTime</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>FirstUseDate</name>
<dataType>DateTime</dataType>
</stateVariable>
</serviceStateTable>
</scpd>

<?xml version="1.0"?>
<root xmlns="urn:dslforum-org:device-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<URLBase>http://<!-- #echo var="UPNP_SERVER_IP" --></URLBase>
<device>
<deviceType>urn:dslforum-org:device:InternetGatewayDevice:1</deviceType>
<friendlyName><!-- #echo var="_PROD_FRIENDLY_NAME" --> (<!-- #echo var="_BOARD_SERIAL_NBR" -->)</friendlyName>
<manufacturer><!-- #echo var="_COMPANY_NAME" --></manufacturer>
<manufacturerURL><!-- #echo var="_COMPANY_URL" --></manufacturerURL>
<modelDescription><!-- #echo var="_PROD_DESCRIPTION" --></modelDescription>
<modelName><!-- #echo var="_PROD_NAME" --></modelName>
<modelNumber><!-- #echo var="_PROD_NUMBER" --></modelNumber>
<modelURL><!-- #echo var="_PROD_URL" --></modelURL>
<serialNumber><!-- #echo var="_BOARD_SERIAL_NBR" --></serialNumber>
<UDN><!-- #exec cgi="includeUDN(DSLF-IGD)" --></UDN>
<presentationURL>/</presentationURL>
<serviceList>
<!-- #exec cgi="includeDeviceInfo(DSLF-IGD)" --><!-- #exec cgi="includeDeviceConfig(DSLF-IGD)" --><!-- #exec cgi="includeL3Forward(DSLF-IGD)" --><!-- #exec cgi="includeLANConfigSec(DSLF-IGD)" --><!-- #exec cgi="includeManagementServer(DSLF-IGD)" --><!-- #exec cgi="includeXa1taConfig(DSLF-IGD)" --></serviceList>
<deviceList>
<!-- #exec cgi="includeLanDevices(DSLF-IGD)" --><!-- #exec cgi="includeWanDevices(DSLF-IGD)" --></deviceList>
</device>
</root>

<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetConfigPassword</name>
<argumentList>
<argument>
<name>NewPassword</name>
<direction>in</direction>
<relatedStateVariable>ConfigPassword</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>ConfigPassword</name>
<dataType>string</dataType>
</stateVariable>
</serviceStateTable>
</scpd>
<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>GetInfo</name>
<argumentList>
<argument>
<name>NewEnable</name>
<direction>out</direction>
<relatedStateVariable>Enable</relatedStateVariable>
</argument>
<argument>
<name>NewStatus</name>
<direction>out</direction>
<relatedStateVariable>Status</relatedStateVariable>
</argument>
<argument>
<name>NewMACAddress</name>
<direction>out</direction>
<relatedStateVariable>MACAddress</relatedStateVariable>
</argument>
<argument>
<name>NewMACAddressControlEnabled</name>
<direction>out</direction>
<relatedStateVariable>MACAddressControlEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>MaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewDuplexMode</name>
<direction>out</direction>
<relatedStateVariable>DuplexMode</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetStatistics</name>
<argumentList>
<argument>
<name>NewPacketsSent</name>
<direction>out</direction>
<relatedStateVariable>Stats.PacketsSent</relatedStateVariable>
</argument>
<argument>
<name>NewPacketsReceived</name>
<direction>out</direction>
<relatedStateVariable>Stats.PacketsReceived</relatedStateVariable>
</argument>
<argument>
<name>NewBytesSent</name>
<direction>out</direction>
<relatedStateVariable>Stats.BytesSent</relatedStateVariable>
</argument>
<argument>
<name>NewBytesReceived</name>
<direction>out</direction>
<relatedStateVariable>Stats.BytesReceived</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>Enable</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Status</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Up</allowedValue>
<allowedValue>NoLink</allowedValue>
<allowedValue>Error</allowedValue>
<allowedValue>Disabled</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>MACAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>MACAddressControlEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>MaxBitRate</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>10</allowedValue>
<allowedValue>100</allowedValue>
<allowedValue>1000</allowedValue>
<allowedValue>Auto</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>DuplexMode</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Half</allowedValue>
<allowedValue>Full</allowedValue>
<allowedValue>Auto</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.PacketsSent</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.PacketsReceived</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.BytesSent</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.BytesReceived</name>
<dataType>ui4</dataType>
</stateVariable>
</serviceStateTable>
</scpd>

<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetDHCPServerConfigurable</name>
<argumentList>
<argument>
<name>NewDHCPServerConfigurable</name>
<direction>in</direction>
<relatedStateVariable>DHCPServerConfigurable</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDHCPServerConfigurable</name>
<argumentList>
<argument>
<name>NewDHCPServerConfigurable</name>
<direction>out</direction>
<relatedStateVariable>DHCPServerConfigurable</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDHCPRelay</name>
<argumentList>
<argument>
<name>NewDHCPRelay</name>
<direction>out</direction>
<relatedStateVariable>DHCPRelay</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetSubnetMask</name>
<argumentList>
<argument>
<name>NewSubnetMask</name>
<direction>in</direction>
<relatedStateVariable>SubnetMask</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetSubnetMask</name>
<argumentList>
<argument>
<name>NewSubnetMask</name>
<direction>out</direction>
<relatedStateVariable>SubnetMask</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetIPRouter</name>
<argumentList>
<argument>
<name>NewIPRouters</name>
<direction>in</direction>
<relatedStateVariable>IPRouters</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeleteIPRouter</name>
<argumentList>
<argument>
<name>NewIPRouters</name>
<direction>in</direction>
<relatedStateVariable>IPRouters</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetIPRoutersList</name>
<argumentList>
<argument>
<name>NewIPRouters</name>
<direction>out</direction>
<relatedStateVariable>IPRouters</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetDomainName</name>
<argumentList>
<argument>
<name>NewDomainName</name>
<direction>in</direction>
<relatedStateVariable>DomainName</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDomainName</name>
<argumentList>
<argument>
<name>NewDomainName</name>
<direction>out</direction>
<relatedStateVariable>DomainName</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetAddressRange</name>
<argumentList>
<argument>
<name>NewMinAddress</name>
<direction>in</direction>
<relatedStateVariable>MinAddress</relatedStateVariable>
</argument>
<argument>
<name>NewMaxAddress</name>
<direction>in</direction>
<relatedStateVariable>MaxAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetAddressRange</name>
<argumentList>
<argument>
<name>NewMinAddress</name>
<direction>out</direction>
<relatedStateVariable>MinAddress</relatedStateVariable>
</argument>
<argument>
<name>NewMaxAddress</name>
<direction>out</direction>
<relatedStateVariable>MaxAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetReservedAddress</name>
<argumentList>
<argument>
<name>NewReservedAddresses</name>
<direction>in</direction>
<relatedStateVariable>ReservedAddresses</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeleteReservedAddress</name>
<argumentList>
<argument>
<name>NewReservedAddresses</name>
<direction>in</direction>
<relatedStateVariable>ReservedAddresses</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetReservedAddresses</name>
<argumentList>
<argument>
<name>NewReservedAddresses</name>
<direction>out</direction>
<relatedStateVariable>ReservedAddresses</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetDNSServer</name>
<argumentList>
<argument>
<name>NewDNSServers</name>
<direction>in</direction>
<relatedStateVariable>DNSServers</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeleteDNSServer</name>
<argumentList>
<argument>
<name>NewDNSServers</name>
<direction>in</direction>
<relatedStateVariable>DNSServers</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDNSServers</name>
<argumentList>
<argument>
<name>NewDNSServers</name>
<direction>out</direction>
<relatedStateVariable>DNSServers</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>DHCPServerConfigurable</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DHCPRelay</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>SubnetMask</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>IPRouters</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DNSServers</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DomainName</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>MinAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>MaxAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ReservedAddresses</name>
<dataType>string</dataType>
</stateVariable>
</serviceStateTable>
</scpd>
<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetDefaultConnectionService</name>
<argumentList>
<argument>
<name>NewDefaultConnectionService</name>
<direction>in</direction>
<relatedStateVariable>DefaultConnectionService</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDefaultConnectionService</name>
<argumentList>
<argument>
<name>NewDefaultConnectionService</name>
<direction>out</direction>
<relatedStateVariable>DefaultConnectionService</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="yes">
<name>DefaultConnectionService</name>
<dataType>string</dataType>
</stateVariable>
</serviceStateTable>
</scpd>


<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetEnabledForInternet</name>
<argumentList>
<argument>
<name>NewEnabledForInternet</name>
<direction>in</direction>
<relatedStateVariable>EnabledForInternet</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetEnabledForInternet</name>
<argumentList>
<argument>
<name>NewEnabledForInternet</name>
<direction>out</direction>
<relatedStateVariable>EnabledForInternet</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetCommonLinkProperties</name>
<argumentList>
<argument>
<name>NewWANAccessType</name>
<direction>out</direction>
<relatedStateVariable>WANAccessType</relatedStateVariable>
</argument>
<argument>
<name>NewLayer1UpstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>Layer1UpstreamMaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewLayer1DownstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>Layer1DownstreamMaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewPhysicalLinkStatus</name>
<direction>out</direction>
<relatedStateVariable>PhysicalLinkStatus</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetMaximumActiveConnections</name>
<argumentList>
<argument>
<name>NewMaximumActiveConnections</name>
<direction>out</direction>
<relatedStateVariable>MaximumActiveConnections</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetTotalBytesSent</name>
<argumentList>
<argument>
<name>NewTotalBytesSent</name>
<direction>out</direction>
<relatedStateVariable>TotalBytesSent</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetTotalBytesReceived</name>
<argumentList>
<argument>
<name>NewTotalBytesReceived</name>
<direction>out</direction>
<relatedStateVariable>TotalBytesReceived</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetTotalPacketsSent</name>
<argumentList>
<argument>
<name>NewTotalPacketsSent</name>
<direction>out</direction>
<relatedStateVariable>TotalPacketsSent</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetTotalPacketsReceived</name>
<argumentList>
<argument>
<name>NewTotalPacketsReceived</name>
<direction>out</direction>
<relatedStateVariable>TotalPacketsReceived</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>WANAccessType</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>DSL</allowedValue>
<allowedValue>POTS</allowedValue>
<allowedValue>Cable</allowedValue>
<allowedValue>Ethernet</allowedValue>
<allowedValue>Other</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>Layer1UpstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Layer1DownstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PhysicalLinkStatus</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Up</allowedValue>
<allowedValue>Down</allowedValue>
<allowedValue>Initializing</allowedValue>
<allowedValue>Unavailable</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>MaximumActiveConnections</name>
<dataType>ui2</dataType>
<allowedValueRange>
<minimum>1</minimum>
<step>1</step>
</allowedValueRange>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalBytesSent</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalBytesReceived</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalPacketsSent</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalPacketsReceived</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>EnabledForInternet</name>
<dataType>boolean</dataType>
</stateVariable>
</serviceStateTable>
</scpd>
<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetLoopDiagnosticsState</name>
<argumentList>
<argument>
<name>NewLoopDiagnosticsState</name>
<direction>in</direction>
<relatedStateVariable>LoopDiagnosticsState</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetLoopDiagnosticsState</name>
<argumentList>
<argument>
<name>NewLoopDiagnosticsState</name>
<direction>out</direction>
<relatedStateVariable>LoopDiagnosticsState</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetLoopDiagnosticsResults</name>
<argumentList>
<argument>
<name>NewACTPSDds</name>
<direction>out</direction>
<relatedStateVariable>ACTPSDds</relatedStateVariable>
</argument>
<argument>
<name>NewACTPSDus</name>
<direction>out</direction>
<relatedStateVariable>ACTPSDus</relatedStateVariable>
</argument>
<argument>
<name>NewACTATPds</name>
<direction>out</direction>
<relatedStateVariable>ACTATPds</relatedStateVariable>
</argument>
<argument>
<name>NewACTATPus</name>
<direction>out</direction>
<relatedStateVariable>ACTATPus</relatedStateVariable>
</argument>
<argument>
<name>NewQLNpsds</name>
<direction>out</direction>
<relatedStateVariable>QLNpsds</relatedStateVariable>
</argument>
<argument>
<name>NewBITSpsds</name>
<direction>out</direction>
<relatedStateVariable>BITSpsds</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="yes">
<name>LoopDiagnosticsState</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>None</allowedValue>
<allowedValue>Requested</allowedValue>
<allowedValue>Complete</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="yes">
<name>BITSpsds</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>ACTPSDds</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>ACTPSDus</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>ACTATPds</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>ACTATPus</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>QLNpsds</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>HLog</name>
<dataType>string</dataType>
</stateVariable>
</serviceStateTable>
</scpd>


<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>GetInfo</name>
<argumentList>
<argument>
<name>NewEnable</name>
<direction>out</direction>
<relatedStateVariable>Enable</relatedStateVariable>
</argument>
<argument>
<name>NewStatus</name>
<direction>out</direction>
<relatedStateVariable>Status</relatedStateVariable>
</argument>
<argument>
<name>NewModulationType</name>
<direction>out</direction>
<relatedStateVariable>ModulationType</relatedStateVariable>
</argument>
<argument>
<name>NewLineEncoding</name>
<direction>out</direction>
<relatedStateVariable>LineEncoding</relatedStateVariable>
</argument>
<argument>
<name>NewLineNumber</name>
<direction>out</direction>
<relatedStateVariable>LineNumber</relatedStateVariable>
</argument>
<argument>
<name>NewUpstreamCurrRate</name>
<direction>out</direction>
<relatedStateVariable>UpstreamCurrRate</relatedStateVariable>
</argument>
<argument>
<name>NewDownstreamCurrRate</name>
<direction>out</direction>
<relatedStateVariable>DownstreamCurrRate</relatedStateVariable>
</argument>
<argument>
<name>NewUpstreamMaxRate</name>
<direction>out</direction>
<relatedStateVariable>UpstreamMaxRate</relatedStateVariable>
</argument>
<argument>
<name>NewDownstreamMaxRate</name>
<direction>out</direction>
<relatedStateVariable>DownstreamMaxRate</relatedStateVariable>
</argument>
<argument>
<name>NewUpstreamNoiseMargin</name>
<direction>out</direction>
<relatedStateVariable>UpstreamNoiseMargin</relatedStateVariable>
</argument>
<argument>
<name>NewDownstreamNoiseMargin</name>
<direction>out</direction>
<relatedStateVariable>DownstreamNoiseMargin</relatedStateVariable>
</argument>
<argument>
<name>NewUpstreamAttenuation</name>
<direction>out</direction>
<relatedStateVariable>UpstreamAttenuation</relatedStateVariable>
</argument>
<argument>
<name>NewDownstreamAttenuation</name>
<direction>out</direction>
<relatedStateVariable>DownstreamAttenuation</relatedStateVariable>
</argument>
<argument>
<name>NewUpstreamPower</name>
<direction>out</direction>
<relatedStateVariable>UpstreamPower</relatedStateVariable>
</argument>
<argument>
<name>NewDownstreamPower</name>
<direction>out</direction>
<relatedStateVariable>DownstreamPower</relatedStateVariable>
</argument>
<argument>
<name>NewDataPath</name>
<direction>out</direction>
<relatedStateVariable>DataPath</relatedStateVariable>
</argument>
<argument>
<name>NewInterleavedDepth</name>
<direction>out</direction>
<relatedStateVariable>InterleavedDepth</relatedStateVariable>
</argument>
<argument>
<name>NewATURVendor</name>
<direction>out</direction>
<relatedStateVariable>ATURVendor</relatedStateVariable>
</argument>
<argument>
<name>NewATURCountry</name>
<direction>out</direction>
<relatedStateVariable>ATURCountry</relatedStateVariable>
</argument>
<argument>
<name>NewATUCVendor</name>
<direction>out</direction>
<relatedStateVariable>ATUCVendor</relatedStateVariable>
</argument>
<argument>
<name>NewATUCCountry</name>
<direction>out</direction>
<relatedStateVariable>ATUCCountry</relatedStateVariable>
</argument>
<argument>
<name>NewShowtimeStart</name>
<direction>out</direction>
<relatedStateVariable>ShowtimeStart</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetStatisticsShowtime</name>
<argumentList>
<argument>
<name>NewReceiveBlocks</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.ReceiveBlocks</relatedStateVariable>
</argument>
<argument>
<name>NewTransmitBlocks</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.TransmitBlocks</relatedStateVariable>
</argument>
<argument>
<name>NewCellDelin</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.CellDelin</relatedStateVariable>
</argument>
<argument>
<name>NewLinkRetrain</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.LinkRetrain</relatedStateVariable>
</argument>
<argument>
<name>NewLossOfFraming</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.LossOfFraming</relatedStateVariable>
</argument>
<argument>
<name>NewErroredSecs</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.ErroredSecs</relatedStateVariable>
</argument>
<argument>
<name>NewSeverelyErroredSecs</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.SeverelyErroredSecs</relatedStateVariable>
</argument>
<argument>
<name>NewFECErrors</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.FECErrors</relatedStateVariable>
</argument>
<argument>
<name>NewHECErrors</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.HECErrors</relatedStateVariable>
</argument>
<argument>
<name>NewCRCErrors</name>
<direction>out</direction>
<relatedStateVariable>Stats.Showtime.CRCErrors</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>Enable</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Status</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Up</allowedValue>
<allowedValue>Initializing</allowedValue>
<allowedValue>Establishing</allowedValue>
<allowedValue>NoSignal</allowedValue>
<allowedValue>Error</allowedValue>
<allowedValue>Disabled</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>ModulationType</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>ADSL_G.dmt</allowedValue>
<allowedValue>ADSL_G.lite</allowedValue>
<allowedValue>ADSL_G.dmt.bis</allowedValue>
<allowedValue>ADSL_re-adsl</allowedValue>
<allowedValue>ADSL_2plus</allowedValue>
<allowedValue>ADSL_four</allowedValue>
<allowedValue>ADSL_ANSI_T1.413</allowedValue>
<allowedValue>G.shdsl</allowedValue>
<allowedValue>IDSL</allowedValue>
<allowedValue>HDSL</allowedValue>
<allowedValue>SDSL</allowedValue>
<allowedValue>VDSL</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>LineEncoding</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>DMT</allowedValue>
<allowedValue>CAP</allowedValue>
<allowedValue>2B1Q</allowedValue>
<allowedValue>43BT</allowedValue>
<allowedValue>PAM</allowedValue>
<allowedValue>QAM</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>LineNumber</name>
<dataType>ui1</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpstreamCurrRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DownstreamCurrRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpstreamMaxRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DownstreamMaxRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpstreamNoiseMargin</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DownstreamNoiseMargin</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpstreamAttenuation</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DownstreamAttenuation</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpstreamPower</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DownstreamPower</name>
<dataType>i4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DataPath</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Interleaved</allowedValue>
<allowedValue>Fast</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>ATURVendor</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ATURCountry</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ATUCVendor</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ATUCCountry</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>InterleavedDepth</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ShowtimeStart</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.CellDelin</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.LossOfFraming</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.ErroredSecs</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.FECErrors</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.CRCErrors</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.HECErrors</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.ReceiveBlocks</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.TransmitBlocks</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.LinkRetrain</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Stats.Showtime.SeverelyErroredSecs</name>
<dataType>ui4</dataType>
</stateVariable>
</serviceStateTable>
</scpd>
<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>GetInfo</name>
<argumentList>
<argument>
<name>NewLinkType</name>
<direction>out</direction>
<relatedStateVariable>LinkType</relatedStateVariable>
</argument>
<argument>
<name>NewLinkStatus</name>
<direction>out</direction>
<relatedStateVariable>LinkStatus</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetDSLLinkType</name>
<argumentList>
<argument>
<name>NewLinkType</name>
<direction>in</direction>
<relatedStateVariable>LinkType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDSLLinkInfo</name>
<argumentList>
<argument>
<name>NewLinkType</name>
<direction>out</direction>
<relatedStateVariable>LinkType</relatedStateVariable>
</argument>
<argument>
<name>NewLinkStatus</name>
<direction>out</direction>
<relatedStateVariable>LinkStatus</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetAutoConfig</name>
<argumentList>
<argument>
<name>NewAutoConfig</name>
<direction>out</direction>
<relatedStateVariable>AutoConfig</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetModulationType</name>
<argumentList>
<argument>
<name>NewModulationType</name>
<direction>out</direction>
<relatedStateVariable>ModulationType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetDestinationAddress</name>
<argumentList>
<argument>
<name>NewDestinationAddress</name>
<direction>in</direction>
<relatedStateVariable>DestinationAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDestinationAddress</name>
<argumentList>
<argument>
<name>NewDestinationAddress</name>
<direction>out</direction>
<relatedStateVariable>DestinationAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetATMEncapsulation</name>
<argumentList>
<argument>
<name>NewATMEncapsulation</name>
<direction>in</direction>
<relatedStateVariable>ATMEncapsulation</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetATMEncapsulation</name>
<argumentList>
<argument>
<name>NewATMEncapsulation</name>
<direction>out</direction>
<relatedStateVariable>ATMEncapsulation</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetFCSPreserved</name>
<argumentList>
<argument>
<name>NewFCSPreserved</name>
<direction>in</direction>
<relatedStateVariable>FCSPreserved</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetFCSPreserved</name>
<argumentList>
<argument>
<name>NewFCSPreserved</name>
<direction>out</direction>
<relatedStateVariable>FCSPreserved</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>LinkType</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>EoA</allowedValue>
<allowedValue>IPoA</allowedValue>
<allowedValue>CIP</allowedValue>
<allowedValue>PPPoA</allowedValue>
<allowedValue>PPPoE</allowedValue>
<allowedValue>Unconfigured</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>LinkStatus</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Up</allowedValue>
<allowedValue>Down</allowedValue>
<allowedValue>Initializing</allowedValue>
<allowedValue>Unavailable</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>DestinationAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>AutoConfig</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ModulationType</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>ADSL_G.dmt</allowedValue>
<allowedValue>ADSL_G.lite</allowedValue>
<allowedValue>ADSL_G.dmt.bis</allowedValue>
<allowedValue>ADSL_re-adsl</allowedValue>
<allowedValue>ADSL_2plus</allowedValue>
<allowedValue>ADLS_four</allowedValue>
<allowedValue>ADSL_ANSI_T1.413</allowedValue>
<allowedValue>G.shdsl</allowedValue>
<allowedValue>IDSL</allowedValue>
<allowedValue>HDSL</allowedValue>
<allowedValue>SDSL</allowedValue>
<allowedValue>VDSL</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>ATMEncapsulation</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>LLC</allowedValue>
<allowedValue>VCMUX</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>FCSPreserved</name>
<dataType>boolean</dataType>
</stateVariable>
</serviceStateTable>
</scpd>

<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>GetInfo</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>out</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
<argument>
<name>NewPossibleConnectionTypes</name>
<direction>out</direction>
<relatedStateVariable>PossibleConnectionTypes</relatedStateVariable>
</argument>
<argument>
<name>NewConnectionStatus</name>
<direction>out</direction>
<relatedStateVariable>ConnectionStatus</relatedStateVariable>
</argument>
<argument>
<name>NewLastConnectionError</name>
<direction>out</direction>
<relatedStateVariable>LastConnectionError</relatedStateVariable>
</argument>
<argument>
<name>NewRouteProtocolRx</name>
<direction>out</direction>
<relatedStateVariable>RouteProtocolRx</relatedStateVariable>
</argument>
<argument>
<name>NewUpstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>UpstreamMaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewDownstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>DownstreamMaxBitRate</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetConnectionType</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>in</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetConnectionTypeInfo</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>out</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
<argument>
<name>NewPossibleConnectionTypes</name>
<direction>out</direction>
<relatedStateVariable>PossibleConnectionTypes</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>RequestConnection</name>
</action>
<action>
<name>ForceTermination</name>
</action>
<action>
<name>GetStatusInfo</name>
<argumentList>
<argument>
<name>NewConnectionStatus</name>
<direction>out</direction>
<relatedStateVariable>ConnectionStatus</relatedStateVariable>
</argument>
<argument>
<name>NewLastConnectionError</name>
<direction>out</direction>
<relatedStateVariable>LastConnectionError</relatedStateVariable>
</argument>
<argument>
<name>NewUptime</name>
<direction>out</direction>
<relatedStateVariable>Uptime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetNATRSIPStatus</name>
<argumentList>
<argument>
<name>NewRSIPAvailable</name>
<direction>out</direction>
<relatedStateVariable>RSIPAvailable</relatedStateVariable>
</argument>
<argument>
<name>NewNATEnabled</name>
<direction>out</direction>
<relatedStateVariable>NATEnabled</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetGenericPortMappingEntry</name>
<argumentList>
<argument>
<name>NewPortMappingIndex</name>
<direction>in</direction>
<relatedStateVariable>PortMappingNumberOfEntries</relatedStateVariable>
</argument>
<argument>
<name>NewRemoteHost</name>
<direction>out</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>out</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>out</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>out</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>out</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>out</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>out</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>out</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetSpecificPortMappingEntry</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>out</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>out</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>out</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>out</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>out</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>AddPortMapping</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>in</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>in</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>in</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>in</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>in</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeletePortMapping</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument> 
</argumentList>
</action>
<action>
<name>GetExternalIPAddress</name>
<argumentList>
<argument>
<name>NewExternalIPAddress</name>
<direction>out</direction>
<relatedStateVariable>ExternalIPAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>ConnectionType</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PossibleConnectionTypes</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Unconfigured</allowedValue>
<allowedValue>IP_Routed</allowedValue>
<allowedValue>IP_Bridged</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>ConnectionStatus</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Unconfigured</allowedValue>
<allowedValue>Connecting</allowedValue>
<allowedValue>Connected</allowedValue>
<allowedValue>PendingDisconnect</allowedValue>
<allowedValue>Disconnecting</allowedValue>
<allowedValue>Disconnected</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>Uptime</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>LastConnectionError</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>ERROR_NONE</allowedValue>
<allowedValue>ERROR_COMMAND_ABORTED</allowedValue>
<allowedValue>ERROR_NOT_ENABLED_FOR_INTERNET</allowedValue>
<allowedValue>ERROR_USER_DISCONNECT</allowedValue>
<allowedValue>ERROR_ISP_DISCONNECT</allowedValue>
<allowedValue>ERROR_IDLE_DISCONNECT</allowedValue>
<allowedValue>ERROR_FORCED_DISCONNECT</allowedValue>
<allowedValue>ERROR_NO_CARRIER</allowedValue>
<allowedValue>ERROR_IP_CONFIGURATION</allowedValue>
<allowedValue>ERROR_UNKNOWN</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>RSIPAvailable</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>NATEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ExternalIPAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingNumberOfEntries</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingLeaseDuration</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>RemoteHost</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ExternalPort</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>InternalPort</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingProtocol</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>TCP</allowedValue>
<allowedValue>UDP</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>InternalClient</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingDescription</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DownstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>RouteProtocolRx</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Off</allowedValue>
<allowedValue>RIPv1</allowedValue>
<allowedValue>RIPv2</allowedValue>
<allowedValue>OSPF</allowedValue>
</allowedValueList>
</stateVariable>
</serviceStateTable>
</scpd>


<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>GetInfo</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>out</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
<argument>
<name>NewPossibleConnectionTypes</name>
<direction>out</direction>
<relatedStateVariable>PossibleConnectionTypes</relatedStateVariable>
</argument>
<argument>
<name>NewConnectionStatus</name>
<direction>out</direction>
<relatedStateVariable>ConnectionStatus</relatedStateVariable>
</argument>
<argument>
<name>NewLastConnectionError</name>
<direction>out</direction>
<relatedStateVariable>LastConnectionError</relatedStateVariable>
</argument>
<argument>
<name>NewRouteProtocolRx</name>
<direction>out</direction>
<relatedStateVariable>RouteProtocolRx</relatedStateVariable>
</argument>
<argument>
<name>NewUpstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>UpstreamMaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewDownstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>DownstreamMaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewEnable</name>
<direction>out</direction>
<relatedStateVariable>Enable</relatedStateVariable>
</argument>
<argument>
<name>NewUptime</name>
<direction>out</direction>
<relatedStateVariable>Uptime</relatedStateVariable>
</argument>
<argument>
<name>NewConnectionTrigger</name>
<direction>out</direction>
<relatedStateVariable>ConnectionTrigger</relatedStateVariable>
</argument>
<argument>
<name>NewRSIPAvailable</name>
<direction>out</direction>
<relatedStateVariable>RSIPAvailable</relatedStateVariable>
</argument>
<argument>
<name>NewNATEnabled</name>
<direction>out</direction>
<relatedStateVariable>NATEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewUserName</name>
<direction>out</direction>
<relatedStateVariable>UserName</relatedStateVariable>
</argument>
<argument>
<name>NewExternalIPAddress</name>
<direction>out</direction>
<relatedStateVariable>ExternalIPAddress</relatedStateVariable>
</argument>
<argument>
<name>NewMACAddress</name>
<direction>out</direction>
<relatedStateVariable>MACAddress</relatedStateVariable>
</argument>
<argument>
<name>NewDNSEnabled</name>
<direction>out</direction>
<relatedStateVariable>DNSEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewDNSOverrideAllowed</name>
<direction>out</direction>
<relatedStateVariable>DNSOverrideAllowed</relatedStateVariable>
</argument>
<argument>
<name>NewPPPoEACName</name>
<direction>out</direction>
<relatedStateVariable>PPPoEACName</relatedStateVariable>
</argument>
<argument>
<name>NewPPPoEServiceName</name>
<direction>out</direction>
<relatedStateVariable>PPPoEServiceName</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetConnectionType</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>in</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetConnectionTypeInfo</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>out</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
<argument>
<name>NewPossibleConnectionTypes</name>
<direction>out</direction>
<relatedStateVariable>PossibleConnectionTypes</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>RequestConnection</name>
</action>
<action>
<name>ForceTermination</name>
</action>
<action>
<name>SetAutoDisconnectTime</name>
<argumentList>
<argument>
<name>NewAutoDisconnectTime</name>
<direction>in</direction>
<relatedStateVariable>AutoDisconnectTime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetIdleDisconnectTime</name>
<argumentList>
<argument>
<name>NewIdleDisconnectTime</name>
<direction>in</direction>
<relatedStateVariable>IdleDisconnectTime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetStatusInfo</name>
<argumentList>
<argument>
<name>NewConnectionStatus</name>
<direction>out</direction>
<relatedStateVariable>ConnectionStatus</relatedStateVariable>
</argument>
<argument>
<name>NewLastConnectionError</name>
<direction>out</direction>
<relatedStateVariable>LastConnectionError</relatedStateVariable>
</argument>
<argument>
<name>NewUptime</name>
<direction>out</direction>
<relatedStateVariable>Uptime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetLinkLayerMaxBitRates</name>
<argumentList>
<argument>
<name>NewUpstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>UpstreamMaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewDownstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>DownstreamMaxBitRate</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetPPPAuthenticationProtocol</name>
<argumentList>
<argument>
<name>NewPPPAuthenticationProtocol</name>
<direction>out</direction>
<relatedStateVariable>PPPAuthenticationProtocol</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetUserName</name>
<argumentList>
<argument>
<name>NewUserName</name>
<direction>out</direction>
<relatedStateVariable>UserName</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetUserName</name>
<argumentList>
<argument>
<name>NewUserName</name>
<direction>in</direction>
<relatedStateVariable>UserName</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetPassword</name>
<argumentList>
<argument>
<name>NewPassword</name>
<direction>in</direction>
<relatedStateVariable>Password</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetAutoDisconnectTime</name>
<argumentList>
<argument>
<name>NewAutoDisconnectTime</name>
<direction>out</direction>
<relatedStateVariable>AutoDisconnectTime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetIdleDisconnectTime</name>
<argumentList>
<argument>
<name>NewIdleDisconnectTime</name>
<direction>out</direction>
<relatedStateVariable>IdleDisconnectTime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetNATRSIPStatus</name>
<argumentList>
<argument>
<name>NewRSIPAvailable</name>
<direction>out</direction>
<relatedStateVariable>RSIPAvailable</relatedStateVariable>
</argument>
<argument>
<name>NewNATEnabled</name>
<direction>out</direction>
<relatedStateVariable>NATEnabled</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetGenericPortMappingEntry</name>
<argumentList>
<argument>
<name>NewPortMappingIndex</name>
<direction>in</direction>
<relatedStateVariable>PortMappingNumberOfEntries</relatedStateVariable>
</argument>
<argument>
<name>NewRemoteHost</name>
<direction>out</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>out</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>out</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>out</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>out</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>out</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>out</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>out</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetSpecificPortMappingEntry</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>out</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>out</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>out</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>out</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>out</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>AddPortMapping</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>in</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>in</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>in</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>in</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>in</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeletePortMapping</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument> 
</argumentList>
</action>
<action>
<name>GetExternalIPAddress</name>
<argumentList>
<argument>
<name>NewExternalIPAddress</name>
<direction>out</direction>
<relatedStateVariable>ExternalIPAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>ConnectionType</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PossibleConnectionTypes</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Unconfigured</allowedValue> 
<allowedValue>IP_Routed</allowedValue>    
<allowedValue>DHCP_Spoofed</allowedValue> 
<allowedValue>PPPOE_Bridged</allowedValue>
<allowedValue>PPTP_Relay</allowedValue> 
<allowedValue>L2TP_Relay</allowedValue> 
<allowedValue>PPPOE_Relay</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>ConnectionStatus</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Unconfigured</allowedValue>
<allowedValue>Connecting</allowedValue>
<allowedValue>Authenticating</allowedValue>
<allowedValue>Connected</allowedValue>
<allowedValue>PendingDisconnect</allowedValue>
<allowedValue>Disconnecting</allowedValue>
<allowedValue>Disconnected</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>Uptime</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UserName</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Password</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>LastConnectionError</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>ERROR_NONE</allowedValue>
<allowedValue>ERROR_ISP_TIME_OUT</allowedValue>   
<allowedValue>ERROR_COMMAND_ABORTED</allowedValue>
<allowedValue>ERROR_NOT_ENABLED_FOR_INTERNET</allowedValue>
<allowedValue>ERROR_BAD_PHONE_NUMBER</allowedValue> 
<allowedValue>ERROR_USER_DISCONNECT</allowedValue>  
<allowedValue>ERROR_ISP_DISCONNECT</allowedValue>   
<allowedValue>ERROR_IDLE_DISCONNECT</allowedValue>  
<allowedValue>ERROR_FORCED_DISCONNECT</allowedValue>
<allowedValue>ERROR_SERVER_OUT_OF_RESOURCES</allowedValue>
<allowedValue>ERROR_RESTRICTED_LOGON_HOURS</allowedValue>
<allowedValue>ERROR_ACCOUNT_DISABLED</allowedValue>
<allowedValue>ERROR_ACCOUNT_EXPIRED</allowedValue> 
<allowedValue>ERROR_PASSWORD_EXPIRED</allowedValue>
<allowedValue>ERROR_AUTHENTICATION_FAILURE</allowedValue>
<allowedValue>ERROR_NO_DIALTONE</allowedValue>
<allowedValue>ERROR_NO_CARRIER</allowedValue>
<allowedValue>ERROR_NO_ANSWER</allowedValue>
<allowedValue>ERROR_LINE_BUSY</allowedValue>
<allowedValue>ERROR_UNSUPPORTED_BITSPERSECOND</allowedValue>
<allowedValue>ERROR_TOO_MANY_LINE_ERRORS</allowedValue>
<allowedValue>ERROR_IP_CONFIGURATION</allowedValue>
<allowedValue>ERROR_UNKNOWN</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>RSIPAvailable</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>NATEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ExternalIPAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingNumberOfEntries</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingLeaseDuration</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>RemoteHost</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ExternalPort</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>InternalPort</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingProtocol</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>TCP</allowedValue>
<allowedValue>UDP</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>InternalClient</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingDescription</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>AutoDisconnectTime</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>IdleDisconnectTime</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PPPAuthenticationProtocol</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DownstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DownstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>RouteProtocolRx</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Off</allowedValue>
<allowedValue>RIPv1</allowedValue>
<allowedValue>RIPv2</allowedValue>
<allowedValue>OSPF</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>ConnectionTrigger</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>OnDemand</allowedValue>
<allowedValue>AlwaysOn</allowedValue>
<allowedValue>Manual</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>MACAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DNSEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DNSOverrideAllowed</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PPPoEACName</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PPPoEServiceName</name>
<dataType>string</dataType>
</stateVariable>
</serviceStateTable>
</scpd>



<?xml version="1.0"?>
<scpd xmlns="urn:dslforum-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>GetInfo</name>
<argumentList>
<argument>
<name>NewEnable</name>
<direction>out</direction>
<relatedStateVariable>Enable</relatedStateVariable>
</argument>
<argument>
<name>NewStatus</name>
<direction>out</direction>
<relatedStateVariable>Status</relatedStateVariable>
</argument>
<argument>
<name>NewMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>MaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewChannel</name>
<direction>out</direction>
<relatedStateVariable>Channel</relatedStateVariable>
</argument>
<argument>
<name>NewSSID</name>
<direction>out</direction>
<relatedStateVariable>SSID</relatedStateVariable>
</argument>
<argument>
<name>NewBeaconType</name>
<direction>out</direction>
<relatedStateVariable>BeaconType</relatedStateVariable>
</argument>
<argument>
<name>NewMACAddressControlEnabled</name>
<direction>out</direction>
<relatedStateVariable>MACAddressControlEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewStandard</name>
<direction>out</direction>
<relatedStateVariable>Standard</relatedStateVariable>
</argument>
<argument>
<name>NewBSSID</name>
<direction>out</direction>
<relatedStateVariable>BSSID</relatedStateVariable>
</argument>
<argument>
<name>NewBasicEncryptionModes</name>
<direction>out</direction>
<relatedStateVariable>BasicEncryptionModes</relatedStateVariable>
</argument>
<argument> 
<name>NewBasicAuthenticationMode</name>
<direction>out</direction>
<relatedStateVariable>BasicAuthenticationMode</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetChannelInfo</name>
<argumentList>
<argument>
<name>NewChannel</name>
<direction>out</direction>
<relatedStateVariable>Channel</relatedStateVariable>
</argument>
<argument>
<name>NewPossibleChannels</name>
<direction>out</direction>
<relatedStateVariable>PossibleChannels</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetChannel</name>
<argumentList>
<argument>
<name>NewChannel</name>
<direction>in</direction>
<relatedStateVariable>Channel</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetConfig</name>
<argumentList>
<argument>
<name>NewMaxBitRate</name>
<direction>in</direction>
<relatedStateVariable>MaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewChannel</name>
<direction>in</direction>
<relatedStateVariable>Channel</relatedStateVariable>
</argument>
<argument>
<name>NewSSID</name>
<direction>in</direction>
<relatedStateVariable>SSID</relatedStateVariable>
</argument>
<argument>
<name>NewBeaconType</name>
<direction>in</direction>
<relatedStateVariable>BeaconType</relatedStateVariable>
</argument>
<argument>
<name>NewMACAddressControlEnabled</name>
<direction>in</direction>
<relatedStateVariable>MACAddressControlEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewBasicEncryptionModes</name>
<direction>in</direction>
<relatedStateVariable>BasicEncryptionModes</relatedStateVariable>
</argument>
<argument>
<name>NewBasicAuthenticationMode</name>
<direction>in</direction>
<relatedStateVariable>BasicAuthenticationMode</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetDefaultWEPKeyIndex</name>
<argumentList>
<argument>
<name>NewWEPKeyIndex</name>
<direction>in</direction>
<relatedStateVariable>WEPKeyIndex</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDefaultWEPKeyIndex</name>
<argumentList>
<argument>
<name>NewWEPKeyIndex</name>
<direction>out</direction>
<relatedStateVariable>WEPKeyIndex</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetEnable</name>
<argumentList>
<argument>
<name>NewEnable</name>
<direction>in</direction>
<relatedStateVariable>Enable</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetSecurityKeys</name>
<argumentList>
<argument>
<name>NewWEPKey0</name>
<direction>in</direction>
<relatedStateVariable>WEPKey</relatedStateVariable>
</argument>
<argument>
<name>NewWEPKey1</name>
<direction>in</direction>
<relatedStateVariable>WEPKey</relatedStateVariable>
</argument>
<argument>
<name>NewWEPKey2</name>
<direction>in</direction>
<relatedStateVariable>WEPKey</relatedStateVariable>
</argument>
<argument>
<name>NewWEPKey3</name>
<direction>in</direction>
<relatedStateVariable>WEPKey</relatedStateVariable>
</argument>
<argument>
<name>NewPreSharedKey</name>
<direction>in</direction>
<relatedStateVariable>PreSharedKey</relatedStateVariable>
</argument>
<argument>
<name>NewKeyPassphrase</name>
<direction>in</direction>
<relatedStateVariable>KeyPassphrase</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetSecurityKeys</name>
<argumentList>
<argument>
<name>NewWEPKey0</name>
<direction>out</direction>
<relatedStateVariable>WEPKey</relatedStateVariable>
</argument>
<argument>
<name>NewWEPKey1</name>
<direction>out</direction>
<relatedStateVariable>WEPKey</relatedStateVariable>
</argument>
<argument>
<name>NewWEPKey2</name>
<direction>out</direction>
<relatedStateVariable>WEPKey</relatedStateVariable>
</argument>
<argument>
<name>NewWEPKey3</name>
<direction>out</direction>
<relatedStateVariable>WEPKey</relatedStateVariable>
</argument>
<argument>
<name>NewPreSharedKey</name>
<direction>out</direction>
<relatedStateVariable>PreSharedKey</relatedStateVariable>
</argument>
<argument>
<name>NewKeyPassphrase</name>
<direction>out</direction>
<relatedStateVariable>KeyPassphrase</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetBasBeaconSecurityProperties</name>
<argumentList>
<argument>
<name>NewBasicEncryptionModes</name>
<direction>in</direction>
<relatedStateVariable>BasicEncryptionModes</relatedStateVariable>
</argument>
<argument>
<name>NewBasicAuthenticationMode</name>
<direction>in</direction>
<relatedStateVariable>BasicAuthenticationMode</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetBasBeaconSecurityProperties</name>
<argumentList>
<argument>
<name>NewBasicEncryptionModes</name>
<direction>out</direction>
<relatedStateVariable>BasicEncryptionModes</relatedStateVariable>
</argument>
<argument>
<name>NewBasicAuthenticationMode</name>
<direction>out</direction>
<relatedStateVariable>BasicAuthenticationMode</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetBeaconAdvertisement</name>
<argumentList>
<argument>
<name>NewBeaconAdvertisementEnabled</name>
<direction>in</direction>
<relatedStateVariable>BeaconAdvertisementEnabled</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetBeaconAdvertisement</name>
<argumentList>
<argument>
<name>NewBeaconAdvertisementEnabled</name>
<direction>out</direction>
<relatedStateVariable>BeaconAdvertisementEnabled</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetSSID</name>
<argumentList>
<argument>
<name>NewSSID</name>
<direction>in</direction>
<relatedStateVariable>SSID</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetSSID</name>
<argumentList>
<argument>
<name>NewSSID</name>
<direction>out</direction>
<relatedStateVariable>SSID</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetBeaconType</name>
<argumentList>
<argument>
<name>NewBeaconType</name>
<direction>in</direction>
<relatedStateVariable>BeaconType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetBeaconType</name>
<argumentList>
<argument>
<name>NewBeaconType</name>
<direction>out</direction>
<relatedStateVariable>BeaconType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetRadioMode</name>
<argumentList>
<argument>
<name>NewRadioEnabled</name>
<direction>in</direction>
<relatedStateVariable>RadioEnabled</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetRadioMode</name>
<argumentList>
<argument>
<name>NewRadioEnabled</name>
<direction>out</direction>
<relatedStateVariable>RadioEnabled</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetAuthenticationServiceMode</name>
<argumentList>
<argument>
<name>NewAuthenticationServiceMode</name>
<direction>in</direction>
<relatedStateVariable>AuthenticationServiceMode</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetWPABeaconSecurityProperties</name>
<argumentList>
<argument>
<name>NewWPAEncryptionModes</name>
<direction>in</direction>
<relatedStateVariable>WPAEncryptionModes</relatedStateVariable>
</argument>
<argument>
<name>NewWPAAuthenticationMode</name>
<direction>in</direction>
<relatedStateVariable>WPAAuthenticationMode</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetWPABeaconSecurityProperties</name>
<argumentList>
<argument>
<name>NewWPAEncryptionModes</name>
<direction>out</direction>
<relatedStateVariable>WPAEncryptionModes</relatedStateVariable>
</argument>
<argument>
<name>NewWPAAuthenticationMode</name>
<direction>out</direction>
<relatedStateVariable>WPAAuthenticationMode</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetPreSharedKey</name>
<argumentList>
<argument>
<name>NewPreSharedKeyIndex</name>
<direction>in</direction>
<relatedStateVariable>PreSharedKeyIndex</relatedStateVariable>
</argument>
<argument>
<name>NewAssociatedDeviceMACAddress</name>
<direction>in</direction>
<relatedStateVariable>AssociatedDeviceMACAddress</relatedStateVariable>
</argument>
<argument>
<name>NewPreSharedKey</name>
<direction>in</direction>
<relatedStateVariable>PreSharedKey</relatedStateVariable>
</argument>
<argument>
<name>NewKeyPassphrase</name>
<direction>in</direction>
<relatedStateVariable>KeyPassphrase</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetDataTransmitRates</name>
<argumentList>
<argument>
<name>NewBasicDataTransmitRates</name>
<direction>in</direction>
<relatedStateVariable>BasicDataTransmitRates</relatedStateVariable>
</argument>
<argument>
<name>NewOperationalDataTransmitRates</name>
<direction>in</direction>
<relatedStateVariable>OperationalDataTransmitRates</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDataTransmitRateInfo</name>
<argumentList>
<argument>
<name>NewBasicDataTransmitRates</name>
<direction>out</direction>
<relatedStateVariable>BasicDataTransmitRates</relatedStateVariable>
</argument>
<argument>
<name>NewOperationalDataTransmitRates</name>
<direction>out</direction>
<relatedStateVariable>OperationalDataTransmitRates</relatedStateVariable>
</argument>
<argument>
<name>NewPossibleDataTransmitRates</name>
<direction>out</direction>
<relatedStateVariable>PossibleDataTransmitRates</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetByteStatsForAssociatedDev</name>
<argumentList>
<argument>
<name>NewAssociatedDeviceMACAddress</name>
<direction>in</direction>
<relatedStateVariable>AssociatedDeviceMACAddress</relatedStateVariable>
</argument>
<argument>
<name>NewTotalBytesSent</name>
<direction>out</direction>
<relatedStateVariable>TotalBytesSent</relatedStateVariable>
</argument>
<argument>
<name>NewTotalBytesReceived</name>
<direction>out</direction>
<relatedStateVariable>TotalBytesReceived</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetPacketStatsForAssociatedDev</name>
<argumentList>
<argument>
<name>NewAssociatedDeviceMACAddress</name>
<direction>in</direction>
<relatedStateVariable>AssociatedDeviceMACAddress</relatedStateVariable>
</argument>
<argument>
<name>NewTotalPacketsSent</name>
<direction>out</direction>
<relatedStateVariable>TotalPacketsSent</relatedStateVariable>
</argument>
<argument>
<name>NewTotalPacketsReceived</name>
<direction>out</direction>
<relatedStateVariable>TotalPacketsReceived</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>X_SetChannelWidth</name>
<argumentList>
<argument>
<name>NewX_ChannelWidth</name>
<direction>in</direction>
<relatedStateVariable>X_ChannelWidth</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>X_GetChannelWidth</name>
<argumentList>
<argument>
<name>NewX_ChannelWidth</name>
<direction>out</direction>
<relatedStateVariable>X_ChannelWidth</relatedStateVariable>
</argument>
<argument>
<name>NewX_PossibleChannelWidth</name>
<direction>out</direction>
<relatedStateVariable>X_PossibleChannelWidth</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>Enable</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Status</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Up</allowedValue>
<allowedValue>Error</allowedValue>
<allowedValue>Disabled</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>MaxBitRate</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Channel</name>
<dataType>ui1</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PossibleChannels</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>SSID</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>BeaconType</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>None</allowedValue>
<allowedValue>Basic</allowedValue>
<allowedValue>WPA</allowedValue>
<allowedValue>11i</allowedValue>
<allowedValue>WPAand11i</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>WEPKey</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>WEPEncryptionLevel</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PreSharedKey</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>KeyPassphrase</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>MACAddressControlEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Standard</name> 
<dataType>string</dataType>
<allowedValueList>
<allowedValue>a</allowedValue> 
<allowedValue>b</allowedValue>
<allowedValue>g</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>BSSID</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>BasicEncryptionModes</name> 
<dataType>string</dataType>
<allowedValueList>
<allowedValue>None</allowedValue>
<allowedValue>WEPEncryption</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>BasicAuthenticationMode</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>None</allowedValue>
<allowedValue>EAPAuthentication</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>RadioEnabled</name>
<dataType>boolean</dataType>   
</stateVariable>
<stateVariable sendEvents="no">
<name>AuthenticationServiceMode</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>None</allowedValue>
<allowedValue>RadiusClient</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>WPAEncryptionModes</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>TKIPEncryption</allowedValue>
<allowedValue>AESEncryption</allowedValue>
<allowedValue>TKIPandAESEncryption</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>WPAAuthenticationMode</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>PSKAuthentication</allowedValue>
<allowedValue>EAPAuthentication</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>PreSharedKeyIndex</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>0</allowedValue>
<allowedValue>1</allowedValue>
<allowedValue>2</allowedValue>
<allowedValue>3</allowedValue>
<allowedValue>4</allowedValue>
<allowedValue>5</allowedValue>
<allowedValue>6</allowedValue>
<allowedValue>7</allowedValue>
<allowedValue>8</allowedValue>
<allowedValue>9</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>AssociatedDeviceMACAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>WEPKeyIndex</name>
<dataType>ui1</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>BeaconAdvertisementEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>BasicDataTransmitRates</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>OperationalDataTransmitRates</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PossibleDataTransmitRates</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalPacketsSent</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalPacketsReceived</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>X_ChannelWidth</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>20</allowedValue>
<allowedValue>20,40</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalBytesSent</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalBytesReceived</name>
<dataType>ui4</dataType>
</stateVariable>
</serviceStateTable>
</scpd>
<?xml version="1.0"?>
<root xmlns="urn:schemas-upnp-org:device-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<URLBase>http://<!-- #echo var="UPNP_SERVER_IP" --></URLBase>
<device>
<deviceType>urn:schemas-upnp-org:device:InternetGatewayDevice:1</deviceType>
<friendlyName><!-- #echo var="_PROD_FRIENDLY_NAME" --> (<!-- #echo var="_BOARD_SERIAL_NBR" -->)</friendlyName>
<manufacturer><!-- #echo var="_COMPANY_NAME" --></manufacturer>
<manufacturerURL><!-- #echo var="_COMPANY_URL" --></manufacturerURL>
<modelDescription><!-- #echo var="_PROD_DESCRIPTION" --></modelDescription>
<modelName><!-- #echo var="_PROD_NAME" --></modelName>
<modelNumber><!-- #echo var="_PROD_NUMBER" --></modelNumber>
<modelURL><!-- #echo var="_PROD_URL" --></modelURL>
<serialNumber><!-- #echo var="_BOARD_SERIAL_NBR" --></serialNumber>
<UDN><!-- #exec cgi="includeUDN(UPNP-IGD)" --></UDN>
<presentationURL>/</presentationURL>
<serviceList>
<!-- #exec cgi="includeL3Forward(UPNP-IGD)" --></serviceList>
<deviceList>
<!-- #exec cgi="includeWanDevices(UPNP-IGD)" --></deviceList>
</device>
</root>

<?xml version="1.0"?>
<scpd xmlns="urn:schemas-upnp-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetDHCPServerConfigurable</name>
<argumentList>
<argument>
<name>NewDHCPServerConfigurable</name>
<direction>in</direction>
<relatedStateVariable>DHCPServerConfigurable</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDHCPServerConfigurable</name>
<argumentList>
<argument>
<name>NewDHCPServerConfigurable</name>
<direction>out</direction>
<relatedStateVariable>DHCPServerConfigurable</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetDHCPRelay</name>
<argumentList>
<argument>
<name>NewDHCPRelay</name>
<direction>in</direction>
<relatedStateVariable>DHCPRelay</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDHCPRelay</name>
<argumentList>
<argument>
<name>NewDHCPRelay</name>
<direction>out</direction>
<relatedStateVariable>DHCPRelay</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetSubnetMask</name>
<argumentList>
<argument>
<name>NewSubnetMask</name>
<direction>in</direction>
<relatedStateVariable>SubnetMask</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetSubnetMask</name>
<argumentList>
<argument>
<name>NewSubnetMask</name>
<direction>out</direction>
<relatedStateVariable>SubnetMask</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetIPRouter</name>
<argumentList>
<argument>
<name>NewIPRouters</name>
<direction>in</direction>
<relatedStateVariable>IPRouters</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeleteIPRouter</name>
<argumentList>
<argument>
<name>NewIPRouters</name>
<direction>in</direction>
<relatedStateVariable>IPRouters</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetIPRoutersList</name>
<argumentList>
<argument>
<name>NewIPRouters</name>
<direction>out</direction>
<relatedStateVariable>IPRouters</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetDomainName</name>
<argumentList>
<argument>
<name>NewDomainName</name>
<direction>in</direction>
<relatedStateVariable>DomainName</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDomainName</name>
<argumentList>
<argument>
<name>NewDomainName</name>
<direction>out</direction>
<relatedStateVariable>DomainName</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetAddressRange</name>
<argumentList>
<argument>
<name>NewMinAddress</name>
<direction>in</direction>
<relatedStateVariable>MinAddress</relatedStateVariable>
</argument>
<argument>
<name>NewMaxAddress</name>
<direction>in</direction>
<relatedStateVariable>MaxAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetAddressRange</name>
<argumentList>
<argument>
<name>NewMinAddress</name>
<direction>out</direction>
<relatedStateVariable>MinAddress</relatedStateVariable>
</argument>
<argument>
<name>NewMaxAddress</name>
<direction>out</direction>
<relatedStateVariable>MaxAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetReservedAddress</name>
<argumentList>
<argument>
<name>NewReservedAddresses</name>
<direction>in</direction>
<relatedStateVariable>ReservedAddresses</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeleteReservedAddress</name>
<argumentList>
<argument>
<name>NewReservedAddresses</name>
<direction>in</direction>
<relatedStateVariable>ReservedAddresses</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetReservedAddresses</name>
<argumentList>
<argument>
<name>NewReservedAddresses</name>
<direction>out</direction>
<relatedStateVariable>ReservedAddresses</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetDNSServer</name>
<argumentList>
<argument>
<name>NewDNSServers</name>
<direction>in</direction>
<relatedStateVariable>DNSServers</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeleteDNSServer</name>
<argumentList>
<argument>
<name>NewDNSServers</name>
<direction>in</direction>
<relatedStateVariable>DNSServers</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDNSServers</name>
<argumentList>
<argument>
<name>NewDNSServers</name>
<direction>out</direction>
<relatedStateVariable>DNSServers</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>DHCPServerConfigurable</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DHCPRelay</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>SubnetMask</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>IPRouters</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DNSServers</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DomainName</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>MinAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>MaxAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ReservedAddresses</name>
<dataType>string</dataType>
</stateVariable>
</serviceStateTable>
</scpd>
<?xml version="1.0"?>
<scpd xmlns="urn:schemas-upnp-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetDefaultConnectionService</name>
<argumentList>
<argument>
<name>NewDefaultConnectionService</name>
<direction>in</direction>
<relatedStateVariable>DefaultConnectionService</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDefaultConnectionService</name>
<argumentList>
<argument>
<name>NewDefaultConnectionService</name>
<direction>out</direction>
<relatedStateVariable>DefaultConnectionService</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="yes">
<name>DefaultConnectionService</name>
<dataType>string</dataType>
</stateVariable>
</serviceStateTable>
</scpd>


<?xml version="1.0"?>
<scpd xmlns="urn:schemas-upnp-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetEnabledForInternet</name>
<argumentList>
<argument>
<name>NewEnabledForInternet</name>
<direction>in</direction>
<relatedStateVariable>EnabledForInternet</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetEnabledForInternet</name>
<argumentList>
<argument>
<name>NewEnabledForInternet</name>
<direction>out</direction>
<relatedStateVariable>EnabledForInternet</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetCommonLinkProperties</name>
<argumentList>
<argument>
<name>NewWANAccessType</name>
<direction>out</direction>
<relatedStateVariable>WANAccessType</relatedStateVariable>
</argument>
<argument>
<name>NewLayer1UpstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>Layer1UpstreamMaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewLayer1DownstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>Layer1DownstreamMaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewPhysicalLinkStatus</name>
<direction>out</direction>
<relatedStateVariable>PhysicalLinkStatus</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetMaximumActiveConnections</name>
<argumentList>
<argument>
<name>NewMaximumActiveConnections</name>
<direction>out</direction>
<relatedStateVariable>MaximumActiveConnections</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetTotalBytesSent</name>
<argumentList>
<argument>
<name>NewTotalBytesSent</name>
<direction>out</direction>
<relatedStateVariable>TotalBytesSent</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetTotalBytesReceived</name>
<argumentList>
<argument>
<name>NewTotalBytesReceived</name>
<direction>out</direction>
<relatedStateVariable>TotalBytesReceived</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetTotalPacketsSent</name>
<argumentList>
<argument>
<name>NewTotalPacketsSent</name>
<direction>out</direction>
<relatedStateVariable>TotalPacketsSent</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetTotalPacketsReceived</name>
<argumentList>
<argument>
<name>NewTotalPacketsReceived</name>
<direction>out</direction>
<relatedStateVariable>TotalPacketsReceived</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>WANAccessType</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>DSL</allowedValue>
<allowedValue>POTS</allowedValue>
<allowedValue>Cable</allowedValue>
<allowedValue>Ethernet</allowedValue>
<allowedValue>Other</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>Layer1UpstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Layer1DownstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PhysicalLinkStatus</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Up</allowedValue>
<allowedValue>Down</allowedValue>
<allowedValue>Initializing</allowedValue>
<allowedValue>Unavailable</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>MaximumActiveConnections</name>
<dataType>ui2</dataType>
<allowedValueRange>
<minimum>1</minimum>
<maximum>100</maximum>
<step>1</step>
</allowedValueRange>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalBytesSent</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalBytesReceived</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalPacketsSent</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>TotalPacketsReceived</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>EnabledForInternet</name>
<dataType>boolean</dataType>
</stateVariable>
</serviceStateTable>
</scpd>
<?xml version="1.0"?>
<scpd xmlns="urn:schemas-upnp-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetDSLLinkType</name>
<argumentList>
<argument>
<name>NewLinkType</name>
<direction>in</direction>
<relatedStateVariable>LinkType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDSLLinkInfo</name>
<argumentList>
<argument>
<name>NewLinkType</name>
<direction>out</direction>
<relatedStateVariable>LinkType</relatedStateVariable>
</argument>
<argument>
<name>NewLinkStatus</name>
<direction>out</direction>
<relatedStateVariable>LinkStatus</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetAutoConfig</name>
<argumentList>
<argument>
<name>NewAutoConfig</name>
<direction>out</direction>
<relatedStateVariable>AutoConfig</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetModulationType</name>
<argumentList>
<argument>
<name>NewModulationType</name>
<direction>out</direction>
<relatedStateVariable>ModulationType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetDestinationAddress</name>
<argumentList>
<argument>
<name>NewDestinationAddress</name>
<direction>out</direction>
<relatedStateVariable>DestinationAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetATMEncapsulation</name>
<argumentList>
<argument>
<name>NewATMEncapsulation</name>
<direction>in</direction>
<relatedStateVariable>ATMEncapsulation</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetATMEncapsulation</name>
<argumentList>
<argument>
<name>NewATMEncapsulation</name>
<direction>out</direction>
<relatedStateVariable>ATMEncapsulation</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetFCSPreserved</name>
<argumentList>
<argument>
<name>NewFCSPreserved</name>
<direction>in</direction>
<relatedStateVariable>FCSPreserved</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetFCSPreserved</name>
<argumentList>
<argument>
<name>NewFCSPreserved</name>
<direction>out</direction>
<relatedStateVariable>FCSPreserved</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>LinkType</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>EoA</allowedValue>
<allowedValue>IPoA</allowedValue>
<allowedValue>CIP</allowedValue>
<allowedValue>PPPoA</allowedValue>
<allowedValue>PPPoE</allowedValue>
<allowedValue>Unconfigured</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="yes">
<name>LinkStatus</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Up</allowedValue>
<allowedValue>Down</allowedValue>
<allowedValue>Initializing</allowedValue>
<allowedValue>Unavailable</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>ModulationType</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>ADSL_G.dmt</allowedValue>
<allowedValue>ADSL_G.lite</allowedValue>
<allowedValue>G.shdsl</allowedValue>
<allowedValue>IDSL</allowedValue>
<allowedValue>HDSL</allowedValue>
<allowedValue>SDSL</allowedValue>
<allowedValue>VDSL</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>DestinationAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ATMEncapsulation</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>LLC</allowedValue>
<allowedValue>VCMUX</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>FCSPreserved</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>AutoConfig</name>
<dataType>boolean</dataType>
</stateVariable>
</serviceStateTable>
</scpd>


<?xml version="1.0"?>
<scpd xmlns="urn:schemas-upnp-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetConnectionType</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>in</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetConnectionTypeInfo</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>out</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
<argument>
<name>NewPossibleConnectionTypes</name>
<direction>out</direction>
<relatedStateVariable>PossibleConnectionTypes</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>RequestConnection</name>
</action>
<action>
<name>ForceTermination</name>
</action>
<action>
<name>GetStatusInfo</name>
<argumentList>
<argument>
<name>NewConnectionStatus</name>
<direction>out</direction>
<relatedStateVariable>ConnectionStatus</relatedStateVariable>
</argument>
<argument>
<name>NewLastConnectionError</name>
<direction>out</direction>
<relatedStateVariable>LastConnectionError</relatedStateVariable>
</argument>
<argument>
<name>NewUptime</name>
<direction>out</direction>
<relatedStateVariable>Uptime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetNATRSIPStatus</name>
<argumentList>
<argument>
<name>NewRSIPAvailable</name>
<direction>out</direction>
<relatedStateVariable>RSIPAvailable</relatedStateVariable>
</argument>
<argument>
<name>NewNATEnabled</name>
<direction>out</direction>
<relatedStateVariable>NATEnabled</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetGenericPortMappingEntry</name>
<argumentList>
<argument>
<name>NewPortMappingIndex</name>
<direction>in</direction>
<relatedStateVariable>PortMappingNumberOfEntries</relatedStateVariable>
</argument>
<argument>
<name>NewRemoteHost</name>
<direction>out</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>out</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>out</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>out</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>out</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>out</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>out</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>out</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetSpecificPortMappingEntry</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>out</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>out</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>out</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>out</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>out</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>AddPortMapping</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>in</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>in</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>in</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>in</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>in</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeletePortMapping</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument> 
</argumentList>
</action>
<action>
<name>GetExternalIPAddress</name>
<argumentList>
<argument>
<name>NewExternalIPAddress</name>
<direction>out</direction>
<relatedStateVariable>ExternalIPAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>ConnectionType</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>PossibleConnectionTypes</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Unconfigured</allowedValue>
<allowedValue>IP_Routed</allowedValue>
<allowedValue>IP_Bridged</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="yes">
<name>ConnectionStatus</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Unconfigured</allowedValue>
<allowedValue>Connecting</allowedValue>
<allowedValue>Connected</allowedValue>
<allowedValue>PendingDisconnect</allowedValue>
<allowedValue>Disconnecting</allowedValue>
<allowedValue>Disconnected</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>Uptime</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>LastConnectionError</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>ERROR_NONE</allowedValue>
<allowedValue>ERROR_COMMAND_ABORTED</allowedValue>
<allowedValue>ERROR_NOT_ENABLED_FOR_INTERNET</allowedValue>
<allowedValue>ERROR_USER_DISCONNECT</allowedValue>
<allowedValue>ERROR_ISP_DISCONNECT</allowedValue>
<allowedValue>ERROR_IDLE_DISCONNECT</allowedValue>
<allowedValue>ERROR_FORCED_DISCONNECT</allowedValue>
<allowedValue>ERROR_NO_CARRIER</allowedValue>
<allowedValue>ERROR_IP_CONFIGURATION</allowedValue>
<allowedValue>ERROR_UNKNOWN</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>RSIPAvailable</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>NATEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>ExternalIPAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>PortMappingNumberOfEntries</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingLeaseDuration</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>RemoteHost</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ExternalPort</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>InternalPort</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingProtocol</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>TCP</allowedValue>
<allowedValue>UDP</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>InternalClient</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingDescription</name>
<dataType>string</dataType>
</stateVariable>
</serviceStateTable>
</scpd>


<?xml version="1.0"?>
<scpd xmlns="urn:schemas-upnp-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>SetConnectionType</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>in</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetConnectionTypeInfo</name>
<argumentList>
<argument>
<name>NewConnectionType</name>
<direction>out</direction>
<relatedStateVariable>ConnectionType</relatedStateVariable>
</argument>
<argument>
<name>NewPossibleConnectionTypes</name>
<direction>out</direction>
<relatedStateVariable>PossibleConnectionTypes</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>ConfigureConnection</name>
<argumentList>
<argument>
<name>NewUserName</name>
<direction>in</direction>
<relatedStateVariable>UserName</relatedStateVariable>
</argument>
<argument>
<name>NewPassword</name>
<direction>in</direction>
<relatedStateVariable>Password</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>RequestConnection</name>
</action>
<action>
<name>ForceTermination</name>
</action>
<action>
<name>SetAutoDisconnectTime</name>
<argumentList>
<argument>
<name>NewAutoDisconnectTime</name>
<direction>in</direction>
<relatedStateVariable>AutoDisconnectTime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetIdleDisconnectTime</name>
<argumentList>
<argument>
<name>NewIdleDisconnectTime</name>
<direction>in</direction>
<relatedStateVariable>IdleDisconnectTime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetStatusInfo</name>
<argumentList>
<argument>
<name>NewConnectionStatus</name>
<direction>out</direction>
<relatedStateVariable>ConnectionStatus</relatedStateVariable>
</argument>
<argument>
<name>NewLastConnectionError</name>
<direction>out</direction>
<relatedStateVariable>LastConnectionError</relatedStateVariable>
</argument>
<argument>
<name>NewUptime</name>
<direction>out</direction>
<relatedStateVariable>Uptime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetPPPAuthenticationProtocol</name>
<argumentList>
<argument>
<name>NewPPPAuthenticationProtocol</name>
<direction>out</direction>
<relatedStateVariable>PPPAuthenticationProtocol</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetUserName</name>
<argumentList>
<argument>
<name>NewUserName</name>
<direction>out</direction>
<relatedStateVariable>UserName</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetPassword</name>
<argumentList>
<argument>
<name>NewPassword</name>
<direction>out</direction>
<relatedStateVariable>Password</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>X_SetUserName</name>
<argumentList>
<argument>
<name>NewUserName</name>
<direction>in</direction>
<relatedStateVariable>UserName</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>X_SetPassword</name>
<argumentList>
<argument>
<name>NewPassword</name>
<direction>in</direction>
<relatedStateVariable>Password</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetLinkLayerMaxBitRates</name>
<argumentList>
<argument>
<name>NewUpstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>UpstreamMaxBitRate</relatedStateVariable>
</argument>
<argument>
<name>NewDownstreamMaxBitRate</name>
<direction>out</direction>
<relatedStateVariable>DownstreamMaxBitRate</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetAutoDisconnectTime</name>
<argumentList>
<argument>
<name>NewAutoDisconnectTime</name>
<direction>out</direction>
<relatedStateVariable>AutoDisconnectTime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetIdleDisconnectTime</name>
<argumentList>
<argument>
<name>NewIdleDisconnectTime</name>
<direction>out</direction>
<relatedStateVariable>IdleDisconnectTime</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetNATRSIPStatus</name>
<argumentList>
<argument>
<name>NewRSIPAvailable</name>
<direction>out</direction>
<relatedStateVariable>RSIPAvailable</relatedStateVariable>
</argument>
<argument>
<name>NewNATEnabled</name>
<direction>out</direction>
<relatedStateVariable>NATEnabled</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetGenericPortMappingEntry</name>
<argumentList>
<argument>
<name>NewPortMappingIndex</name>
<direction>in</direction>
<relatedStateVariable>PortMappingNumberOfEntries</relatedStateVariable>
</argument>
<argument>
<name>NewRemoteHost</name>
<direction>out</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>out</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>out</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>out</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>out</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>out</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>out</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>out</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetSpecificPortMappingEntry</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>out</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>out</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>out</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>out</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>out</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>AddPortMapping</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
<argument>
<name>NewInternalPort</name>
<direction>in</direction>
<relatedStateVariable>InternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewInternalClient</name>
<direction>in</direction>
<relatedStateVariable>InternalClient</relatedStateVariable>
</argument>
<argument>
<name>NewEnabled</name>
<direction>in</direction>
<relatedStateVariable>PortMappingEnabled</relatedStateVariable>
</argument>
<argument>
<name>NewPortMappingDescription</name>
<direction>in</direction>
<relatedStateVariable>PortMappingDescription</relatedStateVariable>
</argument>
<argument>
<name>NewLeaseDuration</name>
<direction>in</direction>
<relatedStateVariable>PortMappingLeaseDuration</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>DeletePortMapping</name>
<argumentList>
<argument>
<name>NewRemoteHost</name>
<direction>in</direction>
<relatedStateVariable>RemoteHost</relatedStateVariable>
</argument>
<argument>
<name>NewExternalPort</name>
<direction>in</direction>
<relatedStateVariable>ExternalPort</relatedStateVariable>
</argument>
<argument>
<name>NewProtocol</name>
<direction>in</direction>
<relatedStateVariable>PortMappingProtocol</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>GetExternalIPAddress</name>
<argumentList>
<argument>
<name>NewExternalIPAddress</name>
<direction>out</direction>
<relatedStateVariable>ExternalIPAddress</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>ConnectionType</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>PossibleConnectionTypes</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Unconfigured</allowedValue>
<allowedValue>IP_Routed</allowedValue>
<allowedValue>DHCP_Spoofed</allowedValue>
<allowedValue>PPPOE_Bridged</allowedValue>
<allowedValue>PPTP_Relay</allowedValue>
<allowedValue>L2TP_Relay</allowedValue>
<allowedValue>PPPOE_Relay</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="yes">
<name>ConnectionStatus</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>Unconfigured</allowedValue>
<allowedValue>Connecting</allowedValue>
<allowedValue>Authenticating</allowedValue>
<allowedValue>Connected</allowedValue>
<allowedValue>PendingDisconnect</allowedValue>
<allowedValue>Disconnecting</allowedValue>
<allowedValue>Disconnected</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>Uptime</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UserName</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>Password</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>UpstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DownstreamMaxBitRate</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>LastConnectionError</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>ERROR_NONE</allowedValue>
<allowedValue>ERROR_ISP_TIME_OUT</allowedValue>
<allowedValue>ERROR_COMMAND_ABORTED</allowedValue>
<allowedValue>ERROR_NOT_ENABLED_FOR_INTERNET</allowedValue>
<allowedValue>ERROR_BAD_PHONE_NUMBER</allowedValue>
<allowedValue>ERROR_USER_DISCONNECT</allowedValue>
<allowedValue>ERROR_ISP_DISCONNECT</allowedValue>
<allowedValue>ERROR_IDLE_DISCONNECT</allowedValue>
<allowedValue>ERROR_FORCED_DISCONNECT</allowedValue>
<allowedValue>ERROR_SERVER_OUT_OF_RESOURCES</allowedValue>
<allowedValue>ERROR_RESTRICTED_LOGON_HOURS</allowedValue>
<allowedValue>ERROR_ACCOUNT_DISABLED</allowedValue>
<allowedValue>ERROR_ACCOUNT_EXPIRED</allowedValue>
<allowedValue>ERROR_PASSWORD_EXPIRED</allowedValue>
<allowedValue>ERROR_AUTHENTICATION_FAILURE</allowedValue>
<allowedValue>ERROR_NO_DIALTONE</allowedValue>
<allowedValue>ERROR_NO_CARRIER</allowedValue>
<allowedValue>ERROR_NO_ANSWER</allowedValue>
<allowedValue>ERROR_LINE_BUSY</allowedValue>
<allowedValue>ERROR_UNSUPPORTED_BITSPERSECOND</allowedValue>
<allowedValue>ERROR_TOO_MANY_LINE_ERRORS</allowedValue>
<allowedValue>ERROR_IP_CONFIGURATION</allowedValue>
<allowedValue>ERROR_UNKNOWN</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>AutoDisconnectTime</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>IdleDisconnectTime</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PPPAuthenticationProtocol</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>RSIPAvailable</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>NATEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>ExternalIPAddress</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>PortMappingNumberOfEntries</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingEnabled</name>
<dataType>boolean</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingLeaseDuration</name>
<dataType>ui4</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>RemoteHost</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>ExternalPort</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>InternalPort</name>
<dataType>ui2</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingProtocol</name>
<dataType>string</dataType>
<allowedValueList>
<allowedValue>TCP</allowedValue>
<allowedValue>UDP</allowedValue>
</allowedValueList>
</stateVariable>
<stateVariable sendEvents="no">
<name>InternalClient</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>PortMappingDescription</name>
<dataType>string</dataType>
</stateVariable>
</serviceStateTable>
</scpd>
<?xml version="1.0"?>
<root xmlns="urn:schemas-upnp-org:device-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<URLBase>http://<!-- #echo var="UPNP_SERVER_IP" --></URLBase>
<device>
<deviceType>urn:schemas-wifialliance-org:device:WFADevice:1</deviceType>
<friendlyName><!-- #echo var="_PROD_FRIENDLY_NAME" --> (<!-- #echo var="_BOARD_SERIAL_NBR" -->)</friendlyName>
<manufacturer><!-- #echo var="_COMPANY_NAME" --></manufacturer>
<manufacturerURL><!-- #echo var="_COMPANY_URL" --></manufacturerURL>
<modelDescription><!-- #echo var="_PROD_DESCRIPTION" --></modelDescription>
<modelName><!-- #echo var="_PROD_NAME" --></modelName>
<modelNumber><!-- #echo var="_PROD_NUMBER" --></modelNumber>
<modelURL><!-- #echo var="_PROD_URL" --></modelURL>
<serialNumber><!-- #echo var="_BOARD_SERIAL_NBR" --></serialNumber>
<UDN><!-- #exec cgi="includeUDN(WFA)" --></UDN>
<serviceList>
<!-- #exec cgi="includeWFAWLANConfig(WFA)" --></serviceList>
<presentationURL>/</presentationURL>
</device>
</root>

<?xml version="1.0"?>
<scpd xmlns="urn:schemas-upnp-org:service-1-0">
<specVersion>
<major>1</major>
<minor>0</minor>
</specVersion>
<actionList>
<action>
<name>GetDeviceInfo</name>
<argumentList>
<argument>
<name>NewDeviceInfo</name>
<direction>out</direction>
<relatedStateVariable>DeviceInfo</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>PutMessage</name>
<argumentList>
<argument>
<name>NewInMessage</name>
<direction>in</direction>
<relatedStateVariable>InMessage</relatedStateVariable>
</argument>
<argument>
<name>NewOutMessage</name>
<direction>out</direction>
<relatedStateVariable>OutMessage</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>PutWLANResponse</name>
<argumentList>
<argument>
<name>NewMessage</name>
<direction>in</direction>
<relatedStateVariable>Message</relatedStateVariable>
</argument>
<argument>
<name>NewWLANEventType</name>
<direction>in</direction>
<relatedStateVariable>WLANEventType</relatedStateVariable>
</argument>
<argument>
<name>NewWLANEventMAC</name>
<direction>in</direction>
<relatedStateVariable>WLANEventMAC</relatedStateVariable>
</argument>
</argumentList>
</action>
<action>
<name>SetSelectedRegistrar</name>
<argumentList>
<argument>
<name>NewMessage</name>
<direction>in</direction>
<relatedStateVariable>Message</relatedStateVariable>
</argument>
</argumentList>
</action>
</actionList>
<serviceStateTable>
<stateVariable sendEvents="no">
<name>Message</name>
<dataType>bin.base64</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>InMessage</name>
<dataType>bin.base64</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>OutMessage</name>
<dataType>bin.base64</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>DeviceInfo</name>
<dataType>bin.base64</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>APSettings</name>
<dataType>bin.base64</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>APStatus</name>
<dataType>ui1</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>STASettings</name>
<dataType>bin.base64</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>STAStatus</name>
<dataType>ui1</dataType>
</stateVariable>
<stateVariable sendEvents="yes">
<name>WLANEvent</name>
<dataType>bin.base64</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>WLANEventType</name>
<dataType>ui1</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>WLANEventMAC</name>
<dataType>string</dataType>
</stateVariable>
<stateVariable sendEvents="no">
<name>WLANResponse</name>
<dataType>bin.base64</dataType>
</stateVariable>
</serviceStateTable>
</scpd>

config maxage=1800 writemode=natonly safenat=enabled onlydefault=enabled
debug traceconfig level=0
<vdslShapes version="1.0">

	<vdslShape name="A_NUS0">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "2">
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_32">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "6">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_36">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  49" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  81" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "10">
			<breakPointVdsl toneIndex="   7" psd=" -385"></breakPointVdsl>
			<breakPointVdsl toneIndex="  36" psd=" -385"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   49" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   36"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_40">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  49" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  81" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "14">
			<breakPointVdsl toneIndex="   7" psd=" -390"></breakPointVdsl>
			<breakPointVdsl toneIndex="  40" psd=" -390"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   49" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   40"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_44">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  49" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  81" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "18">
			<breakPointVdsl toneIndex="   7" psd=" -394"></breakPointVdsl>
			<breakPointVdsl toneIndex="  44" psd=" -394"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   49" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   44"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_48">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  49" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  81" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "22">
			<breakPointVdsl toneIndex="   7" psd=" -398"></breakPointVdsl>
			<breakPointVdsl toneIndex="  48" psd=" -398"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   49" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   48"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_52">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "26">
			<breakPointVdsl toneIndex="   7" psd=" -401"></breakPointVdsl>
			<breakPointVdsl toneIndex="  52" psd=" -401"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   52"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_56">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "30">
			<breakPointVdsl toneIndex="   7" psd=" -404"></breakPointVdsl>
			<breakPointVdsl toneIndex="  56" psd=" -404"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   56"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_60">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "34">
			<breakPointVdsl toneIndex="   7" psd=" -407"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -407"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_64">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "38">
			<breakPointVdsl toneIndex="   7" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex="  63" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   63"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_EU_128">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex=" 138" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 170" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5323" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="9" annexUs0      = "42">
			<breakPointVdsl toneIndex="  12" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 123" psd=" -438"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="5343" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="  138" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5323"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="   12" endTone = "  123"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5343" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_VDSL1_FTTEX_ANSI_M1">

		<limitingMaskDn nrOfBreakPoints="6" >
			<breakPointVdsl toneIndex="  33" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="4" annexUs0      = "2">
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="2">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_VDSL1_FTTEX_ANSI_M2">

		<limitingMaskDn nrOfBreakPoints="6" >
			<breakPointVdsl toneIndex="  33" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -534"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="4" annexUs0      = "2">
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="2">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_VDSL1_FTTCAB_ANSI_M1">

		<limitingMaskDn nrOfBreakPoints="4" >
			<breakPointVdsl toneIndex="  33" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="4" annexUs0      = "2">
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="2">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_VDSL1_FTTCAB_ANSI_M2">

		<limitingMaskDn nrOfBreakPoints="6" >
			<breakPointVdsl toneIndex="  33" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -534"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="4" annexUs0      = "2">
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="2">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_VDSL1_FTTEX_ANSI_M1_e">

		<limitingMaskDn nrOfBreakPoints="8" >
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3932" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "6">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  34" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 3932"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   34"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_VDSL1_FTTEX_ANSI_M2_e">

		<limitingMaskDn nrOfBreakPoints="8" >
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -534"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3932" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "6">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  34" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 3932"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   34"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_VDSL1_FTTCAB_ANSI_M1_e">

		<limitingMaskDn nrOfBreakPoints="6" >
			<breakPointVdsl toneIndex="  65" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3932" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "6">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  34" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 3932"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   34"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="A_VDSL1_FTTCAB_ANSI_M2_e">

		<limitingMaskDn nrOfBreakPoints="8" >
			<breakPointVdsl toneIndex="  65" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -534"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3932" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "6">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  34" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -540"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -540"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 3932"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   34"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_1, 998-M1x-A">

		<limitingMaskDn nrOfBreakPoints="10" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 521" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 580" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "5">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_2, 998-M1x-B">

		<limitingMaskDn nrOfBreakPoints="10" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 521" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 580" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "13">
			<breakPointVdsl toneIndex="  28" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="   28" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_3, 998-M1-NUS0">

		<limitingMaskDn nrOfBreakPoints="10" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 521" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 580" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="4" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="2">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_4, 998-M2x-A">

		<limitingMaskDn nrOfBreakPoints="10" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "5">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -590"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_5, 998-M2x-M">

		<limitingMaskDn nrOfBreakPoints="10" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "9">
			<breakPointVdsl toneIndex="   7" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -590"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_6, 998-M2x-B">

		<limitingMaskDn nrOfBreakPoints="10" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "13">
			<breakPointVdsl toneIndex="  28" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -590"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="   28" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_7, 998-M2x-NUS0">

		<limitingMaskDn nrOfBreakPoints="10" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="5" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -590"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="2">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_8, 998E17-M2x-NUS0">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="3256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4081" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2783" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2784" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3236" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 3256" endTone = " 4081"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2783"></vdslToneGroup>
		<vdslToneGroup startTone=" 2784" endTone = " 3236"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_9, 998E17-M2x-NUS0-M">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="3256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4081" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2783" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2784" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3236" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 3256" endTone = " 4081"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2783"></vdslToneGroup>
		<vdslToneGroup startTone=" 2784" endTone = " 3236"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_10, 998ADE17-M2x-NUS0-M">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4081" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="5" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -590"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 4081"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="2">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_11, 998ADE17-M2x-A">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4081" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "5">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -590"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 4081"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_12, 998ADE17-M2x-B">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4081" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "13">
			<breakPointVdsl toneIndex="  28" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -590"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 4081"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="   28" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_13, 998E30-M2x-NUS0">

		<limitingMaskDn nrOfBreakPoints="14" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="3256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4964" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5782" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="9" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2783" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2784" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3236" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4984" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5762" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="4">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 3256" endTone = " 4964"></vdslToneGroup>
		<vdslToneGroup startTone=" 5782" endTone = " 6947"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2783"></vdslToneGroup>
		<vdslToneGroup startTone=" 2784" endTone = " 3236"></vdslToneGroup>
		<vdslToneGroup startTone=" 4984" endTone = " 5762"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_14, 998E30-M2x-M">

		<limitingMaskDn nrOfBreakPoints="14" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="3256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4964" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5782" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="9" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2783" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2784" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3236" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4984" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5762" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="4">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 3256" endTone = " 4964"></vdslToneGroup>
		<vdslToneGroup startTone=" 5782" endTone = " 6947"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2783"></vdslToneGroup>
		<vdslToneGroup startTone=" 2784" endTone = " 3236"></vdslToneGroup>
		<vdslToneGroup startTone=" 4984" endTone = " 5762"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_15, 998ADE30-M2x-NUS0-M">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5762" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="5782" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5762"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5782" endTone = " 6947"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B8_16, 998ADE30-M2x-NUS0-A">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -543"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -594"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -584"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -563"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5762" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="5782" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 5762"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 5782" endTone = " 6947"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_1, 997-M1c-A-7">

		<limitingMaskDn nrOfBreakPoints="7" >
			<breakPointVdsl toneIndex="  33" psd=" -710"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 521" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 579" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 685" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1193" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1625" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="4" annexUs0      = "5">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 706" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1173" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  685"></vdslToneGroup>
		<vdslToneGroup startTone=" 1193" endTone = " 1625"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="2">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  706" endTone = " 1173"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_2, 997-M1x-M-8">

		<limitingMaskDn nrOfBreakPoints="10" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 521" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 580" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 685" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1193" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1625" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "9">
			<breakPointVdsl toneIndex="   7" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 706" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1173" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1645" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2048" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   65" endTone = "  685"></vdslToneGroup>
		<vdslToneGroup startTone=" 1193" endTone = " 1625"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  706" endTone = " 1173"></vdslToneGroup>
		<vdslToneGroup startTone=" 1645" endTone = " 2048"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_3, 997-M1x-M">

		<limitingMaskDn nrOfBreakPoints="10" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 521" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 580" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 685" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1193" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1625" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "9">
			<breakPointVdsl toneIndex="   7" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 706" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1173" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1645" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   65" endTone = "  685"></vdslToneGroup>
		<vdslToneGroup startTone=" 1193" endTone = " 1625"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  706" endTone = " 1173"></vdslToneGroup>
		<vdslToneGroup startTone=" 1645" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_4, 997-M2x-M-8">

		<limitingMaskDn nrOfBreakPoints="7" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 685" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1193" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1625" psd=" -575"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "9">
			<breakPointVdsl toneIndex="   7" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 706" psd=" -539"></breakPointVdsl>
			<breakPointVdsl toneIndex="1173" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1645" psd=" -575"></breakPointVdsl>
			<breakPointVdsl toneIndex="2048" psd=" -584"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   65" endTone = "  685"></vdslToneGroup>
		<vdslToneGroup startTone=" 1193" endTone = " 1625"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  706" endTone = " 1173"></vdslToneGroup>
		<vdslToneGroup startTone=" 1645" endTone = " 2048"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_5, 997-M2x-A">

		<limitingMaskDn nrOfBreakPoints="7" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 685" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1193" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1625" psd=" -575"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "5">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 706" psd=" -539"></breakPointVdsl>
			<breakPointVdsl toneIndex="1173" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1645" psd=" -575"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  685"></vdslToneGroup>
		<vdslToneGroup startTone=" 1193" endTone = " 1625"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  706" endTone = " 1173"></vdslToneGroup>
		<vdslToneGroup startTone=" 1645" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_6, 997-M2x-M">

		<limitingMaskDn nrOfBreakPoints="7" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 685" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1193" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1625" psd=" -575"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "9">
			<breakPointVdsl toneIndex="   7" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -410"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 706" psd=" -539"></breakPointVdsl>
			<breakPointVdsl toneIndex="1173" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1645" psd=" -575"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   65" endTone = "  685"></vdslToneGroup>
		<vdslToneGroup startTone=" 1193" endTone = " 1625"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  706" endTone = " 1173"></vdslToneGroup>
		<vdslToneGroup startTone=" 1645" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_7, HPE17-M1-NUS0">

		<limitingMaskDn nrOfBreakPoints="4" >
			<breakPointVdsl toneIndex="1645" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2338" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4081" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="4" annexUs0      = "1">
			<breakPointVdsl toneIndex="2358" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2783" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2784" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3236" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone=" 1645" endTone = " 2338"></vdslToneGroup>
		<vdslToneGroup startTone=" 3256" endTone = " 4081"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="2">
		<vdslToneGroup startTone=" 2358" endTone = " 2783"></vdslToneGroup>
		<vdslToneGroup startTone=" 2784" endTone = " 3236"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_8, HPE30-M1-NUS0">

		<limitingMaskDn nrOfBreakPoints="6" >
			<breakPointVdsl toneIndex="1645" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2338" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4964" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5782" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "1">
			<breakPointVdsl toneIndex="2358" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2783" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2784" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3236" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4984" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="5762" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone=" 1645" endTone = " 2338"></vdslToneGroup>
		<vdslToneGroup startTone=" 3256" endTone = " 4964"></vdslToneGroup>
		<vdslToneGroup startTone=" 5782" endTone = " 6947"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone=" 2358" endTone = " 2783"></vdslToneGroup>
		<vdslToneGroup startTone=" 2784" endTone = " 3236"></vdslToneGroup>
		<vdslToneGroup startTone=" 4984" endTone = " 5762"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_9, 997E17-M2x-A">

		<limitingMaskDn nrOfBreakPoints="11" >
			<breakPointVdsl toneIndex="  33" psd=" -655"></breakPointVdsl>
			<breakPointVdsl toneIndex="  53" psd=" -655"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 109" psd=" -520"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 110" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 685" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1193" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1625" psd=" -575"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3236" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="9" annexUs0      = "5">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 706" psd=" -539"></breakPointVdsl>
			<breakPointVdsl toneIndex="1173" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1645" psd=" -575"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4071" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   33" endTone = "  685"></vdslToneGroup>
		<vdslToneGroup startTone=" 1193" endTone = " 1625"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 3236"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  706" endTone = " 1173"></vdslToneGroup>
		<vdslToneGroup startTone=" 1645" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 3256" endTone = " 4071"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_10, 997E30-M2x-NUS0">

		<limitingMaskDn nrOfBreakPoints="13" >
			<breakPointVdsl toneIndex="  33" psd=" -655"></breakPointVdsl>
			<breakPointVdsl toneIndex="  53" psd=" -655"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 109" psd=" -520"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 110" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 685" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex="1193" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1625" psd=" -575"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3236" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4532" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6251" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="9" annexUs0      = "1">
			<breakPointVdsl toneIndex=" 706" psd=" -539"></breakPointVdsl>
			<breakPointVdsl toneIndex="1173" psd=" -561"></breakPointVdsl>
			<breakPointVdsl toneIndex="1645" psd=" -575"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="3256" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4512" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6271" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="4">
		<vdslToneGroup startTone="   33" endTone = "  685"></vdslToneGroup>
		<vdslToneGroup startTone=" 1193" endTone = " 1625"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 3236"></vdslToneGroup>
		<vdslToneGroup startTone=" 4532" endTone = " 6251"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="  706" endTone = " 1173"></vdslToneGroup>
		<vdslToneGroup startTone=" 1645" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 3256" endTone = " 4512"></vdslToneGroup>
		<vdslToneGroup startTone=" 6271" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="B7_BT_ANFP">

		<limitingMaskDn nrOfBreakPoints="7" >
			<breakPointVdsl toneIndex="  33" psd=" -710"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 521" psd=" -530"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 561" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 685" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1193" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1625" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "5">
			<breakPointVdsl toneIndex="   7" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -380"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 706" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1173" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1645" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="2">
		<vdslToneGroup startTone="   33" endTone = "  685"></vdslToneGroup>
		<vdslToneGroup startTone=" 1193" endTone = " 1625"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  706" endTone = " 1173"></vdslToneGroup>
		<vdslToneGroup startTone=" 1645" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="C_138_b">

		<limitingMaskDn nrOfBreakPoints="6" >
			<breakPointVdsl toneIndex="  33" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4197" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "7">
			<breakPointVdsl toneIndex="   7" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4207" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 4197"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 4207" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="C_276_b">

		<limitingMaskDn nrOfBreakPoints="6" >
			<breakPointVdsl toneIndex="  65" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4197" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="8" annexUs0      = "11">
			<breakPointVdsl toneIndex="   7" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4207" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 4197"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="4">
		<vdslToneGroup startTone="    7" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 4207" endTone = " 6947"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="C_138_co">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  33" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  65" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4197" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "15">
			<breakPointVdsl toneIndex="   7" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex="  32" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   33" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 4197"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   32"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="C_276_co">

		<limitingMaskDn nrOfBreakPoints="12" >
			<breakPointVdsl toneIndex="  65" psd=" -580"></breakPointVdsl>
			<breakPointVdsl toneIndex="  97" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 256" psd=" -400"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 376" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 512" psd=" -515"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 819" psd=" -532"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -582"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -572"></breakPointVdsl>
			<breakPointVdsl toneIndex="1245" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -550"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4197" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="7" annexUs0      = "19">
			<breakPointVdsl toneIndex="   7" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex="  60" psd=" -500"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 880" psd=" -547"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -562"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -583"></breakPointVdsl>
			<breakPointVdsl toneIndex="2319" psd=" -590"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="   65" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 4197"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="    7" endTone = "   60"></vdslToneGroup>
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

	<vdslShape name="C_TCMISDN">

		<limitingMaskDn nrOfBreakPoints="6" >
			<breakPointVdsl toneIndex=" 149" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex=" 859" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1216" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1961" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2793" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4197" psd=" -600"></breakPointVdsl>
		</limitingMaskDn>

		<limitingMaskUp nrOfBreakPoints="6" annexUs0      = "3">
			<breakPointVdsl toneIndex=" 880" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1196" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="1981" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="2773" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="4207" psd=" -600"></breakPointVdsl>
			<breakPointVdsl toneIndex="6947" psd=" -600"></breakPointVdsl>
		</limitingMaskUp>

		<bandPlanDn noOfToneGroups="3">
		<vdslToneGroup startTone="  149" endTone = "  859"></vdslToneGroup>
		<vdslToneGroup startTone=" 1216" endTone = " 1961"></vdslToneGroup>
		<vdslToneGroup startTone=" 2793" endTone = " 4197"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanDn>

		<bandPlanUp noOfToneGroups="3">
		<vdslToneGroup startTone="  880" endTone = " 1196"></vdslToneGroup>
		<vdslToneGroup startTone=" 1981" endTone = " 2773"></vdslToneGroup>
		<vdslToneGroup startTone=" 4207" endTone = " 6947"></vdslToneGroup>
		<vdslToneGroup startTone="    0" endTone = "    0"></vdslToneGroup>
		</bandPlanUp>

	</vdslShape>

</vdslShapes>
add name video vid 836
add name data vid 835
add name mgmt vid 837
add name dummy vid 911
priomap config entry=prio_0_7_2vlan priomap=1,1,2,2,0,0,3,1
priomap config entry=prio_8_15_2vlan priomap=4,4,5,5,5,5,5,6
ifadd intf br_video name video untagged enabled
ifadd intf vdsl2    name video untagged disabled
ifadd intf bri_ge   name video untagged disabled
ifadd intf bri_ge name mgmt untagged disabled 
ifadd intf bri_ge name data untagged disabled
ifadd intf vdsl2 name mgmt untagged disabled
ifadd intf vdsl2 name data untagged disabled
ifadd intf OBC name mgmt untagged disabled
ifadd intf OBC name data untagged disabled
ifadd intf OBC name video untagged disabled
ifadd intf vdsl2 name dummy untagged enabled
ifadd intf bri_ge name dummy untagged enabled
:eth bridge ifconfig intf vdsl2 vlan dummy
:eth bridge ifconfig intf bri_ge vlan dummy
ifdelete intf br_video name default
ifdelete intf bri_ge name default
ifdelete intf vdsl2 name default
tone patterntable add id=1 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=2 maxloops=0 nextentryafterloops=0
tone patterntable add id=2 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=1 maxloops=0 nextentryafterloops=0
tone patterntable add id=161 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=162 maxloops=0 nextentryafterloops=0
tone patterntable add id=162 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=161 maxloops=0 nextentryafterloops=0
tone patterntable add id=171 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=172 maxloops=0 nextentryafterloops=0
tone patterntable add id=172 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=173 maxloops=0 nextentryafterloops=0
tone patterntable add id=173 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=600 nextentry=174 maxloops=0 nextentryafterloops=0
tone patterntable add id=174 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=1000 nextentry=171 maxloops=0 nextentryafterloops=0
tone patterntable add id=181 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=500 nextentry=182 maxloops=0 nextentryafterloops=0
tone patterntable add id=182 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=500 nextentry=181 maxloops=0 nextentryafterloops=0
tone patterntable add id=191 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=1000 nextentry=192 maxloops=0 nextentryafterloops=0
tone patterntable add id=192 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=4000 nextentry=191 maxloops=0 nextentryafterloops=0
tone patterntable add id=201 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=1000 nextentry=202 maxloops=0 nextentryafterloops=0
tone patterntable add id=202 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=1000 nextentry=201 maxloops=0 nextentryafterloops=0
tone patterntable add id=211 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=400 nextentry=212 maxloops=0 nextentryafterloops=0
tone patterntable add id=212 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=100 nextentry=213 maxloops=0 nextentryafterloops=0
tone patterntable add id=213 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=250 nextentry=214 maxloops=0 nextentryafterloops=0
tone patterntable add id=214 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=100 nextentry=215 maxloops=0 nextentryafterloops=0
tone patterntable add id=215 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=150 nextentry=0 maxloops=0 nextentryafterloops=0
tone patterntable add id=216 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=14000 nextentry=211 maxloops=0 nextentryafterloops=0
tone patterntable add id=221 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=400 nextentry=222 maxloops=0 nextentryafterloops=0
tone patterntable add id=222 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=223 maxloops=0 nextentryafterloops=0
tone patterntable add id=223 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=400 nextentry=224 maxloops=0 nextentryafterloops=0
tone patterntable add id=224 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=200 nextentry=225 maxloops=0 nextentryafterloops=0
tone patterntable add id=225 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=800 nextentry=226 maxloops=0 nextentryafterloops=0
tone patterntable add id=226 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=4000 nextentry=221 maxloops=0 nextentryafterloops=0
tone patterntable add id=231 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=5000 nextentry=232 maxloops=0 nextentryafterloops=0
tone patterntable add id=232 tone=on freq1=425 power1=-17 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=5000 nextentry=231 maxloops=0 nextentryafterloops=0
tone patterntable add id=65 tone=on freq1=425 power1=-6 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=100 nextentry=66 maxloops=0 nextentryafterloops=0
tone patterntable add id=66 tone=on freq1=0 power1=0 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=100 nextentry=67 maxloops=0 nextentryafterloops=0
tone patterntable add id=67 tone=on freq1=425 power1=-6 freq2=0 power2=0 freq3=0 power3=0 freq4=0 power4=0 duration=100 nextentry=0 maxloops=0 nextentryafterloops=0

tone descrtable add tone=none status=enabled delay=0 patternentryid=0 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0

tone descrtable add tone=fastbusy         status=enabled delay=0 patternentryid=161 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=rejection        status=enabled delay=0 patternentryid=161 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=release          status=enabled delay=0 patternentryid=161 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=warning          status=enabled delay=0 patternentryid=161 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=congestion       status=enabled delay=0 patternentryid=161 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=stutterdial      status=enabled delay=0 patternentryid=161 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=specialdial      status=enabled delay=0 patternentryid=161 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=startdialtimeout status=enabled delay=0 patternentryid=1 file="" filerepeat=0 text="" maxduration=40000 nexttone= "" repeatafter=0
tone descrtable add tone=continoustone    status=enabled delay=0 patternentryid=231 file="" filerepeat=0 text="" maxduration=0 nexttone= "" repeatafter=0

tone descrtable add tone=dial status=enabled delay=0 patternentryid=171 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0

tone descrtable add tone=busy status=enabled delay=0 patternentryid=181 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0

tone descrtable add tone=ringback status=enabled delay=0 patternentryid=191 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0

tone descrtable add tone=confirmation status=enabled delay=0 patternentryid=201 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0

tone descrtable add tone=callwaiting status=enabled delay=0 patternentryid=211 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=14000

tone descrtable add tone=ccbs status=enabled delay=0 patternentryid=221 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0

tone descrtable add tone=remotecallhold    status=disabled delay=0 patternentryid=0 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=callhold          status=disabled delay=0 patternentryid=0 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=remotecallwaiting status=disabled delay=0 patternentryid=0 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0
tone descrtable add tone=mwi status=enabled delay=400 patternentryid=65 file="" filerepeat=0 text="" maxduration=3000 nexttone=dial repeatafter=1000
tone descrtable add tone=bargein           status=disabled delay=0 patternentryid=0 file="" filerepeat=0 text="" maxduration=0 nexttone="" repeatafter=0

tone eventtable modify eventid=21 tone=startdialtimeout

sip inboundauth config BYE=disabled INFO=disabled INVITE=disabled NOTIFY=disabled OPTIONS disabled 
sip inboundauth config PING disabled PRACK disabled REFER disabled SUBSCRIBE disabled UPDATE disabled
sip config useragentdomain modemtelecom.homenet.telecomitalia.it 
sip config phonecontext +39 
sip config primregaddr modemtelecom.homenet.telecomitalia.it 
sip config realm modemtelecom.homenet.telecomitalia.it 
sip config timertf 12000
sip config proxyport 5065 
sip config regport 5065
sip config primproxyaddr=modemtelecom.homenet.telecomitalia.it 
sip config PRACK when_supported
sip config stop_register_on_403 enabled
sip config privacy=strict session-expires=0 min-se=0 regexpire=3600 regexpire_Tbefore=5 expires=0
sip config other4xx5xx6xxwaiting=60 403waiting=20 400503waiting=60 401407waiting=0 reinvite_at_cgfax_detect=disabled CWreply=180
sip config rtpmapstaticPT=disabled transport=UDP reinvite_stop_audio=disabled clirformat=standard DTMF*#inINFO=1011
sip config clip_consider_displayname=yes sdp_ptime=notsent replace#=enabled symmetriccodec=enabled SIPURI_port=disabled rport=disabled
sip config SDP_username=default t38portincrement=0 ping=0 response420=disabled register-backoff-timer=60 stickyoutbproxy=enabled 
sip config failbehaviour=stop
sip config SDP_username_per_UA=disabled transport_in_contact=disabled mwi-resubscribe-delay=0
sip config timer_f_expired_waiting=0 stop_register_on_408=disabled stop_register_on_timerfexpired=disabled distinct_t38_port=enabled
sip config provisional_timer=1200 realmcheck=disabled
sip config stop_register_on_403=disabled
sip config TISpecificTag SIPSERVER
sip config teluri no
sip config omit_displayname=yes
sip config symmetricDynRTPPayload=enabled
sip config regpersistency=disabled

sip2fxo config session-expires=130 min-se=100

codec config type=g711a ptime=20 vad=disabled priority=3 status=enabled
codec config type=g711u ptime=20 vad=disabled priority=4 status=disabled
codec config type=g729 ptime=20 vad=disabled priority=2 status=enabled
codec config type=g722 ptime=20 vad=disabled priority=1 status=enabled
codec config type=amr vad=disabled priority=4 status=disabled
codec dynamic config type=rfc2833 payloadtype=101
codec dynamic config type=g726_40 payloadtype=102
codec dynamic config type=ilbc payloadtype=103
codec dynamic config type=amr payloadtype=104

config sign_internal=external
config rtp_portrange=1024-1151
config rtcp_interval=5000
config interfaces_enable=15
config pstnsoftswitchover enabled
config delayeddisconnect disabled
config delayeddisconnecttimer 0
config intf loop 
config static_intf enabled
config autofxo=enabled digitrelay=rfc2833 click2dial_ports=all endofnumber=# 
config ringmuteduration=0 feature-mngt=internal nocallsetupmsg=never 
config syslogscope=all no-answer-timer=200

qos config type Signaling qosfield DSCP dscp cs5
qos config type Realtime qosfield DSCP dscp cs5

services config cw_reject_scope common
services assign type keypad servicecode 11
services provision type keypad
services config keypad_associate_cli **1*
services config keypad_cli_del_btw_fxs **1#
services config keypad_cli_query **762#
services config keypad_pos_active  **761#
services config keypad_pos_deactive  **760#
services config keypad_pos_query **#76#
services config keypad_wifi_on  **941#
services config keypad_wifi_off **940#
services config mwi_phone both
services provision type keypad
services activate type keypad

dialplan add prefix=*63#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4  maximumdigits=4 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=#63#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4  maximumdigits=4 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*#63#    defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=5  maximumdigits=5 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*#64#    defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=5  maximumdigits=5 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*63*1#   defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=6  maximumdigits=6 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*63*0*1# defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=8  maximumdigits=8 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*63*0*2# defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=8  maximumdigits=8 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*63*0*3# defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=8  maximumdigits=8 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*63*0*4# defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=8  maximumdigits=8 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*63*0*5# defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=8  maximumdigits=8 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=#63*1#   defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=6  maximumdigits=6 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*63*2#   defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=6  maximumdigits=6 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=#63*2#   defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=6  maximumdigits=6 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*63*3#   defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=6  maximumdigits=6 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=#63*3#   defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=6  maximumdigits=6 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*43#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4  maximumdigits=4 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=#43#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4  maximumdigits=4 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*#43#    defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=5  maximumdigits=5 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon

dialplan add prefix=#24#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4  maximumdigits=4 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*#24#    defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=5  maximumdigits=5 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon

dialplan add prefix=*33#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4  maximumdigits=4 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*#33#    defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=5  maximumdigits=5 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon

dialplan add prefix=#28#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4  maximumdigits=4 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*#28#    defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=5  maximumdigits=5 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon

dialplan add prefix=#61#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4  maximumdigits=4 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*#61#    defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=5  maximumdigits=5 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon

dialplan add prefix=#21#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4  maximumdigits=4 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon
dialplan add prefix=*#21#    defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=5  maximumdigits=5 posofmodify=0 remnumdigits=0 insert=NA rescan=no data=no action=ROUTE_excl_eon

dialplan add prefix=*67#     defaultport=VoIP fallbackport=NA priority=NA fallback=disabled minimumdigits=4 maximumdigits=30 posofmodify=0 remnumdigits=0 rescan=no data=no action=ROUTE_incl_eon

services provision type=transfer
services provision type=hold
services provision type=waiting
services provision type=clip
services provision type=clir
services provision type=3pty
services provision type=mwi
services provision type=bargein

services deactivate type=transfer
services activate type=hold
services activate type=waiting
services activate type=clip
services deactivate type=clir
services activate type=3pty
services activate type=mwi
services withdraw type bargein

services assign type transfer servicecode AAA
services assign type hold servicecode AAB
services assign type waiting servicecode AAC
services assign type clip servicecode ABA
services assign type clir servicecode DAA
services assign type 3pty servicecode ABC
services assign type mwi servicecode ACA
services assign type bargein servicecode ACB

services assign type acr servicecode BCB
services assign type callreturn servicecode BCC
services assign type ccbs servicecode CAA
services assign type cfbs servicecode CAB
services assign type cfnr servicecode CAC
services assign type cfu servicecode CBA
services assign type forcedFXO servicecode CBB
services assign type internalcall servicecode CBC
services assign type mce servicecode CCA
services assign type vmnr servicecode CCB
services assign type warmline servicecode CCC

services config hfhf_feature=enabled
services config mwi_network=unsollicited
services config cw_timer 120

fxsport config interdigitOpen=3000
fxsport config interdigit=3000
fxsport config widebandsupport enabled

services soc socflush
services soc config Registerrecalltimer=0
services soc config TOAfterActiveCallEnded=0

services soc add function=TerminateHeldCall SOC=ignore
services soc add function=RejectIncomingCall SOC=HF0
services soc add function=TerminateActiveAndSwitchToHeld SOC=HF1
services soc add function=TerminateActiveAndSwitchToWaiting SOC=HF1
services soc add function=NoActiveCallRetrieveHeld SOC=HF
services soc add function=HoldActiveCallAndEnableCallSetup SOC=HF
services soc add function=From3PartyDropLastParty SOC=ignore
services soc add function=SwitchBetweenActiveAndHeld SOC=HF2
services soc add function=SwitchBetweenActiveAndWaiting SOC=HF2
services soc add function=Transfer SOC=HF4
services soc add function=CallToBusyUserActivateCCBS SOC=ignore
services soc add function=TerminateActiveAndEnableCallSetup SOC=ignore
services soc add function=From3PartyHoldBAndC SOC=ignore
services soc add function=From3PartyRetreiveBAndC SOC=HF3
services soc add function=From3PartyHoldConf SOC=HF

services 3gpp config 3GPP3PTY enabled
services 3gpp config 3GPP3PTYjoin refer_focus2user  
services 3gpp config 3GPP3PTYFactoryUri sip:conference@factory.telecomitalia.it

numbtransl config Globalnumbpostprocess=disabled
config countrycode=0
sip config privacy=ignore
sip config regexpire_Tbefore=0
numbertranslAC add level 1 areacode +39  action hideareacode   delete 0 executeprefdel insideareacode
numbertranslAC add level 2 areacode + action showareacode   delete 1 prefix 00 executeprefdel insideareacode

config delayeddisconnecttimer=0
config delayeddisconnect=disabled

sip config PRACK=when_supported

sip responsemap delete responsecode=181
sip responsemap delete responsecode=488

profile flush
profile add SIP_URI=**11@modemtelecom.homenet.telecomitalia.it voiceport=FXS1 username=**11 password=11 enable=enabled shouldregister=no
profile add SIP_URI=**12@modemtelecom.homenet.telecomitalia.it voiceport=FXS2 username=**12 password=12 enable=enabled shouldregister=no
profile add SIP_URI=**13@modemtelecom.homenet.telecomitalia.it voiceport=DECT1 username=**13 password=13 enable=enabled shouldregister=no
profile add SIP_URI=**14@modemtelecom.homenet.telecomitalia.it voiceport=DECT2 username=**14 password=14 enable=enabled shouldregister=no
profile add SIP_URI=**15@modemtelecom.homenet.telecomitalia.it voiceport=DECT3 username=**15 password=15 enable=enabled shouldregister=no
profile add SIP_URI=**16@modemtelecom.homenet.telecomitalia.it voiceport=DECT4 username=**16 password=16 enable=enabled shouldregister=no
profile add SIP_URI=**17@modemtelecom.homenet.telecomitalia.it voiceport=DECT5 username=**17 password=17 enable=enabled shouldregister=no

fax config VBDcodec G711A transport=t38

profile add SIP_URI=FXO voiceport=SIMFXO username=FXO password=FXO enable=enabled outboundproxy=127.0.0.1 outboundproxyport=5090 shouldregister=no

cac config max#portsperprofile all
services soc modify id=6 function=Establish3Party SOC=HF3

fax config VBDcodec G711A transport=t38
